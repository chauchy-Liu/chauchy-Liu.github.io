<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>QT_C++ | 和其光, 同其尘</title><meta name="keywords" content="C++"><meta name="author" content="刘传玺"><meta name="copyright" content="刘传玺"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="QT QT是一个跨平台的应用程序和用户界面框架，用于开发图形用户界面（GUI）应用程序以及命令行工具。https:&#x2F;&#x2F;www.qt.io&#x2F;zh-cn&#x2F; 部署空项目流程 macos系统 1）启动qt creator，并创建新项目 在此处选择CMake  此处无法选择构建时，在qt偏好设置中找qt版本  添加自己安装的qt的目录，在该目录下找&#x2F;opt&#x2F;homebrew&#x2F;Cellar&#x2F;qt&#x2F;6.8.2&#x2F;">
<meta property="og:type" content="article">
<meta property="og:title" content="QT_C++">
<meta property="og:url" content="http://chauchy-liu.github.io/2025/02/24/QT-C/index.html">
<meta property="og:site_name" content="和其光, 同其尘">
<meta property="og:description" content="QT QT是一个跨平台的应用程序和用户界面框架，用于开发图形用户界面（GUI）应用程序以及命令行工具。https:&#x2F;&#x2F;www.qt.io&#x2F;zh-cn&#x2F; 部署空项目流程 macos系统 1）启动qt creator，并创建新项目 在此处选择CMake  此处无法选择构建时，在qt偏好设置中找qt版本  添加自己安装的qt的目录，在该目录下找&#x2F;opt&#x2F;homebrew&#x2F;Cellar&#x2F;qt&#x2F;6.8.2&#x2F;">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Justlovesmile/CDN2/post/cover4.jpg">
<meta property="article:published_time" content="2025-02-24T05:38:55.000Z">
<meta property="article:modified_time" content="2025-10-29T14:07:20.668Z">
<meta property="article:author" content="刘传玺">
<meta property="article:tag" content="C++">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/Justlovesmile/CDN2/post/cover4.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://chauchy-liu.github.io/2025/02/24/QT-C/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="manifest" href="/img/pwa/manifest.json"/><link rel="apple-touch-icon" sizes="180x180" href="/img/pwa/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/img/pwa/32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/img/pwa/16.png"/><link rel="mask-icon" href="/img/pwa/safari-pinned-tab.svg" color="#5bbad5"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'mediumZoom',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'QT_C++',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-10-29 22:07:20'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.2"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/touxiang.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">34</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">27</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">30</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.jsdelivr.net/gh/Justlovesmile/CDN2/post/cover4.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">和其光, 同其尘</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">QT_C++</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-02-24T05:38:55.000Z" title="发表于 2025-02-24 13:38:55">2025-02-24</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-10-29T14:07:20.668Z" title="更新于 2025-10-29 22:07:20">2025-10-29</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/ui%E5%9B%BE%E5%BD%A2%E8%AE%BE%E8%AE%A1/">ui图形设计</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">71.2k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>320分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="QT_C++"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1>QT</h1>
<p>QT是一个跨平台的应用程序和用户界面框架，用于开发图形用户界面（GUI）应用程序以及命令行工具。<a target="_blank" rel="noopener" href="https://www.qt.io/zh-cn/">https://www.qt.io/zh-cn/</a></p>
<h2 id="部署空项目流程">部署空项目流程</h2>
<h2 id="macos系统">macos系统</h2>
<p>1）启动qt creator，并创建新项目<br>
在此处选择CMake<br>
<img src="/2025/02/24/QT-C/QT-C/image-20250225111517457.png" alt="image-20250225111517457"><br>
此处无法选择构建时，在qt偏好设置中找qt版本<br>
<img src="/2025/02/24/QT-C/QT-C/image-20250225111730167.png" alt="image-20250225111730167"><br>
添加自己安装的qt的目录，在该目录下找/opt/homebrew/Cellar/qt/6.8.2/bin/qmake<br>
<img src="/2025/02/24/QT-C/QT-C/image-20250225111855718.png" alt="image-20250225111855718"><br>
再在构建套件中添加新的构建，例如qt-6.8.2, 选择QT版本为自己安装的QT版本。<br>
<img src="/2025/02/24/QT-C/QT-C/image-20250225112222623.png" alt="image-20250225112222623"><br>
完成后可以选择创建项目中的构建了，然后生成如下目录，关掉qt creator，并用vscode打开项目<br>
<img src="/2025/02/24/QT-C/QT-C/image-20250225110321646.png" alt="image-20250225110321646"></p>
<p>2） build：这是项目的构建目录，所有构建输出文件都会存放在这里。</p>
<ul>
<li>.cmake：CMake 生成的内部配置文件目录，包含一些缓存和临时文件。</li>
<li>CMakeFiles：CMake 生成的辅助文件目录，包含构建过程中使用的中间文件和配置文件。
<ul>
<li>project1_autogen：自动生成的文件目录，通常包含由 CMake 自动生成的代码文件。</li>
</ul>
</li>
<li>project1.app：macOS 应用程序包目录，包含构建生成的 macOS 应用程序。
<ul>
<li>Contents：应用程序包的内容目录，包含应用程序的所有资源和可执行文件。</li>
</ul>
<ul>
<li>MacOS：应用程序的可执行文件目录，包含实际的可执行文件。
<ul>
<li>
<p>project1: 可执行文件</p>
</li>
<li>
<p>Info.plist：应用程序的配置信息文件，包含应用程序的元数据。</p>
</li>
</ul>
</li>
<li>cmake_install.cmake：CMake 生成的安装脚本文件，用于安装构建生成的文件。</li>
<li>CMakeCache.txt：CMake 缓存文件，包含项目配置的缓存信息。</li>
<li>compile_commands.json：CMake 生成的编译命令文件，包含编译每个源文件时使用的编译命令，供 C/C++ 扩展使用以提供代码提示。</li>
</ul>
</li>
<li>Makefile：CMake 生成的 Makefile 文件，用于使用 make 工具进行构建。</li>
</ul>
<p>3)vscode配置文件<br>
.vscode目录下</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//c_cpp_properties.json</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;configurations&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Mac&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="comment">// &quot;includePath&quot;: [</span></span><br><span class="line">            <span class="comment">//     &quot;$&#123;workspaceFolder&#125;/**&quot;,</span></span><br><span class="line">            <span class="comment">//     &quot;/opt/homebrew/Cellar/qt/6.8.2/include/**&quot;,</span></span><br><span class="line">            <span class="comment">//     &quot;/opt/homebrew/Cellar/qt/6.8.2/lib/QtWidgets.framework/Headers/**&quot;,</span></span><br><span class="line">            <span class="comment">//     &quot;/opt/anaconda3/include/qt/**&quot;</span></span><br><span class="line">            <span class="comment">// ],</span></span><br><span class="line">            <span class="attr">&quot;defines&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;macFrameworkPath&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/System/Library/Frameworks&quot;</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;compilerPath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/usr/bin/clang&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;cStandard&quot;</span><span class="punctuation">:</span> <span class="string">&quot;c17&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;cppStandard&quot;</span><span class="punctuation">:</span> <span class="string">&quot;c++17&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;intelliSenseMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;macos-clang-arm64&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;compileCommands&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;workspaceFolder&#125;/build/compile_commands.json&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="number">4</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>cppdbg调试</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//launch.json</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="comment">// Use IntelliSense to learn about possible attributes.</span></span><br><span class="line">    <span class="comment">// Hover to view descriptions of existing attributes.</span></span><br><span class="line">    <span class="comment">// For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387</span></span><br><span class="line">    <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0.2.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;configurations&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Launch Debug&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cppdbg&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;request&quot;</span><span class="punctuation">:</span> <span class="string">&quot;launch&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;program&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;workspaceFolder&#125;/build/$&#123;workspaceFolderBasename&#125;.app/Contents/MacOS/$&#123;workspaceFolderBasename&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;stopAtEntry&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;cwd&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;workspaceFolder&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;preLaunchTask&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Build&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;environment&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;externalConsole&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;osx&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;MIMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;lldb&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;linux&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;MIMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;gdb&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;setupCommands&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                    <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Enable pretty-printing for gdb&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;-enable-pretty-printing&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;ignoreFailures&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">                    <span class="punctuation">&#125;</span></span><br><span class="line">                <span class="punctuation">]</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;windows&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;program&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;workspaceFolder&#125;/build/$&#123;workspaceFolderBasename&#125;&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;visualizerFile&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/Users/liuchuanxi/Library/Application Support/Code/User/workspaceStorage/c1a684b63ca8c4024c16455bcff0c27c/tonka3000.qtvsctools/qt.natvis.xml&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>lldb调试</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="comment">// Use IntelliSense to learn about possible attributes.</span></span><br><span class="line">    <span class="comment">// Hover to view descriptions of existing attributes.</span></span><br><span class="line">    <span class="comment">// For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387</span></span><br><span class="line">    <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0.2.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;configurations&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Launch Debug&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;lldb&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;request&quot;</span><span class="punctuation">:</span> <span class="string">&quot;launch&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;program&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;workspaceFolder&#125;/build/$&#123;workspaceFolderBasename&#125;.app/Contents/MacOS/$&#123;workspaceFolderBasename&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="comment">// &quot;stopAtEntry&quot;: false,</span></span><br><span class="line">            <span class="attr">&quot;cwd&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;workspaceFolder&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;preLaunchTask&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Build&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="comment">// &quot;environment&quot;: [],</span></span><br><span class="line">            <span class="comment">// &quot;externalConsole&quot;: false,</span></span><br><span class="line">            <span class="attr">&quot;terminal&quot;</span><span class="punctuation">:</span> <span class="string">&quot;console&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="comment">// &quot;osx&quot;: &#123;</span></span><br><span class="line">            <span class="comment">//     &quot;MIMode&quot;: &quot;lldb&quot;</span></span><br><span class="line">            <span class="comment">// &#125;,</span></span><br><span class="line">            <span class="comment">// &quot;linux&quot;: &#123;</span></span><br><span class="line">            <span class="comment">//     &quot;MIMode&quot;: &quot;gdb&quot;,</span></span><br><span class="line">            <span class="comment">//     &quot;setupCommands&quot;: [</span></span><br><span class="line">            <span class="comment">//         &#123;</span></span><br><span class="line">            <span class="comment">//             &quot;description&quot;: &quot;Enable pretty-printing for gdb&quot;,</span></span><br><span class="line">            <span class="comment">//             &quot;text&quot;: &quot;-enable-pretty-printing&quot;,</span></span><br><span class="line">            <span class="comment">//             &quot;ignoreFailures&quot;: true</span></span><br><span class="line">            <span class="comment">//         &#125;</span></span><br><span class="line">            <span class="comment">//     ]</span></span><br><span class="line">            <span class="comment">// &#125;,</span></span><br><span class="line">            <span class="attr">&quot;windows&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;program&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;workspaceFolder&#125;/build/$&#123;workspaceFolderBasename&#125;&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="comment">// &quot;visualizerFile&quot;: &quot;/Users/liuchuanxi/Library/Application Support/Code/User/workspaceStorage/8a5d47b53b311182bce2c87223499096/tonka3000.qtvsctools/qt.natvis.xml&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//settings.json</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;cmake.sourceDirectory&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;workspaceFolder&#125;/CMakeLists.txt&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="comment">//ui设计引擎</span></span><br><span class="line">    <span class="attr">&quot;qt-ui.customWidgetsDesignerExePath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/opt/homebrew/Cellar/qt/6.8.2/bin/Designer&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>编译</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//tasks.json</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="comment">// for the documentation about the tasks.json format</span></span><br><span class="line">    <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;tasks&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="comment">// 在根文件夹中执行创建文件夹build的命令</span></span><br><span class="line">            <span class="comment">// 除windows系统外执行的命令为`mkdir -p build`</span></span><br><span class="line">            <span class="comment">// windows系统是在powershell中执行命令`mkdir -Force build`</span></span><br><span class="line">            <span class="attr">&quot;label&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Build_dir&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;mkdir&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;shell&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;-p&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;build&quot;</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="comment">// 在build文件夹中调用cmake进行项目配置</span></span><br><span class="line">            <span class="comment">// 除windows系统外执行的命令为`cmake -DCMAKE_BUILD_TYPE=&lt;Debug|Release|RelWithDebInfo|MinSizeRel&gt; ../`</span></span><br><span class="line">            <span class="comment">// windows系统是在visual stuido的环境中执行命令`cmake -DCMAKE_BUILD_TYPE=&lt;Debug|Release|RelWithDebInfo|MinSizeRel&gt;  ../ -G &quot;CodeBlocks - NMake Makefiles&quot;`</span></span><br><span class="line">            <span class="attr">&quot;label&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Cmake&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;shell&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cmake&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;-DCMAKE_BUILD_TYPE=$&#123;input:CMAKE_BUILD_TYPE&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;-DCMAKE_EXPORT_COMPILE_COMMANDS=ON&quot;</span><span class="punctuation">,</span> <span class="comment">// 生成compile_commands.json 供c/c++扩展提示使用</span></span><br><span class="line">                <span class="string">&quot;../&quot;</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;cwd&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;workspaceFolder&#125;/build&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;dependsOn&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;Build_dir&quot;</span> <span class="comment">// 在task `build_dir` 后执行该task</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="comment">// 在build文件夹中调用cmake编译构建debug程序</span></span><br><span class="line">            <span class="comment">// 执行的命令为`cmake --build ./ --target all --`</span></span><br><span class="line">            <span class="comment">//  windows系统如上需要在visual stuido的环境中执行命令</span></span><br><span class="line">            <span class="attr">&quot;label&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Build&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;group&quot;</span><span class="punctuation">:</span> <span class="string">&quot;test&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;shell&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cmake&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;--build&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;./&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;--target&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;all&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;--&quot;</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;cwd&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;workspaceFolder&#125;/build&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;problemMatcher&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$gcc&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;dependsOn&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;Cmake&quot;</span> <span class="comment">// 在task `cmake` 后执行该task</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;label&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Run&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;shell&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;group&quot;</span><span class="punctuation">:</span><span class="string">&quot;build&quot;</span><span class="punctuation">,</span></span><br><span class="line">            </span><br><span class="line">            <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span><span class="string">&quot;./$&#123;workspaceFolderBasename&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;cwd&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;workspaceFolder&#125;/build&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;dependsOn&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;Build&quot;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;inputs&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CMAKE_BUILD_TYPE&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pickString&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;What CMAKE_BUILD_TYPE do you want to create?&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;Debug&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;Release&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;RelWithDebInfo&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;MinSizeRel&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;default&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Debug&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;PLATFORM&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pickString&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;What PLATFORM do you want to create?&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;x86&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;amd64&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;arm&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;x86_arm&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;x86_amd64&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;amd64_x86&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;amd64_arm&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;default&quot;</span><span class="punctuation">:</span> <span class="string">&quot;amd64&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vcvars_ver&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pickString&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;What vcvars_ver do you want to create?&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;14.2&quot;</span><span class="punctuation">,</span> <span class="comment">// 2019</span></span><br><span class="line">                <span class="string">&quot;14.1&quot;</span><span class="punctuation">,</span> <span class="comment">// 2017</span></span><br><span class="line">                <span class="string">&quot;14.0&quot;</span><span class="punctuation">,</span> <span class="comment">// 2015</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;default&quot;</span><span class="punctuation">:</span> <span class="string">&quot;14.2&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>4）cmake:</p>
<ul>
<li>
<p>使用方法<br>
<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_30908103/article/details/96064514">https://blog.csdn.net/weixin_30908103/article/details/96064514</a><br>
<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_42190402/article/details/142754530">https://blog.csdn.net/qq_42190402/article/details/142754530</a><br>
<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/696690726">https://zhuanlan.zhihu.com/p/696690726</a><br>
<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/631107787">https://zhuanlan.zhihu.com/p/631107787</a><br>
<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/461896034?utm_id=0">https://zhuanlan.zhihu.com/p/461896034?utm_id=0</a><br>
<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_51355375/article/details/142434829">https://blog.csdn.net/qq_51355375/article/details/142434829</a><br>
<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_51470638/article/details/129101424">https://blog.csdn.net/qq_51470638/article/details/129101424</a><br>
<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_39698985/article/details/115433257">https://blog.csdn.net/qq_39698985/article/details/115433257</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/chalindian6720/article/details/145440556">https://blog.csdn.net/chalindian6720/article/details/145440556</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_44002418/article/details/131724795">https://blog.csdn.net/qq_44002418/article/details/131724795</a></p>
</li>
<li>
<p>样例项目目录<br>
<img src="/2025/02/24/QT-C/QT-C/image-20250225224738984.png" alt="image-20250225224738984"><br>
上边的工程目录对应的CMakeList.txt</p>
</li>
</ul>
  <figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line">cmake_minimum_required(VERSION 3.16)</span><br><span class="line"></span><br><span class="line">#项目名称</span><br><span class="line">project(project1 VERSION 0.1 LANGUAGES CXX)</span><br><span class="line"></span><br><span class="line">set(CMAKE_AUTOUIC ON) #用户界面编译器，将根据.ui文件生成相应的.h文件，例如根据mainwindow.ui生成ui_mainwindow.h。</span><br><span class="line">set(CMAKE_AUTOMOC ON)#元对象编译器，用于处理QT拓展的C++语法。</span><br><span class="line">set(CMAKE_AUTORCC ON)#rcc工具用于在构建过程中将资源嵌入到Qt应用程序中</span><br><span class="line">set(CMAKE_INCLUDE_CURRENT_DIR ON)</span><br><span class="line"></span><br><span class="line">set(CMAKE_CXX_STANDARD 17)</span><br><span class="line">set(CMAKE_CXX_STANDARD_REQUIRED ON)</span><br><span class="line"></span><br><span class="line">find_package(QT NAMES Qt6 Qt5 REQUIRED COMPONENTS Widgets)</span><br><span class="line">find_package(Qt$&#123;QT_VERSION_MAJOR&#125; REQUIRED COMPONENTS Widgets)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># set(HEADER_DIR $&#123;CMAKE_SOURCE_DIR&#125;/include)</span><br><span class="line"># set(SOURCE_DIR $&#123;CMAKE_SOURCE_DIR&#125;/src)</span><br><span class="line"># set(FORM_DIR $&#123;CMAKE_SOURCE_DIR&#125;/form)</span><br><span class="line"># 查找某个路径下的所有源文件，此处将src目录下的所有文件名赋给SRC变量</span><br><span class="line">aux_source_directory(src SRC)</span><br><span class="line"># file(GLOB/GLOB_RECURSE 变量名 要搜索的文件路径和文件类型)</span><br><span class="line">#GLOB: 将指定目录下搜索到的满足条件的所有文件名生成一个列表，并将其存储到变量中。</span><br><span class="line">#GLOB_RECURSE：递归搜索指定目录，将搜索到的满足条件的文件名生成一个列表，并将其存储到变量中。</span><br><span class="line">#CMAKE_CURRENT_SOURCE_DIR 宏表示当前访问的 CMakeLists.txt 文件所在的路径。</span><br><span class="line">FILE(GLOB INC &quot;include/*.h&quot;)</span><br><span class="line">#CMAKE_AUTOUIC_SEARCH_PATHS告诉 CMake 哪些目录下的 .ui 文件应该被 AutoUic 处理。设置了这个变量后，CMake 将会在这些指定的目录下搜索 .ui 文件，并将它们转换为相应的头文件.h。</span><br><span class="line">list(APPEND CMAKE_AUTOUIC_SEARCH_PATHS &quot;form&quot;)</span><br><span class="line"></span><br><span class="line"># qt6_wrap_ui(MOC_ $&#123;FORM_DIR&#125;/mainwindow.ui)</span><br><span class="line"># qt6_wrap_ui(UI_HEADERS $&#123;FORM_DIR&#125;/mainwindow.ui)</span><br><span class="line"></span><br><span class="line"># include_directories(</span><br><span class="line">#     $&#123;CMAKE_SOURCE_DIR&#125;/include</span><br><span class="line">#     $&#123;UI_HEADERS&#125;</span><br><span class="line"># )</span><br><span class="line"></span><br><span class="line">set(PROJECT_SOURCES</span><br><span class="line">    # $&#123;SOURCE_DIR&#125;/main.cpp</span><br><span class="line">    # $&#123;SOURCE_DIR&#125;/mainwindow.cpp</span><br><span class="line">    # $&#123;UI_HEADERS&#125;</span><br><span class="line">    # $&#123;HEADER_DIR&#125;</span><br><span class="line">    $&#123;SRC&#125;</span><br><span class="line">    $&#123;INC&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">if($&#123;QT_VERSION_MAJOR&#125; GREATER_EQUAL 6)</span><br><span class="line">    qt_add_executable(project1</span><br><span class="line">        MANUAL_FINALIZATION</span><br><span class="line">        $&#123;PROJECT_SOURCES&#125;</span><br><span class="line">    )</span><br><span class="line"># Define target properties for Android with Qt 6 as:</span><br><span class="line">#    set_property(TARGET project1 APPEND PROPERTY QT_ANDROID_PACKAGE_SOURCE_DIR</span><br><span class="line">#                 $&#123;CMAKE_CURRENT_SOURCE_DIR&#125;/android)</span><br><span class="line"># For more information, see https://doc.qt.io/qt-6/qt-add-executable.html#target-creation</span><br><span class="line">else()</span><br><span class="line">    if(ANDROID)</span><br><span class="line">        add_library(project1 SHARED</span><br><span class="line">            $&#123;PROJECT_SOURCES&#125;</span><br><span class="line">        )</span><br><span class="line"># Define properties for Android with Qt 5 after find_package() calls as:</span><br><span class="line">#    set(ANDROID_PACKAGE_SOURCE_DIR &quot;$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;/android&quot;)</span><br><span class="line">    else()</span><br><span class="line">        # 定义工程会生成一个可执行程序 add_executable(可执行程序名 源文件名称)</span><br><span class="line">        add_executable(project1</span><br><span class="line">            $&#123;PROJECT_SOURCES&#125;</span><br><span class="line">        )</span><br><span class="line">    endif()</span><br><span class="line">endif()</span><br><span class="line"></span><br><span class="line">target_include_directories(project1 PRIVATE include)</span><br><span class="line">target_link_libraries(project1 PRIVATE Qt$&#123;QT_VERSION_MAJOR&#125;::Widgets)</span><br><span class="line"></span><br><span class="line"># Qt for iOS sets MACOSX_BUNDLE_GUI_IDENTIFIER automatically since Qt 6.1.</span><br><span class="line"># If you are developing for iOS or macOS you should consider setting an</span><br><span class="line"># explicit, fixed bundle identifier manually though.</span><br><span class="line">if($&#123;QT_VERSION&#125; VERSION_LESS 6.1.0)</span><br><span class="line">  set(BUNDLE_ID_OPTION MACOSX_BUNDLE_GUI_IDENTIFIER com.example.project1)</span><br><span class="line">endif()</span><br><span class="line">set_target_properties(project1 PROPERTIES</span><br><span class="line">    $&#123;BUNDLE_ID_OPTION&#125;</span><br><span class="line">    MACOSX_BUNDLE_BUNDLE_VERSION $&#123;PROJECT_VERSION&#125;</span><br><span class="line">    MACOSX_BUNDLE_SHORT_VERSION_STRING $&#123;PROJECT_VERSION_MAJOR&#125;.$&#123;PROJECT_VERSION_MINOR&#125;</span><br><span class="line">    MACOSX_BUNDLE TRUE</span><br><span class="line">    WIN32_EXECUTABLE TRUE</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">include(GNUInstallDirs)</span><br><span class="line">install(TARGETS project1</span><br><span class="line">    BUNDLE DESTINATION .</span><br><span class="line">    LIBRARY DESTINATION $&#123;CMAKE_INSTALL_LIBDIR&#125;</span><br><span class="line">    RUNTIME DESTINATION $&#123;CMAKE_INSTALL_BINDIR&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">if(QT_VERSION_MAJOR EQUAL 6)</span><br><span class="line">    qt_finalize_executable(project1)</span><br><span class="line">endif()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>多项目嵌套cmake样例</strong></p>
<img src="/2025/02/24/QT-C/QT-C/image-20250513090030932.png" alt="image-20250513090030932" style="zoom:50%;">
<p>每个项目下有自己的CMakeLists.txt。</p>
<ul>
<li>
<p>project3下的CMakeLists.txt</p>
  <figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.16</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#项目名称</span></span><br><span class="line"><span class="keyword">project</span>(project3 VERSION <span class="number">0.1</span> LANGUAGES CXX)</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span>(CMAKE_AUTOUIC <span class="keyword">ON</span>) <span class="comment">#用户界面编译器，将根据.ui文件生成相应的.h文件，例如根据mainwindow.ui生成ui_mainwindow.h。</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_AUTOMOC <span class="keyword">ON</span>)<span class="comment">#元对象编译器，用于处理QT拓展的C++语法。</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_AUTORCC <span class="keyword">ON</span>)<span class="comment">#rcc工具用于在构建过程中将资源嵌入到Qt应用程序中</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_INCLUDE_CURRENT_DIR <span class="keyword">ON</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_STANDARD <span class="number">17</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_STANDARD_REQUIRED <span class="keyword">ON</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">find_package</span>(QT NAMES Qt6 Qt5 REQUIRED COMPONENTS Widgets)</span><br><span class="line"><span class="keyword">find_package</span>(Qt<span class="variable">$&#123;QT_VERSION_MAJOR&#125;</span> REQUIRED COMPONENTS Widgets)</span><br><span class="line"><span class="comment"># 添加 mainwindow 子目录</span></span><br><span class="line"><span class="keyword">add_subdirectory</span>(mainwindow)</span><br><span class="line"><span class="keyword">add_subdirectory</span>(app)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Qt for iOS sets MACOSX_BUNDLE_GUI_IDENTIFIER automatically since Qt 6.1.</span></span><br><span class="line"><span class="comment"># If you are developing for iOS or macOS you should consider setting an</span></span><br><span class="line"><span class="comment"># explicit, fixed bundle identifier manually though.</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$&#123;QT_VERSION&#125;</span> <span class="keyword">VERSION_LESS</span> <span class="number">6.1</span>.<span class="number">0</span>)</span><br><span class="line">  <span class="keyword">set</span>(BUNDLE_ID_OPTION MACOSX_BUNDLE_GUI_IDENTIFIER com.example.project3)</span><br><span class="line"><span class="keyword">endif</span>()</span><br><span class="line"><span class="keyword">set_target_properties</span>(project3 PROPERTIES</span><br><span class="line">    <span class="variable">$&#123;BUNDLE_ID_OPTION&#125;</span></span><br><span class="line">    MACOSX_BUNDLE_BUNDLE_VERSION <span class="variable">$&#123;PROJECT_VERSION&#125;</span></span><br><span class="line">    MACOSX_BUNDLE_SHORT_VERSION_STRING <span class="variable">$&#123;PROJECT_VERSION_MAJOR&#125;</span>.<span class="variable">$&#123;PROJECT_VERSION_MINOR&#125;</span></span><br><span class="line">    MACOSX_BUNDLE <span class="keyword">TRUE</span></span><br><span class="line">    WIN32_EXECUTABLE <span class="keyword">TRUE</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span>(GNUInstallDirs)</span><br><span class="line"><span class="keyword">install</span>(TARGETS project3</span><br><span class="line">    BUNDLE DESTINATION .</span><br><span class="line">    LIBRARY DESTINATION <span class="variable">$&#123;CMAKE_INSTALL_LIBDIR&#125;</span></span><br><span class="line">    RUNTIME DESTINATION <span class="variable">$&#123;CMAKE_INSTALL_BINDIR&#125;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(QT_VERSION_MAJOR <span class="keyword">EQUAL</span> <span class="number">6</span>)</span><br><span class="line">    qt_finalize_executable(project3)</span><br><span class="line"><span class="keyword">endif</span>()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>app目录下CMakeLists.txt</p>
  <figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cmake_minimum_required(VERSION 3.16)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># #项目名称</span></span><br><span class="line"><span class="comment"># project(project3 VERSION 0.1 LANGUAGES CXX)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># set(CMAKE_AUTOUIC ON) #用户界面编译器，将根据.ui文件生成相应的.h文件，例如根据mainwindow.ui生成ui_mainwindow.h。</span></span><br><span class="line"><span class="comment"># set(CMAKE_AUTOMOC ON)#元对象编译器，用于处理QT拓展的C++语法。</span></span><br><span class="line"><span class="comment"># set(CMAKE_AUTORCC ON)#rcc工具用于在构建过程中将资源嵌入到Qt应用程序中</span></span><br><span class="line"><span class="comment"># set(CMAKE_INCLUDE_CURRENT_DIR ON)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># set(CMAKE_CXX_STANDARD 17)</span></span><br><span class="line"><span class="comment"># set(CMAKE_CXX_STANDARD_REQUIRED ON)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># find_package(QT NAMES Qt6 Qt5 REQUIRED COMPONENTS Widgets)</span></span><br><span class="line"><span class="comment"># find_package(Qt$&#123;QT_VERSION_MAJOR&#125; REQUIRED COMPONENTS Widgets)</span></span><br><span class="line"><span class="comment"># 添加 mainwindow 子目录</span></span><br><span class="line"><span class="comment"># add_subdirectory(mainwindow)</span></span><br><span class="line"><span class="comment"># add_subdirectory(app)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># set(HEADER_DIR $&#123;CMAKE_SOURCE_DIR&#125;/include)</span></span><br><span class="line"><span class="comment"># set(SOURCE_DIR $&#123;CMAKE_SOURCE_DIR&#125;/src)</span></span><br><span class="line"><span class="comment"># set(FORM_DIR $&#123;CMAKE_SOURCE_DIR&#125;/form)</span></span><br><span class="line"><span class="comment"># 查找某个路径下的所有源文件，此处将src目录下的所有文件名赋给SRC变量</span></span><br><span class="line"><span class="keyword">aux_source_directory</span>(. SRC)</span><br><span class="line"><span class="comment"># file(GLOB/GLOB_RECURSE 变量名 要搜索的文件路径和文件类型)</span></span><br><span class="line"><span class="comment">#GLOB: 将指定目录下搜索到的满足条件的所有文件名生成一个列表，并将其存储到变量中。</span></span><br><span class="line"><span class="comment">#GLOB_RECURSE：递归搜索指定目录，将搜索到的满足条件的文件名生成一个列表，并将其存储到变量中。</span></span><br><span class="line"><span class="comment">#CMAKE_CURRENT_SOURCE_DIR 宏表示当前访问的 CMakeLists.txt 文件所在的路径。</span></span><br><span class="line"><span class="comment"># FILE(GLOB INC &quot;mainwindow/include/*.h&quot;)</span></span><br><span class="line"><span class="comment"># 添加qrc文件</span></span><br><span class="line"><span class="comment"># file(GLOB QRC &quot;resources/*.qrc&quot;)</span></span><br><span class="line"><span class="comment">#CMAKE_AUTOUIC_SEARCH_PATHS告诉 CMake 哪些目录下的 .ui 文件应该被 AutoUic 处理。设置了这个变量后，CMake 将会在这些指定的目录下搜索 .ui 文件，并将它们转换为相应的头文件.h。</span></span><br><span class="line"><span class="comment"># list(APPEND CMAKE_AUTOUIC_SEARCH_PATHS &quot;form&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># qt6_wrap_ui(MOC_ $&#123;FORM_DIR&#125;/mainwindow.ui)</span></span><br><span class="line"><span class="comment"># qt6_wrap_ui(UI_HEADERS $&#123;FORM_DIR&#125;/mainwindow.ui)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># include_directories(</span></span><br><span class="line"><span class="comment">#     $&#123;CMAKE_SOURCE_DIR&#125;/include</span></span><br><span class="line"><span class="comment">#     $&#123;UI_HEADERS&#125;</span></span><br><span class="line"><span class="comment"># )</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span>(PROJECT_SOURCES</span><br><span class="line">    <span class="comment"># $&#123;SOURCE_DIR&#125;/main.cpp</span></span><br><span class="line">    <span class="comment"># $&#123;SOURCE_DIR&#125;/mainwindow.cpp</span></span><br><span class="line">    <span class="comment"># $&#123;UI_HEADERS&#125;</span></span><br><span class="line">    <span class="comment"># $&#123;HEADER_DIR&#125;</span></span><br><span class="line">    <span class="variable">$&#123;SRC&#125;</span></span><br><span class="line">    <span class="comment"># $&#123;INC&#125;</span></span><br><span class="line">    <span class="comment"># $&#123;QRC&#125;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># add_executable(project3 </span></span><br><span class="line"><span class="comment">#     $&#123;PROJECT_SOURCES&#125;</span></span><br><span class="line"><span class="comment"># )</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$&#123;QT_VERSION_MAJOR&#125;</span> <span class="keyword">GREATER_EQUAL</span> <span class="number">6</span>)</span><br><span class="line">    qt_add_executable(project3</span><br><span class="line">        MANUAL_FINALIZATION</span><br><span class="line">        <span class="variable">$&#123;PROJECT_SOURCES&#125;</span></span><br><span class="line">    )</span><br><span class="line"><span class="comment"># Define target properties for Android with Qt 6 as:</span></span><br><span class="line"><span class="comment">#    set_property(TARGET project3 APPEND PROPERTY QT_ANDROID_PACKAGE_SOURCE_DIR</span></span><br><span class="line"><span class="comment">#                 $&#123;CMAKE_CURRENT_SOURCE_DIR&#125;/android)</span></span><br><span class="line"><span class="comment"># For more information, see https://doc.qt.io/qt-6/qt-add-executable.html#target-creation</span></span><br><span class="line"><span class="keyword">else</span>()</span><br><span class="line">    <span class="keyword">if</span>(ANDROID)</span><br><span class="line">        <span class="keyword">add_library</span>(project3 SHARED</span><br><span class="line">            <span class="variable">$&#123;PROJECT_SOURCES&#125;</span></span><br><span class="line">        )</span><br><span class="line"><span class="comment"># Define properties for Android with Qt 5 after find_package() calls as:</span></span><br><span class="line"><span class="comment">#    set(ANDROID_PACKAGE_SOURCE_DIR &quot;$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;/android&quot;)</span></span><br><span class="line">    <span class="keyword">else</span>()</span><br><span class="line">        <span class="comment"># 定义工程会生成一个可执行程序 add_executable(可执行程序名 源文件名称)</span></span><br><span class="line">        <span class="keyword">add_executable</span>(project3</span><br><span class="line">            <span class="variable">$&#123;PROJECT_SOURCES&#125;</span></span><br><span class="line">        )</span><br><span class="line">    <span class="keyword">endif</span>()</span><br><span class="line"><span class="keyword">endif</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment"># target_include_directories(project3 PRIVATE include)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">target_link_libraries</span>(project3 PUBLIC  MainWindow) </span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>mainwindow目录下CMakeLists.txt</p>
  <figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># project(mainwindow)</span></span><br><span class="line"><span class="comment"># set(HEADER_DIR $&#123;CMAKE_SOURCE_DIR&#125;/include)</span></span><br><span class="line"><span class="comment"># set(SOURCE_DIR $&#123;CMAKE_SOURCE_DIR&#125;/src)</span></span><br><span class="line"><span class="comment"># set(FORM_DIR $&#123;CMAKE_SOURCE_DIR&#125;/form)</span></span><br><span class="line"><span class="comment"># 查找某个路径下的所有源文件，此处将src目录下的所有文件名赋给SRC变量</span></span><br><span class="line"><span class="keyword">aux_source_directory</span>(src SRC)</span><br><span class="line"><span class="comment"># file(GLOB/GLOB_RECURSE 变量名 要搜索的文件路径和文件类型)</span></span><br><span class="line"><span class="comment">#GLOB: 将指定目录下搜索到的满足条件的所有文件名生成一个列表，并将其存储到变量中。</span></span><br><span class="line"><span class="comment">#GLOB_RECURSE：递归搜索指定目录，将搜索到的满足条件的文件名生成一个列表，并将其存储到变量中。</span></span><br><span class="line"><span class="comment">#CMAKE_CURRENT_SOURCE_DIR 宏表示当前访问的 CMakeLists.txt 文件所在的路径。</span></span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;打印CMAKE_CURRENT_CSOURCE_DIR路径$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">FILE</span>(GLOB INC <span class="string">&quot;$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;/include/*.h&quot;</span>)</span><br><span class="line"><span class="comment"># 添加qrc文件</span></span><br><span class="line"><span class="keyword">file</span>(GLOB QRC <span class="string">&quot;$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;/resources/*.qrc&quot;</span>)</span><br><span class="line"><span class="comment">#CMAKE_AUTOUIC_SEARCH_PATHS告诉 CMake 哪些目录下的 .ui 文件应该被 AutoUic 处理。设置了这个变量后，CMake 将会在这些指定的目录下搜索 .ui 文件，并将它们转换为相应的头文件.h。</span></span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;打印AUTOUIC路径$&#123;CMAKE_AUTOUIC_SEARCH_PATHS&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">list</span>(APPEND CMAKE_AUTOUIC_SEARCH_PATHS <span class="string">&quot;form&quot;</span>)</span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;打印AUTOUIC路径$&#123;CMAKE_AUTOUIC_SEARCH_PATHS&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># qt6_wrap_ui(MOC_ $&#123;FORM_DIR&#125;/mainwindow.ui)</span></span><br><span class="line"><span class="comment"># qt6_wrap_ui(UI_HEADERS $&#123;FORM_DIR&#125;/mainwindow.ui)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># include_directories(</span></span><br><span class="line"><span class="comment">#     $&#123;CMAKE_SOURCE_DIR&#125;/include</span></span><br><span class="line"><span class="comment">#     $&#123;UI_HEADERS&#125;</span></span><br><span class="line"><span class="comment"># )</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成链接库</span></span><br><span class="line"><span class="keyword">add_library</span> (MainWindow STATIC <span class="variable">$&#123;SRC&#125;</span> <span class="variable">$&#123;INC&#125;</span> <span class="variable">$&#123;QRC&#125;</span>)</span><br><span class="line"><span class="keyword">target_include_directories</span>(MainWindow PUBLIC <span class="variable">$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;</span>/<span class="keyword">include</span>/) <span class="comment"># 必须是目录,使用target_link_libraries添加本项目依赖时可以包含本项目的include文件</span></span><br><span class="line"><span class="keyword">target_link_libraries</span>(MainWindow PUBLIC Qt<span class="variable">$&#123;QT_VERSION_MAJOR&#125;</span>::Widgets)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>app目录用于项目的入口，父项目即使用<code>add_subdirectory</code>的项目中的变量例如<code>project3</code>可以用在子项目中，兄弟级项目间同名变量例如<code>SRC</code>相互独立。</p>
<h2 id="Windows系统">Windows系统</h2>
<p><img src="/2025/02/24/QT-C/QT-C/image-20250225202335789.png" alt="image-20250225202335789"></p>
<p>windows中qt项目路径中不能有中文名，否则报错：moc process failed to compile</p>
<h1>C++知识点</h1>
<h2 id="命名空间">命名空间</h2>
<p>命名空间为了解决名字冲突。<br>
命名空间定义</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> Cir &#123;</span><br><span class="line">  <span class="type">const</span> <span class="type">double</span> PI = <span class="number">3.14</span>;</span><br><span class="line">  <span class="function"><span class="type">double</span> <span class="title">areaOfCircle</span><span class="params">(<span class="type">double</span> radius)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> PI*radius*radius;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="type">double</span> length;</span><br><span class="line">  <span class="keyword">class</span> <span class="title class_">student</span> &#123;</span><br><span class="line">    String name;</span><br><span class="line">    <span class="type">int</span> age;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">behavior</span><span class="params">(String name)</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cir</span>::student::<span class="built_in">behavior</span>(String name)&#123;</span><br><span class="line">  std::cout &lt;&lt; name &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> Cir::PI;</span><br><span class="line"><span class="keyword">using</span> MyType = <span class="type">int</span>;</span><br></pre></td></tr></table></figure>
<h2 id="内联函数">内联函数</h2>
<p>内联函数直接在每个调用点(使用点)展开，即函数调用替换为函数代码，减少调用开销(调度栈)</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">max</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x&gt;y?x:y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="type">int</span> result = <span class="built_in">add</span>(<span class="number">5</span>,<span class="number">3</span>);<span class="comment">//编译器在此处将add(5,3)替换为代码&#123;return 5&gt;3?5:3;&#125;</span></span><br><span class="line">  std::cout &lt;&lt; <span class="string">&quot;Result: &quot;</span> &lt;&lt; result &lt;&lt; std::endl;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">  </span><br></pre></td></tr></table></figure>
<h2 id="匿名函数-lambda表达式">匿名函数 lambda表达式</h2>
<p>匿名函数可以在需要调用的地方直接定义函数，无需单独定义</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[cature clause](parameters) -&gt; return_type &#123;</span><br><span class="line">  <span class="comment">//函数体</span></span><br><span class="line">  <span class="comment">//可以使用在捕获列表中的变量</span></span><br><span class="line">  <span class="keyword">return</span> expression;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> add = [](<span class="type">int</span> a, <span class="type">int</span> b)&#123;</span><br><span class="line">  <span class="keyword">return</span> a+b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> sum = <span class="built_in">add</span>(<span class="number">10</span>,<span class="number">20</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li>捕获列表：获取外部的变量</li>
</ul>
<h3 id="C-中Lambda表达式的两种形式解析">C++中Lambda表达式的两种形式解析</h3>
<p>在C++中，<code>[=]()&#123;&#125;</code>和<code>[&amp;]()&#123;&#125;</code>是Lambda表达式的两种主要捕获方式，它们决定了Lambda函数体如何访问外部变量。</p>
<h4 id="1-值捕获（Capture-by-Value）">1. <code>[=]()&#123;&#125;</code> - 值捕获（Capture by Value）</h4>
<h5 id="作用">作用</h5>
<ul>
<li>以<strong>值拷贝</strong>的方式捕获所有外部变量</li>
<li>在Lambda内部使用的是外部变量的<strong>副本</strong></li>
<li>Lambda内部对变量的修改不会影响外部变量</li>
</ul>
<h5 id="示例">示例</h5>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> x = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">auto</span> lambda = [=]() &#123;</span><br><span class="line">    <span class="comment">// 这里使用的是x的副本</span></span><br><span class="line">    std::cout &lt;&lt; x &lt;&lt; std::endl;  <span class="comment">// 输出10</span></span><br><span class="line">    <span class="comment">// x = 20; // 错误！值捕获的变量默认是const的</span></span><br><span class="line">&#125;;</span><br><span class="line">x = <span class="number">30</span>;  <span class="comment">// 修改外部x</span></span><br><span class="line"><span class="built_in">lambda</span>();  <span class="comment">// 仍然输出10（使用的是最初捕获的副本）</span></span><br></pre></td></tr></table></figure>
<h5 id="特点">特点</h5>
<ul>
<li>安全：不会意外修改外部变量</li>
<li>独立：Lambda可以使用变量的快照</li>
<li>性能：对于大型对象可能有拷贝开销</li>
</ul>
<h4 id="2-引用捕获（Capture-by-Reference）">2. <code>[&amp;]()&#123;&#125;</code> - 引用捕获（Capture by Reference）</h4>
<h5 id="作用-2">作用</h5>
<ul>
<li>以<strong>引用</strong>的方式捕获所有外部变量</li>
<li>在Lambda内部使用的是外部变量的<strong>别名</strong></li>
<li>Lambda内部对变量的修改会影响外部变量</li>
</ul>
<h5 id="示例-2">示例</h5>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> x = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">auto</span> lambda = [&amp;]() &#123;</span><br><span class="line">    std::cout &lt;&lt; x &lt;&lt; std::endl;  <span class="comment">// 输出10</span></span><br><span class="line">    x = <span class="number">20</span>;  <span class="comment">// 修改的是外部x</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">lambda</span>();</span><br><span class="line">std::cout &lt;&lt; x &lt;&lt; std::endl;  <span class="comment">// 输出20（外部x已被修改）</span></span><br></pre></td></tr></table></figure>
<h5 id="特点-2">特点</h5>
<ul>
<li>高效：没有拷贝开销</li>
<li>危险：可能导致悬垂引用（如果Lambda生命周期长于捕获的变量）</li>
<li>可变：可以修改外部变量</li>
</ul>
<h4 id="关键区别对比">关键区别对比</h4>
<table>
<thead>
<tr>
<th>特性</th>
<th><code>[=]</code> 值捕获</th>
<th><code>[&amp;]</code> 引用捕获</th>
</tr>
</thead>
<tbody>
<tr>
<td>捕获方式</td>
<td>拷贝值</td>
<td>创建引用</td>
</tr>
<tr>
<td>外部变量影响</td>
<td>不影响原变量</td>
<td>直接影响原变量</td>
</tr>
<tr>
<td>默认const</td>
<td>是</td>
<td>否</td>
</tr>
<tr>
<td>性能</td>
<td>可能有拷贝开销</td>
<td>无拷贝开销</td>
</tr>
<tr>
<td>安全性</td>
<td>高（无悬垂引用风险）</td>
<td>低（可能悬垂引用）</td>
</tr>
<tr>
<td>适用场景</td>
<td>需要变量快照、并行编程</td>
<td>需要修改外部变量、短生命周期使用</td>
</tr>
</tbody>
</table>
<h4 id="更灵活的捕获方式">更灵活的捕获方式</h4>
<p>C++还支持更精确的捕获控制：</p>
<ol>
<li>
<p><strong>混合捕获</strong>：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a = <span class="number">1</span>, b = <span class="number">2</span>, c = <span class="number">3</span>;</span><br><span class="line">[=, &amp;b]() &#123; <span class="comment">/* a和c值捕获，b引用捕获 */</span> &#125;;</span><br><span class="line">[&amp;, a]()  &#123; <span class="comment">/* b和c引用捕获，a值捕获 */</span> &#125;;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>显式捕获</strong>：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> x = <span class="number">10</span>, y = <span class="number">20</span>;</span><br><span class="line">[x, &amp;y]() &#123; <span class="comment">/* 只捕获x(值)和y(引用) */</span> &#125;;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>初始化捕获</strong> (C++14+)：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> p = std::<span class="built_in">make_unique</span>&lt;<span class="type">int</span>&gt;(<span class="number">10</span>);</span><br><span class="line">[ptr = std::<span class="built_in">move</span>(p)]() &#123; <span class="comment">/* 使用移动语义捕获 */</span> &#125;;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="使用建议">使用建议</h4>
<ol>
<li><strong>优先使用值捕获</strong>：除非确实需要修改外部变量或避免拷贝开销</li>
<li><strong>注意生命周期</strong>：引用捕获时要确保Lambda不会比捕获的变量活得久</li>
<li><strong>简单场景用<code>[=]</code>/<code>[&amp;]</code>，复杂场景显式指定</strong>：提高代码可读性</li>
<li><strong>在Qt信号槽中</strong>：注意Lambda捕获可能导致的对象生命周期问题</li>
</ol>
<h4 id="Qt中的特殊考虑">Qt中的特殊考虑</h4>
<p>在Qt信号槽连接中使用Lambda时：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 安全方式 - 值捕获</span></span><br><span class="line"><span class="built_in">connect</span>(button, &amp;QPushButton::clicked, [=]() &#123;</span><br><span class="line">    <span class="comment">// 使用类成员时需要确保this仍然有效</span></span><br><span class="line">    <span class="keyword">this</span>-&gt;<span class="built_in">doSomething</span>(); </span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 危险方式 - 引用捕获可能导致悬垂引用</span></span><br><span class="line">SomeObject *obj = <span class="keyword">new</span> SomeObject;</span><br><span class="line"><span class="built_in">connect</span>(button, &amp;QPushButton::clicked, [&amp;]() &#123;</span><br><span class="line">    obj-&gt;<span class="built_in">doSomething</span>();  <span class="comment">// 危险！如果obj被delete</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>理解这两种捕获方式的区别对于编写正确、高效的C++代码非常重要，特别是在异步编程和事件驱动编程（如Qt）中。</p>
<h2 id="数组-静态">数组(静态)</h2>
<ul>
<li>声明：int myArray[10];</li>
<li>初始化: int myArray[5] = {5,4,5,4,2};</li>
<li>访问: int value = myArray[2]</li>
</ul>
<h2 id="引用">引用</h2>
<p>引用是变量别名或标签，只能用在已有的变量上。<br>
引用和指针的区别</p>
<ul>
<li>不存在空引用，引用必须连接到一个合法的内存上</li>
<li>引用只能在初始化时连接到对象，一旦引用被连接到一个对象上，就不能连接到其他对象上，指针是可以随时指向另一个对象的。</li>
<li>引用和指针不能跨作用域使用，只能在对象的生命周期内（为销毁之前）使用。</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> i=<span class="number">17</span>;</span><br><span class="line"><span class="type">int</span> *p = &amp;i;</span><br><span class="line">*p = <span class="number">20</span>;</span><br><span class="line"><span class="type">int</span>&amp; r = i;</span><br><span class="line"><span class="type">double</span> vals[] = &#123;<span class="number">10.1</span>,<span class="number">12.6</span>,<span class="number">33.1</span>,<span class="number">24.1</span>,<span class="number">50.0</span>&#125;;</span><br><span class="line"><span class="function"><span class="type">double</span>&amp; <span class="title">setValue</span><span class="params">(<span class="type">int</span> i)</span></span>&#123;</span><br><span class="line">  <span class="type">double</span>&amp; ref = vals[i];</span><br><span class="line">  <span class="keyword">return</span> ref;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="built_in">setValue</span>(<span class="number">3</span>) = <span class="number">88.9</span>;</span><br><span class="line">  cout &lt;&lt; vals[<span class="number">3</span>];</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="结构体-类">结构体/类</h2>
<p>结构体</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Car</span>&#123;</span><br><span class="line">  <span class="type">char</span>* color;</span><br><span class="line">  <span class="type">int</span> year;</span><br><span class="line">  <span class="built_in">void</span> (*printCarInfo)();</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Car</span> car;</span><br><span class="line">car.color = <span class="string">&quot;white&quot;</span>;</span><br><span class="line">car.printCarInfo = []()-&gt;<span class="type">void</span>&#123;<span class="built_in">printf</span>(<span class="string">&quot;this is a Car\n&quot;</span>)&#125;;</span><br><span class="line">car.<span class="built_in">pirntCarInfo</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Car</span> *AodiA6;</span><br><span class="line">AodiA6 = (<span class="keyword">struct</span> Car*)<span class="built_in">malloc</span>(<span class="built_in">size</span>(<span class="keyword">struct</span> Car));</span><br><span class="line">AodiA6-&gt;color = <span class="string">&quot;black&quot;</span>;</span><br><span class="line">AodiA6-&gt;printCarInfo = []()-&gt;<span class="type">void</span>&#123;<span class="built_in">printf</span>(<span class="string">&quot;this is a AodiA6\n&quot;</span>);</span><br><span class="line">AodiA6-&gt;<span class="built_in">printCarInfo</span>();</span><br></pre></td></tr></table></figure>
<p>类包含</p>
<ul>
<li>
<p>数据成员</p>
</li>
<li>
<p>成员函数</p>
</li>
<li>
<p>构造函数和析构函数</p>
</li>
<li>
<p>访问修饰符:public, private, protect</p>
<p><img src="/2025/02/24/QT-C/QT-C/image-20250226180425851.png" alt="image-20250226180425851"></p>
</li>
<li>
<p>继承关系</p>
</li>
<li>
<p>生成对象: new</p>
</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Car</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="comment">//成员数据</span></span><br><span class="line">  string color;</span><br><span class="line">  string brand;</span><br><span class="line">  string type;</span><br><span class="line">  <span class="type">int</span> year;</span><br><span class="line">  <span class="comment">//成员函数</span></span><br><span class="line">  <span class="built_in">void</span> (*printCarIfo)(string color, string brand, string type, <span class="type">int</span> year);</span><br><span class="line">  <span class="built_in">void</span> (*carRun)(string type);</span><br><span class="line">  <span class="built_in">void</span> (*carStop)(string type);</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">carRun</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cout &lt;&lt; type &lt;&lt; endl;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">carStop</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">bwmThreePringCarInfo</span><span class="params">(string color, string brand, string type, <span class="type">int</span> year)</span></span>&#123;</span><br><span class="line">  string str = <span class="string">&quot;xxx&quot;</span>;</span><br><span class="line">  cout &lt;&lt; str &lt;&lt;endl;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Car::carStop</span><span class="params">()</span></span>&#123;</span><br><span class="line">  cout &lt;&lt; type &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>拥有关系：<br>
C++中一个类包含另一个类的对象称为组合，这是一种常见的设计模式，表示一个类是由另一个类的对象组成，这种关系表示拥有关系（has-a）</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Wheel</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  string brand;</span><br><span class="line">  string year;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">wheelPrintInfo</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Wheel::wheelPrintInfo</span><span class="params">()</span></span>&#123;</span><br><span class="line">  cout &lt;&lt; brand &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Car</span>&#123;</span><br><span class="line"><span class="keyword">public</span></span><br><span class="line">  string color;</span><br><span class="line">  string brand;</span><br><span class="line">  string type;</span><br><span class="line">  string year;</span><br><span class="line">  Wheel wl;</span><br><span class="line">  wheel *wlp;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">realPrintInfo</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">void</span> Car <span class="title">realPrintInfo</span><span class="params">()</span></span>&#123;</span><br><span class="line">  cout &lt;&lt; type &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  Car *Aodi = <span class="keyword">new</span> <span class="built_in">Car</span>();</span><br><span class="line">  Aodi-&gt;color = <span class="string">&quot;black&quot;</span>;</span><br><span class="line">  Aodi-&gt;wl = <span class="built_in">Wheel</span>();</span><br><span class="line">  Aodi-&gt;wl.color = <span class="string">&quot;black&quot;</span>;</span><br><span class="line">  Aodi-&gt;wlp = <span class="keyword">new</span> <span class="built_in">Wheel</span>()</span><br><span class="line">  Aodi-&gt;wlp-&gt;brand = <span class="string">&quot;miqi&quot;</span>;</span><br><span class="line">  Car BMW = <span class="built_in">Car</span>();</span><br><span class="line">  BMW.color = <span class="string">&quot;white&quot;</span>;</span><br><span class="line">  BMW.wl = <span class="built_in">Wheel</span>();</span><br><span class="line">  BMW.wl.color = <span class="string">&quot;black&quot;</span>;</span><br><span class="line">  BMW.wlp = <span class="keyword">new</span> <span class="built_in">Wheel</span>();</span><br><span class="line">  BMW.wlp-&gt;brand = <span class="string">&quot;beinaili&quot;</span>;</span><br><span class="line">  Aodi.<span class="built_in">realPrintInfo</span>();</span><br><span class="line">  BMW.<span class="built_in">realPrintInfo</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="重载">重载</h2>
<h3 id="函数重载">函数重载</h3>
<p>同一个作用域内可以声明几个同名函数，但是函数的形参（参数个数，参数类型和参数顺序）必须不同，对函数的返回类型没有要求</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">printData</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(<span class="type">int</span> i)</span></span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;整数: &quot;</span>&lt;&lt; i &lt;&lt; endl;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(<span class="type">double</span> f)</span></span>&#123;</span><br><span class="line">      cout &lt;&lt; <span class="string">&quot;浮点：&quot;</span>&lt;&lt; f &lt;&lt; endl;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(<span class="type">char</span> c[])</span></span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;字符数组：&quot;</span>&lt;&lt; c &lt;&lt;endl;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  printData pd;</span><br><span class="line">  pd.<span class="built_in">print</span>(<span class="number">5</span>);</span><br><span class="line">  pd.<span class="built_in">print</span>(<span class="number">500.263</span>);</span><br><span class="line">  <span class="type">char</span> c[] = <span class="string">&quot;hello c++&quot;</span>;</span><br><span class="line">  pd.<span class="built_in">print</span>(c);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="运算符重载">运算符重载</h3>
<p>自定义各种运算符在自定义类上的行为特性。<br>
基本原则：</p>
<ul>
<li>不可以创建新的运算符</li>
<li>至少有一个操作数是用户定义的类型，不能重载两个操作数是两个基本类型的运算符</li>
<li>不能更改运算符的优先级和结合性</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  string name;</span><br><span class="line">  <span class="type">int</span> age;</span><br><span class="line">  <span class="type">static</span> <span class="type">int</span> number;</span><br><span class="line">  <span class="type">bool</span> <span class="keyword">operator</span>==(Person pTmp);</span><br><span class="line">  <span class="type">int</span> <span class="keyword">operator</span>+(Person pTmp);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">bool</span> Person::<span class="keyword">operator</span>==(Person pTmp)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> pTmp.name == name &amp;&amp; pTmp.age == age;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Person::<span class="keyword">operator</span>+(Person pTmp)&#123;</span><br><span class="line">  <span class="keyword">this</span>-&gt;number += pTmp.number;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  Person p1 = <span class="built_in">Person</span>();</span><br><span class="line">  p1.age = <span class="number">12</span>;</span><br><span class="line">  p1.name = <span class="string">&quot;wl&quot;</span>;</span><br><span class="line">  Person p2 = <span class="built_in">Person</span>();</span><br><span class="line">  p2.age = <span class="number">12</span>;</span><br><span class="line">  p2.name = <span class="string">&quot;lw&quot;</span>;</span><br><span class="line">  <span class="type">bool</span> ret = p1==p2;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="构造函数">构造函数</h2>
<p>类的构造函数是特殊成员函数，每次创建类的对象时执行，用于构造成员变量的初始化值，分配内存空间等，构造函数没有返回值。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Car</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  string brand;</span><br><span class="line">  <span class="type">int</span> year;</span><br><span class="line">  <span class="built_in">Car</span>()&#123;</span><br><span class="line">    brand = <span class="string">&quot;未知&quot;</span>;</span><br><span class="line">    year = <span class="number">0</span>;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;无参构造&quot;</span> &lt;&lt; endl;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">display</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;brand:&quot;</span> &lt;&lt; brand &lt;&lt; <span class="string">&quot;, year: &quot;</span> &lt;&lt; year &lt;&lt; endl;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  Car car = <span class="built_in">Car</span>();</span><br><span class="line">  car.<span class="built_in">display</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="初始化列表">初始化列表</h3>
<p>直接在对象的构造过程中初始化成员变量，而不是先创建成员变量后再赋值。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span>&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  <span class="type">int</span> a;</span><br><span class="line">  <span class="type">double</span> b;</span><br><span class="line">  std::string c;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">MyClass</span>(<span class="type">int</span> x, <span class="type">double</span> y, <span class="type">const</span> std::string&amp; z): <span class="built_in">a</span>(x), <span class="built_in">b</span>(y), <span class="built_in">c</span>(z)&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;a: &quot;</span> &lt;&lt; a &lt;&lt; <span class="string">&quot;b: &quot;</span> &lt;&lt; b &lt;&lt;<span class="string">&quot;c:&quot;</span> &lt;&lt; c &lt;&lt;endl;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>成员变量初始化顺序是按照他们声明的顺序，而不是初始化列表中的顺序赋值。</p>
<h3 id="this指针">this指针</h3>
<p>this 指针指向调用对象的指针，在类的作用域中使用，可以明确指出类的成员变量和成员函数。<br>
链式调用</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Car</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  string brand;</span><br><span class="line">  <span class="type">int</span> year;</span><br><span class="line">  <span class="built_in">Car</span>()&#123;</span><br><span class="line">    brand = <span class="string">&quot;未知&quot;</span>;</span><br><span class="line">    year = <span class="number">0</span>;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;无参构造&quot;</span> &lt;&lt; endl;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">display</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;brand:&quot;</span> &lt;&lt; brand &lt;&lt; <span class="string">&quot;, year: &quot;</span> &lt;&lt; year &lt;&lt; endl;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function">Car&amp; <span class="title">setYear</span><span class="params">(<span class="type">int</span> year)</span></span>&#123;</span><br><span class="line">    <span class="keyword">this</span>-&gt;year = year;</span><br><span class="line">    <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  Car car = <span class="built_in">Car</span>();</span><br><span class="line">  car.<span class="built_in">display</span>();</span><br><span class="line">  <span class="comment">//链式调用,car对象调用setYear返回自身，因此可以直接调用对象的display方法</span></span><br><span class="line">  car.<span class="built_in">setYear</span>(<span class="number">2023</span>).<span class="built_in">display</span>()</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="new和delete关键字">new和delete关键字</h3>
<p>new用于动态分配内存。</p>
<ul>
<li>分配单个对象<br>
int* ptr = new int; // int* p=(int*)malloc(sizeof(int));<br>
MyClass* obj = new MyClass(arg1, arg2);</li>
<li>分配对象数组<br>
int* arr = new int[10]; // int* a=(int*)malloc(sizeof(int)<em>10);<br>
int</em> arr = new int[10]{1,2,3,4,5}<br>
new要与delete配对使用, new分配的内存必须用delete释放, new[]分配的内存必须delete[]释放</li>
<li>释放单个对象<br>
delete ptr;</li>
<li>释放数组<br>
delete[] arr;</li>
</ul>
<h2 id="拷贝构造函数">拷贝构造函数</h2>
<p>拷贝构造函数用于创建一个新对象作为现有对象的副本。被调用的情况：</p>
<ol>
<li>当一个新对象被创建为另一个同类型的现有对象的副本时：<br>
MyClass obj1 = obj2; 或者MyClass obj1(obj2); 其中obj2是现有对象。</li>
<li>将对象作为参数传递给函数时（按值传递）：<br>
当对象作为参数传递给函数，并且参数不是引用时，会使用拷贝构造函数创建函数内部的对象副本。</li>
<li>从函数返回对象时（按值返回）：<br>
最为函数返回值，并且没有使用引用或指针时，拷贝构造函数用于从函数返回值创建副本。</li>
<li>初始化数组或容器中的元素时：</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">MyClass</span>(<span class="type">const</span> MyClass&amp; other)&#123;&#125;;<span class="comment">//other是对同类型对象的常量引用，即用的对象是常量，不可修改。</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>深拷贝和浅拷贝是处理对象拷贝时的两种方法，尤其是在对象包含指针或者动态分配内存时。</p>
<h3 id="浅拷贝">浅拷贝</h3>
<p>浅拷贝只复制对象的成员变量的值。如果成员变量是指针，则复制指针的值（即内存地址），而不是指针所指向的实际数据。这会导致多个对象共享相同的内存地址。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Shallow</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="type">int</span>* data;</span><br><span class="line">  <span class="built_in">Shallow</span>(<span class="type">int</span> d)&#123;</span><br><span class="line">    data = <span class="keyword">new</span> <span class="built_in">int</span>(d); <span class="comment">//动态分配</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;观察数据：&quot;</span>&lt;&lt;endl;</span><br><span class="line">    cout &lt;&lt; d &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; *data &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;观察内存在构造函数中：&quot;</span> &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; data &lt;&lt;endl;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//默认的拷贝构造函数是浅拷贝,可以不用显示定义</span></span><br><span class="line">  <span class="built_in">Shallow</span>(<span class="type">const</span> Shallow&amp; obj)&#123;</span><br><span class="line">    data = obj.data <span class="comment">//复制地址而不是数据</span></span><br><span class="line">  &#125;</span><br><span class="line">  ~<span class="built_in">Shallow</span>()&#123;</span><br><span class="line">    <span class="keyword">delete</span> data;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="function">Shallow <span class="title">obj1</span><span class="params">(<span class="number">20</span>)</span></span>;</span><br><span class="line">  Shallow obj2 = obj1;</span><br><span class="line">  cout &lt;&lt; <span class="string">&quot;观察内存在main函数obj2的data地址：&quot;</span>&lt;&lt;endl;</span><br><span class="line">  cout &lt;&lt; obj2.data &lt;&lt; endl;</span><br><span class="line">  cout &lt;&lt;<span class="string">&quot;*obj1.data:&quot;</span>&lt;&lt;*obj1.data&lt;&lt;<span class="string">&quot;, *obj2.data:&quot;</span> &lt;&lt; *obj2.data &lt;&lt; endl;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="深拷贝">深拷贝</h3>
<p>深拷贝复制对象成员变量的值以及指针所指向的实际数据。这意味着创建新的独立副本，避免了共享内存地址的问题。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Deep</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="type">int</span>* data;</span><br><span class="line">  <span class="built_in">Shallow</span>(<span class="type">int</span> d)&#123;</span><br><span class="line">    data = <span class="keyword">new</span> <span class="built_in">int</span>(d); <span class="comment">//动态分配</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;观察数据：&quot;</span>&lt;&lt;endl;</span><br><span class="line">    cout &lt;&lt; d &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; *data &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;观察内存在构造函数中：&quot;</span> &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; data &lt;&lt;endl;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//显示定义深拷贝的构造函数</span></span><br><span class="line">  <span class="built_in">Deep</span>(<span class="type">const</span> Deep&amp; source)&#123;</span><br><span class="line">    data = <span class="keyword">new</span> <span class="built_in">int</span>(*source.data);<span class="comment">//复制数据，而不是地址</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;深拷贝构造函数&quot;</span>&lt;&lt;endl;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  ~<span class="built_in">Deep</span>()&#123;</span><br><span class="line">    <span class="keyword">delete</span> data;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="function">Deep <span class="title">obj1</span><span class="params">(<span class="number">20</span>)</span></span>;</span><br><span class="line">  Deep obj2 = obj1;</span><br><span class="line">  cout &lt;&lt; <span class="string">&quot;观察内存在main函数obj2的data地址：&quot;</span>&lt;&lt;endl;</span><br><span class="line">  cout &lt;&lt; obj2.data &lt;&lt; endl;</span><br><span class="line">  cout &lt;&lt;<span class="string">&quot;*obj1.data:&quot;</span>&lt;&lt;*obj1.data&lt;&lt;<span class="string">&quot;, *obj2.data:&quot;</span> &lt;&lt; *obj2.data &lt;&lt; endl;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="规则三则">规则三则</h3>
<p>规则三则（rule of three）是一个面向对象编程原则，涉及到类的拷贝控制。规则三则指出，如果你需要显式地定义或重载类的任何一个拷贝控制操作（拷贝构造函数、拷贝赋值运算符、析构函数），那么你几乎肯定需要显示地定义或重载所有三个。这是因为这三个功能通常都是用于管理动态分配的资源，比如在堆上分配的内存。确保了动态分配资源正确管理，避免了内存泄漏和浅拷贝问题</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span>&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  <span class="type">char</span>* buffer;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="comment">//构造函数</span></span><br><span class="line">  <span class="built_in">MyClass</span>(<span class="type">const</span> <span class="type">char</span>* str)&#123;</span><br><span class="line">    <span class="keyword">if</span> (str)&#123;</span><br><span class="line">      buffer = <span class="keyword">new</span> <span class="type">char</span>[<span class="built_in">strlen</span>(str)+<span class="number">1</span>];</span><br><span class="line">      <span class="built_in">strcpy</span>(buffer,str);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      buffer = <span class="literal">nullptr</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//析构函数</span></span><br><span class="line">  ~<span class="built_in">MyClass</span>()&#123;</span><br><span class="line">    <span class="keyword">delete</span>[] buffer;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//拷贝构造函数</span></span><br><span class="line">  <span class="built_in">MyClass</span>(<span class="type">const</span> MyClass&amp; other)&#123;</span><br><span class="line">    <span class="keyword">if</span> (other.buffer)&#123;</span><br><span class="line">      buffer = <span class="keyword">new</span> <span class="type">char</span>[<span class="built_in">strlen</span>(other.buffer)+<span class="number">1</span>];</span><br><span class="line">      <span class="built_in">strcpy</span>(buffer, other.buffer);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      buffer = <span class="literal">nullptr</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//赋值运算</span></span><br><span class="line">  MyClass&amp; <span class="keyword">operator</span>=(<span class="type">const</span> MyClass&amp; other)&#123;</span><br><span class="line">    <span class="comment">//自赋值检查</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span> == &amp;other) <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    <span class="comment">//释放原有空间</span></span><br><span class="line">    <span class="keyword">delete</span>[] buffer;</span><br><span class="line">    buffer = <span class="keyword">new</span> <span class="type">char</span>[<span class="built_in">strlen</span>(other.buffer)+<span class="number">1</span>];</span><br><span class="line">    <span class="built_in">strcpy</span>(buffer, other.buffer);</span><br><span class="line">    <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="避免不必要的拷贝">避免不必要的拷贝</h3>
<p>避免不必要的拷贝是C++设计的重要原则，尤其是在处理大型对象或资源密集型对象时。使用引用（包括常量引用）和移动语义是实现这个目标的两种常见方法。</p>
<ol>
<li>使用引用传递对象<br>
通过使用引用来传递对象，可以避免在函数调用时创建对象的副本。</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LargeObject</span>&#123;</span><br><span class="line">  <span class="comment">//假设这是一个占用大量内存的大型对象</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">processLargeObject</span><span class="params">(<span class="type">const</span> LargeObject&amp; obj)</span></span>&#123;</span><br><span class="line">  <span class="comment">//处理对象，但不修改它</span></span><br><span class="line">  cout &lt;&lt; <span class="string">&quot;Processing object...&quot;</span>&lt;&lt;endl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  LargeObject myLargeObject;</span><br><span class="line">  <span class="built_in">processingLargeObject</span>(myLargeObject);<span class="comment">//通过引用传递，避免拷贝</span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>使用移动语义<br>
移动语义允许资源（动态分配内存）的所有权从一个对象转移到另一个对象，这避免了不必要的拷贝。<br>
左值 ：表达式结束后依然存在的持久对象，可取地址。<br>
右值 ：表达式结束后就不再存在的临时对象，不可取地址。<br>
例如：int x1 = 1; \1是右值，x1是左值<br>
为支持移动语义引入新的引用类型，称为&quot;右值引用&quot;，使用&quot;&amp;&amp;“来声明。而使用”&amp;“声明的引用，则称为&quot;左值引用”。<br>
右值引用只能够引用没有名称的临时对象以及使用std::move标记的对象。由于右值都是临时的值，临时值释放后也就不再持有属性的所有权。</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;utility&gt;</span> <span class="comment">//std::move</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MovableObject</span>&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  <span class="type">char</span>* buffer;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">MovableObject</span>()&#123;</span><br><span class="line">    <span class="comment">//构造函数</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">MovableObject</span>(<span class="type">const</span> MovableObject&amp; other)&#123;</span><br><span class="line">    <span class="comment">//拷贝构造函数（费资源）</span></span><br><span class="line">  &#125;</span><br><span class="line">  MovableOject&amp; <span class="keyword">operator</span>=(<span class="type">const</span> MovableObject&amp; other)&#123;</span><br><span class="line">    <span class="comment">//拷贝赋值费资源</span></span><br><span class="line">    <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">MovableObject</span>(Movable&amp;&amp; other) <span class="keyword">noexcept</span>&#123;</span><br><span class="line">    <span class="comment">//移动构造函数，移动资所有权，省资源</span></span><br><span class="line">    buffer = other.buffer;</span><br><span class="line">    other.buffer = <span class="literal">nullptr</span>;<span class="comment">//临时变量，右值释放资源</span></span><br><span class="line">  &#125;</span><br><span class="line">  MovableOject&amp; <span class="keyword">operator</span>=(MovableObject&amp;&amp; other)&#123;</span><br><span class="line">    <span class="comment">//移动赋值省资源</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span> == &amp;other) <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    <span class="keyword">delete</span>[] buffer;</span><br><span class="line">    buffer = other.buffer;</span><br><span class="line">    other.buffer = <span class="literal">nullptr</span>; <span class="comment">//临时变量，右值释放资源</span></span><br><span class="line">    <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  ~<span class="built_in">MovableObject</span>()&#123;</span><br><span class="line">    <span class="keyword">delete</span>[] buffer;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="禁用拷贝构造函数">禁用拷贝构造函数</h3>
<ul>
<li>delete关键字明确指定不允许拷贝构造：</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">NonCopyable</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">NonCopyable</span>() = <span class="keyword">default</span>; <span class="comment">//使用默认构造函数</span></span><br><span class="line">  <span class="comment">//禁用拷贝构造函数</span></span><br><span class="line">  <span class="built_in">NonCopyable</span>(<span class="type">const</span> NonCopyable&amp; ) = <span class="keyword">delete</span>;</span><br><span class="line">  <span class="comment">//禁用拷贝赋值运算符</span></span><br><span class="line">  NonCopyable&amp; <span class="keyword">operator</span>=(<span class="type">const</span> NonCopyalbe&amp;) = <span class="keyword">delete</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  NonCopyable obj1;</span><br><span class="line">  <span class="comment">//NonCopyable obj2 = obj1; //编译报错，拷贝构造函数被禁用。</span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>private声明拷贝构造和拷贝赋值+不提供它们具体实现：</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">NonCopyable</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">NonCopyable</span>() = <span class="keyword">default</span>; <span class="comment">//使用默认构造函数</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  <span class="comment">//禁用拷贝构造函数</span></span><br><span class="line">  <span class="built_in">NonCopyable</span>(<span class="type">const</span> NonCopyable&amp; );</span><br><span class="line">  <span class="comment">//禁用拷贝赋值运算符</span></span><br><span class="line">  NonCopyable&amp; <span class="keyword">operator</span>=(<span class="type">const</span> NonCopyalbe&amp;);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  NonCopyable obj1;</span><br><span class="line">  <span class="comment">//NonCopyable obj2 = obj1; //编译报错，无法访问私有的拷贝构造函数。</span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>要点</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>定义和作用</td>
<td>拷贝构造函数在创建对象作为另一个现有对象副本时调用，通常有一个对同类型对象的常量引用参数。</td>
</tr>
<tr>
<td>语法</td>
<td>典型声明ClassName(const ClassName&amp; other)</td>
</tr>
<tr>
<td>深拷贝和浅拷贝</td>
<td>浅拷贝复制值，深拷贝创建资源的独立副本。对于包含指针的类，深拷贝通常必要。</td>
</tr>
<tr>
<td>规则三则</td>
<td>如果实现拷贝构造函数、拷贝赋值运算符或析构函数中的任何一个，通常应该实现所有三个。</td>
</tr>
<tr>
<td>避免不必要的拷贝</td>
<td>对大型对象，使用移动语义避免不必要的拷贝，并在传递对象时使用引用或者指针。</td>
</tr>
<tr>
<td>拷贝构造函数的隐式调用</td>
<td>不仅在显式复制时调用，也可能在将对象作为函数参数传递、从函数返回对象时隐式调用。</td>
</tr>
<tr>
<td>禁用拷贝构造函数</td>
<td>对某些类，可以通过将拷贝构造函数声明为私有或使用delete关键字禁用拷贝。</td>
</tr>
</tbody>
</table>
<h2 id="析构函数">析构函数</h2>
<p>析构函数在对象生命周期结束时被自动调用，用于执行对象销毁前的清理工作。析构函数对于涉及动态分配资源（内存、文件句柄、网络连接等）情况特别重要。</p>
<ol>
<li>语法：~MyClass()</li>
<li>无返回值和参数</li>
<li>自动调用：当对象生命周期结束时（例如，一个局部对象的作用域结束，或者使用delete删除动态分配的对象），析构函数会被自动调用。</li>
<li>不可重载：每个类只能有一个析构函数。</li>
<li>继承和多态：如果一个类是多态基类，其析构函数应该是虚的。</li>
</ol>
<h2 id="静态成员">静态成员</h2>
<p>静态成员包括静态成员变量和静态成员函数。特点如下</p>
<ul>
<li>静态成员变量
<ol>
<li>定义：静态成员变量是类的所有对象共享的变量。与普通成员变量相比，无论创建多少个类实例，静态成员变量只有一份拷贝。</li>
<li>初始化：静态成员变量需要在类外进行初始化，通常在类的实现文件中。</li>
<li>访问：静态成员变量可以通过类型直接访问，不要创建类的对象。也可以通过类的对象访问。</li>
<li>用途：常用于存储类级别的信息（例如，计数类的实例数量）或全局数据需要被类的所有实例共享。</li>
</ol>
</li>
<li>静态成员函数
<ol>
<li>定义：静态成员函数是可以不依赖于类的实例而被调用的函数。它不能访问类的非静态成员变量和非静态成员函数。</li>
<li>访问：可以通过类名直接调用，也可以通过类的实例调用。</li>
<li>用途：通常用于实现与具体对象无关的功能，或访问静态成员变量。</li>
</ol>
</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="type">static</span> <span class="type">int</span> staticValue;<span class="comment">//静态变量</span></span><br><span class="line">  <span class="built_in">MyClass</span>()&#123;</span><br><span class="line">    staticValue++;</span><br><span class="line">  &#125;</span><br><span class="line">  ~<span class="built_in">MyClass</span>()&#123;</span><br><span class="line">    staticValue--;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="type">static</span> <span class="type">int</span> <span class="title">getStaticValue</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> staticValue;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//类外初始化静态成员变量</span></span><br><span class="line"><span class="type">int</span> MyClass::staticValue = <span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  MyClass obj1, obj2;</span><br><span class="line">  std::cout &lt;&lt; MyClass::staticValue &lt;&lt; std::endl;</span><br><span class="line">  std::cout &lt;&lt; MyClass::<span class="built_in">getStaticValue</span>() &lt;&lt; std::endl;</span><br><span class="line">  std::cout &lt;&lt; obj1.<span class="built_in">getStaticValue</span>() &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="继承">继承</h2>
<p>继承允许一个类（称为派生类或子类）继承另一个类（称为基类或父类）的属性和方法。继承的主要目的是实现<strong>代码的重用</strong>，以及建立一种<strong>类型之间的层次关系</strong>。其特点如下：</p>
<ol>
<li>代码重用：子类继承了父类的属性和方法，减少代码的重复编写。</li>
<li>扩展性：子类可以扩展父类的功能，添加新的属性和方法，或者重写（覆盖）现有的方法。</li>
<li>多态性：通过继承和虚函数，允许在<strong>运行时</strong>决定调用哪个函数（某个子类的函数或者父类的函数）</li>
<li>继承访问权限：public,protect,private<br>
不同访问级别的继承如何影响基类的不同访问级别的成员在派生类中的访问级别<br>
|基类成员类型|public继承|protected继承|private继承|<br>
|—|—|—|—|<br>
|public|public|protected|private|<br>
|protected|protected|protected|private|<br>
|private|不可访问|不可访问|不可访问|</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Base</span>&#123;<span class="comment">//基类</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">show</span><span class="params">()</span></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Base show&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Derived</span>: <span class="keyword">public</span> Base&#123;<span class="comment">//派生类，用:表示继承</span></span><br><span class="line">  <span class="comment">//继承了Base的所有共有成员</span></span><br><span class="line">  <span class="comment">//添加新方法</span></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">run</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  Derived d;</span><br><span class="line">  d.<span class="built_in">show</span>();<span class="comment">//调用继承来自Base的show方法</span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2025/02/24/QT-C/QT-C/image-20250314112658753.png" alt="image-20250314112658753"></p>
<h3 id="分文件方式实现继承">分文件方式实现继承</h3>
<p>animal.h</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> ANIMAL_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ANIMAL_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  string name;</span><br><span class="line">  <span class="type">int</span> age;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">  <span class="type">int</span> protectAnimal;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  <span class="type">int</span> wildOrHome;</span><br><span class="line">  </span><br><span class="line">  <span class="built_in">Animal</span>();</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">makeSound</span><span class="params">()</span></span>;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">eatFood</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">//ANIMAL_H</span></span></span><br></pre></td></tr></table></figure>
<p>animal.cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;animal.h&quot;</span></span></span><br><span class="line">Animal::<span class="built_in">Animal</span>()&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Animal::makeSound</span><span class="params">()</span></span>&#123;</span><br><span class="line">  cout &lt;&lt; <span class="string">&quot;动物叫&quot;</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Animal::eatFood</span><span class="params">()</span></span>&#123;</span><br><span class="line">  cout &lt;&lt; <span class="string">&quot;动物吃&quot;</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>lion.h</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> LION_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LION_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;animal.h&quot;</span></span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Lion</span>: <span class="keyword">protected</span> Animal&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="type">int</span> sleepingTime;</span><br><span class="line">  <span class="built_in">Lion</span>();</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">hunting</span><span class="params">()</span></span>;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">testFun</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">//LION_H</span></span></span><br></pre></td></tr></table></figure>
<p>lion.cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;lion.h&quot;</span></span></span><br><span class="line">Lion::<span class="built_in">Lion</span>()&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">testFunc</span><span class="params">()</span></span>&#123;</span><br><span class="line">  name = <span class="string">&quot;狮子&quot;</span>;</span><br><span class="line">  protectAnimal = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Lion::hunting</span><span class="params">()</span></span>&#123;</span><br><span class="line">  cout &lt;&lt; <span class="string">&quot;狮子捕猎&quot;</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>cat.h</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> CAT_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CAT_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;animal.h&quot;</span></span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cat</span>: <span class="keyword">public</span> Animal&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">Lion</span>();</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">eatFish</span><span class="params">()</span></span>;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">digAHole</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">//LION_H</span></span></span><br></pre></td></tr></table></figure>
<p>cat.cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;cat.h&quot;</span></span></span><br><span class="line">Cat::<span class="built_in">Cat</span>()&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Cat::eatFish</span><span class="params">()</span></span>&#123;</span><br><span class="line">  cout &lt;&lt; <span class="string">&quot;猫吃鱼&quot;</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Cat::digAHole</span><span class="params">()</span></span>&#123;</span><br><span class="line">  cout &lt;&lt; <span class="string">&quot;猫挖洞，要干啥&quot;</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>main.cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;animal.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;lion.h&quot;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  Animal a;</span><br><span class="line">  a.<span class="built_in">makeSound</span>();</span><br><span class="line">  Lion l;</span><br><span class="line">  l.<span class="built_in">makeSound</span>();</span><br><span class="line">  l.<span class="built_in">hunting</span>();</span><br><span class="line">  Cat c;</span><br><span class="line">  c.<span class="built_in">eatFood</span>();</span><br><span class="line">  c.<span class="built_in">eatFish</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="基类构造函数">基类构造函数</h3>
<p>派生类可以通过其构造函数的初始化列表来调用基类的构造函数。创建派生类对象时，基类的构造函数总是在派生类的构造函数之前被调用。没有指定基类构造函数时调用默认构造函数。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Base</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="type">int</span> data;</span><br><span class="line">  <span class="built_in">Base</span>(<span class="type">int</span> x)&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Base constructor with x=&quot;</span> &lt;&lt; x &lt;&lt; std::endl;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Derived</span>: <span class="keyword">public</span> Base&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="type">double</span> ydata;</span><br><span class="line">  <span class="built_in">Derived</span>(<span class="type">int</span> x, <span class="type">double</span> y): <span class="built_in">Base</span>(x)&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Derived constructor with y = &quot;</span> &lt;&lt; y &lt;&lt; std::endl;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="function">Derive <span class="title">obj</span><span class="params">(<span class="number">10</span>,<span class="number">3.14</span>)</span></span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="虚函数">虚函数</h3>
<p>virtual和override关键字用于支持涉及类继承和方法重载的多态。<br>
<strong>virtual</strong></p>
<ul>
<li>使用场景：在基类中声明虚函数</li>
<li>目的：允许派生类重写该函数，实现多态</li>
<li>行为：通过基类的指针或引用调用一个虚函数时，调用的是对象实际类型的函数模版</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Base</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">func</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Function in Base&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">virtual</span> ~<span class="built_in">Base</span>()&#123;&#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><strong>override</strong></p>
<ul>
<li>使用场景：在派生类中重写虚函数</li>
<li>目的：明确指示派生类中的函数意图重写基类的虚函数</li>
<li>行为：确保派生类的函数确实重写了基类中的一个虚函数(参数，函数名，返回值要匹配)。如果没有匹配的虚函数，编译器会报错。</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Derived</span>: <span class="keyword">public</span> Base &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Function in Derived&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  Base&amp; b = <span class="built_in">Derived</span>();</span><br><span class="line">  b.<span class="built_in">func</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>注意</strong></p>
<ul>
<li>override只在派生类中使用，而且在派生类中重写基类的虚函数</li>
<li>虚析构函数：如果类中有虚函数，通常应该将析构函数也声明为虚函数</li>
<li>继承中的虚函数：一旦在基类中声明为虚函数，该函数在所有派生类中自动成为虚函数，无论是否使用virtual关键字</li>
</ul>
<h3 id="多重继承">多重继承</h3>
<p>多重继承是一种允许一个类同时继承多个基类的特性。多重继承增加语言灵活性同时增加了额外复杂性，特别是当多个基类具有相同的成员时。如果不同的基类有相同名称的成员，则必须明确指出所引用的是哪个基类的成员。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ClassA</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">displayA</span><span class="params">()</span></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Displaying ClassA&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ClassB</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">displayB</span><span class="params">()</span></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Displaying ClassB&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ClassC</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">displayA</span><span class="params">()</span></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Displaying ClassC&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Derived</span>: <span class="keyword">public</span> ClassA, <span class="keyword">public</span> ClassB, <span class="keyword">public</span> ClassC&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">display</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ClassA::<span class="built_in">displayA</span>();</span><br><span class="line">    <span class="built_in">displayB</span>();</span><br><span class="line">    ClassC::<span class="built_in">displayA</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  Derived obj;</span><br><span class="line">  obj.ClassA::<span class="built_in">displayA</span>();</span><br><span class="line">  obj.<span class="built_in">display</span>();</span><br><span class="line">  obj.<span class="built_in">displayB</span>();</span><br><span class="line">  obj.ClassC::<span class="built_in">displayA</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>注意</strong></p>
<ul>
<li>菱形继承问题：如果两个基类继承自同一个更高层的基类，这可能导致派生类中存在两份基类的副本，可以通过虚继承解决</li>
<li>复杂性：多重继承可能会使类的结构变得复杂，尤其是当继承层次较深或类中有多个基类时。</li>
<li>设计考虑：使用组合或接口（纯虚类）</li>
</ul>
<h3 id="虚继承">虚继承</h3>
<p>虚继承解决多重继承中的菱形问题，即一个类继承自两个具有共同基类的类时，会导致共同基类的成员在派生类中存在两份拷贝，这会导致资源浪费和引起数据不一致问题。虚继承通过确保共同基类的单一实例存在于继承层次中，来解决这一问题。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Base</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="type">int</span> data;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Derived1</span>: <span class="keyword">public</span> Base&#123;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Derived2</span>: <span class="keyword">public</span> Base&#123;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FinalDerived</span>: <span class="keyword">public</span> Derived1, <span class="keyword">public</span> Derived2&#123;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  FinalDerived <span class="keyword">final</span>;</span><br><span class="line">  <span class="keyword">final</span>.data = <span class="number">10</span>; <span class="comment">//报错：non-static member &#x27;data&#x27; found in multiple base-class subobjects of type &#x27;Base&#x27;</span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>虚继承, 最终的派生类只含一份基类</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Base</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="type">int</span> data;</span><br><span class="line">  <span class="built_in">Base</span>(<span class="type">int</span> data)&#123;</span><br><span class="line">    <span class="keyword">this</span>-&gt;data = data;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Derived1</span>: <span class="keyword">virtual</span> <span class="keyword">public</span> Base&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">Derived1</span>(<span class="type">int</span> data): <span class="built_in">Base</span>(data)&#123;</span><br><span class="line">  </span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Derived2</span>: <span class="keyword">virtual</span> <span class="keyword">public</span> Base&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">Derived2</span>(<span class="type">int</span> data): <span class="built_in">Base</span>(data)&#123;</span><br><span class="line">  </span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FinalDerived</span>: <span class="keyword">public</span> Derived1, <span class="keyword">public</span> Derived2&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">FinalDerived</span>(<span class="type">int</span> data): <span class="built_in">Derived1</span>(data)&#123;&#125;<span class="comment">//报错:constructor for FinalDerived must explicitly initialize the base class Base which does not have a default constructor</span></span><br><span class="line">  <span class="built_in">FinalDerived</span>(<span class="type">int</span> data): <span class="built_in">Derived1</span>(data), <span class="built_in">Derived2</span>(data), <span class="built_in">Base</span>(data)&#123;&#125;<span class="comment">//警告：Derived1(data), Derived2(data)必须再Base后面初始化</span></span><br><span class="line">  <span class="built_in">FinalDerived</span>(<span class="type">int</span> data): <span class="built_in">Base</span>(data), <span class="built_in">Derived1</span>(data), <span class="built_in">Derived2</span>(data) &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="function">FinalDerived <span class="title">final</span><span class="params">(<span class="number">11</span>)</span></span>;</span><br><span class="line">  <span class="keyword">final</span>.data = <span class="number">10</span>; </span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过将Derived1和Derived2对Base的继承声明为虚继承，FinalDerived类中只会有一份Base类的成员。无论通过Derived1还是Derived2的路径，访问的都是同一个Base类的成员。<br>
<strong>注意</strong></p>
<ul>
<li>初始化虚基类：在使用虚继承时，虚基类（如上Base基类）只能由最派生类（如FinalDerived）初始化。</li>
<li>内存布局：虚继承可能会改变类的内存布局，会增加额外的开销，比如虚基类指针。</li>
<li>设计考虑：设计使用组合或接口（纯虚类）</li>
</ul>
<h3 id="多态">多态</h3>
<p>你有一个遥控器（就像基类指针），该遥控器可以控制不同的电子设备（就像许多派生类），无论电视、音响还是灯光，遥控器的开关按钮（就像虚函数）都能控制他们，但具体的操作那个设备取决于遥控器指向的设备。</p>
<ul>
<li>使用虚函数：
<ul>
<li>在基类中定义一个虚函数，该函数可以在任何派生类中被重写</li>
<li>基类使用关键字virtual声明，派生类可以使用override显示声明重写</li>
</ul>
</li>
<li>创建派生类并重写虚函数：
<ul>
<li>在派生类中提供虚函数的具体实现。</li>
</ul>
</li>
<li>通过基类的引用或指针调用虚函数
<ul>
<li>当使用基类的指针或者引用来调用虚函数时，实际调用的是对象的实际类型（派生类）中的函数版本, <strong>注</strong>：基类指针和引用指向的派生对象调用的只能是基类的虚函数，不能是派生类中非虚函数。</li>
</ul>
</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RemoteCon</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">openUtils</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TvRemoteCon</span>: <span class="keyword">public</span> RemoteCon&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">openUtils</span><span class="params">()</span> <span class="keyword">override</span></span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;电视遥控器被打开&quot;</span> &lt;&lt; endl;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">testFunc</span><span class="params">()</span></span>&#123;&#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RoundspeakerCon</span>: <span class="keyword">public</span> RemoteCon&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">openUtils</span><span class="params">()</span> <span class="keyword">override</span></span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;音响遥控器被打开&quot;</span> &lt;&lt; endl;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LightCon</span>: <span class="keyword">public</span> RemoteCon&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">openUtils</span><span class="params">()</span> <span class="keyword">override</span></span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;灯光遥控器被打开&quot;</span> &lt;&lt; endl;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  RemoteCon* remoteCon = <span class="keyword">new</span> TvRemoteCon;</span><br><span class="line">  remoteCon-&gt;<span class="built_in">openUtils</span>();</span><br><span class="line">  remoteCon-&gt;<span class="built_in">testFunc</span>();<span class="comment">//报错：no member named testFunc in RemoteCon</span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>为什么使用多态：</p>
<ul>
<li>灵活性：允许我们可以处理不确定类型的对象代码</li>
<li>可扩展性：可以添加新的派生类而不必修改使用基类的引用或指针代码。</li>
<li>接口与实现分离：设计一个稳定接口，而将具体实现留给派生类去处理。</li>
</ul>
<h3 id="抽象类">抽象类</h3>
<p>抽象类定义了一组方法，但是这些方法没有具体实现，意味着抽象类定义了派生类应该具有的功能，但不完全实现这些功能。<br>
抽象类特点：</p>
<ul>
<li>包含至少一个纯虚函数：
<ul>
<li>抽象类至少有一个纯虚函数，它是一种特殊虚函数，在抽象类中没有具体实现，而是留给派生类去实现。</li>
<li>纯虚函数的声明方式是在虚函数声明的末尾加上= 0。</li>
</ul>
</li>
<li>不能直接实例化：
<ul>
<li>由于抽象类不完整，所以不能直接创建他的对象。就像你不能直接使用交通工具概念去任何地方，你需要具体的交通工具去。</li>
</ul>
</li>
<li>用于提供基础结构：
<ul>
<li>抽象类的主要目的是为派生类提供一个共同的基础结构，确保所有派生类都有一致的接口和行为。</li>
</ul>
</li>
<li>派生类必须实现全部的基类纯虚函数，否则派生类还是抽象类也不能实例化。</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Teacher</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  string name;</span><br><span class="line">  string school;</span><br><span class="line">  string major;</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">goInClass</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">startTeaching</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">afterTeaching</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EnglishTeacher</span>: <span class="keyword">public</span> Teacher&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">goInClass</span><span class="params">()</span> <span class="keyword">override</span></span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;英语老师开始进入教室&quot;</span> &lt;&lt; endl;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">startTeaching</span><span class="params">()</span> <span class="keyword">override</span></span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;英语老师开始教学&quot;</span> &lt;&lt; endl;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">afterTeaching</span><span class="params">()</span> <span class="keyword">override</span></span>&#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  Teacher t; <span class="comment">//报错：抽象类不能实例化</span></span><br><span class="line">  EnglishTeacher e;</span><br><span class="line">  e.<span class="built_in">goInClass</span>();</span><br><span class="line">  Teacher* t1 = <span class="keyword">new</span> EnglishTeacher;<span class="comment">//抽象类支持多态</span></span><br><span class="line">  t1-&gt;<span class="built_in">startTeaching</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="纯虚函数-接口">纯虚函数-接口</h3>
<p>C++不像java有接口关键字interface来定义接口，但可以通过抽象类和纯虚函数的方式来实现接口的概念。<br>
接口通常用于定义类应该实现的方法，但不提供具体实现。接口允许多个类共享相同的成员函数，同时让每个类根据需要去实现这些接口。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BasketBallMove</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">passTheBall</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LiveMove</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">eat</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">bite</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">drink</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">la</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Human</span>: <span class="keyword">public</span> LiveMove, <span class="keyword">public</span> BasketBallMove&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">eat</span><span class="params">()</span> <span class="keyword">override</span></span>&#123;;&#125;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">bite</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;;&#125;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">drink</span><span class="params">()</span> <span class="keyword">override</span></span>&#123;;&#125;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">la</span><span class="params">()</span> <span class="keyword">override</span></span>&#123;;&#125;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">passTheBall</span><span class="params">()</span> <span class="keyword">override</span></span>&#123;;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span>: <span class="keyword">public</span> LiveMove&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">eat</span><span class="params">()</span> <span class="keyword">override</span></span>&#123;;&#125;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">bite</span><span class="params">()</span> <span class="keyword">override</span></span>&#123;;&#125;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">drink</span><span class="params">()</span> <span class="keyword">override</span></span>&#123;;&#125;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">la</span><span class="params">()</span> <span class="keyword">override</span></span>&#123;;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  Human h;</span><br><span class="line">  Dog g;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="模版">模版</h2>
<p>模版(template)是一种通用的编程工具,允许程序员编写<strong>泛型代码</strong>，使得类或者函数能够适用于<strong>多种不同的数据类型</strong>而不需要重复编写相似的代码。</p>
<h3 id="类模版">类模版</h3>
<p>类模版能够定义通用的类，其中某些类型可以作为参数。这样的类可以处理不同类型的数据，而不需要为每个数据类型编写单独的类。<strong>注</strong>：模版类的成员函数定义不能在类定义外，只能在类内</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyTemplate</span>&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  T data;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">MyTemplate</span>(T d): <span class="built_in">data</span>(d) &#123;&#125;</span><br><span class="line">  <span class="function">T <span class="title">getData</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> data;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//报错：不允许</span></span><br><span class="line"><span class="comment">//T MyTemplate::getData()&#123;</span></span><br><span class="line"><span class="comment">//    return data;</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="comment">//使用类模版创建对象</span></span><br><span class="line">  <span class="function">MyTemplate&lt;<span class="type">int</span>&gt; <span class="title">intObject</span><span class="params">(<span class="number">5</span>)</span></span>;</span><br><span class="line">  MyTemplate&lt;std::string&gt; stringObject = <span class="built_in">MyTemplate</span>&lt;std::string&gt;(<span class="string">&quot;Hello&quot;</span>)</span><br><span class="line">  <span class="comment">//调用类模版中的函数</span></span><br><span class="line">  std::cout &lt;&lt; intObject.<span class="built_in">getData</span>() &lt;&lt; std::endl;</span><br><span class="line">  std::cout &lt;&lt; stringObject.<span class="built_in">getData</span>() &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="函数模版">函数模版</h3>
<p>函数模版允许编写通用函数，可以处理多种不同类型的数据。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定义函数模版</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function">T <span class="title">add</span><span class="params">(T a, T b)</span></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a+b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="comment">//使用函数模版调用通用函数</span></span><br><span class="line">  <span class="type">int</span> result1 = <span class="built_in">add</span>(<span class="number">5</span>, <span class="number">10</span>);</span><br><span class="line">  <span class="type">double</span> result2 = <span class="built_in">add</span>(<span class="number">3.5</span>, <span class="number">2.7</span>)</span><br><span class="line">  <span class="comment">//输出函数模版调用结果</span></span><br><span class="line">  std::cout &lt;&lt; <span class="string">&quot;Result 1:&quot;</span> &lt;&lt; result1 &lt;&lt; std::endl;</span><br><span class="line">  std::cout &lt;&lt; <span class="string">&quot;Result 2:&quot;</span> &lt;&lt; result2 &lt;&lt; std::endl;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>模版提高了代码的重用性和可维护性</p>
<h3 id="模版特化">模版特化</h3>
<p>模版特化允许针对特定的数据类型或特定的模版参数提供定制化的实现。允许您为模版提供一个特殊的实现，以覆盖或扩展默认的模版行为。<strong>注</strong>：模版特化需要再写一遍主模版，但是类型参数那个确定了类型就省略那个参数</p>
<p>有两种类型的模版特化：完全特化和部分特化。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> N&gt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">(T a, N b)</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//完全特化</span></span><br><span class="line"><span class="keyword">template</span> &lt;&gt; </span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">(<span class="type">int</span> a, <span class="type">double</span> b)</span></span>&#123;&#125;</span><br><span class="line"><span class="comment">//部分特化</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> N&gt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">(<span class="type">int</span> a, N b)</span></span>&#123;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="模版声明">模版声明</h3>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定义</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> A&gt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">swap</span><span class="params">(T&amp; a, A&amp; b)</span></span>&#123;</span><br><span class="line">  T tmp = a;</span><br><span class="line">  a = b;</span><br><span class="line">  b = tmp;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//模版声明</span></span><br><span class="line"><span class="keyword">template</span> </span><br><span class="line"><span class="type">void</span> <span class="built_in">swap</span>&lt;<span class="type">int</span>, <span class="type">int</span>&gt;(<span class="type">int</span>&amp; a, <span class="type">int</span>&amp; b);</span><br><span class="line"><span class="comment">//显式实例化(使用)</span></span><br><span class="line"><span class="built_in">swap</span>&lt;<span class="type">int</span>, <span class="type">int</span> &gt;(<span class="number">1</span>,<span class="number">3</span>);</span><br><span class="line"><span class="comment">//隐式实例化（使用）</span></span><br><span class="line"><span class="built_in">swap</span>(<span class="number">2</span>,<span class="number">4</span>);</span><br><span class="line"><span class="comment">//特化</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="type">void</span> <span class="built_in">swap</span>&lt;T, <span class="type">double</span>&gt;(T&amp; a, <span class="type">double</span> b)&#123;</span><br><span class="line">  T tmp = a;</span><br><span class="line">  a = b;</span><br><span class="line">  b = tmp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="强制转换">强制转换</h2>
<p>在C++中，强制类型转换是一种将变量从一种类型转换成另一种类型的方法。C++提供了四种强制转换运算符，每种都有其特定的用途和使用场景：</p>
<ol>
<li><strong>static_cast</strong>:
<ul>
<li>static_cast是最常用的类型转换运算符，用于无风险的转换，如整数到浮点数，字符到整数等。</li>
<li>它在编译时执行，不执行运行时类型检查（RTTI）。</li>
<li>示例：<code>int x = static_cast&lt;int&gt;(y);</code> 其中<code>y</code>可能是<code>float</code>类型。</li>
</ul>
</li>
<li><strong>dynamic_cast</strong>:
<ul>
<li>专门用于处理对象的多态性，只能用于指针和引用，且涉及对象类必须有虚函数。</li>
<li>它在运行时检查类型的安全性，如果类型转换失败，对于指针类型返回<code>nullptr</code>，对于引用类型抛出异常。</li>
<li>示例：<code>Derived* dp = dynamic_cast&lt;Derived*&gt;(bp);</code>其中<code>bp</code>是基类指针，<code>Derived</code>是派生类。</li>
</ul>
</li>
<li><strong>const_cast</strong>:
<ul>
<li>用于修改类型的<code>const</code>或<code>volatile</code>属性。</li>
<li>通常用于去除对象的<code>const</code>性质，允许修改原本被声明为<code>const</code>的变量。</li>
<li>示例：<code>const int a = 10; int* b = const_cast&lt;int*&gt;(&amp;a);</code></li>
</ul>
</li>
<li><strong>reinterpret_cast</strong>:
<ul>
<li>用于进行低级别的重新解释转换，几乎无限制，但也是最危险的。</li>
<li>它可以将一种完全不相关的类型转换为另一种类型，比如将指针类型转换为整数类型。</li>
<li>示例：<code>long p = reinterpret_cast&lt;long&gt;(&amp;object);</code>其中<code>object</code>是某个类的对象。</li>
</ul>
</li>
</ol>
<h2 id="软件开发网络通信架构">软件开发网络通信架构</h2>
<h3 id="BS架构-CS架构">BS架构/CS架构</h3>
<p><strong>CS架构（客户-服务器架构）</strong></p>
<p>CS架构是典型的两层结构，包括客户端和服务器两个部分。客户端和服务器通过网络进行通信，每一部分有明确的职责。</p>
<ol>
<li>客户端
<ul>
<li>用户界面通常在客户端呈现。</li>
<li>可以是桌面应用程序、移动应用或专用软件。</li>
<li>负责向服务器发送请求，接收和处理服务响应。</li>
</ul>
</li>
<li>服务器
<ul>
<li>管理数据和业务逻辑。</li>
<li>处理来自客户端的请求，并发送响应。</li>
<li>通常承载在远程系统上，如数据库服务器、应用服务器等。</li>
</ul>
</li>
<li>特点
<ul>
<li>需要为每种操作系统或平台单独开发客户端。</li>
<li>高效的数据处理和响应能力。</li>
<li>在客户端设备上占用资源（内存、cpu）。</li>
</ul>
</li>
</ol>
<p><strong>BS架构（浏览器-服务器架构）</strong></p>
<p>BS架构是一种基于Web的三层或多层架构，主要通过Web浏览器作为客户端访问服务器上的应用程序。</p>
<ol>
<li>浏览器（客户端）
<ul>
<li>使用标准Web浏览器（如Chrome, Firefox）作为客户端。</li>
<li>无需安装额外的软件，使用HTML, CSS和JavaScript显示内容。</li>
</ul>
</li>
<li>服务器
<ul>
<li>和CS架构中的服务器类似，处理业务逻辑和数据存储。</li>
<li>通过Web服务（HTTP服务器）提供页面和数据。</li>
</ul>
</li>
<li>特点
<ul>
<li>跨平台兼容性强，可以在任何支持Web浏览器的设备上运行。</li>
<li>客户端无需安装专用软件，容易维护和更新。</li>
<li>可能依赖网络性能，所有操作都在服务器上进行。</li>
</ul>
</li>
</ol>
<p><strong>对比</strong></p>
<ul>
<li>部署和维护：BS架构易于部署和维护，而CS架构通常需要在每个客户端单独安装和更新。</li>
<li>性能：CS架构可以更有效的利用客户端的计算资源，适合高性能要求的应用。BS架构依赖于服务器的性能和网络延迟。</li>
<li>安全性：CS架构中数据经常在客户端和服务器之间传输，可能需要更复杂的安全措施。BS架构中敏感数据主要存储在服务器端。</li>
<li>用户体验：CS架构通常能提供更丰富的用户界面和交互功能。BS架构的用户体验受限于Web技术的能力。</li>
</ul>
<h3 id="HTTP">HTTP</h3>
<p>HTTP（超文本传输协议）是一种用于分布式、协作式和超媒体信息系统的应用协议。他是万维网（www）的数据通信基础。</p>
<ol>
<li>
<p>请求和响应</p>
<p>HTTP是基于请求-响应模式的协议。客户端（通常是Web浏览器）向服务器发送一个HTTP请求，然后服务器返回一个HTTP响应。请求包含请求的资源（如网页），而响应包含请求的资源的内容。</p>
</li>
<li>
<p>HTTP方法</p>
<ul>
<li>GET：用于请求资源。</li>
<li>POST: 用于提交数据给服务器。</li>
<li>PUT：用于上传文件或内容。</li>
<li>DELETE：用于请求删除资源。</li>
<li>HEAD：用于获取资源的元信息，而不是资源本身。</li>
</ul>
</li>
<li>
<p>状态码</p>
<ul>
<li>200 OK：请求成功</li>
<li>404 Not Found：请求的资源未找到</li>
<li>500 Internal Server Error：服务器内部错误</li>
<li>301 Moved Permanently：请求的资源已永久移动到新位置</li>
</ul>
</li>
<li>
<p>URL（统一资源定位符）</p>
<p>URL是Web上的资源地址。它指定了资源的位置以及用于访问资源的协议。</p>
</li>
<li>
<p>HTTP头</p>
<p>HTTP请求和响应包含头部信息，包括元数据，例如内容类型，内容长度，服务器信息，客户端信息等。<code>Content-Type</code>头部指示响应中的媒体类型（如text/html, application/json）</p>
</li>
<li>
<p>无状态协议</p>
<p>HTTP是一个无状态协议，即服务器不会保留任何请求的数据状态。而使用Cookies这样的机制可以在多个请求之间维持状态。</p>
</li>
<li>
<p>安全性</p>
<p>HTTPS是HTTP的安全版本，它在HTTP和TCP之间增加了一个加密层（通常是SSL/TLS）。这提供了数据传输的加密和更好的安全性。</p>
</li>
<li>
<p>RESTful API</p>
<p>RESTful是一种使用HTTP协议的Web服务设计风格，它利用HTTP的方法来实现API的不同操作。在RESTful架构中，每个URL代表一个资源，并使用HTTP的方法（GET/POST）来处理这些资源。</p>
</li>
<li>
<p>Session和Cookies</p>
<p>由于HTTP本身是无状态的，Cookies和会话（Session）被用来在多个请求之间存储用户数据，从而为用户提供连贯的体验。</p>
</li>
</ol>
<h2 id="JSON数据">JSON数据</h2>
<p>JSON（javascript object notation）是一种轻量级的数据交换格式。优点：</p>
<table>
<thead>
<tr>
<th>原因</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>易于阅读和编写</td>
<td>JSON结构简单、清晰，对人类来说易于阅读和编写。</td>
</tr>
<tr>
<td>轻量级数据格式</td>
<td>相较于XML标记语言，JSON更轻量，使用更少的符号，数据体积更小。</td>
</tr>
<tr>
<td>易于解析和生成</td>
<td>大多数编程语言都提供了解析和生成JSON的内置支持库。</td>
</tr>
<tr>
<td>跨语言支持</td>
<td>JSON是独立于语言的，被广泛支持和使用在多种编程语言中。</td>
</tr>
<tr>
<td>网络友好</td>
<td>JSON格式适合WEB环境，易于通过网络传输，是WEB API的常用格式。</td>
</tr>
<tr>
<td>数据互操作性</td>
<td>作为一种标准化格式，JSON提高了不同系统间的数据互操作性。</td>
</tr>
</tbody>
</table>
<p>不同语言处理JSON的库</p>
<table>
<thead>
<tr>
<th>语言/平台</th>
<th>Json处理库/接口</th>
<th>特点/描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>C</td>
<td>Jansson</td>
<td>提供JSON的编码、解码和处理功能</td>
</tr>
<tr>
<td>C++</td>
<td>nlohmann/json</td>
<td>json库，易于使用</td>
</tr>
<tr>
<td>Java</td>
<td>Jackson</td>
<td>强大JSON处理库，支持JSON序列化和反序列化</td>
</tr>
<tr>
<td></td>
<td>Gson</td>
<td>Google提供的JSON序列化和反序列化库</td>
</tr>
<tr>
<td>Python</td>
<td>json</td>
<td>Python标准库中的JSON处理模块</td>
</tr>
<tr>
<td>Qt</td>
<td>QJsonDocument</td>
<td>Qt框架中用于JSON处理类</td>
</tr>
<tr>
<td></td>
<td>QJsonObject</td>
<td>用于表示JSON对象的Qt类</td>
</tr>
<tr>
<td></td>
<td>QJsonArray</td>
<td>用于表示JSON数组的Qt类</td>
</tr>
<tr>
<td>Android</td>
<td>org.json</td>
<td>Android SDK自带的JSON处理类，提供基础JSON操作功能</td>
</tr>
<tr>
<td>iOS</td>
<td>JSONSerialization</td>
<td>Apple提供的用于JSON处理的类，Swift和Objective-C标准库中的模块</td>
</tr>
</tbody>
</table>
<h3 id="Qt生成JSON数据">Qt生成JSON数据</h3>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QJsonDocument&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QJsonObject&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QJsonArray&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QFile&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">createJsonFile</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="comment">//创建一个Json对象</span></span><br><span class="line">  QJsonObject jsonObj;</span><br><span class="line">  jsonObj[<span class="string">&quot;name&quot;</span>] = <span class="string">&quot;Jonh Doe&quot;</span>;</span><br><span class="line">  jsonObj[<span class="string">&quot;age&quot;</span>] = <span class="number">30</span>;</span><br><span class="line">  jsonObj[<span class="string">&quot;email&quot;</span>] = <span class="string">&quot;john.doe@example.com&quot;</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//创建一个Json数组</span></span><br><span class="line">  QJsonArray jsonArr;</span><br><span class="line">  jsonArr.<span class="built_in">append</span>(<span class="string">&quot;C++&quot;</span>);</span><br><span class="line">  jsonArr.<span class="built_in">append</span>(<span class="string">&quot;python&quot;</span>);</span><br><span class="line">  jsonArr.<span class="built_in">append</span>(<span class="string">&quot;javascript&quot;</span>);</span><br><span class="line">  jsonArr.<span class="built_in">append</span>(<span class="number">13</span>);</span><br><span class="line">  <span class="comment">//将数组添加到json对象</span></span><br><span class="line">  jsonObj[<span class="string">&quot;languages&quot;</span>] = jsonArr;</span><br><span class="line">  <span class="comment">//创建子对象</span></span><br><span class="line">  QJsonObject jsonSon;</span><br><span class="line">  jsonSon[<span class="string">&quot;sonId&quot;</span>] = <span class="number">244</span>;</span><br><span class="line">  <span class="comment">//将子对象添加到父对象</span></span><br><span class="line">  jsonObj[<span class="string">&quot;son&quot;</span>] = jsonSon;</span><br><span class="line">  <span class="comment">//将Json对象转为Json文档</span></span><br><span class="line">  <span class="function">QJsonDocument <span class="title">jsonDoc</span><span class="params">(jsonObj)</span></span>;</span><br><span class="line">  <span class="comment">//将Json文档转换为字符串</span></span><br><span class="line">  QByteArray jsonData = jsonDoc.<span class="built_in">toJson</span>(QJsonDocument::Indented);</span><br><span class="line">  <span class="comment">//将Json数据写入文件</span></span><br><span class="line">  <span class="function">QFile <span class="title">file</span><span class="params">(<span class="string">&quot;output.json&quot;</span>)</span></span>;</span><br><span class="line">  <span class="keyword">if</span> (!file.<span class="built_in">open</span>(QIODevice::WriteOnly))&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;Failed to open file for writing&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  file.<span class="built_in">write</span>(jsonData);</span><br><span class="line">  file.<span class="built_in">close</span>();</span><br><span class="line">  <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;JSON data saved to output.json&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="built_in">createJsonFile</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="QT解析JSON数据">QT解析JSON数据</h3>
<p>假设有一个json字符串</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;John Doe&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span> <span class="number">30</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span><span class="string">&quot;john.doe@example.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;skill&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;c++&quot;</span><span class="punctuation">,</span> <span class="string">&quot;python&quot;</span><span class="punctuation">,</span> <span class="string">&quot;java&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;sonId&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">123</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QJsonDocument&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QJsonObject&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QJsonArray&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QFile&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">parseJson</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">  R&quot;()&quot;是用于定义原始字符串字面量的标记。</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  QString jsonString = <span class="string">R&quot;(</span></span><br><span class="line"><span class="string">    &#123;</span></span><br><span class="line"><span class="string">      &quot;name&quot;: &quot;John Doe&quot;,</span></span><br><span class="line"><span class="string">      &quot;age&quot;: 30,</span></span><br><span class="line"><span class="string">      &quot;email&quot;:&quot;john.doe@example.com&quot;,</span></span><br><span class="line"><span class="string">      &quot;skill&quot;: [&quot;c++&quot;, &quot;python&quot;, &quot;java&quot;],</span></span><br><span class="line"><span class="string">      &quot;sonId&quot;: &#123;</span></span><br><span class="line"><span class="string">        &quot;id&quot;: 123</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  )&quot;</span>;</span><br><span class="line">  <span class="comment">//将Json字符串转成QJsonDocument</span></span><br><span class="line">  QJsonDocument jsonDoc = QJsonDocument::<span class="built_in">fromJson</span>(jsonString.<span class="built_in">toUtf8</span>());</span><br><span class="line">  <span class="comment">//检查JSON文件是否包含一个对象</span></span><br><span class="line">  <span class="keyword">if</span> (!jsonDoc.<span class="built_in">isNull</span>() &amp;&amp; jsonDoc.<span class="built_in">isObject</span>())&#123;</span><br><span class="line">    <span class="comment">//获取JSON对象</span></span><br><span class="line">    QJsonObject jsonObj = jsonDoc.<span class="built_in">object</span>();</span><br><span class="line">    <span class="comment">//访问对象的键值</span></span><br><span class="line">    QString name = jsonObj[<span class="string">&quot;name&quot;</span>].<span class="built_in">toString</span>();</span><br><span class="line">    <span class="type">int</span> age = jsonObj[<span class="string">&quot;age&quot;</span>].<span class="built_in">toInt</span>();</span><br><span class="line">    QString email = jsonObj[<span class="string">&quot;email&quot;</span>].<span class="built_in">toString</span>();</span><br><span class="line">    <span class="comment">//处理Json数组</span></span><br><span class="line">    <span class="keyword">if</span> (jsonObj.<span class="built_in">contains</span>(<span class="string">&quot;skills&quot;</span>) &amp;&amp; jsonObj[<span class="string">&quot;skills&quot;</span>].<span class="built_in">isArray</span>())&#123;</span><br><span class="line">      QJsonArray skillsArray = jsonObj[<span class="string">&quot;skills&quot;</span>].<span class="built_in">toArray</span>();</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">const</span> QJsonValue&amp; value: skillsArray)&#123;</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;Skills:&quot;</span> &lt;&lt; value.<span class="built_in">toString</span>();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;Invalid JSON...&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="built_in">parseJson</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Model-View结构">Model/View结构</h2>
<img src="/2025/02/24/QT-C/QT-C/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-07-23%20093322.png" alt="屏幕截图 2025-07-23 093322" style="zoom: 50%;">
<ul>
<li>数据：如数据库的一个数据表或SQL查询结果，内存中的一个StringList,或磁盘文件结构等。</li>
<li>Model:  与数据通信，并为视图组件提供数据接口。</li>
<li>View（组件）: 屏幕上的界面组件，视图从数据模型获得每个数据项的模型索引(model index)，通过模型索引获取数据。</li>
<li>delegate/proxy: 控制model如何编辑数据和view如何显示模型（在界面上行为/功能）。在标准的视图组件中，代理功能显示一个数据，当数据被编辑时，提供一个编辑器，一般是QLineEdit.</li>
<li>数据和Model一对一，model和View是多对多。</li>
</ul>
<p><strong>数据模型种类</strong></p>
<table>
<thead>
<tr>
<th>Model类</th>
<th>用途</th>
</tr>
</thead>
<tbody>
<tr>
<td>QStringListModel</td>
<td>用于处理字符串列表数据的数据模型类</td>
</tr>
<tr>
<td>QStandardItemModel</td>
<td>标准的基于项数据的数据模型类，每个项数据可以是任何数据类型</td>
</tr>
<tr>
<td>QFileSystemModel</td>
<td>计算机上文件系统的数据模型类</td>
</tr>
<tr>
<td>QSortFilterProxyModel</td>
<td>与其他数据模型结合，提供排序和过滤功能的数据模型类</td>
</tr>
<tr>
<td>QSqlQueryModel</td>
<td>用于数据库SQL查询结果的数据模型类</td>
</tr>
<tr>
<td>QSqlTableModel</td>
<td>用于数据库的一个数据表的数据模型类</td>
</tr>
<tr>
<td>QSqlRelationalTableModel</td>
<td>用于关系型数据表的数据模型类</td>
</tr>
</tbody>
</table>
<p><strong>view组件</strong></p>
<p><img src="/2025/02/24/QT-C/QT-C/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-07-23%20095142.png" alt="屏幕截图 2025-07-23 095142"></p>
<p><strong>代理</strong></p>
<p><img src="/2025/02/24/QT-C/QT-C/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-07-23%20095317.png" alt="屏幕截图 2025-07-23 095317"></p>
<ul>
<li>当我们有通过模型编辑数据的需求时可以使用代理</li>
<li>当我们想展示非LineEdit类型组件时可以使用代理</li>
</ul>
<p><img src="/2025/02/24/QT-C/QT-C/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-07-24%20143127.png" alt="屏幕截图 2025-07-24 143127"></p>
<p>派生类必须实现三个代理抽象类的虚函数。</p>
<p><img src="/2025/02/24/QT-C/QT-C/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-07-24%20143210.png" alt="屏幕截图 2025-07-24 143210"></p>
<p><strong>数据项</strong></p>
<p>项的三要素：父项、行号、列号</p>
<p><img src="/2025/02/24/QT-C/QT-C/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-07-23%20095557.png" alt="屏幕截图 2025-07-23 095557"></p>
<p>QModelIndex()是根项Root item, 查找不同模型的各项。</p>
<p><img src="/2025/02/24/QT-C/QT-C/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-07-23%20095850.png" alt="屏幕截图 2025-07-23 095850"></p>
<p><strong>数据项角色</strong></p>
<p>一个项可以配置多种角色和数据，项可以根据角色过滤出数据。</p>
<p><img src="/2025/02/24/QT-C/QT-C/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-07-23%20100154.png" alt="屏幕截图 2025-07-23 100154"></p>
<p><strong>文件系统模型</strong></p>
<p><img src="/2025/02/24/QT-C/QT-C/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-07-23%20100612.png" alt="屏幕截图 2025-07-23 100612"></p>
<p>可以让文件系统模型对应多种视图treeView, listView, tableView。</p>
<p><strong>标准项模型</strong></p>
<p><img src="/2025/02/24/QT-C/QT-C/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-07-23%20150303.png" alt="屏幕截图 2025-07-23 150303"></p>
<h2 id="窗体">窗体</h2>
<h3 id="Qt对话框模态和非模态">Qt对话框模态和非模态</h3>
<p>在Qt中，对话框可以分为模态（Modal）和非模态（Modeless）两种类型。</p>
<h4 id="模态对话框（Modal-Dialog）">模态对话框（Modal Dialog）</h4>
<p>模态对话框会阻止用户与应用程序的其他部分交互，直到对话框被关闭。这意味着在模态对话框打开时，用户无法访问或操作应用程序的其余部分，直到模态对话框被关闭。</p>
<p>在Qt中，可以通过<code>QDialog</code>类创建一个模态对话框，并通过调用<code>exec()</code>方法来显示它。</p>
<h4 id="非模态对话框（Modeless-Dialog）">非模态对话框（Modeless Dialog）</h4>
<p>非模态对话框允许用户在与对话框交互的同时，仍然可以与应用程序的其他部分交互。这意味着用户可以在打开非模态对话框的同时，继续使用应用程序的其他功能。</p>
<p>在Qt中，非模态对话框通过调用<code>show()</code>方法而不是<code>exec()</code>方法来显示。</p>
<p><img src="/2025/02/24/QT-C/QT-C/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-07-25%20141635.png" alt="屏幕截图 2025-07-25 141635"><img src="/2025/02/24/QT-C/QT-C/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-07-25%20141659.png" alt="屏幕截图 2025-07-25 141659"></p>
<h3 id="多窗体">多窗体</h3>
<p><img src="/2025/02/24/QT-C/QT-C/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-07-24%20170131.png" alt="屏幕截图 2025-07-24 170131"></p>
<p><img src="/2025/02/24/QT-C/QT-C/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-07-24%20170150.png" alt="屏幕截图 2025-07-24 170150"></p>
<p><img src="/2025/02/24/QT-C/QT-C/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-07-24%20170307.png" alt="屏幕截图 2025-07-24 170307"></p>
<p><img src="/2025/02/24/QT-C/QT-C/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-07-24%20170355.png" alt="屏幕截图 2025-07-24 170355"><img src="/2025/02/24/QT-C/QT-C/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-07-24%20170522.png" alt="屏幕截图 2025-07-24 170522"><img src="/2025/02/24/QT-C/QT-C/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-07-24%20170539.png" alt="屏幕截图 2025-07-24 170539"></p>
<h3 id="MDI模式（Multi-Document-Interface）">MDI模式（Multi Document Interface）</h3>
<p><img src="/2025/02/24/QT-C/QT-C/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-07-25%20140720.png" alt="屏幕截图 2025-07-25 140720"></p>
<h2 id="QT记事本项目">QT记事本项目</h2>
<p><strong>功能介绍</strong></p>
<ul>
<li>文本创建、打开、保存、关闭</li>
<li>UI样式美化</li>
<li>添加打开、保存快捷键</li>
<li>底部显示行列号及文本字符编码</li>
<li>Ctrl加鼠标滚轮支持字体放缩<br>
<strong>工程概述</strong></li>
<li>Qt中MainWindow与Widget项目区别：</li>
</ul>
<ol>
<li>MainWindow包含完整的菜单栏，工具栏和状态栏的主窗口应用程序框架，适合复杂应用程序，需要复杂用户组件。</li>
<li>Widget是一个简单窗体，没有菜单栏，工具栏和状态栏，适合简单或专用应用程序，不用复杂的用户界面组件。</li>
</ol>
<ul>
<li>QApplication: QApplication a(argc,argv);这行代码的作用是创建一个QApplication类的实例。Qt应用必须做的第一步，它负责管理应用程序的许多核心功能。</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//main.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;widget.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QApplication&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span>&#123;</span><br><span class="line">  <span class="function">QApplication <span class="title">a</span><span class="params">(argc, argv)</span></span>;</span><br><span class="line">  Widget w;</span><br><span class="line">  w.<span class="built_in">show</span>();</span><br><span class="line">  <span class="keyword">return</span> a.<span class="built_in">exec</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>QApplication类在Qt框架中的主要功能和职责：</p>
<table>
<thead>
<tr>
<th><strong>功能</strong></th>
<th><strong>说明</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>事件循环</td>
<td>维护事件循环，负责接收和分发各种事件，如鼠标点击、键盘输入等</td>
</tr>
<tr>
<td>全局设置</td>
<td>处理应用程序的全局设置，包括字体，颜色和其他用户界面元素</td>
</tr>
<tr>
<td>GUI的初始化</td>
<td>在没有创建QApplication情况下，无法使用Qt的任何GUI组件，因此它负责初始化GUI环境</td>
</tr>
<tr>
<td>命令行参数处理</td>
<td>可以处理命令行参数，这对于需要命令行交互的应用程序来说是必要的</td>
</tr>
</tbody>
</table>
<ul>
<li>return a.exec()<br>
在Qt中，QApplication::exec()函数用来启动应用程序的事件循环。当调用这个函数时，他会开始处理和分发事件。这个函数会一直运行，直到事件循环结束，通常是因为调用了QApplication:quit()函数或者关闭了应用程序的主窗口。简而言之，exec()是qt程序的主循环，负责监听和响应事件，保持应用程序运行直到用户决定推出。</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//自己的widget.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> WIDGET_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WIDGET_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QWidget&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//声明Qt Designer生成的交互窗口框架</span></span><br><span class="line">QT_BEGIN_NAMESPACE</span><br><span class="line"><span class="keyword">namespace</span> Ui &#123;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Widget</span>;</span><br><span class="line">&#125;</span><br><span class="line">QT_END_NAMESPACE</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Widget</span> : <span class="keyword">public</span> QWidget</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Widget</span>(QWidget *parent = <span class="literal">nullptr</span>);</span><br><span class="line">    ~<span class="built_in">Widget</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Ui::Widget *ui;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// WIDGET_H</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>namespace Ui {class Widget;}<br>
在Qt框架中，namespace Ui {class Widget;}通常定义在使用Qt Designer设计GUI时自动生成的代码中头文件中，例如${workspace}/build/projectName/include/ui_mainwindow.h；以声明的方式使用在自己的头文件中，例如${workspace}/include/mainwindow.h，这里Ui是命名空间，class Widget是一个前向声明，这种做法允许你在.cpp源文件中引用由Qt Designer创建的UI界面，而不需要在头文件中包含完整的UI定义。在源文件中你要创建Ui::Widget类型的对象来访问和操作UI组件。</p>
</li>
<li>
<p>QT_BEGIN_NAMESPACE<br>
QT_BEGIN_NAMESPACE是Qt框架中用于支持命名空间的宏定义，Qt使用这些宏来确保其库中的类和函数不会与其他库中的同名类和函数冲突，QT_BEGIN_NAMESPACE宏要在定义Qt类和函数之前使用，指定接下来的代码位于Qt的命名空间中。一般与QT_END_NAMESPACE配对使用，后者标志命名空间的结束。</p>
</li>
<li>
<p>Q_OBJECT<br>
Q_OBJECT宏是用于启用Qt对象的元对象系统。当你在Qt中定义一个类时，如果这个类继承自QObject或其子类，并且你想使用Qt的信号和槽机制、国际化、属性系统或其他Qt元对象系统提供的功能，就必须在类定义中包含Q_OBJECT宏。<br>
这个宏允许Qt的元对象编译器（moc）识别并处理这个类，生成额外的代码，这些代码是实现元对象功能（如信号与槽机制）所必须的代码。</p>
</li>
<li>
<p>Widget::Widget(QWidget* parent): QWidget(parent), ui(new Ui::Widget)<br>
QWidget(parent)初始化列表调用基类的QWidget的构造函数，将parent传递给它。ui(new Ui::Widget)是初始化类内部的ui成员变量，这是通过new关键字动态分配的。Ui::widget是有Qt Designer工具生成，用于处理用户界面。这种方式允许将用户界面设计与后端逻辑代码分离，有助于提高代码的可维护性和可读性。</p>
</li>
</ul>
<h3 id="从UI-Designer中个性化窗口样式">从UI Designer中个性化窗口样式</h3>
<p>Qt creator中左边栏找帮助<img src="/2025/02/24/QT-C/QT-C/image-20250325090821659.png" alt="image-20250325090821659">，查找stylesheet类似于HTML的CSS。<br>
例如“打开”按钮的设置<br>
<img src="/2025/02/24/QT-C/QT-C/image-20250325105609211.png" alt="image-20250325105609211"></p>
<h4 id="加载资源的配置">加载资源的配置</h4>
<ol>
<li>添加resources文件夹</li>
<li>配置res.qrc文件<br>
<img src="/2025/02/24/QT-C/QT-C/image-20250326100315990.png" alt="image-20250326100315990"></li>
<li>增加资源文件路径到cmakeList.txt文件, <strong>注</strong>：<code>QRC</code>变量必须在<code>qt_add_executable</code>被调用才能被加载，如果在<code>add_library</code>里使用资源不会被加载出来。</li>
</ol>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 添加qrc文件</span><br><span class="line">file(GLOB QRC &quot;resources/*.qrc&quot;)</span><br><span class="line">set(PROJECT_SOURCES</span><br><span class="line">    # $&#123;SOURCE_DIR&#125;/main.cpp</span><br><span class="line">    # $&#123;SOURCE_DIR&#125;/mainwindow.cpp</span><br><span class="line">    # $&#123;UI_HEADERS&#125;</span><br><span class="line">    # $&#123;HEADER_DIR&#125;</span><br><span class="line">    $&#123;SRC&#125;</span><br><span class="line">    $&#123;INC&#125;</span><br><span class="line">    $&#123;QRC&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>也可以在UI Designer界面配置资源<br>
<img src="/2025/02/24/QT-C/QT-C/image-20250327111908308.png" alt="image-20250327111908308"><br>
<img src="/2025/02/24/QT-C/QT-C/image-20250327112225971.png" alt="image-20250327112225971" style="zoom:50%;"></li>
</ol>
<h4 id="UI组件与窗体联动">UI组件与窗体联动</h4>
<p>在mainWindow.cpp文件中显性的设置ui查组件的布局layout和widget窗体关联,使窗体变化时layout也跟着变化。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;mainwindow.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ui_mainwindow.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">MainWindow::<span class="built_in">MainWindow</span>(QWidget *parent)</span><br><span class="line">    : <span class="built_in">QMainWindow</span>(parent)</span><br><span class="line">    , <span class="built_in">ui</span>(<span class="keyword">new</span> Ui::MainWindow)<span class="comment">//实例化ui对象</span></span><br><span class="line">&#123;</span><br><span class="line">    ui-&gt;<span class="built_in">setupUi</span>(<span class="keyword">this</span>);<span class="comment">//ui对象赋值</span></span><br><span class="line">    <span class="comment">//虽然上行代码将自己的Widget和Ui::Widget进行关联，但是如果发生窗体大小变化的时候，里面的布局不会随之变化</span></span><br><span class="line">    <span class="comment">//通过下面这行代码显示说明，让窗口变化时，布局及其子控件随之调整</span></span><br><span class="line">    ui-&gt;centralwidget-&gt;<span class="built_in">setLayout</span>(ui-&gt;verticalLayout);</span><br><span class="line">    ui-&gt;statWidget-&gt;<span class="built_in">setLayout</span>(ui-&gt;bottomHLayout);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MainWindow::~<span class="built_in">MainWindow</span>()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">delete</span> ui;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>在 Qt 中，<code>ui(new Ui::MainWindow)</code> 和 <code>ui-&gt;setupUi(this)</code> 是与 Qt Designer 生成的 UI 文件相关的关键初始化代码</p>
<ol>
<li><code>ui(new Ui::MainWindow)</code></li>
</ol>
<ul>
<li><strong>创建 UI 类的实例</strong>：<code>Ui::MainWindow</code> 是 Qt Designer 生成的界面类（对应 <code>mainwindow.ui</code> 文件编译后生成的 <code>ui_mainwindow.h</code>），该实例是一个空白对象。</li>
<li><strong>分配内存</strong>：通过 <code>new</code> 操作符在堆上创建界面对象</li>
</ul>
<ol start="2">
<li><code>ui-&gt;setupUi(this)</code>
<ul>
<li><strong>构建用户界面</strong>：将 <code>.ui</code> 文件中设计的界面实例化到当前窗口，该实例不在是一个空白对象。</li>
<li><strong>完成以下操作</strong>：
<ul>
<li>创建所有子控件（按钮、文本框等）</li>
<li>设置控件层级关系（父子关系）</li>
<li>应用布局（Layout）</li>
<li>连接信号槽（如果 Designer 中已设置）</li>
<li>应用样式表（如果 Designer 中已设置）</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="信号与槽">信号与槽</h3>
<p>怎样让按键按下后后操作上的反应？信号与槽机制是一种事件通信机制。</p>
<ol>
<li>信号signal:是由对象在特定事件发生时发出的消息。例如，QPushButton有一个clicked()信号，当用户点击按钮时发出。</li>
<li>槽slot: 是用来响应信号的方法。一个槽可以是任意函数，当其关联的信号被发出时，该槽函数将被调用。</li>
<li>连接信号和槽：使用QObject::connect()方法将信号连接到槽。当信号发出时，关联的槽函数会自动执行。</li>
</ol>
<p><strong>按键QPushButton设置信号与槽</strong><br>
几种不同的方式来设置按键信号与槽的连接</p>
<table>
<thead>
<tr>
<th>连接方式</th>
<th>描述</th>
<th>示例</th>
</tr>
</thead>
<tbody>
<tr>
<td>使用QObject::connect</td>
<td>最常用的方式，直接通过QObject::connect函数连接信号与槽</td>
<td>QObject::connect(senderPointer, SIGNAL(signal()), receiverPointer, SLOT(slot()));</td>
</tr>
<tr>
<td>使用C++11 Lambda表达式</td>
<td>利用C++11引入的Lambda表达式进行信号与槽的连接。这种方式可以直接在连接点使用匿名函数，使代码更加简洁</td>
<td>QObject::connect(senderPointer, &amp;SenderClass::signal, [=](){/*lambda body*/});</td>
</tr>
<tr>
<td>使用函数指针</td>
<td>允许使用函数指针(&amp;func)直接连接信号与槽，这种方式类型安全，且可以利用IDE的代码补全和错误检查</td>
<td>QObject::connect(senderPointer, &amp;SenderClass::signal, receiverPointer, &amp;ReceiverClass::slot);</td>
</tr>
<tr>
<td>自动连接（使用UI文件）</td>
<td>在使用Qt Designer时，可以通过命名约定自动连接信号和槽。当UI文件加载时，以on_<objectName>_<signalName>命名的槽会自动连接到相应的信号。</signalName></objectName></td>
<td>在Qt Designer中命名按钮为pushButton,然后在代码中定义on_pushButton_clicked()</td>
</tr>
</tbody>
</table>
<p>各自特点：</p>
<ol>
<li>QObject::connect使用普遍，这种方式使用<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E5%AD%97%E7%AC%A6%E4%B8%B2&amp;spm=1001.2101.3001.7020">字符串</a>来指定信号和槽，因此编译器无法检查信号和槽是否匹配，也无法检测连接是否成功。如果信号和槽的签名不匹配，或者槽函数的访问权限不允许连接，连接仍然会“成功”，但实际上并不会生效。这就导致了<strong>连接成功但槽函数没有触发的情况</strong>。在构造函数中调用信号与槽连接，需在头文件中声明。。</li>
<li>Lambda表达式可以在同一位置编写信号处理逻辑，提高代码可读性，在构造函数中调用与槽连接，无需在头文件中声明。</li>
<li>使用函数指针在编译时提供更好的类型检查，在构造函数中调用信号与槽连接，需在头文件中声明。</li>
<li>自动连接通常在使用Qt Designer设计UI时比较方便，无需调用信号与槽连接，需在头文件中声明。。</li>
</ol>
<ul>
<li>
<p>非代码方式<img src="/2025/02/24/QT-C/QT-C/image-20250327111545599.png" alt="image-20250327111545599"></p>
</li>
<li>
<p>代码方式</p>
<ol>
<li>
<p>使用Qt creator的转到槽实现自动化生成槽声明和实现模版</p>
</li>
<li>
<p>vscode仿照转到槽，自己生成槽声明和实现模版</p>
 <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> MAINWINDOW_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAINWINDOW_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QMainWindow&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line">QT_BEGIN_NAMESPACE</span><br><span class="line"><span class="keyword">namespace</span> Ui &#123;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MainWindow</span>;</span><br><span class="line">&#125;</span><br><span class="line">QT_END_NAMESPACE</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MainWindow</span> : <span class="keyword">public</span> QMainWindow</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">MainWindow</span>(QWidget *parent = <span class="literal">nullptr</span>);</span><br><span class="line">    ~<span class="built_in">MainWindow</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> slots:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_btnCloseIcon_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">btnOldConnectFunc</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">btnNewConnectFunc</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//lambda匿名槽函数方式不需要声明</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Ui::MainWindow *ui;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// MAINWINDOW_H</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
 <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;mainwindow.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ui_mainwindow.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">MainWindow::<span class="built_in">MainWindow</span>(QWidget *parent)</span><br><span class="line">    : <span class="built_in">QMainWindow</span>(parent)</span><br><span class="line">    , <span class="built_in">ui</span>(<span class="keyword">new</span> Ui::MainWindow)</span><br><span class="line">&#123;</span><br><span class="line">    ui-&gt;<span class="built_in">setupUi</span>(<span class="keyword">this</span>);</span><br><span class="line">    <span class="comment">//虽然上行代码将自己的Widget和Ui::Widget进行关联，但是如果发生窗体大小变化的时候，里面的布局不会随之变化</span></span><br><span class="line">    <span class="comment">//通过下面这行代码显示说明，让窗口变化时，布局及其子控件随之调整</span></span><br><span class="line">    ui-&gt;centralwidget-&gt;<span class="built_in">setLayout</span>(ui-&gt;verticalLayout);</span><br><span class="line">    ui-&gt;statWidget-&gt;<span class="built_in">setLayout</span>(ui-&gt;bottomHLayout);</span><br><span class="line">    <span class="comment">//在构造函数中进行信号与槽的绑定</span></span><br><span class="line">    <span class="comment">//第一种on_objectName_signalName方式不需要在构造函数中连接信号与槽</span></span><br><span class="line">    <span class="comment">//第二种方式QObject::connect(sender, SIGNAL(signal), receiver, SLOT(slot));</span></span><br><span class="line">    QObject::<span class="built_in">connect</span>(ui-&gt;btnOldConnect, <span class="built_in">SIGNAL</span>(<span class="built_in">clicked</span>()), <span class="keyword">this</span>, <span class="built_in">SLOT</span>(<span class="built_in">btnOldConnectFunc</span>()));</span><br><span class="line">    <span class="comment">//第三种方式：Lambda表达式QObject::connect(sender, &amp;SenderClass::signal, [=]()&#123;/* lambda body */&#125;)</span></span><br><span class="line">    QObject::<span class="built_in">connect</span>(ui-&gt;btnLambda, &amp;QPushButton::clicked, [=]()&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Lambda Button Clicked: QObject::connect(sender, &amp;SenderClass::signal, [=]()&#123;/* lambda body */&#125;)&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">//第四种方式:函数数指针QObject::connect(sender, &amp;Sender::signal, receiver, &amp;Receiver::slot);</span></span><br><span class="line">    QObject::<span class="built_in">connect</span>(ui-&gt;btnNewConnect, &amp;QPushButton::clicked, <span class="keyword">this</span>, &amp;MainWindow::btnNewConnectFunc);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MainWindow::~<span class="built_in">MainWindow</span>()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">delete</span> ui;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//第一种连接信号与槽方式</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_btnCloseIcon_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Close Icon Clicked: on_objectName_signalName format&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">this</span>-&gt;<span class="built_in">close</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::btnOldConnectFunc</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Old Connect Button Clicked: QObject::connect(sender, SIGNAL(signal), receiver, SLOT(slot));&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::btnNewConnectFunc</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;New Connect Button Clicked: QObject::connect(sender, &amp;Sender::signal, receiver, &amp;Receiver::slot);&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
</ul>
<h3 id="private-和-private-slots-的区别"><code>private:</code> 和 <code>private slots:</code> 的区别</h3>
<h4 id="1-private-访问修饰符">1. <code>private:</code> 访问修饰符</h4>
<p><code>private:</code> 是 C++ 中的一个访问控制符，用来指定类的成员只能在类的内部访问。它的作用是确保类的实现细节对外部不可见。即使我们将槽函数放在 <code>private:</code> 中，<strong>Qt 的信号槽机制不会自动识别它为槽函数</strong>，因此信号无法正确连接。</p>
<h4 id="2-private-slots-访问修饰符">2. <code>private slots:</code> 访问修饰符</h4>
<p><code>private slots:</code> 是 Qt 的一种特有的语法，它不仅表示这些槽函数是 <code>private</code> <a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E8%AE%BF%E9%97%AE%E6%9D%83%E9%99%90&amp;spm=1001.2101.3001.7020">访问权限</a>的，而且告诉 Qt 这个函数是一个 <strong>槽函数</strong>。Qt 会根据元对象系统（Meta-Object System）自动识别和连接这些函数。因此，<strong><code>private slots:</code> 中的槽函数可以被正确识别并响应信号</strong>，即使它们的访问权限是 <code>private</code>。</p>
<h4 id="访问权限与信号槽机制">访问权限与<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E4%BF%A1%E5%8F%B7%E6%A7%BD%E6%9C%BA%E5%88%B6&amp;spm=1001.2101.3001.7020">信号槽机制</a></h4>
<p>Qt 的信号槽机制与 C++ 的普通成员函数指针有所不同。Qt 使用 <strong>元对象系统（Meta-Object System）</strong> 来识别信号和槽的连接。这个系统能够识别并正确连接通过 <code>private slots:</code> 声明的槽函数，但它并不会识别 <code>private:</code> 中的普通成员函数。因此，<strong>信号与 <code>private:</code> 中的函数无法正常连接</strong>。</p>
<h4 id="为什么-private-slots-中的槽函数可以正常使用？">为什么 <code>private slots:</code> 中的槽函数可以正常使用？</h4>
<p>当我们使用 <code>private slots:</code> 来声明槽函数时，Qt 的元对象系统会确保这些函数可以作为槽进行连接。虽然这些函数的访问权限是 <code>private</code>，但是 Qt 会自动处理这个限制并正确连接信号和槽。因此，<strong>槽函数放在 <code>private slots:</code> 中是推荐的做法</strong>。</p>
<p><strong>QDebug</strong><br>
QDebug是Qt框架中用于输出调试信息的一个类。输出文本到标准输出，QDebug可以和信号与槽机制一起使用，使得在响应各种事件时能够输出有用调试信息。<br>
使用qDebug()函数生成成QDebug对象，然后使用流操作符&lt;&lt;来输出各种信息。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;This is a debug message&quot;</span>;</span><br><span class="line"><span class="type">int</span> value = <span class="number">10</span>;</span><br><span class="line"><span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;The value is &quot;</span> &lt;&lt; value;</span><br></pre></td></tr></table></figure>
<p>qDebug()可以输出自定义类型，只要为这些类型提供输出操作符重载。Qt还提供了qInfo(),QWarning(), qCritical()和qFatal()函数，用于输出不同级别的信息，分别用于普通信息，警告，关键错误和致命错误。有助于日志的分级控制输出内容。</p>
<h3 id="自定义信号与槽">自定义信号与槽</h3>
<p>信号与槽是Qt对象通信的核心，使得一个对象能够在发生某种事件时通知其他对象。自定义信号与槽的实现步骤如下：</p>
<ol>
<li><strong>定义信号</strong>：在Qt中信号是由signals关键字声明的类成员函数。他们不需要实现只需要声明。</li>
</ol>
  <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span>: <span class="keyword">public</span> QObject&#123;</span><br><span class="line">  Q_OBJECT</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">MyClass</span>();</span><br><span class="line">signals: <span class="comment">//调用连接信号与槽时是在类外部, signals前不能使用任何访问修饰符public, private, protected</span></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">mySignal</span><span class="params">(<span class="type">int</span> value)</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li><strong>定义槽</strong>：槽可以是任何普通的成员函数，但通常在类定义中用slots关键字标识。槽可以有返回类型，也可以接受参数,但他们的参数类型需要与发出信号的参数类型匹配。</li>
</ol>
  <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span>: <span class="keyword">public</span> QObject&#123;</span><br><span class="line">  Q_OBJECT</span><br><span class="line"><span class="keyword">public</span> slots: <span class="comment">//调用连接信号与槽时是在类外部</span></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">mySlot</span><span class="params">(<span class="type">int</span> value)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MyClass::mySlot</span><span class="params">(<span class="type">int</span> value)</span></span>&#123;</span><br><span class="line">  std::cout &lt;&lt; <span class="string">&quot;自定义信号与槽&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">  <span class="comment">//emit mySignal(value); #报错：无限循环</span></span><br><span class="line">  <span class="comment">//std::cout &lt;&lt; &quot;触发mySignal(&quot;&lt;&lt; value &lt;&lt; &quot;)&quot; &lt;&lt; std::endl;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li><strong>连接信号与槽</strong>：使用QObject::connect函数将信号与槽连接。当信号被发射时，连接到这个信号的槽将被调用。</li>
</ol>
  <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MyClass* myObject = <span class="keyword">new</span> <span class="built_in">MyClass</span>();</span><br><span class="line">QObject::<span class="built_in">connect</span>(myObject, <span class="built_in">SIGNAL</span>(<span class="built_in">mySignal</span>(<span class="type">int</span>)), myObject, <span class="built_in">SLOT</span>(<span class="built_in">mySlot</span>(<span class="type">int</span>)));</span><br><span class="line"><span class="function">emit <span class="title">mySignal</span><span class="params">(<span class="number">123</span>)</span></span>;<span class="comment">//触发信号后调用mySlot(int)槽函数</span></span><br></pre></td></tr></table></figure>
<p>该行代码连接了myObject对象的mySignal信号到同一对象的mySlot槽。<br>
4. <strong>发射信号</strong>：使用emit关键自发射信号。当信号被发射时，<strong>所有连接到这个信号的槽都会被调用</strong>。</p>
  <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">emit <span class="title">mySignal</span><span class="params">(<span class="number">123</span>)</span></span>;<span class="comment">//</span></span><br></pre></td></tr></table></figure>
<p>自定义信号和槽使得组件之间的通信变得灵活而松耦合(不用has-a组合，而是传惨)，实现复杂的事件驱动逻辑。</p>
<ol start="5">
<li>
<p><strong>参数处理规则</strong><br>
1). <strong>参数数量可以不同</strong>：</p>
<ul>
<li>槽的参数数量可以比信号少</li>
<li>多余的参数会被忽略</li>
</ul>
<p>2). <strong>参数类型必须兼容</strong>：</p>
<ul>
<li>完全匹配或Qt隐式转换支持的类型<br>
例如：int ↔ qint32，QString ↔ const char*</li>
</ul>
</li>
</ol>
<h3 id="文件操作类QFile">文件操作类QFile</h3>
<p>QFile用于处理文件的类，继承自QIODevice,可以像IO设备一样使用。<br>
<strong>主要功能</strong></p>
<ol>
<li>文件读写：打开文件读写</li>
<li>文件信息：检索信息如：大小，修改日期</li>
<li>文件操作：文件重命名，移动，删除，保存等</li>
<li>错误处理：在文件操作时提供错误处理机制，可以通过相应的函数检查和获取错误信息。<br>
<strong>常用方法</strong></li>
</ol>
<ul>
<li>open():打开一个文件，模式：只读，只写，读写</li>
<li>close():关闭文件</li>
<li>read()和write():读取和写入数据</li>
<li>exists():检查文件是否存在</li>
<li>remove():删除文件</li>
<li>copy():复制文件</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QFile&gt;</span></span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">mainwindow.cpp 其余代码</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">//读文件</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_btnOpenIcon_clicked</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//1. 打开文件</span></span><br><span class="line">    <span class="function">QFile <span class="title">file</span><span class="params">(<span class="string">&quot;./test.txt&quot;</span>)</span></span>;<span class="comment">// QFile file; file.setFileName(&quot;./test.txt&quot;);</span></span><br><span class="line">    <span class="type">bool</span> open_flag = file.<span class="built_in">open</span>(QIODevice::ReadOnly | QIODevice::Text);</span><br><span class="line">    <span class="keyword">if</span> (!open_flag)&#123;</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;Open File Failed!&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> size = file.<span class="built_in">size</span>();</span><br><span class="line">    <span class="comment">//2. 读取文件</span></span><br><span class="line">    <span class="comment">// char context[100] = &#123;&#x27;\0&#x27;&#125;;</span></span><br><span class="line">    <span class="type">char</span>* context = <span class="keyword">new</span> <span class="type">char</span>[size];</span><br><span class="line">    qint64 read_flag = file.<span class="built_in">read</span>(context, size);</span><br><span class="line">    <span class="keyword">if</span> (read_flag == <span class="number">-1</span>)&#123;</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;Read File Failed!&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//3. 输出文件内容</span></span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;File Content: &quot;</span> &lt;&lt; context;</span><br><span class="line">    <span class="comment">//4. 关闭文件</span></span><br><span class="line">    file.<span class="built_in">close</span>();</span><br><span class="line">    <span class="keyword">delete</span>[] context;</span><br><span class="line">    context = <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//保存文件</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_btnSaveIcon_clicked</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//1. 打开文件</span></span><br><span class="line">    QFile file = <span class="built_in">QFile</span>(<span class="string">&quot;./test1.txt&quot;</span>);</span><br><span class="line">    <span class="type">bool</span> open_flag = file.<span class="built_in">open</span>(QIODevice::WriteOnly | QIODevice::Text);</span><br><span class="line">    <span class="keyword">if</span> (!open_flag)&#123;</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;Open File Failed!&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//2. 写入文件</span></span><br><span class="line">    qint64 write_flag = file.<span class="built_in">write</span>(<span class="string">&quot;Program 45-QFile001 write something to this File, 我是传玺&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(write_flag==<span class="number">-1</span>)&#123;</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;Write File Failed!&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//3. 关闭文件</span></span><br><span class="line">    file.<span class="built_in">close</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="QTextStream">QTextStream</h4>
<p>QTextStream用于处理文本数据，特别是在需要考虑字符编码和文本格式的情况。</p>
<table>
<thead>
<tr>
<th>特性类别</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>字符编码</td>
<td>支持Unicode，可以处理如UTF-8，UTF-16等不同编码，通过set Encoding(QStringConverter::Utf8)方法设置特定编码</td>
</tr>
<tr>
<td>读写文本</td>
<td>用于读写文件，字符串或者任何继承自QIODevice的对象</td>
</tr>
<tr>
<td>格式化</td>
<td>提供文本格式化功能，如数字精度，基数（十进制，十六进制）调整</td>
</tr>
<tr>
<td>流操作符</td>
<td>支持使用&lt;&lt;和&gt;&gt;操作符，类似于iostream</td>
</tr>
<tr>
<td>换行处理</td>
<td>自动处理不同操作系统见的换行符差异（Linux的\n和windows的\r\n）</td>
</tr>
<tr>
<td>缓冲机制</td>
<td>提供缓冲机制，提高读写效率</td>
</tr>
<tr>
<td>字符串操作</td>
<td>可以方便地处理和解析字符串数据</td>
</tr>
<tr>
<td>错误处理</td>
<td>能够检测和报告在读写过程中出现的错误</td>
</tr>
</tbody>
</table>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//QTextStream</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_btnIn_clicked</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="function">QFile <span class="title">file</span><span class="params">(<span class="string">&quot;./test.txt&quot;</span>)</span></span>;</span><br><span class="line">    <span class="type">bool</span> open_flag = file.<span class="built_in">open</span>(QIODevice::ReadOnly | QIODevice::Text);</span><br><span class="line">    <span class="keyword">if</span> (!open_flag)&#123;</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;Open File Failed!&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">QTextStream <span class="title">in</span><span class="params">(&amp;file)</span></span>;</span><br><span class="line">    in.<span class="built_in">setEncoding</span>(QStringConverter::Utf8);<span class="comment">//(&quot;UTF-8&quot;);</span></span><br><span class="line">    <span class="type">int</span> context = file.<span class="built_in">size</span>();</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;File size: &quot;</span> &lt;&lt; context;</span><br><span class="line">    <span class="keyword">while</span>(!in.<span class="built_in">atEnd</span>())&#123;</span><br><span class="line">        QString line = in.<span class="built_in">readLine</span>();</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;File Content: &quot;</span> &lt;&lt; line;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_btnOut_clicked</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="function">QFile <span class="title">file</span><span class="params">(<span class="string">&quot;./test1.txt&quot;</span>)</span></span>;</span><br><span class="line">    <span class="type">bool</span> open_flag = file.<span class="built_in">open</span>(QIODevice::WriteOnly | QIODevice::Text);</span><br><span class="line">    <span class="keyword">if</span> (!open_flag)&#123;</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;Open File Failed!&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">QTextStream <span class="title">out</span><span class="params">(&amp;file)</span></span>;</span><br><span class="line">    out.<span class="built_in">setEncoding</span>(QStringConverter::Utf8);</span><br><span class="line">    out &lt;&lt; <span class="string">&quot;Program 45-QFile001 write something to this File, 我是传玺, 文本字符流&quot;</span>;</span><br><span class="line">    file.<span class="built_in">close</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>QTextStream</strong>无法设置GBK等编码格式，应使用QTextCodec设置编码格式，处理的不在是stream流而是QByteArray字节数组。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//QTextCodec</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_btnOpenIcon_clicked</span><span class="params">()</span></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;分步骤打开&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    QFileDialog  qFileDialog;</span><br><span class="line">    qFileDialog.<span class="built_in">setWindowTitle</span>(<span class="built_in">tr</span>(<span class="string">&quot;Open File&quot;</span>));</span><br><span class="line">    qFileDialog.<span class="built_in">setDirectory</span>(<span class="string">&quot;/Users/liuchuanxi/项目/QT&quot;</span>);</span><br><span class="line">    qFileDialog.<span class="built_in">setFileMode</span>(QFileDialog::ExistingFiles);</span><br><span class="line">    qFileDialog.<span class="built_in">setNameFilter</span>(<span class="built_in">tr</span>(<span class="string">&quot;Images (*.png *.jpg *.bmp);;Text files (*.txt)&quot;</span>));</span><br><span class="line">    <span class="keyword">if</span> (qFileDialog.<span class="built_in">exec</span>())&#123;</span><br><span class="line">        QStringList fileNames = qFileDialog.<span class="built_in">selectedFiles</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">const</span> QString &amp;fileName : fileNames) &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;Selected File: &quot;</span> &lt;&lt; fileName.<span class="built_in">toStdString</span>() &lt;&lt; std::endl;</span><br><span class="line">            <span class="comment">// QFile file(fileName);</span></span><br><span class="line">            file.<span class="built_in">setFileName</span>(fileName);<span class="comment">//此处file是类中的QFile成员</span></span><br><span class="line">            <span class="type">bool</span> open_flag = file.<span class="built_in">open</span>(QIODevice::ReadOnly | QIODevice::Text);</span><br><span class="line">            <span class="keyword">if</span> (!open_flag)&#123;</span><br><span class="line">                <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;Open File Failed!&quot;</span>;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;<span class="comment">//if</span></span><br><span class="line">            <span class="comment">// QTextStream in(&amp;file);</span></span><br><span class="line">            <span class="comment">// in.setEncoding(QStringConverter::Utf8);//(&quot;UTF-8&quot;);</span></span><br><span class="line">            QTextCodec *codec = QTextCodec::<span class="built_in">codecForName</span>(<span class="string">&quot;GBK&quot;</span>);</span><br><span class="line">            <span class="type">int</span> context = file.<span class="built_in">size</span>();</span><br><span class="line">            <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;File size: &quot;</span> &lt;&lt; context;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//窗口清除原有文本</span></span><br><span class="line">            ui-&gt;textEdit-&gt;<span class="built_in">clear</span>();</span><br><span class="line">            <span class="comment">// while(!in.atEnd())&#123;</span></span><br><span class="line">            <span class="keyword">while</span>(!file.<span class="built_in">atEnd</span>())&#123;</span><br><span class="line">                <span class="comment">// QString line = in.readLine();</span></span><br><span class="line">                QByteArray line = file.<span class="built_in">readLine</span>();</span><br><span class="line">                QString line_code =  codec-&gt;<span class="built_in">toUnicode</span>(line);</span><br><span class="line">                <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;File Content: &quot;</span> &lt;&lt; line;</span><br><span class="line">                <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;编码 File Content: &quot;</span> &lt;&lt; line_code;</span><br><span class="line">                <span class="keyword">if</span> (file.<span class="built_in">pos</span>() == line.<span class="built_in">length</span>()+<span class="number">1</span>)&#123;</span><br><span class="line">                    <span class="comment">//覆盖内容</span></span><br><span class="line">                    ui-&gt;textEdit-&gt;<span class="built_in">setText</span>(line_code);</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="comment">//追加内容</span></span><br><span class="line">                    ui-&gt;textEdit-&gt;<span class="built_in">append</span>(line_code);</span><br><span class="line">                &#125;<span class="comment">//end if</span></span><br><span class="line">            &#125;<span class="comment">//while</span></span><br><span class="line">            <span class="comment">// file.close();</span></span><br><span class="line">        &#125;<span class="comment">//for</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;No File Selected&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;<span class="comment">//if</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="QFileDialog文件对话框">QFileDialog文件对话框</h4>
<p><strong>QFileDialog开发流程</strong></p>
<ol>
<li>实例化：QFileDialog dialog;</li>
<li>设置模式: 设置对话的模式，如打开文件，保存文件等</li>
</ol>
<p>​       Dialog.setFileMode(QFileDialog::AnyFile);</p>
<ol start="3">
<li>设置过滤器:如果需要，设置文件类型过滤器，以限制用户可以选择的文件类型。</li>
</ol>
<p>Dialog.setNameFilter(tr(“Images (*.png *.xpm *.jpg);;Text files (*.txt);;XML files (*.xml)”));</p>
<ol start="4">
<li>
<p>显示对话框:通过调用exec()方法显示对话框，并在用户作出选择后执行相应的操作。</p>
<p>if (dialog.exec()){</p>
<p>​    QStringList files = dialog.selectedFiles();</p>
<p>​    //对用户选定的文件进行操作</p>
<p>}</p>
</li>
</ol>
<p>​       通过selectedFiles方法获取用户选择的文件路径列表，然后对这些文件进行处理。这是使用QFileDialog的基本模式。Qt也允许使用静态方法直接创建和显示对话框，例如：QFileDialog::getOpenFileName(),这些方法更简单，但是提供的自定义选项较少。</p>
<p><strong>静态方法打开文件</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_btnOpenIcon_clicked</span><span class="params">()</span></span>&#123; </span><br><span class="line">    QString fileName = QFileDialog::<span class="built_in">getOpenFileName</span>(<span class="keyword">this</span>,</span><br><span class="line">            <span class="built_in">tr</span>(<span class="string">&quot;Open File&quot;</span>), <span class="string">&quot;/home&quot;</span>, <span class="built_in">tr</span>(<span class="string">&quot;Images (*.png *.xpm *.jpg )&quot;</span>));</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&#x27;File Name:&#x27;</span> &lt;&lt; fileName;</span><br><span class="line">    <span class="function">QFile <span class="title">file</span><span class="params">(fileName)</span></span>;</span><br><span class="line">    <span class="type">bool</span> open_flag = file.<span class="built_in">open</span>(QIODevice::ReadOnly | QIODevice::Text);</span><br><span class="line">    <span class="keyword">if</span> (!open_flag)&#123;</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;Open File Failed!&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">QTextStream <span class="title">in</span><span class="params">(&amp;file)</span></span>;</span><br><span class="line">    in.<span class="built_in">setEncoding</span>(QStringConverter::Utf8);<span class="comment">//(&quot;UTF-8&quot;);</span></span><br><span class="line">    <span class="type">int</span> context = file.<span class="built_in">size</span>();</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;File size: &quot;</span> &lt;&lt; context;</span><br><span class="line">    <span class="keyword">while</span>(!in.<span class="built_in">atEnd</span>())&#123;</span><br><span class="line">        QString line = in.<span class="built_in">readLine</span>();</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;File Content: &quot;</span> &lt;&lt; line;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2025/02/24/QT-C/QT-C/image-20250410142306617.png" alt="image-20250410142306617"></p>
<p><code>tr()</code> 的作用是：</p>
<ol>
<li><strong>标记字符串为可翻译</strong>：告诉 Qt 的翻译工具（lupdate）这个字符串需要被提取到翻译文件（.ts）中</li>
<li><strong>运行时翻译</strong>：在程序运行时，会根据当前语言环境自动查找并返回对应的翻译文本。</li>
<li>文件过滤器字符串通常需要显示在用户界面中（如文件对话框），因此应该支持多语言：</li>
</ol>
<p><code>;;</code>的作用：分割各过滤条件。</p>
<p><strong>分步骤打开文件</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::btnOldConnectFunc</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Old Connect Button Clicked: QObject::connect(sender, SIGNAL(signal), receiver, SLOT(slot));&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;分步骤打开&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    QFileDialog  qFileDialog;</span><br><span class="line">    qFileDialog.<span class="built_in">setWindowTitle</span>(<span class="built_in">tr</span>(<span class="string">&quot;Open File&quot;</span>));</span><br><span class="line">    qFileDialog.<span class="built_in">setDirectory</span>(<span class="string">&quot;/Users/liuchuanxi/项目/QT&quot;</span>);</span><br><span class="line">    qFileDialog.<span class="built_in">setFileMode</span>(QFileDialog::ExistingFiles);</span><br><span class="line">    qFileDialog.<span class="built_in">setNameFilter</span>(<span class="built_in">tr</span>(<span class="string">&quot;Images (*.png *.jpg *.bmp);;Text files (*.txt)&quot;</span>));</span><br><span class="line">    <span class="keyword">if</span> (qFileDialog.<span class="built_in">exec</span>())&#123;</span><br><span class="line">        QStringList fileNames = qFileDialog.<span class="built_in">selectedFiles</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">const</span> QString &amp;fileName : fileNames) &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;Selected File: &quot;</span> &lt;&lt; fileName.<span class="built_in">toStdString</span>() &lt;&lt; std::endl;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;No File Selected&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>静态保存文件</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::btnNewConnectFunc</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;New Connect Button Clicked: QObject::connect(sender, &amp;Sender::signal, receiver, &amp;Receiver::slot);&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;静态方法实现保存文件&quot;</span>;</span><br><span class="line">    QString fileName = QFileDialog::<span class="built_in">getSaveFileName</span>(<span class="keyword">this</span>, </span><br><span class="line">        <span class="built_in">tr</span>(<span class="string">&quot;Save File&quot;</span>), <span class="string">&quot;/Users/liuchuanxi/项目/QT/untitled.txt&quot;</span>, <span class="built_in">tr</span>(<span class="string">&quot;Text files (*.txt)&quot;</span>));</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt;<span class="string">&quot;保存的文件：&quot;</span>&lt;&lt; fileName;</span><br><span class="line">    <span class="function">QFile <span class="title">file</span><span class="params">(fileName)</span></span>;</span><br><span class="line">    <span class="type">bool</span> open_flag = file.<span class="built_in">open</span>(QIODevice::WriteOnly | QIODevice::Text);</span><br><span class="line">    <span class="keyword">if</span> (!open_flag)&#123;</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;Open File Failed!&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">QTextStream <span class="title">out</span><span class="params">(&amp;file)</span></span>;</span><br><span class="line">    out.<span class="built_in">setEncoding</span>(QStringConverter::Utf8);</span><br><span class="line">    out &lt;&lt; <span class="string">&quot;这是保存后自动生成的文字&quot;</span>;</span><br><span class="line">    file.<span class="built_in">close</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>分步骤保存文件</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_btnSaveIcon_clicked</span><span class="params">()</span></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;分步骤保存&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    QFileDialog  qFileDialog;</span><br><span class="line">    qFileDialog.<span class="built_in">setWindowTitle</span>(<span class="built_in">tr</span>(<span class="string">&quot;Open File&quot;</span>));</span><br><span class="line">    qFileDialog.<span class="built_in">setDirectory</span>(<span class="string">&quot;/Users/liuchuanxi/项目/QT&quot;</span>);</span><br><span class="line">    qFileDialog.<span class="built_in">setAcceptMode</span>(QFileDialog::AcceptSave);  <span class="comment">// 设置为保存模式</span></span><br><span class="line">    qFileDialog.<span class="built_in">setDefaultSuffix</span>(<span class="string">&quot;txt&quot;</span>);                 <span class="comment">// 默认后缀</span></span><br><span class="line">    qFileDialog.<span class="built_in">setFileMode</span>(QFileDialog::AnyFile);</span><br><span class="line">    qFileDialog.<span class="built_in">setNameFilter</span>(<span class="built_in">tr</span>(<span class="string">&quot;Text files (*.txt)&quot;</span>));</span><br><span class="line">    <span class="keyword">if</span> (qFileDialog.<span class="built_in">exec</span>() == QFileDialog::Accepted)&#123;</span><br><span class="line">        QString fileName = qFileDialog.<span class="built_in">selectedFiles</span>().<span class="built_in">first</span>();</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt;<span class="string">&quot;保存的文件：&quot;</span>&lt;&lt; fileName;</span><br><span class="line">        <span class="function">QFile <span class="title">file</span><span class="params">(fileName)</span></span>;</span><br><span class="line">        <span class="type">bool</span> open_flag = file.<span class="built_in">open</span>(QIODevice::WriteOnly | QIODevice::Text);</span><br><span class="line">        <span class="keyword">if</span> (!open_flag)&#123;</span><br><span class="line">            <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;Open File Failed!&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function">QTextStream <span class="title">out</span><span class="params">(&amp;file)</span></span>;</span><br><span class="line">        out.<span class="built_in">setEncoding</span>(QStringConverter::Utf8);</span><br><span class="line">        out &lt;&lt; <span class="string">&quot;这是保存后自动生成的文字&quot;</span>;</span><br><span class="line">        file.<span class="built_in">close</span>();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;No File Selected&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>保存文件时当文件存在时不要弹出对话框</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_btnSaveIcon_clicked</span><span class="params">()</span></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;分步骤保存&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    <span class="comment">//未打开的文件需要对话框</span></span><br><span class="line">    <span class="keyword">if</span> (!file.<span class="built_in">isOpen</span>())&#123;</span><br><span class="line">        QFileDialog  qFileDialog;</span><br><span class="line">        qFileDialog.<span class="built_in">setWindowTitle</span>(<span class="built_in">tr</span>(<span class="string">&quot;Open File&quot;</span>));</span><br><span class="line">        qFileDialog.<span class="built_in">setDirectory</span>(<span class="string">&quot;/Users/liuchuanxi/项目/QT&quot;</span>);</span><br><span class="line">        qFileDialog.<span class="built_in">setAcceptMode</span>(QFileDialog::AcceptSave);  <span class="comment">// 设置为保存模式</span></span><br><span class="line">        qFileDialog.<span class="built_in">setDefaultSuffix</span>(<span class="string">&quot;txt&quot;</span>);                 <span class="comment">// 默认后缀</span></span><br><span class="line">        qFileDialog.<span class="built_in">setFileMode</span>(QFileDialog::AnyFile);</span><br><span class="line">        qFileDialog.<span class="built_in">setNameFilter</span>(<span class="built_in">tr</span>(<span class="string">&quot;Text files (*.txt)&quot;</span>));</span><br><span class="line">        <span class="keyword">if</span> (qFileDialog.<span class="built_in">exec</span>() == QFileDialog::Accepted)&#123;</span><br><span class="line">            QString fileName = qFileDialog.<span class="built_in">selectedFiles</span>().<span class="built_in">first</span>();</span><br><span class="line">            <span class="built_in">qDebug</span>() &lt;&lt;<span class="string">&quot;保存的文件：&quot;</span>&lt;&lt; fileName;</span><br><span class="line">            <span class="comment">// QFile file(fileName);</span></span><br><span class="line">            <span class="keyword">this</span>-&gt;<span class="built_in">setWindowTitle</span>(fileName+<span class="string">&quot;--传玺记事本&quot;</span>);</span><br><span class="line">            file.<span class="built_in">setFileName</span>(fileName);</span><br><span class="line">            <span class="type">bool</span> open_flag = file.<span class="built_in">open</span>(QIODevice::WriteOnly | QIODevice::Text);</span><br><span class="line">            <span class="keyword">if</span> (!open_flag)&#123;</span><br><span class="line">                <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;Open File Failed!&quot;</span>;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// QTextStream out(&amp;file);</span></span><br><span class="line">            <span class="comment">// out.setEncoding(QStringConverter::Utf8);</span></span><br><span class="line">            QString codecName = ui-&gt;encodeComboBox-&gt;<span class="built_in">currentText</span>();</span><br><span class="line">            <span class="type">const</span> <span class="type">char</span>* codecNameCharPtr = codecName.<span class="built_in">toStdString</span>().<span class="built_in">c_str</span>();</span><br><span class="line">            QTextCodec *codec = QTextCodec::<span class="built_in">codecForName</span>(codecNameCharPtr);</span><br><span class="line">            <span class="comment">//从窗口中提取内容</span></span><br><span class="line">            QString context = ui-&gt;textEdit-&gt;<span class="built_in">toPlainText</span>();</span><br><span class="line">            QByteArray out = codec-&gt;<span class="built_in">fromUnicode</span>(context);</span><br><span class="line">            qint64 writeFlag = file.<span class="built_in">write</span>(out);</span><br><span class="line">            file.<span class="built_in">flush</span>();  <span class="comment">// 强制刷新缓冲区</span></span><br><span class="line">            <span class="comment">// file.close();</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;No File Selected&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//清空原文件</span></span><br><span class="line">        QString fileName = file.<span class="built_in">fileName</span>();</span><br><span class="line">        file.<span class="built_in">close</span>();</span><br><span class="line">        file.<span class="built_in">setFileName</span>(fileName);</span><br><span class="line">        <span class="type">bool</span> open_flag = file.<span class="built_in">open</span>(QIODevice::WriteOnly | QIODevice::Text);</span><br><span class="line">        <span class="keyword">if</span> (!open_flag)&#123;</span><br><span class="line">            <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;Open File Failed!&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//重新写入窗口中的文字</span></span><br><span class="line">        QString codecName = ui-&gt;encodeComboBox-&gt;<span class="built_in">currentText</span>();</span><br><span class="line">        <span class="type">const</span> <span class="type">char</span>* codecNameCharPtr = codecName.<span class="built_in">toStdString</span>().<span class="built_in">c_str</span>();</span><br><span class="line">        QTextCodec *codec = QTextCodec::<span class="built_in">codecForName</span>(codecNameCharPtr);</span><br><span class="line">        <span class="comment">//从窗口中提取内容</span></span><br><span class="line">        QString context = ui-&gt;textEdit-&gt;<span class="built_in">toPlainText</span>();</span><br><span class="line">        QByteArray out = codec-&gt;<span class="built_in">fromUnicode</span>(context);</span><br><span class="line">        qint64 writeFlag = file.<span class="built_in">write</span>(out);</span><br><span class="line">        file.<span class="built_in">flush</span>();  <span class="comment">// 强制刷新缓冲区</span></span><br><span class="line">        <span class="type">int</span> a = <span class="number">1</span>;</span><br><span class="line">    &#125;<span class="comment">//end if</span></span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="读取文件显示在窗口中">读取文件显示在窗口中</h4>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_btnOpenIcon_clicked</span><span class="params">()</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;分步骤打开&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    QFileDialog  qFileDialog;</span><br><span class="line">    qFileDialog.<span class="built_in">setWindowTitle</span>(<span class="built_in">tr</span>(<span class="string">&quot;Open File&quot;</span>));</span><br><span class="line">    qFileDialog.<span class="built_in">setDirectory</span>(<span class="string">&quot;/Users/liuchuanxi/项目/QT&quot;</span>);</span><br><span class="line">    qFileDialog.<span class="built_in">setFileMode</span>(QFileDialog::ExistingFiles);</span><br><span class="line">    qFileDialog.<span class="built_in">setNameFilter</span>(<span class="built_in">tr</span>(<span class="string">&quot;Images (*.png *.jpg *.bmp);;Text files (*.txt)&quot;</span>));</span><br><span class="line">    <span class="keyword">if</span> (qFileDialog.<span class="built_in">exec</span>())&#123;</span><br><span class="line">        QStringList fileNames = qFileDialog.<span class="built_in">selectedFiles</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">const</span> QString &amp;fileName : fileNames) &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;Selected File: &quot;</span> &lt;&lt; fileName.<span class="built_in">toStdString</span>() &lt;&lt; std::endl;</span><br><span class="line">            <span class="function">QFile <span class="title">file</span><span class="params">(fileName)</span></span>;</span><br><span class="line">            <span class="type">bool</span> open_flag = file.<span class="built_in">open</span>(QIODevice::ReadOnly | QIODevice::Text);</span><br><span class="line">            <span class="keyword">if</span> (!open_flag)&#123;</span><br><span class="line">                <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;Open File Failed!&quot;</span>;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;<span class="comment">//if</span></span><br><span class="line">            <span class="function">QTextStream <span class="title">in</span><span class="params">(&amp;file)</span></span>;</span><br><span class="line">            in.<span class="built_in">setEncoding</span>(QStringConverter::Utf8);<span class="comment">//(&quot;UTF-8&quot;);</span></span><br><span class="line">            <span class="type">int</span> context = file.<span class="built_in">size</span>();</span><br><span class="line">            <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;File size: &quot;</span> &lt;&lt; context;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//窗口清除原有文本</span></span><br><span class="line">            ui-&gt;textEdit-&gt;<span class="built_in">clear</span>();</span><br><span class="line">            <span class="keyword">while</span>(!in.<span class="built_in">atEnd</span>())&#123;</span><br><span class="line">                QString line = in.<span class="built_in">readLine</span>();</span><br><span class="line">                <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;File Content: &quot;</span> &lt;&lt; line;</span><br><span class="line">                <span class="keyword">if</span> (in.<span class="built_in">pos</span>() == line.<span class="built_in">length</span>()+<span class="number">1</span>)&#123;</span><br><span class="line">                    <span class="comment">//覆盖内容</span></span><br><span class="line">                    ui-&gt;textEdit-&gt;<span class="built_in">setText</span>(line);</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="comment">//追加内容</span></span><br><span class="line">                    ui-&gt;textEdit-&gt;<span class="built_in">append</span>(line);</span><br><span class="line">                &#125;<span class="comment">//end if</span></span><br><span class="line">            &#125;<span class="comment">//while</span></span><br><span class="line">        &#125;<span class="comment">//for</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;No File Selected&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;<span class="comment">//if</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="保存显示在窗口中的内容">保存显示在窗口中的内容</h4>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_btnSaveIcon_clicked</span><span class="params">()</span></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;分步骤保存&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    QFileDialog  qFileDialog;</span><br><span class="line">    qFileDialog.<span class="built_in">setWindowTitle</span>(<span class="built_in">tr</span>(<span class="string">&quot;Open File&quot;</span>));</span><br><span class="line">    qFileDialog.<span class="built_in">setDirectory</span>(<span class="string">&quot;/Users/liuchuanxi/项目/QT&quot;</span>);</span><br><span class="line">    qFileDialog.<span class="built_in">setAcceptMode</span>(QFileDialog::AcceptSave);  <span class="comment">// 设置为保存模式</span></span><br><span class="line">    qFileDialog.<span class="built_in">setDefaultSuffix</span>(<span class="string">&quot;txt&quot;</span>);                 <span class="comment">// 默认后缀</span></span><br><span class="line">    qFileDialog.<span class="built_in">setFileMode</span>(QFileDialog::AnyFile);</span><br><span class="line">    qFileDialog.<span class="built_in">setNameFilter</span>(<span class="built_in">tr</span>(<span class="string">&quot;Text files (*.txt)&quot;</span>));</span><br><span class="line">    <span class="keyword">if</span> (qFileDialog.<span class="built_in">exec</span>() == QFileDialog::Accepted)&#123;</span><br><span class="line">        QString fileName = qFileDialog.<span class="built_in">selectedFiles</span>().<span class="built_in">first</span>();</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt;<span class="string">&quot;保存的文件：&quot;</span>&lt;&lt; fileName;</span><br><span class="line">        <span class="function">QFile <span class="title">file</span><span class="params">(fileName)</span></span>;</span><br><span class="line">        <span class="type">bool</span> open_flag = file.<span class="built_in">open</span>(QIODevice::WriteOnly | QIODevice::Text);</span><br><span class="line">        <span class="keyword">if</span> (!open_flag)&#123;</span><br><span class="line">            <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;Open File Failed!&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function">QTextStream <span class="title">out</span><span class="params">(&amp;file)</span></span>;</span><br><span class="line">        out.<span class="built_in">setEncoding</span>(QStringConverter::Utf8);</span><br><span class="line">        <span class="comment">//从窗口中提取内容</span></span><br><span class="line">        QString context = ui-&gt;textEdit-&gt;<span class="built_in">toPlainText</span>();</span><br><span class="line">        out &lt;&lt; context;</span><br><span class="line">        file.<span class="built_in">close</span>();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;No File Selected&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="关闭文档">关闭文档</h4>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_btnCloseIcon_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Close Icon Clicked: on_objectName_signalName format&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    <span class="comment">// this-&gt;close();</span></span><br><span class="line">    ui-&gt;textEdit-&gt;<span class="built_in">clear</span>();</span><br><span class="line">    <span class="keyword">this</span>-&gt;<span class="built_in">setWindowTitle</span>(<span class="string">&quot;传玺记事本&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (file.<span class="built_in">isOpen</span>())&#123;</span><br><span class="line">        ui-&gt;textEdit-&gt;<span class="built_in">clear</span>();</span><br><span class="line">        file.<span class="built_in">close</span>();</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        ui-&gt;textEdit-&gt;<span class="built_in">clear</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>关闭文档</strong>时跳出弹窗 QMessageBox</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_btnCloseIcon_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Close Icon Clicked: on_objectName_signalName format&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    <span class="comment">// this-&gt;close();</span></span><br><span class="line">    QMessageBox msgBox;</span><br><span class="line">    <span class="keyword">if</span> (file.<span class="built_in">isOpen</span>())&#123;</span><br><span class="line">        msgBox.<span class="built_in">setWindowTitle</span>(file.<span class="built_in">fileName</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    msgBox.<span class="built_in">setText</span>(<span class="string">&quot;文件已被修改。&quot;</span>);</span><br><span class="line">    msgBox.<span class="built_in">setInformativeText</span>(<span class="string">&quot;你要保存更改吗?&quot;</span>);</span><br><span class="line">  	<span class="comment">/*</span></span><br><span class="line"><span class="comment">  	res.qrc配置</span></span><br><span class="line"><span class="comment">  	&lt;RCC&gt;</span></span><br><span class="line"><span class="comment">      &lt;qresource prefix=&quot;/icon&quot;&gt;</span></span><br><span class="line"><span class="comment">        &lt;file&gt;res/noun-serial-port-5265721.png&lt;/file&gt;</span></span><br><span class="line"><span class="comment">      &lt;/qresource&gt;</span></span><br><span class="line"><span class="comment">    &lt;/RCC&gt;</span></span><br><span class="line"><span class="comment">  	*/</span></span><br><span class="line">    <span class="comment">//文件路径：1）res.qrc配置的虚拟引用路径&quot;:/icon/res/notebook.png&quot; 2）真实路径&quot;/resource/res/notebook.png&quot;， &quot;:&quot;表示这是一个Qt资源系统路径，而不是普通的文件系统路径。</span></span><br><span class="line">    msgBox.<span class="built_in">setIconPixmap</span>(<span class="built_in">QPixmap</span>(<span class="string">&quot;:/icon/res/sketchbook.png&quot;</span>).<span class="built_in">scaled</span>(<span class="number">48</span>, <span class="number">48</span>, Qt::KeepAspectRatio, Qt::SmoothTransformation));</span><br><span class="line">    msgBox.<span class="built_in">setStandardButtons</span>(QMessageBox::Save | QMessageBox::Discard | QMessageBox::Cancel);</span><br><span class="line">    msgBox.<span class="built_in">setButtonText</span>(QMessageBox::Save, <span class="string">&quot;保存&quot;</span>);</span><br><span class="line">    msgBox.<span class="built_in">setButtonText</span>(QMessageBox::Cancel, <span class="string">&quot;取消&quot;</span>);</span><br><span class="line">    msgBox.<span class="built_in">setButtonText</span>(QMessageBox::Discard, <span class="string">&quot;放弃&quot;</span>);</span><br><span class="line">    msgBox.<span class="built_in">setDefaultButton</span>(QMessageBox::Save);</span><br><span class="line">    <span class="comment">// msgBox.addButton(&quot;保存&quot;, QMessageBox::AcceptRole);</span></span><br><span class="line">    <span class="comment">// msgBox.addButton(&quot;取消&quot;, QMessageBox::RejectRole);</span></span><br><span class="line">    <span class="comment">// msgBox.addButton(&quot;不保存&quot;, QMessageBox::DestructiveRole);</span></span><br><span class="line">    <span class="type">int</span> ret = msgBox.<span class="built_in">exec</span>();</span><br><span class="line">    <span class="keyword">switch</span> (ret)&#123;</span><br><span class="line">        <span class="keyword">case</span> QMessageBox::Save: <span class="comment">//QMessageBox::AcceptRole:</span></span><br><span class="line">            <span class="comment">// Save was clicked</span></span><br><span class="line">            <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;Save was clicked&quot;</span>;</span><br><span class="line">            <span class="keyword">this</span>-&gt;<span class="built_in">on_btnSaveIcon_clicked</span>();</span><br><span class="line">            <span class="comment">// file.close();</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> QMessageBox::Discard: <span class="comment">//QMessageBox::DestructiveRole:</span></span><br><span class="line">            <span class="comment">// Don&#x27;t Save was clicked</span></span><br><span class="line">            <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;Don&#x27;t Save was clicked&quot;</span>;</span><br><span class="line">            ui-&gt;textEdit-&gt;<span class="built_in">clear</span>();</span><br><span class="line">            <span class="keyword">this</span>-&gt;<span class="built_in">setWindowTitle</span>(<span class="string">&quot;传玺记事本&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (file.<span class="built_in">isOpen</span>())&#123;</span><br><span class="line">                ui-&gt;textEdit-&gt;<span class="built_in">clear</span>();</span><br><span class="line">                file.<span class="built_in">close</span>();</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                ui-&gt;textEdit-&gt;<span class="built_in">clear</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> QMessageBox::Cancel:<span class="comment">//QMessageBox::RejectRole:</span></span><br><span class="line">            <span class="comment">// Cancel was clicked</span></span><br><span class="line">            <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;Cancel was clicked&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="QComboBox">QComboBox</h3>
<p>QComboBox是创建下拉列表的一个控件。它允许用户从一组选项中选择一个，并可以配置为可编辑，使用户能够在其中输入文本。该控件应用于需要从多个选项中进行选择的用户界面场景。</p>
<table>
<thead>
<tr>
<th>功能</th>
<th>描述</th>
<th>API方法</th>
</tr>
</thead>
<tbody>
<tr>
<td>添加选项</td>
<td>向下拉列表添加单个或多个选项</td>
<td>addItem(), addItems()</td>
</tr>
<tr>
<td>获取选项</td>
<td>获取当前选中的文本或索引</td>
<td>currentText(), currentIndex()</td>
</tr>
<tr>
<td>设置选项</td>
<td>设置当前选中的项</td>
<td>setCurrentIndex(int)</td>
</tr>
<tr>
<td>移除选项</td>
<td>从下拉列表中移除项</td>
<td>removeItem(int)</td>
</tr>
<tr>
<td>信号</td>
<td>当选项改变时触发事件</td>
<td>currentIndexChanged(int)</td>
</tr>
<tr>
<td>可编辑性</td>
<td>设置下拉列表是否可编辑</td>
<td>setEditable(bool)</td>
</tr>
<tr>
<td>自定义数据</td>
<td>向下拉列表项关联额外的数据</td>
<td>setItemData(int, const QVariant&amp;)</td>
</tr>
<tr>
<td>清空列表</td>
<td>移除所有选项</td>
<td>clear()</td>
</tr>
</tbody>
</table>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">MainWindow::<span class="built_in">MainWindow</span>(QWidget *parent)</span><br><span class="line">    : <span class="built_in">QMainWindow</span>(parent)</span><br><span class="line">    , <span class="built_in">ui</span>(<span class="keyword">new</span> Ui::MainWindow)&#123;</span><br><span class="line">		QObject::<span class="built_in">connect</span>(ui-&gt;encodeComboBox, &amp;QComboBox::currentIndexChanged, <span class="keyword">this</span>, &amp;MainWindow::oncurrentIndexChanged);      </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::oncurrentIndexChanged</span><span class="params">(<span class="type">int</span> index)</span></span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; index;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt;<span class="string">&quot;当前编码：&quot;</span> &lt;&lt; ui-&gt;encodeComboBox-&gt;<span class="built_in">currentText</span>();</span><br><span class="line">    ui-&gt;textEdit-&gt;<span class="built_in">clear</span>();</span><br><span class="line">    <span class="keyword">if</span> (file.<span class="built_in">isOpen</span>())&#123;</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;文件已打开&quot;</span>;</span><br><span class="line">        ui-&gt;textEdit-&gt;<span class="built_in">clear</span>();</span><br><span class="line">        QTextCodec* codec = QTextCodec::<span class="built_in">codecForName</span>(ui-&gt;encodeComboBox-&gt;<span class="built_in">currentText</span>().<span class="built_in">toStdString</span>().<span class="built_in">c_str</span>());</span><br><span class="line">        file.<span class="built_in">seek</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">while</span> (!file.<span class="built_in">atEnd</span>())&#123;</span><br><span class="line">            QByteArray line = file.<span class="built_in">readLine</span>();</span><br><span class="line">            QString line_code = codec-&gt;<span class="built_in">toUnicode</span>(line);</span><br><span class="line">            <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;编码 File Content: &quot;</span> &lt;&lt; line_code;</span><br><span class="line">            <span class="keyword">if</span> (file.<span class="built_in">pos</span>() == line.<span class="built_in">length</span>()+<span class="number">1</span>)&#123;</span><br><span class="line">                <span class="comment">//覆盖内容</span></span><br><span class="line">                ui-&gt;textEdit-&gt;<span class="built_in">setText</span>(line_code);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">//追加内容</span></span><br><span class="line">                ui-&gt;textEdit-&gt;<span class="built_in">append</span>(line_code);</span><br><span class="line">            &#125;<span class="comment">//end if</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_btnOpenIcon_clicked</span><span class="params">()</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;分步骤打开&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    QFileDialog  qFileDialog;</span><br><span class="line">    qFileDialog.<span class="built_in">setWindowTitle</span>(<span class="built_in">tr</span>(<span class="string">&quot;Open File&quot;</span>));</span><br><span class="line">    qFileDialog.<span class="built_in">setDirectory</span>(<span class="string">&quot;/Users/liuchuanxi/项目/QT&quot;</span>);</span><br><span class="line">    qFileDialog.<span class="built_in">setFileMode</span>(QFileDialog::ExistingFiles);</span><br><span class="line">    qFileDialog.<span class="built_in">setNameFilter</span>(<span class="built_in">tr</span>(<span class="string">&quot;Images (*.png *.jpg *.bmp);;Text files (*.txt)&quot;</span>));</span><br><span class="line">    <span class="keyword">if</span> (qFileDialog.<span class="built_in">exec</span>())&#123;</span><br><span class="line">        QStringList fileNames = qFileDialog.<span class="built_in">selectedFiles</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">const</span> QString &amp;fileName : fileNames) &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;Selected File: &quot;</span> &lt;&lt; fileName.<span class="built_in">toStdString</span>() &lt;&lt; std::endl;</span><br><span class="line">            <span class="comment">// QFile file(fileName);</span></span><br><span class="line">            file.<span class="built_in">setFileName</span>(fileName);</span><br><span class="line">            <span class="type">bool</span> open_flag = file.<span class="built_in">open</span>(QIODevice::ReadOnly | QIODevice::Text);</span><br><span class="line">            <span class="keyword">if</span> (!open_flag)&#123;</span><br><span class="line">                <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;Open File Failed!&quot;</span>;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;<span class="comment">//if</span></span><br><span class="line">            <span class="comment">// QTextStream in(&amp;file);</span></span><br><span class="line">            <span class="comment">// in.setEncoding(QStringConverter::Utf8);//(&quot;UTF-8&quot;);</span></span><br><span class="line">            <span class="comment">// QTextCodec *codec = QTextCodec::codecForName(&quot;GBK&quot;);</span></span><br><span class="line">            QString codecName = ui-&gt;encodeComboBox-&gt;<span class="built_in">currentText</span>();</span><br><span class="line">            <span class="type">const</span> <span class="type">char</span>* codecNameCharPtr = codecName.<span class="built_in">toStdString</span>().<span class="built_in">c_str</span>();</span><br><span class="line">            QTextCodec *codec = QTextCodec::<span class="built_in">codecForName</span>(codecNameCharPtr);</span><br><span class="line">            <span class="type">int</span> context = file.<span class="built_in">size</span>();</span><br><span class="line">            <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;File size: &quot;</span> &lt;&lt; context;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//窗口清除原有文本</span></span><br><span class="line">            ui-&gt;textEdit-&gt;<span class="built_in">clear</span>();</span><br><span class="line">            <span class="comment">// while(!in.atEnd())&#123;</span></span><br><span class="line">            <span class="keyword">while</span>(!file.<span class="built_in">atEnd</span>())&#123;</span><br><span class="line">                <span class="comment">// QString line = in.readLine();</span></span><br><span class="line">                QByteArray line = file.<span class="built_in">readLine</span>();</span><br><span class="line">                QString line_code =  codec-&gt;<span class="built_in">toUnicode</span>(line);</span><br><span class="line">                <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;File Content: &quot;</span> &lt;&lt; line;</span><br><span class="line">                <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;编码 File Content: &quot;</span> &lt;&lt; line_code;</span><br><span class="line">                <span class="keyword">if</span> (file.<span class="built_in">pos</span>() == line.<span class="built_in">length</span>()+<span class="number">1</span>)&#123;</span><br><span class="line">                    <span class="comment">//覆盖内容</span></span><br><span class="line">                    ui-&gt;textEdit-&gt;<span class="built_in">setText</span>(line_code);</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="comment">//追加内容</span></span><br><span class="line">                    ui-&gt;textEdit-&gt;<span class="built_in">append</span>(line_code);</span><br><span class="line">                &#125;<span class="comment">//end if</span></span><br><span class="line">            &#125;<span class="comment">//while</span></span><br><span class="line">            <span class="comment">// file.close();</span></span><br><span class="line">        &#125;<span class="comment">//for</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;No File Selected&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;<span class="comment">//if</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>注</strong>:如果文件以GBK编码保存，用GBK解码-&gt;UTF-8编码-&gt;UTF-8解码-&gt;GBK编码后得到的编码内容和文件保存的GBK编码内容不一样。</p>
<h3 id="游标QTextCursor">游标QTextCursor</h3>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">MainWindow::<span class="built_in">MainWindow</span>(QWidget *parent)</span><br><span class="line">    : <span class="built_in">QMainWindow</span>(parent)</span><br><span class="line">    , <span class="built_in">ui</span>(<span class="keyword">new</span> Ui::MainWindow)&#123;</span><br><span class="line">		QObject::<span class="built_in">connect</span>(ui-&gt;textEdit, &amp;QTextEdit::cursorPositionChanged, <span class="keyword">this</span>, &amp;MainWindow::onCursorPositionChanged);      </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::onCursorPositionChanged</span><span class="params">()</span></span>&#123;</span><br><span class="line">    QTextCursor cursor = ui-&gt;textEdit-&gt;<span class="built_in">textCursor</span>();</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;列: &quot;</span> &lt;&lt; cursor.<span class="built_in">columnNumber</span>()+<span class="number">1</span> &lt;&lt; <span class="string">&quot;行: &quot;</span> &lt;&lt; cursor.<span class="built_in">blockNumber</span>()+<span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> row = cursor.<span class="built_in">blockNumber</span>()+<span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> column = cursor.<span class="built_in">columnNumber</span>()+<span class="number">1</span>;</span><br><span class="line">    ui-&gt;posLabel-&gt;<span class="built_in">setText</span>(QString::<span class="built_in">number</span>(row)+<span class="string">&quot;行，&quot;</span>+QString::<span class="built_in">number</span>(column)+<span class="string">&quot;列&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="窗口标题">窗口标题</h3>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>-&gt;<span class="built_in">setWindowTitle</span>(fileName+<span class="string">&quot;--传玺记事本&quot;</span>);</span><br></pre></td></tr></table></figure>
<h3 id="当前行高亮">当前行高亮</h3>
<p>QTextEdit::ExtraSelection用来表示额外文本选择和高亮的结构</p>
<ol>
<li>结构体：包含两个成员，<code>QTextCursor</code>和<code>QTextCharFormat</code>。<code>QTextCursor</code>表示在文本中的一个位置或者区间，而<code>QTextFormat</code>用于定义这个区间的格式，比如背景、字体。</li>
<li>设置ExtraSelection：可以创建一个或多个ExtraSelection对象，为他们设置相应的光标位置和格式，然后通过QTextEdit的setExtraSelections方法将这些对象应用到文本编辑器中。这样，你可以对文本的特定部分应用特定的格式，而不影响其他文本。</li>
<li>高亮当前行：要高亮显示当前行，你需要在cursorPositionChanged()信号的槽函数中创建一个ExtraSelection对象。使用当前的QTextCursor对象来确定当前行的位置，并设置背景颜色为你选择的高亮颜色。</li>
</ol>
<p>QTextCharFormat::format的成员函数：</p>
<ol>
<li>设置和获取字体样式
<ul>
<li>setFont()设置字体</li>
<li>font()获取字体</li>
</ul>
</li>
<li>设置字体属性
<ul>
<li>setFontWeight()设置字体粗细</li>
<li>setFontItalic()设置字体倾斜</li>
<li>setFontUnderline()设置字体带下划线</li>
</ul>
</li>
<li>设置文本颜色
<ul>
<li>setForeground()设置字体前景色</li>
<li>setBackground()设置字体背景色</li>
</ul>
</li>
<li>其他文本属性
<ul>
<li>setToolTip()设置文本的工具提示</li>
<li>setAnchor()设置文本为超链接</li>
<li>setAnchorHref设置超链接的目标URL</li>
</ul>
</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">MainWindow::<span class="built_in">MainWindow</span>(QWidget *parent)</span><br><span class="line">    : <span class="built_in">QMainWindow</span>(parent)</span><br><span class="line">    , <span class="built_in">ui</span>(<span class="keyword">new</span> Ui::MainWindow)&#123;</span><br><span class="line">		QObject::<span class="built_in">connect</span>(ui-&gt;textEdit, &amp;QTextEdit::cursorPositionChanged, <span class="keyword">this</span>, &amp;MainWindow::onCursorPositionChanged);      </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::onCursorPositionChanged</span><span class="params">()</span></span>&#123;</span><br><span class="line">    QTextCursor cursor = ui-&gt;textEdit-&gt;<span class="built_in">textCursor</span>();</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;列: &quot;</span> &lt;&lt; cursor.<span class="built_in">columnNumber</span>()+<span class="number">1</span> &lt;&lt; <span class="string">&quot;行: &quot;</span> &lt;&lt; cursor.<span class="built_in">blockNumber</span>()+<span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> row = cursor.<span class="built_in">blockNumber</span>()+<span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> column = cursor.<span class="built_in">columnNumber</span>()+<span class="number">1</span>;</span><br><span class="line">    ui-&gt;posLabel-&gt;<span class="built_in">setText</span>(QString::<span class="built_in">number</span>(row)+<span class="string">&quot;行，&quot;</span>+QString::<span class="built_in">number</span>(column)+<span class="string">&quot;列&quot;</span>);</span><br><span class="line">    <span class="comment">//设置当前行高亮</span></span><br><span class="line">    QList&lt;QTextEdit::ExtraSelection&gt; extraSelections;</span><br><span class="line">    QTextEdit::ExtraSelection selection;</span><br><span class="line">    <span class="comment">//知道当前行行号</span></span><br><span class="line">    selection.cursor = ui-&gt;textEdit-&gt;<span class="built_in">textCursor</span>();</span><br><span class="line">    <span class="comment">//颜色</span></span><br><span class="line">    <span class="comment">// QColor color = </span></span><br><span class="line">    <span class="function">QBrush <span class="title">qBrush</span><span class="params">(Qt::yellow)</span></span>;</span><br><span class="line">    selection.format.<span class="built_in">setBackground</span>(qBrush);</span><br><span class="line">    <span class="comment">//让整行亮</span></span><br><span class="line">    selection.format.<span class="built_in">setProperty</span>(QTextFormat::FullWidthSelection, <span class="literal">true</span>);</span><br><span class="line">    <span class="comment">//设置</span></span><br><span class="line">    extraSelections.<span class="built_in">append</span>(selection);</span><br><span class="line">    ui-&gt;textEdit-&gt;<span class="built_in">setExtraSelections</span>(extraSelections);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="QList">QList</h3>
<p>QList是一个容器类，内部实现类似于数组，但也提供了链表特性。QList设计旨在提供一个在多数情况下既高效又方便的通用类表容器。用于存储元素列表。</p>
<ol>
<li>数组式存储：连续内存存储其元素，这意味着提供了索引访问（通过通过下标操作符[]）,以及相对高效的迭代性能。</li>
<li>动态调整大小：与静态数组不同，QList可以动态增长和缩减，自动管理内存分配。</li>
<li>链表特性：虽然QList主要基于数组，但它也提供了一些链表操作，例如在列表开始和结束处添加和移除元素。这些操作比数组中间插入或删除元素更高效。</li>
<li>复制时共享内存：QList使用<code>隐式共享</code>或<code>写时复制</code>的技术。这意味着当你复制一个QList时，他不会立即复制所有元素，而是共享相同的数据，直到你尝试修改其中一个列表，此时他才进行实际的复制。</li>
</ol>
<p><strong>头文件</strong>：<code>#inlcude &lt;QList&gt;</code></p>
<p><strong>实例化</strong>：<code>QList&lt;int&gt; list;</code></p>
<p><strong>添加元素</strong>：<code>list.append(1);</code></p>
<p><strong>访问元素</strong>：<code>int fisrtElement = list[0]; 或者 int firstElement = list.at(0);</code></p>
<p><strong>遍历</strong>：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;list.<span class="built_in">size</span>(); ++i)&#123;</span><br><span class="line">  <span class="built_in">qDebug</span>() &lt;&lt; list[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//迭代器</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> item: list)&#123;</span><br><span class="line">  <span class="built_in">qDebug</span>() &lt;&lt; item;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>移除元素</strong>：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">list.<span class="built_in">removeAt</span>(<span class="number">1</span>);<span class="comment">//移除索引为1的元素</span></span><br><span class="line">list.<span class="built_in">removeOne</span>(<span class="number">3</span>);<span class="comment">//移除一个值为3的元素</span></span><br><span class="line">list.<span class="built_in">clear</span>();<span class="comment">//清空整个列表</span></span><br></pre></td></tr></table></figure>
<h3 id="创建快捷键">创建快捷键</h3>
<p>在Qt中实现快捷键功能涉及到QShortcut类</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建一个快捷键（Ctrl+N）并关联到窗口</span></span><br><span class="line">QShortcut* shortcut = <span class="keyword">new</span> <span class="built_in">QShortcut</span>(<span class="built_in">QKeySequence</span>(<span class="string">&quot;Ctrl+N&quot;</span>), &amp;window);</span><br><span class="line"><span class="comment">//当快捷键被按下时，显示一个消息窗</span></span><br><span class="line">QObject::<span class="built_in">connect</span>(shortcut, &amp;QShortcut::activated, [&amp;]()&#123;</span><br><span class="line">  QMessageBox::<span class="built_in">information</span>(&amp;window, <span class="string">&quot;Shortcut Activated&quot;</span>, <span class="string">&quot;Ctrl+N was pressed&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">QShortcut* shortcutOpen = <span class="keyword">new</span> <span class="built_in">QShortcut</span>(<span class="built_in">QKeySequence</span>(<span class="string">&quot;Ctrl+O&quot;</span>), <span class="keyword">this</span>);</span><br><span class="line">QShortcut* shortcutSave = <span class="keyword">new</span> <span class="built_in">QShortcut</span>(<span class="built_in">QKeySequence</span>(<span class="string">&quot;Ctrl+S&quot;</span>), <span class="keyword">this</span>);</span><br><span class="line"><span class="comment">//把Ctrl+O的信号添加槽，调用打开按键的槽函数</span></span><br><span class="line">QObject::<span class="built_in">connect</span>(shortcutOpen, &amp;QShortcut::activate, [&amp;]()&#123;</span><br><span class="line">  Widget::<span class="built_in">on_pushButtonOpen_clicked</span>();</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//把Ctrl+S的信号添加槽，调用保存按键的槽函数</span></span><br><span class="line">QObject::<span class="built_in">connect</span>(shortcutSave, &amp;QShortcut::activate, [&amp;]()&#123;</span><br><span class="line">  Widget::<span class="built_in">on_pushButtonSave_clicked</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">MainWindow::<span class="built_in">MainWindow</span>(QWidget *parent)</span><br><span class="line">    : <span class="built_in">QMainWindow</span>(parent)</span><br><span class="line">    , <span class="built_in">ui</span>(<span class="keyword">new</span> Ui::MainWindow)&#123;</span><br><span class="line">    <span class="comment">//快捷键</span></span><br><span class="line">    QShortcut* openShortcut = <span class="keyword">new</span> <span class="built_in">QShortcut</span>(<span class="built_in">QKeySequence</span>(<span class="built_in">tr</span>(<span class="string">&quot;Ctrl+O&quot;</span>, <span class="string">&quot;File|Open&quot;</span>)), <span class="keyword">this</span>);</span><br><span class="line">    QShortcut* saveShortcut = <span class="keyword">new</span> <span class="built_in">QShortcut</span>(<span class="built_in">QKeySequence</span>(<span class="built_in">tr</span>(<span class="string">&quot;Ctrl+S&quot;</span>, <span class="string">&quot;File|Save&quot;</span>)), <span class="keyword">this</span>);</span><br><span class="line">    <span class="built_in">connect</span>(openShortcut, &amp;QShortcut::activated, <span class="keyword">this</span>, &amp;MainWindow::on_btnOpenIcon_clicked);</span><br><span class="line">    <span class="built_in">connect</span>(saveShortcut, &amp;QShortcut::activated, <span class="keyword">this</span>, &amp;MainWindow::on_btnSaveIcon_clicked);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="字体放大缩小">字体放大缩小</h3>
<p><strong>lambda</strong>函数方式</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">MainWindow::<span class="built_in">MainWindow</span>(QWidget *parent)</span><br><span class="line">    : <span class="built_in">QMainWindow</span>(parent)</span><br><span class="line">    , <span class="built_in">ui</span>(<span class="keyword">new</span> Ui::MainWindow)&#123;</span><br><span class="line">    <span class="comment">//快捷键</span></span><br><span class="line">    QShortcut* zoomInShortcut = <span class="keyword">new</span> <span class="built_in">QShortcut</span>(<span class="built_in">QKeySequence</span>(<span class="built_in">tr</span>(<span class="string">&quot;Ctrl+Shift+=&quot;</span>)), <span class="keyword">this</span>);</span><br><span class="line">    QShortcut* zoomOutShortcut = <span class="keyword">new</span> <span class="built_in">QShortcut</span>(<span class="built_in">QKeySequence</span>(<span class="built_in">tr</span>(<span class="string">&quot;Ctrl+-&quot;</span>)), <span class="keyword">this</span>);</span><br><span class="line">    <span class="built_in">connect</span>(zoomInShortcut, &amp;QShortcut::activated, <span class="keyword">this</span>, [=]()&#123;</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;Zoom In&quot;</span>;</span><br><span class="line">        <span class="comment">//获取当前字体信息</span></span><br><span class="line">        QFont font = ui-&gt;textEdit-&gt;<span class="built_in">font</span>();</span><br><span class="line">        <span class="comment">//获取当前字体大小</span></span><br><span class="line">        <span class="type">int</span> fontSize = font.<span class="built_in">pointSize</span>();</span><br><span class="line">        <span class="comment">//改变当前字体大小</span></span><br><span class="line">        <span class="keyword">if</span> (fontSize==<span class="number">-1</span>) <span class="keyword">return</span>;</span><br><span class="line">        <span class="type">int</span> newFontSize = fontSize + <span class="number">1</span>;</span><br><span class="line">        font.<span class="built_in">setPointSize</span>(newFontSize);</span><br><span class="line">        ui-&gt;textEdit-&gt;<span class="built_in">setFont</span>(font);</span><br><span class="line">        <span class="comment">// ui-&gt;textEdit-&gt;setFontPointSize(fontSize+1);//该语句无法改变字体大小</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">connect</span>(zoomOutShortcut, &amp;QShortcut::activated, <span class="keyword">this</span>, [=]()&#123;</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;Zoom Out&quot;</span>;</span><br><span class="line">        <span class="comment">//获取当前字体信息</span></span><br><span class="line">        QFont font = ui-&gt;textEdit-&gt;<span class="built_in">font</span>();</span><br><span class="line">        <span class="comment">//获取当前字体大小</span></span><br><span class="line">        <span class="type">int</span> fontSize = font.<span class="built_in">pointSize</span>();</span><br><span class="line">        <span class="comment">//改变当前字体大小</span></span><br><span class="line">        <span class="keyword">if</span> (fontSize==<span class="number">-1</span>) <span class="keyword">return</span>;</span><br><span class="line">        <span class="type">int</span> newFontSize = fontSize - <span class="number">1</span>;</span><br><span class="line">        font.<span class="built_in">setPointSize</span>(newFontSize);</span><br><span class="line">        ui-&gt;textEdit-&gt;<span class="built_in">setFont</span>(font);</span><br><span class="line">        <span class="comment">// ui-&gt;textEdit-&gt;setFontPointSize(fontSize-1);//该语句无法改变字体大小</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>独立定义放缩函数</strong>方式</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//mainwindow.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> MAINWINDOW_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAINWINDOW_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QMainWindow&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QFile&gt;</span></span></span><br><span class="line"></span><br><span class="line">QT_BEGIN_NAMESPACE</span><br><span class="line"><span class="keyword">namespace</span> Ui &#123;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MainWindow</span>;</span><br><span class="line">&#125;</span><br><span class="line">QT_END_NAMESPACE</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MainWindow</span> : <span class="keyword">public</span> QMainWindow</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    QFile file;</span><br><span class="line">    QString preEncodeName;</span><br><span class="line">    <span class="built_in">MainWindow</span>(QWidget *parent = <span class="literal">nullptr</span>);</span><br><span class="line">    ~<span class="built_in">MainWindow</span>();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">zoomIn</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">zoomOut</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> slots:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_btnCloseIcon_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">btnOldConnectFunc</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">btnNewConnectFunc</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_btnOpenIcon_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_btnSaveIcon_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">oncurrentIndexChanged</span><span class="params">(<span class="type">int</span> index)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">onCursorPositionChanged</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//lambda匿名槽函数方式不需要声明</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Ui::MainWindow *ui;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// MAINWINDOW_H</span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//mainwindow.cpp</span></span><br><span class="line">MainWindow::<span class="built_in">MainWindow</span>(QWidget *parent)</span><br><span class="line">    : <span class="built_in">QMainWindow</span>(parent)</span><br><span class="line">    , <span class="built_in">ui</span>(<span class="keyword">new</span> Ui::MainWindow)&#123;</span><br><span class="line">    <span class="comment">//快捷键</span></span><br><span class="line">    QShortcut* zoomInShortcut = <span class="keyword">new</span> <span class="built_in">QShortcut</span>(<span class="built_in">QKeySequence</span>(<span class="built_in">tr</span>(<span class="string">&quot;Ctrl+Shift+=&quot;</span>)), <span class="keyword">this</span>);</span><br><span class="line">    QShortcut* zoomOutShortcut = <span class="keyword">new</span> <span class="built_in">QShortcut</span>(<span class="built_in">QKeySequence</span>(<span class="built_in">tr</span>(<span class="string">&quot;Ctrl+-&quot;</span>)), <span class="keyword">this</span>);</span><br><span class="line">    <span class="built_in">connect</span>(zoomInShortcut, &amp;QShortcut::activated, <span class="keyword">this</span>, [=]()&#123;</span><br><span class="line">        <span class="built_in">zoomIn</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">connect</span>(zoomOutShortcut, &amp;QShortcut::activated, <span class="keyword">this</span>, [=]()&#123;</span><br><span class="line">        <span class="built_in">zoomOut</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::zoomIn</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;Zoom In&quot;</span>;</span><br><span class="line">    <span class="comment">//获取当前字体信息</span></span><br><span class="line">    QFont font = ui-&gt;textEdit-&gt;<span class="built_in">font</span>();</span><br><span class="line">    <span class="comment">//获取当前字体大小</span></span><br><span class="line">    <span class="type">int</span> fontSize = font.<span class="built_in">pointSize</span>();</span><br><span class="line">    <span class="comment">//改变当前字体大小</span></span><br><span class="line">    <span class="keyword">if</span> (fontSize==<span class="number">-1</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="type">int</span> newFontSize = fontSize + <span class="number">1</span>;</span><br><span class="line">    font.<span class="built_in">setPointSize</span>(newFontSize);</span><br><span class="line">    ui-&gt;textEdit-&gt;<span class="built_in">setFont</span>(font);</span><br><span class="line">    <span class="comment">// ui-&gt;textEdit-&gt;setFontPointSize(fontSize+1);</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::zoomOut</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;Zoom Out&quot;</span>;</span><br><span class="line">    <span class="comment">//获取当前字体信息</span></span><br><span class="line">    QFont font = ui-&gt;textEdit-&gt;<span class="built_in">font</span>();</span><br><span class="line">    <span class="comment">//获取当前字体大小</span></span><br><span class="line">    <span class="type">int</span> fontSize = font.<span class="built_in">pointSize</span>();</span><br><span class="line">    <span class="comment">//改变当前字体大小</span></span><br><span class="line">    <span class="keyword">if</span> (fontSize==<span class="number">-1</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="type">int</span> newFontSize = fontSize - <span class="number">1</span>;</span><br><span class="line">    font.<span class="built_in">setPointSize</span>(newFontSize);</span><br><span class="line">    ui-&gt;textEdit-&gt;<span class="built_in">setFont</span>(font);</span><br><span class="line">    <span class="comment">// ui-&gt;textEdit-&gt;setFontPointSize(fontSize-1);</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="事件">事件</h3>
<p>Qt是C++框架主要用来开发窗口的应用程序。我们使用的基于窗口的应用程序都是基于事件，其目的主要是用来实现回调（无需手动写调用函数代码，自动调用，因为只有这样程序的效率才是最高），所以在Qt框架内部为我们提供了一些事件处理机制，当窗口事件产生之后，事件会经过：<code>事件产生</code>-&gt;<code>事件派发</code>-&gt;<code>事件过滤</code>-&gt;<code>事件分发</code>-&gt;<code>事件处理</code>几个阶段。Qt窗口中对于产生的一系列事件都有默认的处理动作，如果我们有特殊需求就需要在合适的阶段重写事件的处理动作，<strong>比如信号与槽就是一种</strong>（信号与槽就无法处理窗口大小改变时的处理过程）。</p>
<p>事件是由系统或者Qt本身在不同的场景下发生的。当用户按下/移动鼠标/敲击键盘，或者窗口关闭/大小变化/隐藏/显示都会发出一个相应的事件。一些事件在对用户操作做出响应时发生，如鼠标/键盘事件等；另一些事件则是由系统自动发出，如计时器事件。</p>
<p>每一个Qt应用程序都对应一个唯一的QApplication应用对象，然后调用该对象的exec()函数，这样Qt框架内部的事件检测就开始了(<code>程序将进入事件循环来监听应用程序的事件</code>)。</p>
<p>查看QWidget protected function</p>
<p><strong>事件在Qt中产生之后的分发过程</strong>：事件传递</p>
<ol>
<li>事件产生后，Qt使用应用程序对象调用notify()函数将事件发送到指定的窗口。在<code>a.exec()</code>中会自动调用notify()函数。</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//事件派发</span></span><br><span class="line">[<span class="keyword">override</span> <span class="keyword">virtual</span>] <span class="function"><span class="type">bool</span> <span class="title">QApplication::notify</span><span class="params">(QObject* receiver, QEvent* e)</span></span>;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>事件在发送过程中可以通过事件过滤器进行过滤，默认不对任何产生的事件进行过滤，可以自定义。可处理本控件及其关联的控件的事件。</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//事件过滤器</span></span><br><span class="line"><span class="comment">//需要先给窗口安装过滤器，该事件才会触发</span></span><br><span class="line">[<span class="keyword">virtual</span>] <span class="function"><span class="type">bool</span> <span class="title">QObject::eventFilter</span><span class="params">(QObject* watched, QEvent* event)</span></span>;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>当事件发送到指定的窗口之后，窗口的事件分发器会对收到的事件进行分类，此处也是Qt框架自动处理。只针对本控件事件。</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//事件分类器(事件分发)</span></span><br><span class="line">[<span class="keyword">override</span> <span class="keyword">virtual</span> <span class="keyword">protected</span>] <span class="function"><span class="type">bool</span> <span class="title">QWidget::event</span><span class="params">(QEvent* event)</span></span>; </span><br></pre></td></tr></table></figure>
<ol start="4">
<li>事件分发器会将分类之后的事件（鼠标事件、键盘事件、绘图事件）分发给对应的事件处理器函数进行处理，每个事件处理器函数都有默认的处理动作（我们也可以重写这些事件处理器函数），比如：鼠标事件。可以自定义</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//事件处理函数</span></span><br><span class="line"><span class="comment">//鼠标按下</span></span><br><span class="line">[<span class="keyword">virtual</span> <span class="keyword">protected</span>] <span class="function"><span class="type">void</span> <span class="title">QWidget::mousePressEvent</span><span class="params">(QMouseEvent* event)</span></span>;</span><br><span class="line"><span class="comment">//鼠标释放</span></span><br><span class="line">[<span class="keyword">virtual</span> <span class="keyword">protected</span>] <span class="function"><span class="type">void</span> <span class="title">QWidget::mouseReleaseEvent</span><span class="params">(QMouseEvent* event)</span></span>;</span><br><span class="line"><span class="comment">//鼠标移动</span></span><br><span class="line">[<span class="keyword">virtual</span> <span class="keyword">protected</span>] <span class="function"><span class="type">void</span> <span class="title">QWidget::mouseMoveEvent</span><span class="params">(QMouseEvent* event)</span></span>;</span><br></pre></td></tr></table></figure>
<p><strong>事件响应反向传递</strong></p>
<p>在事件处理中，<code>accept()</code>和<code>ignore()</code>函数用于控制事件在组件中的传播。<code>accept()</code>组件会“接收”事件，阻止其进一步传播到其他组件；而<code>ignore()</code>会让事件继续传播到父组件。<code>accept()</code>和<code>ignore()</code>确保事件的唯一响应组件，防止事件泄漏到其他组件</p>
<h4 id="事件过程中的事件处理环节">事件过程中的事件处理环节</h4>
<p><strong>程序关闭之前的询问</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//mainwindow.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> MAINWINDOW_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAINWINDOW_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QMainWindow&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QFile&gt;</span></span></span><br><span class="line"></span><br><span class="line">QT_BEGIN_NAMESPACE</span><br><span class="line"><span class="keyword">namespace</span> Ui &#123;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MainWindow</span>;</span><br><span class="line">&#125;</span><br><span class="line">QT_END_NAMESPACE</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MainWindow</span> : <span class="keyword">public</span> QMainWindow</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    QFile file;</span><br><span class="line">    QString preEncodeName;</span><br><span class="line">    <span class="built_in">MainWindow</span>(QWidget *parent = <span class="literal">nullptr</span>);</span><br><span class="line">    ~<span class="built_in">MainWindow</span>();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">zoomIn</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">zoomOut</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">enterEvent</span><span class="params">(QEnterEvent *event)</span> <span class="keyword">override</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">leaveEvent</span><span class="params">(QEvent *event)</span> <span class="keyword">override</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">wheelEvent</span><span class="params">(QWheelEvent *event)</span> <span class="keyword">override</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">closeEvent</span><span class="params">(QCloseEvent* event)</span> <span class="keyword">override</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">resizeEvent</span><span class="params">(QResizeEvent* event)</span> <span class="keyword">override</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> slots:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_btnCloseIcon_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">btnOldConnectFunc</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">btnNewConnectFunc</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_btnOpenIcon_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_btnSaveIcon_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">oncurrentIndexChanged</span><span class="params">(<span class="type">int</span> index)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">onCursorPositionChanged</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//lambda匿名槽函数方式不需要声明</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Ui::MainWindow *ui;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// MAINWINDOW_H</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//MainWindow.cpp</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::enterEvent</span><span class="params">(QEnterEvent *event)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;mouse enter&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::leaveEvent</span><span class="params">(QEvent *event)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;mouse leave&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::wheelEvent</span><span class="params">(QWheelEvent *event)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;wheel&quot;</span>;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; event-&gt;<span class="built_in">angleDelta</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::closeEvent</span><span class="params">(QCloseEvent *event)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;close widget&quot;</span>;</span><br><span class="line">    QMessageBox msgBox;</span><br><span class="line">    <span class="keyword">if</span> (file.<span class="built_in">isOpen</span>())&#123;</span><br><span class="line">        msgBox.<span class="built_in">setWindowTitle</span>(file.<span class="built_in">fileName</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    msgBox.<span class="built_in">setText</span>(<span class="string">&quot;记事本关闭&quot;</span>);</span><br><span class="line">    msgBox.<span class="built_in">setInformativeText</span>(<span class="string">&quot;你要关闭窗口吗?&quot;</span>);</span><br><span class="line">    <span class="comment">//文件路径：1）res.qrc配置的虚拟引用路径&quot;:icon/res/notebook.png&quot; 2）真实路径&quot;/resource/res/notebook.png&quot;， “：”表示这是一个Qt资源系统路径，而不是普通的文件系统路径。</span></span><br><span class="line">    msgBox.<span class="built_in">setIconPixmap</span>(<span class="built_in">QPixmap</span>(<span class="string">&quot;:/icon/res/sketchbook.png&quot;</span>).<span class="built_in">scaled</span>(<span class="number">48</span>, <span class="number">48</span>, Qt::KeepAspectRatio, Qt::SmoothTransformation));</span><br><span class="line">    msgBox.<span class="built_in">setStandardButtons</span>(QMessageBox::Yes | QMessageBox::No);</span><br><span class="line">    msgBox.<span class="built_in">setButtonText</span>(QMessageBox::Yes, <span class="string">&quot;关闭&quot;</span>);</span><br><span class="line">    msgBox.<span class="built_in">setButtonText</span>(QMessageBox::No, <span class="string">&quot;不关闭&quot;</span>);</span><br><span class="line">    msgBox.<span class="built_in">setDefaultButton</span>(QMessageBox::Yes);</span><br><span class="line">    <span class="comment">// msgBox.addButton(&quot;保存&quot;, QMessageBox::AcceptRole);</span></span><br><span class="line">    <span class="comment">// msgBox.addButton(&quot;取消&quot;, QMessageBox::RejectRole);</span></span><br><span class="line">    <span class="comment">// msgBox.addButton(&quot;不保存&quot;, QMessageBox::DestructiveRole);</span></span><br><span class="line">    <span class="type">int</span> ret = msgBox.<span class="built_in">exec</span>();</span><br><span class="line">    <span class="keyword">switch</span>(ret)&#123;</span><br><span class="line">        <span class="keyword">case</span> QMessageBox::Yes: <span class="comment">//QMessageBox::AcceptRole:</span></span><br><span class="line">            <span class="comment">// Save was clicked</span></span><br><span class="line">            <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;Yes was clicked&quot;</span>;</span><br><span class="line">            event-&gt;<span class="built_in">accept</span>();</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> QMessageBox::No: <span class="comment">//QMessageBox::DestructiveRole:</span></span><br><span class="line">            <span class="comment">// Don&#x27;t Save was clicked</span></span><br><span class="line">            <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;No was clicked&quot;</span>;</span><br><span class="line">            event-&gt;<span class="built_in">ignore</span>();</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::resizeEvent</span><span class="params">(QResizeEvent *event)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;resize widget:&quot;</span> &lt;&lt; <span class="string">&quot;old size:&quot;</span> &lt;&lt; event-&gt;<span class="built_in">oldSize</span>() &lt;&lt; <span class="string">&quot;new size:&quot;</span> &lt;&lt; event-&gt;<span class="built_in">size</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>项目目录结构</strong></p>
<p><img src="/2025/02/24/QT-C/QT-C/image-20250422101427167.png" alt="image-20250422101427167"></p>
<p><strong>自定义按键</strong>: MyButton</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//mybutton.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> MYBUTTON_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MYBUTTON_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QWidget&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyButton</span>: <span class="keyword">public</span> QWidget&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    QPixmap pic;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">MyButton</span><span class="params">(QWidget *parent = <span class="literal">nullptr</span>)</span></span>;</span><br><span class="line">    <span class="comment">// ~MyButton();</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">enterEvent</span><span class="params">(QEnterEvent* event)</span> <span class="keyword">override</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">leaveEvent</span><span class="params">(QEvent* event)</span> <span class="keyword">override</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">mousePressEvent</span><span class="params">(QMouseEvent* event)</span> <span class="keyword">override</span></span>;</span><br><span class="line">    <span class="comment">//绘图事件，update()之后会调用</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">paintEvent</span><span class="params">(QPaintEvent* event)</span> <span class="keyword">override</span></span>;</span><br><span class="line"></span><br><span class="line">signals:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">clicked</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// MYBUTTON_H</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//mybutton.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;mybutton.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QPainter&gt;</span></span></span><br><span class="line"></span><br><span class="line">MyButton::<span class="built_in">MyButton</span>(QWidget *parent): <span class="built_in">QWidget</span>(parent)</span><br><span class="line">&#123;</span><br><span class="line">    pic.<span class="built_in">load</span>(<span class="string">&quot;:/icon/res/notebook.png&quot;</span>);</span><br><span class="line">    <span class="built_in">setFixedSize</span>(pic.<span class="built_in">size</span>());</span><br><span class="line">    <span class="built_in">update</span>(); <span class="comment">//触发paintEvent</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MyButton::enterEvent</span><span class="params">(QEnterEvent *event)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    pic.<span class="built_in">load</span>(<span class="string">&quot;:/icon/res/open.png&quot;</span>);</span><br><span class="line">    <span class="built_in">update</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MyButton::leaveEvent</span><span class="params">(QEvent *event)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    pic.<span class="built_in">load</span>(<span class="string">&quot;:/icon/res/notebook.png&quot;</span>);</span><br><span class="line">    <span class="built_in">update</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MyButton::mousePressEvent</span><span class="params">(QMouseEvent *event)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    pic.<span class="built_in">load</span>(<span class="string">&quot;:/icon/res/open2.png&quot;</span>);</span><br><span class="line">    <span class="built_in">update</span>();</span><br><span class="line">    <span class="function">emit <span class="title">clicked</span><span class="params">()</span></span>; <span class="comment">//发射信号</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MyButton::paintEvent</span><span class="params">(QPaintEvent *event)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">QPainter <span class="title">painter</span><span class="params">(<span class="keyword">this</span>)</span></span>;</span><br><span class="line">    painter.<span class="built_in">drawPixmap</span>(<span class="built_in">rect</span>(), pic);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//mainwindow.cpp</span></span><br><span class="line">MainWindow::<span class="built_in">MainWindow</span>(QWidget *parent)</span><br><span class="line">    : <span class="built_in">QMainWindow</span>(parent)</span><br><span class="line">    , <span class="built_in">ui</span>(<span class="keyword">new</span> Ui::MainWindow)</span><br><span class="line">&#123;</span><br><span class="line">    ui-&gt;<span class="built_in">setupUi</span>(<span class="keyword">this</span>);</span><br><span class="line">    <span class="comment">//自定义按键的信号与槽, 捕获MyButton::mousePressEvent事件中发射的c licked()信号</span></span><br><span class="line">    <span class="built_in">connect</span>(ui-&gt;mybutton, &amp;MyButton::clicked, [=]()&#123;</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;MyButton Clicked&quot;</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2025/02/24/QT-C/QT-C/image-20250422102159782.png" alt="image-20250422102159782"></p>
<p>控件mybutton从原来的QWidget控件类（MyButton类继承的父类）提升为MyButton类</p>
<p><img src="/2025/02/24/QT-C/QT-C/mybutton.gif" alt="mybutton"></p>
<p><strong>自定义控件事件</strong>: MyTextEdit</p>
<ol>
<li>自定义控件MyTextEdit并让其继承自Qt中的直接父控件类QTextEdit。</li>
<li>自定义控件MyTextEdit的构造函数的参数类型设置为Qt中的根部父控件类指针QWidget*，并在初始化列表中用传入的根部父控件类指针对象实例化直接父控件类QTextEdit，目的是把QDesigner界面的根部控件QWidget中的QTextEdit控件<strong>提升为</strong>MyTextEdit控件。</li>
<li>在自定义控件类中定义各事件处理函数，例如<code>void MyTextEdit::wheelEvent(QWheelEvent* e)</code></li>
<li>在触发的事件处理函数结束时设置<code>event-&gt;accept()</code>结束该事件的传播，或者将该事件上传给直接的父控件处理，QTextEdit::wheelEvent(e), 防止该函数的子类覆盖父类。</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//myTextEdit.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> MYTEXTEDIT_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MYTEXTEDIT_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QTextEdit&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyTextEdit</span>: <span class="keyword">public</span> QTextEdit</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"><span class="keyword">public</span>: </span><br><span class="line">    <span class="built_in">MyTextEdit</span>(QWidget *parent);</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">wheelEvent</span><span class="params">(QWheelEvent *event)</span> <span class="keyword">override</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">keyPressEvent</span><span class="params">(QKeyEvent *event)</span> <span class="keyword">override</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">keyReleaseEvent</span><span class="params">(QKeyEvent *event)</span> <span class="keyword">override</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">bool</span> ctrlKeyPressed = <span class="literal">false</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// MYTEXTEDIT_H</span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//myTextEdit.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;myTextEdit.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QWheelEvent&gt;</span></span></span><br><span class="line"></span><br><span class="line">MyTextEdit::<span class="built_in">MyTextEdit</span>(QWidget *parent): <span class="built_in">QTextEdit</span>(parent)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MyTextEdit::wheelEvent</span><span class="params">(QWheelEvent *event)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;MyTextEdit.cpp wheelEvent&quot;</span>;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; event-&gt;<span class="built_in">angleDelta</span>();</span><br><span class="line">    <span class="comment">//本方法的放大缩小功能中，滚轮在中间时进行放大和缩小操作也可以实现，不要求滚轮到达顶部或底部时才开始放大或缩小</span></span><br><span class="line">    <span class="keyword">if</span> (event-&gt;<span class="built_in">angleDelta</span>().<span class="built_in">y</span>() &gt; <span class="number">0</span> &amp;&amp; <span class="keyword">this</span>-&gt;ctrlKeyPressed) &#123;</span><br><span class="line">        <span class="comment">// Zoom in</span></span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;Zoom In&quot;</span>;</span><br><span class="line">        <span class="keyword">this</span>-&gt;<span class="built_in">zoomIn</span>();</span><br><span class="line">        event-&gt;<span class="built_in">accept</span>();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (event-&gt;<span class="built_in">angleDelta</span>().<span class="built_in">y</span>() &lt; <span class="number">0</span> &amp;&amp; <span class="keyword">this</span>-&gt;ctrlKeyPressed) &#123;</span><br><span class="line">        <span class="comment">// Zoom out</span></span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;Zoom Out&quot;</span>;</span><br><span class="line">        <span class="keyword">this</span>-&gt;<span class="built_in">zoomOut</span>();</span><br><span class="line">        event-&gt;<span class="built_in">accept</span>();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 其他事件交给父类处理</span></span><br><span class="line">        QTextEdit::<span class="built_in">wheelEvent</span>(event);</span><br><span class="line">    &#125;<span class="comment">//end if </span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MyTextEdit::keyPressEvent</span><span class="params">(QKeyEvent *event)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (event-&gt;<span class="built_in">key</span>() == Qt::Key_Control)&#123;</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;Ctrl Key Pressed&quot;</span>;</span><br><span class="line">        <span class="keyword">this</span>-&gt;ctrlKeyPressed = <span class="literal">true</span>;</span><br><span class="line">        event-&gt;<span class="built_in">accept</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 其他按键交给父类处理</span></span><br><span class="line">        QTextEdit::<span class="built_in">keyPressEvent</span>(event);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MyTextEdit::keyReleaseEvent</span><span class="params">(QKeyEvent *event)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (event-&gt;<span class="built_in">key</span>() == Qt::Key_Control)&#123;</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;Ctrl Key Released&quot;</span>;</span><br><span class="line">        <span class="keyword">this</span>-&gt;ctrlKeyPressed = <span class="literal">false</span>;</span><br><span class="line">        event-&gt;<span class="built_in">accept</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 其他按键交给父类处理</span></span><br><span class="line">        QTextEdit::<span class="built_in">keyPressEvent</span>(event);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="/2025/02/24/QT-C/QT-C/ctrl.gif" alt="ctrl"></p>
<h4 id="事件过程中的事件过滤环节">事件过程中的事件过滤环节</h4>
<p>之前通过继承QTextEdit来重写事件处理函数实现Ctrl+滚轮的检测，现在通过事件过滤器实现。</p>
<p>在Qt事件处理过程中，引入<strong>事件过滤器</strong>可以让你在事件达到目标对象之前进行拦截和处理。这是一种强大的机制，允许你在不同对象间共享事件处理逻辑或在父对象中集中处理待定事件。步骤如下：</p>
<ol>
<li><strong>定义事件过滤器</strong>：事件过滤器通常是一个重写了<code>QObject::eventFilter()</code>方法的对象。这个方法会在事件传递给目标对象之前被调用。</li>
<li><strong>安装事件过滤器</strong>：使用<code>QObject::installEventFilter()</code>方法安装事件过滤器。这个方法告诉Qt在将事件发送给特定对象之前先通过过滤器对象。（例如，如果你想在父窗口中过滤子窗口事件，你需要在父窗口的对象上调用<code>QObject::installEventFilter()</code>，并将子窗口作为参数传递。）某控件对象通过调用<code>QObject::installEventFilter(另一个控件对象)</code>实现在事件发送给本控件对象时调用另一个控件对象的<code>QObject::eventFilter()</code>方法。</li>
<li><strong>事件过滤器逻辑</strong>：在<code>QObject::eventFilter()</code>方法内部，你可以编写自定义逻辑来决定如何处理或忽略事件。如果此方法返回<code>true</code>,则表示事件已被处理，不应该继续传递；如果返回<code>false</code>,则事件将正常传递给目标对象。</li>
<li><strong>事件分发</strong>：当事件发生时，Qt首先将事件发送到安装了事件过滤器<code>QObject::installEventFilter()</code>的对象。在这一步，<code>eventFilter()</code>方法被调用。</li>
<li><strong>决定是否传递事件</strong>：根据<code>eventFilter()</code>方法的返回值，Qt决定是否继续向目标对象传递事件。如果过滤器返回<code>true</code>,事件处理到此结束；如果返回<code>false</code>,事件继续传递到原始目标对象。</li>
<li><strong>目标对象处理事件</strong>：如果事件过滤器允许事件继续传递，目标对象将像没有事件过滤器存在时那样处理事件。</li>
</ol>
<p>事件过滤器特别适用于以下情况：</p>
<ul>
<li>
<p>当你想在不修改子类代码的情况下改变事件的行为。</p>
</li>
<li>
<p>当多个对象需要共享相同的事件处理逻辑。</p>
</li>
<li>
<p>当你需要在更高的层级上监控或修改应用程序的事件流。</p>
</li>
</ul>
<p>通过使用事件过滤器，Qt应用程序可以获得更大的灵活性和更细粒度的事件处理控制。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//mainwindow.cpp</span></span><br><span class="line">MainWindow::<span class="built_in">MainWindow</span>(QWidget *parent)</span><br><span class="line">    : <span class="built_in">QMainWindow</span>(parent)</span><br><span class="line">    , <span class="built_in">ui</span>(<span class="keyword">new</span> Ui::MainWindow)</span><br><span class="line">&#123;</span><br><span class="line">    ui-&gt;<span class="built_in">setupUi</span>(<span class="keyword">this</span>);</span><br><span class="line">    <span class="comment">//一个控件安装另一个控件的事件过滤器</span></span><br><span class="line">    ui-&gt;textEdit-&gt;<span class="built_in">installEventFilter</span>(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">MainWindow::eventFilter</span><span class="params">(QObject *obj, QEvent *event)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;Filtering event for:&quot;</span> &lt;&lt; obj;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;type: &quot;</span> &lt;&lt; event-&gt;<span class="built_in">type</span>();<span class="comment">// &lt;&lt; &quot;QEvent::MouseButtonDblClick: &quot; &lt;&lt; QEvent::MouseButtonDblClick;</span></span><br><span class="line">    <span class="keyword">if</span> (event-&gt;<span class="built_in">type</span>() == QEvent::MouseButtonDblClick)&#123;</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; obj-&gt;<span class="built_in">objectName</span>() &lt;&lt; <span class="string">&quot; Mouse Double Click Event&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (event-&gt;<span class="built_in">type</span>() == QEvent::Wheel)&#123;</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; obj-&gt;<span class="built_in">objectName</span>() &lt;&lt; <span class="string">&quot; Mouse Wheel Event&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//ctrl键按下</span></span><br><span class="line">    <span class="keyword">if</span> (event-&gt;<span class="built_in">type</span>() == QEvent::KeyPress)&#123;</span><br><span class="line">        QKeyEvent* keyEvent = <span class="built_in">static_cast</span>&lt;QKeyEvent*&gt;(event); <span class="comment">//相当于事件分类</span></span><br><span class="line">        <span class="keyword">if</span> (keyEvent-&gt;<span class="built_in">key</span>() == Qt::Key_Control)&#123;</span><br><span class="line">            <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;Ctrl Key Pressed&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//如何将ctrl和滚轮结合呢？，本过滤器中传递的事件event要么是ctrl要么是wheel, 这两个事件类别是互斥的。所以只能一个类别用event传递，另一个类别用其他对象传递。</span></span><br><span class="line">    <span class="comment">//本方法的放大缩小有一个小bug就是在滚轮在中间时进行放大和缩小操作时有问题，只有当滚轮到达顶部或底部时才开始放大或缩小</span></span><br><span class="line">    <span class="keyword">if</span> (event-&gt;<span class="built_in">type</span>() == QEvent::Wheel)&#123;</span><br><span class="line">        <span class="keyword">if</span> (QGuiApplication::<span class="built_in">keyboardModifiers</span>() == Qt::ControlModifier)&#123;</span><br><span class="line">            <span class="comment">// // 获取滚动条指针</span></span><br><span class="line">            <span class="comment">// QScrollBar *vScrollBar = ui-&gt;textEdit-&gt;verticalScrollBar();</span></span><br><span class="line">            <span class="comment">// // 临时禁用滚动条对滚轮的响应</span></span><br><span class="line">            <span class="comment">// vScrollBar-&gt;setEnabled(false);</span></span><br><span class="line">            <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;Ctrl + Mouse Wheel Event&quot;</span>;</span><br><span class="line">            QWheelEvent* wheelEvent = <span class="built_in">static_cast</span>&lt;QWheelEvent*&gt;(event);</span><br><span class="line">            <span class="keyword">if</span> (wheelEvent-&gt;<span class="built_in">angleDelta</span>().<span class="built_in">y</span>() &gt; <span class="number">0</span>)&#123;</span><br><span class="line">                <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;Zoom In&quot;</span>;</span><br><span class="line">                <span class="built_in">zoomIn</span>();</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;Zoom Out&quot;</span>;</span><br><span class="line">                <span class="built_in">zoomOut</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// // 立即恢复滚动条功能</span></span><br><span class="line">            <span class="comment">// vScrollBar-&gt;setEnabled(true);</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>; <span class="comment">// 已处理事件</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="记事本项目总结">记事本项目总结</h3>
<table>
<thead>
<tr>
<th>类别</th>
<th>功能</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>UI设计师基本控件操作</td>
<td>Widget</td>
<td>基础的用户界面单元，用于构建复杂的用户界面。</td>
</tr>
<tr>
<td></td>
<td>QPushButton</td>
<td>用于创建按钮</td>
</tr>
<tr>
<td></td>
<td>QHBoxLayout</td>
<td>水平布局管理器，用于水平排列控件。</td>
</tr>
<tr>
<td></td>
<td>QVBoxLayout</td>
<td>垂直布局管理器，用于垂直排列控件。</td>
</tr>
<tr>
<td></td>
<td>TextEdit</td>
<td>多行文本编辑器控件。</td>
</tr>
<tr>
<td></td>
<td>Stylesheet</td>
<td>使用样式表来定制控件的外观。</td>
</tr>
<tr>
<td>文件操作类</td>
<td>QFile</td>
<td>用于读取和写入文件。</td>
</tr>
<tr>
<td>文件选择对话框类</td>
<td>QFileDialog</td>
<td>提供了一个对话框，允许用户选择文件或目录。</td>
</tr>
<tr>
<td>Qt的信号与槽</td>
<td></td>
<td>用于对象之间的通信机制。</td>
</tr>
<tr>
<td>消息对话框</td>
<td>QMessageBox</td>
<td>用于显示信息、告警、错误等对话框。</td>
</tr>
<tr>
<td>快捷键捕获和处理</td>
<td></td>
<td>用于捕获和处理键盘快捷键。</td>
</tr>
<tr>
<td>Ctrl按键信号捕获和处理</td>
<td></td>
<td>专门处理Ctrl按键的信号。</td>
</tr>
<tr>
<td>鼠标滚轮信号捕获和处理</td>
<td></td>
<td>用于捕获和处理鼠标滚轮动作。</td>
</tr>
<tr>
<td>事件处理</td>
<td>Event</td>
<td>用于处理不同的事件。</td>
</tr>
<tr>
<td>文本字符编码检测</td>
<td></td>
<td>用于检测和处理文本的字符编码。</td>
</tr>
<tr>
<td>字体放大缩小</td>
<td></td>
<td>用于调整字体的大小。</td>
</tr>
<tr>
<td>Qt程序开发流程</td>
<td></td>
<td>涉及从设计到部署的整个开发流程。</td>
</tr>
</tbody>
</table>
<h2 id="串口调试助手">串口调试助手</h2>
<p><strong>项目描述</strong></p>
<ul>
<li>检测并列举系统中的可用串口</li>
<li>配置波特率，校验位，停止位，数据位</li>
<li>启动串口</li>
<li>发送数据</li>
<li>接收数据</li>
<li>需要硬件usb转串口<br>
<img src="/2025/02/24/QT-C/QT-C/image-20250427165844762.png" alt="image-20250427165844762" style="zoom:33%;"></li>
</ul>
<p><strong>UI设计</strong></p>
<p><img src="/2025/02/24/QT-C/QT-C/image-20250427163826195.png" alt="image-20250427163826195" style="zoom: 25%;"><img src="/2025/02/24/QT-C/QT-C/image-20250427163922231.png" alt="image-20250427163922231" style="zoom: 25%;"></p>
<p>自动检测可用串口并添加到串口comBox中</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;mainwindow.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ui_mainwindow.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QSerialPortInfo&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QDebug&gt;</span></span></span><br><span class="line"></span><br><span class="line">MainWindow::<span class="built_in">MainWindow</span>(QWidget *parent)</span><br><span class="line">    : <span class="built_in">QMainWindow</span>(parent)</span><br><span class="line">    , <span class="built_in">ui</span>(<span class="keyword">new</span> Ui::MainWindow)</span><br><span class="line">&#123;</span><br><span class="line">    ui-&gt;<span class="built_in">setupUi</span>(<span class="keyword">this</span>);</span><br><span class="line">    <span class="comment">//窗口内容随窗口大小变化</span></span><br><span class="line">    ui-&gt;centralwidget-&gt;<span class="built_in">setLayout</span>(ui-&gt;windowGridLayout);<span class="comment">//ui-&gt;centralwidget</span></span><br><span class="line">    <span class="comment">//自动检测可用串口，并添加到comboBox中</span></span><br><span class="line">    QList&lt;QSerialPortInfo&gt; serialList = QSerialPortInfo::<span class="built_in">availablePorts</span>();</span><br><span class="line">    <span class="keyword">for</span> (QSerialPortInfo serial : serialList) &#123;</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; serial.<span class="built_in">portName</span>();</span><br><span class="line">        ui-&gt;chuanComboBox-&gt;<span class="built_in">addItem</span>(serial.<span class="built_in">portName</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MainWindow::~<span class="built_in">MainWindow</span>()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">delete</span> ui;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<img src="/2025/02/24/QT-C/QT-C/image-20250427165559231.png" alt="image-20250427165559231" style="zoom:33%;">
<h3 id="初始化构造函数">初始化构造函数</h3>
<p><strong>设置comBox的默认项</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;mainwindow.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ui_mainwindow.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QSerialPortInfo&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QDebug&gt;</span></span></span><br><span class="line"></span><br><span class="line">MainWindow::<span class="built_in">MainWindow</span>(QWidget *parent)</span><br><span class="line">    : <span class="built_in">QMainWindow</span>(parent)</span><br><span class="line">    , <span class="built_in">ui</span>(<span class="keyword">new</span> Ui::MainWindow)</span><br><span class="line">&#123;</span><br><span class="line">    ui-&gt;<span class="built_in">setupUi</span>(<span class="keyword">this</span>);</span><br><span class="line">    <span class="comment">//窗口内容随窗口大小变化</span></span><br><span class="line">    ui-&gt;centralwidget-&gt;<span class="built_in">setLayout</span>(ui-&gt;windowGridLayout);<span class="comment">//ui-&gt;centralwidget</span></span><br><span class="line">    <span class="comment">//自动检测可用串口，并添加到comboBox中</span></span><br><span class="line">    QList&lt;QSerialPortInfo&gt; serialList = QSerialPortInfo::<span class="built_in">availablePorts</span>();</span><br><span class="line">    <span class="keyword">for</span> (QSerialPortInfo serial : serialList) &#123;</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; serial.<span class="built_in">portName</span>();</span><br><span class="line">        ui-&gt;chuanComboBox-&gt;<span class="built_in">addItem</span>(serial.<span class="built_in">portName</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//设置comboBox的默认值</span></span><br><span class="line">    ui-&gt;boTeComboBox-&gt;<span class="built_in">setCurrentIndex</span>(<span class="number">6</span>);</span><br><span class="line">    ui-&gt;dataComboBox-&gt;<span class="built_in">setCurrentIndex</span>(<span class="number">3</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MainWindow::~<span class="built_in">MainWindow</span>()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">delete</span> ui;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<img src="/2025/02/24/QT-C/QT-C/image-20250427170645098.png" alt="image-20250427170645098" style="zoom:33%;">
<h3 id="信号与槽-2">信号与槽</h3>
<h4 id="打开串口时为串口配置波特率、数据位、校验位、停止位、流控参数。"><strong>打开串口</strong>时为串口配置波特率、数据位、校验位、停止位、流控参数。</h4>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//mainwindow.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> MAINWINDOW_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAINWINDOW_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QMainWindow&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QSerialPort&gt;</span></span></span><br><span class="line"></span><br><span class="line">QT_BEGIN_NAMESPACE</span><br><span class="line"><span class="keyword">namespace</span> Ui &#123;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MainWindow</span>;</span><br><span class="line">&#125;</span><br><span class="line">QT_END_NAMESPACE</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MainWindow</span> : <span class="keyword">public</span> QMainWindow</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">MainWindow</span>(QWidget *parent = <span class="literal">nullptr</span>);</span><br><span class="line">    ~<span class="built_in">MainWindow</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> slots:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_closePushButton_clicked</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Ui::MainWindow *ui;</span><br><span class="line">    QSerialPort* serialPort;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// MAINWINDOW_H</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//mainwindow.cpp</span></span><br><span class="line">MainWindow::<span class="built_in">MainWindow</span>(QWidget *parent)</span><br><span class="line">    : <span class="built_in">QMainWindow</span>(parent)</span><br><span class="line">    , <span class="built_in">ui</span>(<span class="keyword">new</span> Ui::MainWindow)</span><br><span class="line">&#123;</span><br><span class="line">    ui-&gt;<span class="built_in">setupUi</span>(<span class="keyword">this</span>);</span><br><span class="line">    <span class="comment">//窗口内容随窗口大小变化</span></span><br><span class="line">    ui-&gt;centralwidget-&gt;<span class="built_in">setLayout</span>(ui-&gt;windowGridLayout);<span class="comment">//ui-&gt;centralwidget</span></span><br><span class="line">    <span class="comment">//自动检测可用串口，并添加到comboBox中</span></span><br><span class="line">    QList&lt;QSerialPortInfo&gt; serialList = QSerialPortInfo::<span class="built_in">availablePorts</span>();</span><br><span class="line">    <span class="keyword">for</span> (QSerialPortInfo serial : serialList) &#123;</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; serial.<span class="built_in">portName</span>();</span><br><span class="line">        ui-&gt;chuanComboBox-&gt;<span class="built_in">addItem</span>(serial.<span class="built_in">portName</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//设置comboBox的默认值</span></span><br><span class="line">    ui-&gt;boTeComboBox-&gt;<span class="built_in">setCurrentIndex</span>(<span class="number">6</span>);</span><br><span class="line">    ui-&gt;dataComboBox-&gt;<span class="built_in">setCurrentIndex</span>(<span class="number">3</span>);</span><br><span class="line">    <span class="comment">//设置串口对象</span></span><br><span class="line">    serialPort = <span class="keyword">new</span> <span class="built_in">QSerialPort</span>(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_closePushButton_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;串口打开关闭槽函数&quot;</span>;</span><br><span class="line">    <span class="comment">//1.选择端口号</span></span><br><span class="line">    serialPort-&gt;<span class="built_in">setPortName</span>(ui-&gt;chuanComboBox-&gt;<span class="built_in">currentText</span>());</span><br><span class="line">    <span class="comment">//2.配置波特率</span></span><br><span class="line">    serialPort-&gt;<span class="built_in">setBaudRate</span>(ui-&gt;boTeComboBox-&gt;<span class="built_in">currentText</span>().<span class="built_in">toInt</span>());</span><br><span class="line">    <span class="comment">//3.配置数据位</span></span><br><span class="line">    serialPort-&gt;<span class="built_in">setDataBits</span>(QSerialPort::<span class="built_in">DataBits</span>(ui-&gt;dataComboBox-&gt;<span class="built_in">currentText</span>().<span class="built_in">toUInt</span>()));</span><br><span class="line">    <span class="comment">//4.配置校验位</span></span><br><span class="line">    <span class="keyword">switch</span> (ui-&gt;validComboBox-&gt;<span class="built_in">currentIndex</span>()) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">            serialPort-&gt;<span class="built_in">setParity</span>(QSerialPort::NoParity);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">            serialPort-&gt;<span class="built_in">setParity</span>(QSerialPort::MarkParity);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            serialPort-&gt;<span class="built_in">setParity</span>(QSerialPort::EvenParity);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">            serialPort-&gt;<span class="built_in">setParity</span>(QSerialPort::OddParity);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">            serialPort-&gt;<span class="built_in">setParity</span>(QSerialPort::SpaceParity);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//5.配置停止位</span></span><br><span class="line">    <span class="comment">// serialPort-&gt;setStopBits(QSerialPort::StopBits(ui-&gt;stopComboBox-&gt;currentText().toUInt()));</span></span><br><span class="line">    <span class="keyword">switch</span> (ui-&gt;stopComboBox-&gt;<span class="built_in">currentIndex</span>()) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">            serialPort-&gt;<span class="built_in">setStopBits</span>(QSerialPort::OneStop);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            serialPort-&gt;<span class="built_in">setStopBits</span>(QSerialPort::OneAndHalfStop);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">            serialPort-&gt;<span class="built_in">setStopBits</span>(QSerialPort::TwoStop);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>: </span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//6.配置流控</span></span><br><span class="line">    <span class="keyword">if</span> (ui-&gt;streamComboBox-&gt;<span class="built_in">currentText</span>() == <span class="string">&quot;No&quot;</span>) &#123;</span><br><span class="line">        serialPort-&gt;<span class="built_in">setFlowControl</span>(QSerialPort::NoFlowControl);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//7.打开串口</span></span><br><span class="line">    <span class="keyword">if</span> (serialPort-&gt;<span class="built_in">open</span>(QIODevice::ReadWrite)) &#123;</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;串口打开成功&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;串口打开失败&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="发送文本信息"><strong>发送文本信息</strong></h4>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">MainWindow::<span class="built_in">MainWindow</span>(QWidget *parent)</span><br><span class="line">    : <span class="built_in">QMainWindow</span>(parent)</span><br><span class="line">    , <span class="built_in">ui</span>(<span class="keyword">new</span> Ui::MainWindow)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//其余部分略</span></span><br><span class="line">    <span class="comment">//设置信号与槽</span></span><br><span class="line">    <span class="built_in">connect</span>(serialPort, &amp;QSerialPort::readyRead, <span class="keyword">this</span>, &amp;MainWindow::onSerialDataReadyToRead);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//.h文件添加声明</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::onSerialDataReadyToRead</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;接收数据槽函数&quot;</span>;</span><br><span class="line">    <span class="comment">//读取数据</span></span><br><span class="line">    QByteArray data = serialPort-&gt;<span class="built_in">readAll</span>();</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;串口对象读取的Byte数据:&quot;</span> &lt;&lt; data;</span><br><span class="line">    QString revMessage = QString::<span class="built_in">fromUtf8</span>(data);</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;串口对象读取的string数据:&quot;</span> &lt;&lt; revMessage;</span><br><span class="line">    <span class="comment">//显示在ui框中</span></span><br><span class="line">    <span class="comment">// ui-&gt;textEdit-&gt;append(revMessage);</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="状态栏"><strong>状态栏</strong></h4>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//mainwindow.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> MAINWINDOW_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAINWINDOW_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QMainWindow&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QSerialPort&gt;</span></span></span><br><span class="line"></span><br><span class="line">QT_BEGIN_NAMESPACE</span><br><span class="line"><span class="keyword">namespace</span> Ui &#123;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MainWindow</span>;</span><br><span class="line">&#125;</span><br><span class="line">QT_END_NAMESPACE</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MainWindow</span> : <span class="keyword">public</span> QMainWindow</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">MainWindow</span>(QWidget *parent = <span class="literal">nullptr</span>);</span><br><span class="line">    ~<span class="built_in">MainWindow</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> slots:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_closePushButton_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_sendPushButton_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">onSerialDataReadyToRead</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Ui::MainWindow *ui;</span><br><span class="line">    QSerialPort* serialPort;</span><br><span class="line">    <span class="type">int</span> writeCount;</span><br><span class="line">    <span class="type">int</span> readCount;</span><br><span class="line">    QString sendHis;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// MAINWINDOW_H</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//mainwidow.cpp</span></span><br><span class="line">MainWindow::<span class="built_in">MainWindow</span>(QWidget *parent)</span><br><span class="line">    : <span class="built_in">QMainWindow</span>(parent)</span><br><span class="line">    , <span class="built_in">ui</span>(<span class="keyword">new</span> Ui::MainWindow)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//略</span></span><br><span class="line">    <span class="keyword">this</span>-&gt;writeCount = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">this</span>-&gt;readCount = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//略</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_sendPushButton_clicked</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> writeCount = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;发送数据槽函数&quot;</span>;</span><br><span class="line">    <span class="comment">//获取发送数据</span></span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;ui框中数据:&quot;</span> &lt;&lt; ui-&gt;sendLineEdit-&gt;<span class="built_in">text</span>();</span><br><span class="line">    QString sendData = ui-&gt;sendLineEdit-&gt;<span class="built_in">text</span>();</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;串口对象写入的数据:&quot;</span> &lt;&lt; sendData.<span class="built_in">toUtf8</span>();</span><br><span class="line">    <span class="comment">//发送数据</span></span><br><span class="line">    writeCount = serialPort-&gt;<span class="built_in">write</span>(sendData.<span class="built_in">toUtf8</span>());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (writeCount == <span class="number">-1</span>)&#123;</span><br><span class="line">        <span class="comment">//状态栏</span></span><br><span class="line">        QFont font = ui-&gt;statusLabel-&gt;<span class="built_in">font</span>();</span><br><span class="line">        font.<span class="built_in">setBold</span>(<span class="literal">true</span>);</span><br><span class="line">        ui-&gt;statusLabel-&gt;<span class="built_in">setFont</span>(font);</span><br><span class="line">        ui-&gt;statusLabel-&gt;<span class="built_in">setText</span>(<span class="string">&quot;Send Failed!&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">//状态栏</span></span><br><span class="line">        <span class="keyword">this</span>-&gt;writeCount += writeCount;</span><br><span class="line">        QFont font = ui-&gt;statusLabel-&gt;<span class="built_in">font</span>();</span><br><span class="line">        font.<span class="built_in">setBold</span>(<span class="literal">true</span>);</span><br><span class="line">        ui-&gt;statusLabel-&gt;<span class="built_in">setFont</span>(font);</span><br><span class="line">        ui-&gt;statusLabel-&gt;<span class="built_in">setText</span>(<span class="string">&quot;Send OK!&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        ui-&gt;sentLabel-&gt;<span class="built_in">setText</span>(<span class="built_in">QString</span>(<span class="string">&quot;Sent: %1&quot;</span>).<span class="built_in">arg</span>(<span class="keyword">this</span>-&gt;writeCount)); <span class="comment">// setNum(this-&gt;writeCount);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//***************************************************** */</span></span><br><span class="line">    <span class="comment">//模拟串口自发自收</span></span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;接收数据槽函数&quot;</span>;</span><br><span class="line">    <span class="comment">//读取数据</span></span><br><span class="line">    <span class="comment">// QByteArray data = ui-&gt;sendLineEdit-&gt;text(); //serialPort-&gt;readAll();</span></span><br><span class="line">    <span class="comment">// qDebug() &lt;&lt; &quot;串口对象读取的Byte数据:&quot; &lt;&lt; data;</span></span><br><span class="line">    <span class="comment">// QString revMessage = QString::fromUtf8(data);</span></span><br><span class="line">    <span class="comment">// qDebug() &lt;&lt; &quot;串口对象读取的string数据:&quot; &lt;&lt; revMessage;</span></span><br><span class="line">    QString revMessage = ui-&gt;sendLineEdit-&gt;<span class="built_in">text</span>();</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;串口对象读取的string数据:&quot;</span> &lt;&lt; revMessage;</span><br><span class="line">    <span class="comment">//显示在ui框中</span></span><br><span class="line">    ui-&gt;textEdit-&gt;<span class="built_in">append</span>(revMessage);</span><br><span class="line">    <span class="comment">//****************************************************** */</span></span><br><span class="line">    <span class="comment">//状态栏</span></span><br><span class="line">    <span class="keyword">if</span> (writeCount != <span class="number">-1</span>)&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;readCount += revMessage.<span class="built_in">toUtf8</span>().<span class="built_in">size</span>();</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;串口对象读取的字节数据:&quot;</span> &lt;&lt; revMessage.<span class="built_in">toUtf8</span>();</span><br><span class="line">        ui-&gt;RevLabel-&gt;<span class="built_in">setText</span>(<span class="built_in">QString</span>(<span class="string">&quot;Received: %1&quot;</span>).<span class="built_in">arg</span>(<span class="keyword">this</span>-&gt;readCount)); <span class="comment">//setNum(this-&gt;readCount);</span></span><br><span class="line">        <span class="comment">//显示在ui框中</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>-&gt;sendHis != revMessage)&#123;</span><br><span class="line">            <span class="keyword">this</span>-&gt;sendHis = revMessage;</span><br><span class="line">            ui-&gt;textEditHis-&gt;<span class="built_in">append</span>(revMessage);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::onSerialDataReadyToRead</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;接收数据槽函数&quot;</span>;</span><br><span class="line">    <span class="comment">//读取数据</span></span><br><span class="line">    QByteArray data = serialPort-&gt;<span class="built_in">readAll</span>();</span><br><span class="line">    <span class="keyword">if</span> (!data.<span class="built_in">isEmpty</span>())&#123;</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;串口对象读取的Byte数据:&quot;</span> &lt;&lt; data;</span><br><span class="line">        QString revMessage = QString::<span class="built_in">fromUtf8</span>(data);</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;串口对象读取的string数据:&quot;</span> &lt;&lt; revMessage;</span><br><span class="line">        <span class="comment">//显示在ui框中</span></span><br><span class="line">        ui-&gt;textEdit-&gt;<span class="built_in">append</span>(revMessage);</span><br><span class="line">        <span class="keyword">this</span>-&gt;readCount += data.<span class="built_in">size</span>();</span><br><span class="line">        ui-&gt;RevLabel-&gt;<span class="built_in">setText</span>(<span class="built_in">QString</span>(<span class="string">&quot;Received: %1&quot;</span>).<span class="built_in">arg</span>(<span class="keyword">this</span>-&gt;readCount)); <span class="comment">//setNum(this-&gt;readCount);</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="串口占用给予提示对话框"><strong>串口占用给予提示对话框</strong></h4>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_closePushButton_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;串口打开关闭槽函数&quot;</span>;</span><br><span class="line">    <span class="comment">//1.选择端口号</span></span><br><span class="line">    serialPort-&gt;<span class="built_in">setPortName</span>(ui-&gt;chuanComboBox-&gt;<span class="built_in">currentText</span>());</span><br><span class="line">    <span class="comment">//2.配置波特率</span></span><br><span class="line">    serialPort-&gt;<span class="built_in">setBaudRate</span>(ui-&gt;boTeComboBox-&gt;<span class="built_in">currentText</span>().<span class="built_in">toInt</span>());</span><br><span class="line">    <span class="comment">//3.配置数据位</span></span><br><span class="line">    serialPort-&gt;<span class="built_in">setDataBits</span>(QSerialPort::<span class="built_in">DataBits</span>(ui-&gt;dataComboBox-&gt;<span class="built_in">currentText</span>().<span class="built_in">toUInt</span>()));</span><br><span class="line">    <span class="comment">//4.配置校验位</span></span><br><span class="line">    <span class="keyword">switch</span> (ui-&gt;validComboBox-&gt;<span class="built_in">currentIndex</span>()) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">            serialPort-&gt;<span class="built_in">setParity</span>(QSerialPort::NoParity);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">            serialPort-&gt;<span class="built_in">setParity</span>(QSerialPort::MarkParity);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            serialPort-&gt;<span class="built_in">setParity</span>(QSerialPort::EvenParity);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">            serialPort-&gt;<span class="built_in">setParity</span>(QSerialPort::OddParity);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">            serialPort-&gt;<span class="built_in">setParity</span>(QSerialPort::SpaceParity);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//5.配置停止位</span></span><br><span class="line">    <span class="comment">// serialPort-&gt;setStopBits(QSerialPort::StopBits(ui-&gt;stopComboBox-&gt;currentText().toUInt()));</span></span><br><span class="line">    <span class="keyword">switch</span> (ui-&gt;stopComboBox-&gt;<span class="built_in">currentIndex</span>()) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">            serialPort-&gt;<span class="built_in">setStopBits</span>(QSerialPort::OneStop);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            serialPort-&gt;<span class="built_in">setStopBits</span>(QSerialPort::OneAndHalfStop);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">            serialPort-&gt;<span class="built_in">setStopBits</span>(QSerialPort::TwoStop);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>: </span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//6.配置流控</span></span><br><span class="line">    <span class="keyword">if</span> (ui-&gt;streamComboBox-&gt;<span class="built_in">currentText</span>() == <span class="string">&quot;No&quot;</span>) &#123;</span><br><span class="line">        serialPort-&gt;<span class="built_in">setFlowControl</span>(QSerialPort::NoFlowControl);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//7.打开串口</span></span><br><span class="line">    <span class="keyword">if</span> (serialPort-&gt;<span class="built_in">open</span>(QIODevice::ReadWrite)) &#123;</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;串口打开成功&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;串口打开失败&quot;</span>;</span><br><span class="line">        QMessageBox msgBox;</span><br><span class="line">        msgBox.<span class="built_in">setWindowTitle</span>(<span class="string">&quot;打开串口错误&quot;</span>);</span><br><span class="line">        msgBox.<span class="built_in">setText</span>(<span class="string">&quot;串口可能被占用&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="串口打开变关闭和串口参数不可修改状态"><strong>串口打开变关闭</strong>和<strong>串口参数不可修改状态</strong></h4>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> MAINWINDOW_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAINWINDOW_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QMainWindow&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QSerialPort&gt;</span></span></span><br><span class="line"></span><br><span class="line">QT_BEGIN_NAMESPACE</span><br><span class="line"><span class="keyword">namespace</span> Ui &#123;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MainWindow</span>;</span><br><span class="line">&#125;</span><br><span class="line">QT_END_NAMESPACE</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MainWindow</span> : <span class="keyword">public</span> QMainWindow</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">MainWindow</span>(QWidget *parent = <span class="literal">nullptr</span>);</span><br><span class="line">    ~<span class="built_in">MainWindow</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> slots:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_closePushButton_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_sendPushButton_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">onSerialDataReadyToRead</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Ui::MainWindow *ui;</span><br><span class="line">    QSerialPort* serialPort;</span><br><span class="line">    <span class="type">int</span> writeCount;</span><br><span class="line">    <span class="type">int</span> readCount;</span><br><span class="line">    QString sendHis;</span><br><span class="line">    <span class="type">bool</span> isSerialPortOpen;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// MAINWINDOW_H</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line">MainWindow::<span class="built_in">MainWindow</span>(QWidget *parent)</span><br><span class="line">    : <span class="built_in">QMainWindow</span>(parent)</span><br><span class="line">    , <span class="built_in">ui</span>(<span class="keyword">new</span> Ui::MainWindow)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//略</span></span><br><span class="line">    isSerialPortOpen = <span class="literal">false</span>;</span><br><span class="line">    <span class="comment">//设置pushbutton不可用</span></span><br><span class="line">    ui-&gt;sendPushButton-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">    <span class="comment">//略</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_closePushButton_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;串口打开关闭槽函数&quot;</span>;</span><br><span class="line">    <span class="comment">//1.选择端口号</span></span><br><span class="line">    serialPort-&gt;<span class="built_in">setPortName</span>(ui-&gt;chuanComboBox-&gt;<span class="built_in">currentText</span>());</span><br><span class="line">    <span class="comment">//2.配置波特率</span></span><br><span class="line">    serialPort-&gt;<span class="built_in">setBaudRate</span>(ui-&gt;boTeComboBox-&gt;<span class="built_in">currentText</span>().<span class="built_in">toInt</span>());</span><br><span class="line">    <span class="comment">//3.配置数据位</span></span><br><span class="line">    serialPort-&gt;<span class="built_in">setDataBits</span>(QSerialPort::<span class="built_in">DataBits</span>(ui-&gt;dataComboBox-&gt;<span class="built_in">currentText</span>().<span class="built_in">toUInt</span>()));</span><br><span class="line">    <span class="comment">//4.配置校验位</span></span><br><span class="line">    <span class="keyword">switch</span> (ui-&gt;validComboBox-&gt;<span class="built_in">currentIndex</span>()) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">            serialPort-&gt;<span class="built_in">setParity</span>(QSerialPort::NoParity);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">            serialPort-&gt;<span class="built_in">setParity</span>(QSerialPort::MarkParity);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            serialPort-&gt;<span class="built_in">setParity</span>(QSerialPort::EvenParity);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">            serialPort-&gt;<span class="built_in">setParity</span>(QSerialPort::OddParity);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">            serialPort-&gt;<span class="built_in">setParity</span>(QSerialPort::SpaceParity);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//5.配置停止位</span></span><br><span class="line">    <span class="comment">// serialPort-&gt;setStopBits(QSerialPort::StopBits(ui-&gt;stopComboBox-&gt;currentText().toUInt()));</span></span><br><span class="line">    <span class="keyword">switch</span> (ui-&gt;stopComboBox-&gt;<span class="built_in">currentIndex</span>()) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">            serialPort-&gt;<span class="built_in">setStopBits</span>(QSerialPort::OneStop);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            serialPort-&gt;<span class="built_in">setStopBits</span>(QSerialPort::OneAndHalfStop);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">            serialPort-&gt;<span class="built_in">setStopBits</span>(QSerialPort::TwoStop);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>: </span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//6.配置流控</span></span><br><span class="line">    <span class="keyword">if</span> (ui-&gt;streamComboBox-&gt;<span class="built_in">currentText</span>() == <span class="string">&quot;No&quot;</span>) &#123;</span><br><span class="line">        serialPort-&gt;<span class="built_in">setFlowControl</span>(QSerialPort::NoFlowControl);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//7.打开串口</span></span><br><span class="line">    <span class="keyword">if</span> (!isSerialPortOpen)&#123;</span><br><span class="line">        <span class="keyword">if</span> (serialPort-&gt;<span class="built_in">open</span>(QIODevice::ReadWrite)) &#123;</span><br><span class="line">            <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;串口打开成功&quot;</span>;</span><br><span class="line">            <span class="comment">//设置combox为无法选择状态</span></span><br><span class="line">            ui-&gt;chuanComboBox-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">            ui-&gt;boTeComboBox-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">            ui-&gt;dataComboBox-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">            ui-&gt;validComboBox-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">            ui-&gt;stopComboBox-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">            ui-&gt;streamComboBox-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">            <span class="comment">//设置pushbutton的文字为关闭</span></span><br><span class="line">            ui-&gt;closePushButton-&gt;<span class="built_in">setText</span>(<span class="string">&quot;关闭串口&quot;</span>);</span><br><span class="line">            <span class="comment">//设置pushbutton可用</span></span><br><span class="line">            ui-&gt;sendPushButton-&gt;<span class="built_in">setEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">            ui-&gt;timeSendCheckBox-&gt;<span class="built_in">setEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">            ui-&gt;sendLineEdit-&gt;<span class="built_in">setEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">            ui-&gt;freqLineEdit-&gt;<span class="built_in">setEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">            ui-&gt;newLineSendCheckBox-&gt;<span class="built_in">setEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">            ui-&gt;HexSendCheckBox-&gt;<span class="built_in">setEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">            ui-&gt;formatInputCheckBox-&gt;<span class="built_in">setEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">            <span class="comment">//设置串口打开状态</span></span><br><span class="line">            isSerialPortOpen = <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;串口打开失败&quot;</span>;</span><br><span class="line">            QMessageBox msgBox;</span><br><span class="line">            msgBox.<span class="built_in">setWindowTitle</span>(<span class="string">&quot;打开串口错误&quot;</span>);</span><br><span class="line">            msgBox.<span class="built_in">setIconPixmap</span>(<span class="built_in">QPixmap</span>(<span class="string">&quot;:icon/res/noun-serial-port-5265721.png&quot;</span>));</span><br><span class="line">            msgBox.<span class="built_in">setText</span>(<span class="string">&quot;串口可能被占用&quot;</span>);</span><br><span class="line">            msgBox.<span class="built_in">exec</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;串口关闭成功&quot;</span>;</span><br><span class="line">        serialPort-&gt;<span class="built_in">close</span>();   </span><br><span class="line">        <span class="comment">//设置combox为可以选择状态</span></span><br><span class="line">        ui-&gt;chuanComboBox-&gt;<span class="built_in">setEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">        ui-&gt;boTeComboBox-&gt;<span class="built_in">setEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">        ui-&gt;dataComboBox-&gt;<span class="built_in">setEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">        ui-&gt;validComboBox-&gt;<span class="built_in">setEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">        ui-&gt;stopComboBox-&gt;<span class="built_in">setEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">        ui-&gt;streamComboBox-&gt;<span class="built_in">setEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">//设置pushbutton的文字为打开</span></span><br><span class="line">        ui-&gt;closePushButton-&gt;<span class="built_in">setText</span>(<span class="string">&quot;打开串口&quot;</span>);</span><br><span class="line">        <span class="comment">//设置串口关闭状态</span></span><br><span class="line">        isSerialPortOpen = <span class="literal">false</span>;</span><br><span class="line">        <span class="comment">//设置pushbutton不可用</span></span><br><span class="line">        ui-&gt;sendPushButton-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">        ui-&gt;timeSendCheckBox-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">        ui-&gt;sendLineEdit-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">        ui-&gt;freqLineEdit-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">        ui-&gt;newLineSendCheckBox-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">        ui-&gt;HexSendCheckBox-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">        ui-&gt;formatInputCheckBox-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>串口打开和关闭状态识别两种方式：1、代码，设置标识符如上<code>isSerialPortOpen</code>，2、QDesigner设计窗口‘串口打开’组件的QAbstractButton的checkable点选<img src="/2025/02/24/QT-C/QT-C/image-20250428174630144.png" alt="image-20250428174630144">，信号与槽重使用带<code>bool</code>参数的<code>on_closePushButton_clicked(bool checked)</code>, 用<code>checked</code>替换<code>isSerialPortOpen</code>, 注：不用设置<code>checked</code>的状态</p>
<h4 id="定时发送-定时器"><strong>定时发送/定时器</strong></h4>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//mainwindow.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> MAINWINDOW_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAINWINDOW_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QMainWindow&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QSerialPort&gt;</span></span></span><br><span class="line"></span><br><span class="line">QT_BEGIN_NAMESPACE</span><br><span class="line"><span class="keyword">namespace</span> Ui &#123;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MainWindow</span>;</span><br><span class="line">&#125;</span><br><span class="line">QT_END_NAMESPACE</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MainWindow</span> : <span class="keyword">public</span> QMainWindow</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">MainWindow</span>(QWidget *parent = <span class="literal">nullptr</span>);</span><br><span class="line">    ~<span class="built_in">MainWindow</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> slots:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_closePushButton_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_sendPushButton_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">onSerialDataReadyToRead</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_timeSendCheckBox_clicked</span><span class="params">(<span class="type">bool</span> checked)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Ui::MainWindow *ui;</span><br><span class="line">    QSerialPort* serialPort;</span><br><span class="line">    <span class="type">int</span> writeCount;</span><br><span class="line">    <span class="type">int</span> readCount;</span><br><span class="line">    QString sendHis;</span><br><span class="line">    <span class="type">bool</span> isSerialPortOpen;</span><br><span class="line">    QTimer* timer;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// MAINWINDOW_H</span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//mainwindow.cpp</span></span><br><span class="line"></span><br><span class="line">MainWindow::<span class="built_in">MainWindow</span>(QWidget *parent)</span><br><span class="line">    : <span class="built_in">QMainWindow</span>(parent)</span><br><span class="line">    , <span class="built_in">ui</span>(<span class="keyword">new</span> Ui::MainWindow)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//略</span></span><br><span class="line">    <span class="comment">//给窗体对象安装定时器</span></span><br><span class="line">    timer = <span class="keyword">new</span> <span class="built_in">QTimer</span>(<span class="keyword">this</span>);</span><br><span class="line">    <span class="comment">//设置信号与槽</span></span><br><span class="line">    <span class="built_in">connect</span>(timer, &amp;QTimer::timeout, <span class="keyword">this</span>, &amp;MainWindow::on_sendPushButton_clicked);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_closePushButton_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;串口打开关闭槽函数&quot;</span>;</span><br><span class="line">    <span class="comment">//1.选择端口号</span></span><br><span class="line">    serialPort-&gt;<span class="built_in">setPortName</span>(ui-&gt;chuanComboBox-&gt;<span class="built_in">currentText</span>());</span><br><span class="line">    <span class="comment">//2.配置波特率</span></span><br><span class="line">    serialPort-&gt;<span class="built_in">setBaudRate</span>(ui-&gt;boTeComboBox-&gt;<span class="built_in">currentText</span>().<span class="built_in">toInt</span>());</span><br><span class="line">    <span class="comment">//3.配置数据位</span></span><br><span class="line">    serialPort-&gt;<span class="built_in">setDataBits</span>(QSerialPort::<span class="built_in">DataBits</span>(ui-&gt;dataComboBox-&gt;<span class="built_in">currentText</span>().<span class="built_in">toUInt</span>()));</span><br><span class="line">    <span class="comment">//4.配置校验位</span></span><br><span class="line">    <span class="keyword">switch</span> (ui-&gt;validComboBox-&gt;<span class="built_in">currentIndex</span>()) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">            serialPort-&gt;<span class="built_in">setParity</span>(QSerialPort::NoParity);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">            serialPort-&gt;<span class="built_in">setParity</span>(QSerialPort::MarkParity);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            serialPort-&gt;<span class="built_in">setParity</span>(QSerialPort::EvenParity);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">            serialPort-&gt;<span class="built_in">setParity</span>(QSerialPort::OddParity);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">            serialPort-&gt;<span class="built_in">setParity</span>(QSerialPort::SpaceParity);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//5.配置停止位</span></span><br><span class="line">    <span class="comment">// serialPort-&gt;setStopBits(QSerialPort::StopBits(ui-&gt;stopComboBox-&gt;currentText().toUInt()));</span></span><br><span class="line">    <span class="keyword">switch</span> (ui-&gt;stopComboBox-&gt;<span class="built_in">currentIndex</span>()) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">            serialPort-&gt;<span class="built_in">setStopBits</span>(QSerialPort::OneStop);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            serialPort-&gt;<span class="built_in">setStopBits</span>(QSerialPort::OneAndHalfStop);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">            serialPort-&gt;<span class="built_in">setStopBits</span>(QSerialPort::TwoStop);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>: </span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//6.配置流控</span></span><br><span class="line">    <span class="keyword">if</span> (ui-&gt;streamComboBox-&gt;<span class="built_in">currentText</span>() == <span class="string">&quot;No&quot;</span>) &#123;</span><br><span class="line">        serialPort-&gt;<span class="built_in">setFlowControl</span>(QSerialPort::NoFlowControl);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//7.打开串口</span></span><br><span class="line">    <span class="keyword">if</span> (!isSerialPortOpen)&#123;</span><br><span class="line">        <span class="keyword">if</span> (serialPort-&gt;<span class="built_in">open</span>(QIODevice::ReadWrite)) &#123;</span><br><span class="line">            <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;串口打开成功&quot;</span>;</span><br><span class="line">            <span class="comment">//设置combox为无法选择状态</span></span><br><span class="line">            ui-&gt;chuanComboBox-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">            ui-&gt;boTeComboBox-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">            ui-&gt;dataComboBox-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">            ui-&gt;validComboBox-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">            ui-&gt;stopComboBox-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">            ui-&gt;streamComboBox-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">            <span class="comment">//设置pushbutton的文字为关闭</span></span><br><span class="line">            ui-&gt;closePushButton-&gt;<span class="built_in">setText</span>(<span class="string">&quot;关闭串口&quot;</span>);</span><br><span class="line">            <span class="comment">//设置pushbutton可用</span></span><br><span class="line">            ui-&gt;sendPushButton-&gt;<span class="built_in">setEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">            ui-&gt;timeSendCheckBox-&gt;<span class="built_in">setEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">            ui-&gt;sendLineEdit-&gt;<span class="built_in">setEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">            ui-&gt;freqLineEdit-&gt;<span class="built_in">setEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">            ui-&gt;newLineSendCheckBox-&gt;<span class="built_in">setEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">            ui-&gt;HexSendCheckBox-&gt;<span class="built_in">setEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">            ui-&gt;formatInputCheckBox-&gt;<span class="built_in">setEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">            <span class="comment">//设置串口打开状态</span></span><br><span class="line">            isSerialPortOpen = <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;串口打开失败&quot;</span>;</span><br><span class="line">            QMessageBox msgBox;</span><br><span class="line">            msgBox.<span class="built_in">setWindowTitle</span>(<span class="string">&quot;打开串口错误&quot;</span>);</span><br><span class="line">            msgBox.<span class="built_in">setIconPixmap</span>(<span class="built_in">QPixmap</span>(<span class="string">&quot;:icon/res/noun-serial-port-5265721.png&quot;</span>));</span><br><span class="line">            msgBox.<span class="built_in">setText</span>(<span class="string">&quot;串口可能被占用&quot;</span>);</span><br><span class="line">            msgBox.<span class="built_in">exec</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;串口关闭成功&quot;</span>;</span><br><span class="line">        serialPort-&gt;<span class="built_in">close</span>();</span><br><span class="line">        <span class="comment">//设置combox为可以选择状态</span></span><br><span class="line">        ui-&gt;chuanComboBox-&gt;<span class="built_in">setEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">        ui-&gt;boTeComboBox-&gt;<span class="built_in">setEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">        ui-&gt;dataComboBox-&gt;<span class="built_in">setEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">        ui-&gt;validComboBox-&gt;<span class="built_in">setEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">        ui-&gt;stopComboBox-&gt;<span class="built_in">setEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">        ui-&gt;streamComboBox-&gt;<span class="built_in">setEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">//设置pushbutton的文字为打开</span></span><br><span class="line">        ui-&gt;closePushButton-&gt;<span class="built_in">setText</span>(<span class="string">&quot;打开串口&quot;</span>);</span><br><span class="line">        <span class="comment">//设置串口关闭状态</span></span><br><span class="line">        isSerialPortOpen = <span class="literal">false</span>;</span><br><span class="line">        <span class="comment">//设置pushbutton不可用</span></span><br><span class="line">        ui-&gt;sendPushButton-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">        ui-&gt;timeSendCheckBox-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">        ui-&gt;sendLineEdit-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">        ui-&gt;freqLineEdit-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">        ui-&gt;newLineSendCheckBox-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">        ui-&gt;HexSendCheckBox-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">        ui-&gt;formatInputCheckBox-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">        <span class="comment">//定时勾选取消</span></span><br><span class="line">        ui-&gt;timeSendCheckBox-&gt;<span class="built_in">setCheckState</span>(Qt::Unchecked);</span><br><span class="line">        <span class="comment">//定时器关闭</span></span><br><span class="line">        timer-&gt;<span class="built_in">stop</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_timeSendCheckBox_clicked</span><span class="params">(<span class="type">bool</span> checked)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;定时发送数据槽函数, 是否勾选：&quot;</span> &lt;&lt; checked;</span><br><span class="line">    <span class="keyword">if</span> (checked) &#123;</span><br><span class="line">        <span class="built_in">on_sendPushButton_clicked</span>();</span><br><span class="line">        <span class="type">int</span> sendDuration = ui-&gt;freqLineEdit-&gt;<span class="built_in">text</span>().<span class="built_in">toInt</span>();</span><br><span class="line">        timer-&gt;<span class="built_in">start</span>(sendDuration);</span><br><span class="line">        ui-&gt;freqLineEdit-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">        ui-&gt;sendPushButton-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">        ui-&gt;sendLineEdit-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        timer-&gt;<span class="built_in">stop</span>();</span><br><span class="line">        ui-&gt;freqLineEdit-&gt;<span class="built_in">setEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">        ui-&gt;sendPushButton-&gt;<span class="built_in">setEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">        ui-&gt;sendLineEdit-&gt;<span class="built_in">setEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="清空-保存接收按键"><strong>清空/保存接收</strong>按键</h4>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_clearPushButton_clicked</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;清空数据槽函数&quot;</span>;</span><br><span class="line">    <span class="comment">//清空发送和接收数据</span></span><br><span class="line">    ui-&gt;textEdit-&gt;<span class="built_in">clear</span>();</span><br><span class="line">    <span class="comment">//状态栏</span></span><br><span class="line">    <span class="keyword">this</span>-&gt;writeCount = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">this</span>-&gt;readCount = <span class="number">0</span>;</span><br><span class="line">    ui-&gt;sentLabel-&gt;<span class="built_in">setText</span>(<span class="string">&quot;Sent: 0&quot;</span>);</span><br><span class="line">    ui-&gt;RevLabel-&gt;<span class="built_in">setText</span>(<span class="string">&quot;Received: 0&quot;</span>);</span><br><span class="line">    QFont font = ui-&gt;statusLabel-&gt;<span class="built_in">font</span>();</span><br><span class="line">    font.<span class="built_in">setBold</span>(<span class="literal">true</span>);</span><br><span class="line">    ui-&gt;statusLabel-&gt;<span class="built_in">setFont</span>(font);</span><br><span class="line">    ui-&gt;statusLabel-&gt;<span class="built_in">setText</span>(<span class="string">&quot;clear&quot;</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_saveRevPushButton_clicked</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;保存接收数据槽函数&quot;</span>;</span><br><span class="line">    <span class="comment">//获取接收数据</span></span><br><span class="line">    QString revMessage = ui-&gt;textEdit-&gt;<span class="built_in">toPlainText</span>();</span><br><span class="line">    <span class="comment">//保存到文件</span></span><br><span class="line">    QString fileName = QFileDialog::<span class="built_in">getSaveFileName</span>(<span class="keyword">this</span>, <span class="built_in">tr</span>(<span class="string">&quot;Save File&quot;</span>), <span class="string">&quot;./&quot;</span>, <span class="built_in">tr</span>(<span class="string">&quot;Text Files (*.txt);;All Files (*)&quot;</span>));</span><br><span class="line">    <span class="keyword">if</span> (fileName.<span class="built_in">isEmpty</span>()) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">QFile <span class="title">file</span><span class="params">(fileName)</span></span>;</span><br><span class="line">    <span class="keyword">if</span> (!file.<span class="built_in">open</span>(QIODevice::WriteOnly | QIODevice::Text)) &#123;</span><br><span class="line">        QMessageBox::<span class="built_in">warning</span>(<span class="keyword">this</span>, <span class="built_in">tr</span>(<span class="string">&quot;Error&quot;</span>), <span class="built_in">tr</span>(<span class="string">&quot;Cannot open file for writing: %1&quot;</span>).<span class="built_in">arg</span>(file.<span class="built_in">errorString</span>()));</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">QTextStream <span class="title">out</span><span class="params">(&amp;file)</span></span>;</span><br><span class="line">    out &lt;&lt; revMessage;</span><br><span class="line">    file.<span class="built_in">close</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="接收时间-状态栏时间"><strong>接收时间/状态栏时间</strong></h4>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//mainwindow.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> MAINWINDOW_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAINWINDOW_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QMainWindow&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QSerialPort&gt;</span></span></span><br><span class="line"></span><br><span class="line">QT_BEGIN_NAMESPACE</span><br><span class="line"><span class="keyword">namespace</span> Ui &#123;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MainWindow</span>;</span><br><span class="line">&#125;</span><br><span class="line">QT_END_NAMESPACE</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MainWindow</span> : <span class="keyword">public</span> QMainWindow</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">MainWindow</span>(QWidget *parent = <span class="literal">nullptr</span>);</span><br><span class="line">    ~<span class="built_in">MainWindow</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> slots:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_closePushButton_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_sendPushButton_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">onSerialDataReadyToRead</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_timeSendCheckBox_clicked</span><span class="params">(<span class="type">bool</span> checked)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_clearPushButton_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_saveRevPushButton_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">refreshStatusTime</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_revTimeCheckBox_clicked</span><span class="params">(<span class="type">bool</span> checked)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Ui::MainWindow *ui;</span><br><span class="line">    QSerialPort* serialPort;</span><br><span class="line">    <span class="type">int</span> writeCount;</span><br><span class="line">    <span class="type">int</span> readCount;</span><br><span class="line">    QString sendHis;</span><br><span class="line">    <span class="type">bool</span> isSerialPortOpen;</span><br><span class="line">    QTimer* timer;</span><br><span class="line">    QString myTime;</span><br><span class="line">    <span class="type">bool</span> isTimeBoxChecked;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">getSystemTime</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// MAINWINDOW_H</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//mainwindow.cpp</span></span><br><span class="line">MainWindow::<span class="built_in">MainWindow</span>(QWidget *parent)</span><br><span class="line">    : <span class="built_in">QMainWindow</span>(parent)</span><br><span class="line">    , <span class="built_in">ui</span>(<span class="keyword">new</span> Ui::MainWindow)</span><br><span class="line">&#123;</span><br><span class="line">    ui-&gt;<span class="built_in">setupUi</span>(<span class="keyword">this</span>);</span><br><span class="line">    <span class="comment">//窗口内容随窗口大小变化</span></span><br><span class="line">    ui-&gt;centralwidget-&gt;<span class="built_in">setLayout</span>(ui-&gt;windowGridLayout);<span class="comment">//ui-&gt;centralwidget</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//设置时间状态栏定时器</span></span><br><span class="line">    QTimer* statusTimer = <span class="keyword">new</span> <span class="built_in">QTimer</span>(<span class="keyword">this</span>);</span><br><span class="line">    statusTimer-&gt;<span class="built_in">start</span>(<span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置初始化成员变量</span></span><br><span class="line">    isTimeBoxChecked = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置信号与槽</span></span><br><span class="line">    <span class="built_in">connect</span>(statusTimer, &amp;QTimer::timeout, <span class="keyword">this</span>, &amp;MainWindow::refreshStatusTime);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_sendPushButton_clicked</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> writeCount = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;发送数据槽函数&quot;</span>;</span><br><span class="line">    <span class="comment">//获取发送数据</span></span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;ui框中数据:&quot;</span> &lt;&lt; ui-&gt;sendLineEdit-&gt;<span class="built_in">text</span>();</span><br><span class="line">    QString sendData = ui-&gt;sendLineEdit-&gt;<span class="built_in">text</span>();</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;串口对象写入的数据:&quot;</span> &lt;&lt; sendData.<span class="built_in">toUtf8</span>();</span><br><span class="line">    <span class="comment">//发送数据</span></span><br><span class="line">    writeCount = serialPort-&gt;<span class="built_in">write</span>(sendData.<span class="built_in">toUtf8</span>());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (writeCount == <span class="number">-1</span>)&#123;</span><br><span class="line">        <span class="comment">//状态栏</span></span><br><span class="line">        QFont font = ui-&gt;statusLabel-&gt;<span class="built_in">font</span>();</span><br><span class="line">        font.<span class="built_in">setBold</span>(<span class="literal">true</span>);</span><br><span class="line">        ui-&gt;statusLabel-&gt;<span class="built_in">setFont</span>(font);</span><br><span class="line">        ui-&gt;statusLabel-&gt;<span class="built_in">setText</span>(<span class="string">&quot;Send Failed!&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">//状态栏</span></span><br><span class="line">        <span class="keyword">this</span>-&gt;writeCount += writeCount;</span><br><span class="line">        QFont font = ui-&gt;statusLabel-&gt;<span class="built_in">font</span>();</span><br><span class="line">        font.<span class="built_in">setBold</span>(<span class="literal">true</span>);</span><br><span class="line">        ui-&gt;statusLabel-&gt;<span class="built_in">setFont</span>(font);</span><br><span class="line">        ui-&gt;statusLabel-&gt;<span class="built_in">setText</span>(<span class="string">&quot;Send OK!&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        ui-&gt;sentLabel-&gt;<span class="built_in">setText</span>(<span class="built_in">QString</span>(<span class="string">&quot;Sent: %1&quot;</span>).<span class="built_in">arg</span>(<span class="keyword">this</span>-&gt;writeCount)); <span class="comment">// setNum(this-&gt;writeCount);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//***************************************************** */</span></span><br><span class="line">    <span class="comment">//模拟串口自发自收</span></span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;接收数据槽函数&quot;</span>;</span><br><span class="line">    <span class="comment">//读取数据</span></span><br><span class="line">    <span class="comment">// QByteArray data = ui-&gt;sendLineEdit-&gt;text(); //serialPort-&gt;readAll();</span></span><br><span class="line">    <span class="comment">// qDebug() &lt;&lt; &quot;串口对象读取的Byte数据:&quot; &lt;&lt; data;</span></span><br><span class="line">    <span class="comment">// QString revMessage = QString::fromUtf8(data);</span></span><br><span class="line">    <span class="comment">// qDebug() &lt;&lt; &quot;串口对象读取的string数据:&quot; &lt;&lt; revMessage;</span></span><br><span class="line">    QString revMessage = ui-&gt;sendLineEdit-&gt;<span class="built_in">text</span>();</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;串口对象读取的string数据:&quot;</span> &lt;&lt; revMessage;</span><br><span class="line">    <span class="comment">//显示在ui框中</span></span><br><span class="line">    <span class="keyword">if</span> (isTimeBoxChecked)&#123;</span><br><span class="line">        <span class="comment">//添加时间戳</span></span><br><span class="line">        <span class="built_in">getSystemTime</span>();</span><br><span class="line">        QString revTimeFormatMessage = <span class="string">&quot;【&quot;</span> + myTime + <span class="string">&quot;】 &quot;</span> + revMessage;</span><br><span class="line">        ui-&gt;textEdit-&gt;<span class="built_in">append</span>(revTimeFormatMessage);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        ui-&gt;textEdit-&gt;<span class="built_in">append</span>(revMessage);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//****************************************************** */</span></span><br><span class="line">    <span class="comment">//状态栏</span></span><br><span class="line">    <span class="keyword">if</span> (writeCount != <span class="number">-1</span>)&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;readCount += revMessage.<span class="built_in">toUtf8</span>().<span class="built_in">size</span>();</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;串口对象读取的字节数据:&quot;</span> &lt;&lt; revMessage.<span class="built_in">toUtf8</span>();</span><br><span class="line">        ui-&gt;RevLabel-&gt;<span class="built_in">setText</span>(<span class="built_in">QString</span>(<span class="string">&quot;Received: %1&quot;</span>).<span class="built_in">arg</span>(<span class="keyword">this</span>-&gt;readCount)); <span class="comment">//setNum(this-&gt;readCount);</span></span><br><span class="line">        <span class="comment">//显示在ui框中</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>-&gt;sendHis != revMessage)&#123;</span><br><span class="line">            <span class="keyword">this</span>-&gt;sendHis = revMessage;</span><br><span class="line">            ui-&gt;textEditHis-&gt;<span class="built_in">append</span>(revMessage);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::refreshStatusTime</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">getSystemTime</span>();</span><br><span class="line">    <span class="comment">//更新状态栏时间</span></span><br><span class="line">    ui-&gt;DateLabel-&gt;<span class="built_in">setText</span>(myTime);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_revTimeCheckBox_clicked</span><span class="params">(<span class="type">bool</span> checked)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;接收时间戳槽函数, 是否勾选：&quot;</span> &lt;&lt; ui-&gt;revTimeCheckBox-&gt;<span class="built_in">isChecked</span>();</span><br><span class="line">    <span class="keyword">if</span> (ui-&gt;revTimeCheckBox-&gt;<span class="built_in">isChecked</span>()) &#123;</span><br><span class="line">        isTimeBoxChecked = <span class="literal">true</span>;   </span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        isTimeBoxChecked = <span class="literal">false</span>;   </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::getSystemTime</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    QDateTime currentTime = QDateTime::<span class="built_in">currentDateTime</span>();</span><br><span class="line">    myTime = currentTime.<span class="built_in">toString</span>(<span class="string">&quot;yyyy-MM-dd hh:mm:ss&quot;</span>);</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;当前系统时间:&quot;</span> &lt;&lt; myTime;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Hex转换"><strong>Hex转换</strong></h4>
<p><img src="/2025/02/24/QT-C/QT-C/image-20250508112500976.png" alt="image-20250508112500976"></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//mainwindow.cpp</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_hexShowCheckBox_clicked</span><span class="params">(<span class="type">bool</span> checked)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (checked)&#123;</span><br><span class="line">        <span class="comment">//1.读取textEdit中的数据</span></span><br><span class="line">        QString tmp = ui-&gt;textEdit-&gt;<span class="built_in">toPlainText</span>();</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;读取的文本数据String类型:&quot;</span> &lt;&lt; tmp;</span><br><span class="line">        <span class="comment">//QString转QByteArray</span></span><br><span class="line">        QByteArray tmpByteArray = tmp.<span class="built_in">toUtf8</span>();</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;转换前的文本数据Byte类型:&quot;</span> &lt;&lt; tmpByteArray;</span><br><span class="line">        <span class="comment">//2.转换成16进制</span></span><br><span class="line">        <span class="comment">//字符QByteArray转成16进制QByteArray</span></span><br><span class="line">        QByteArray tmpHex = tmpByteArray.<span class="built_in">toHex</span>();</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;转换后的Hex数据Byte类型:&quot;</span> &lt;&lt; tmpHex;</span><br><span class="line">        <span class="comment">//3.显示在textEdit中</span></span><br><span class="line">        <span class="comment">//16进制QByteArray转成QString</span></span><br><span class="line">        QString tmpHexString1= QString::<span class="built_in">fromUtf8</span>(tmpHex).<span class="built_in">toUpper</span>();</span><br><span class="line">        QString tmpHexString;</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;转换后的Hex数据String类型:&quot;</span> &lt;&lt; tmpHexString;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;tmpHexString1.<span class="built_in">size</span>(); i+=<span class="number">2</span>)&#123;</span><br><span class="line">            tmpHexString += tmpHexString1.<span class="built_in">mid</span>(i, <span class="number">2</span>) + <span class="string">&quot; &quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ui-&gt;textEdit-&gt;<span class="built_in">setText</span>(tmpHexString);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">//1.读取textEdit中的数据</span></span><br><span class="line">        QString tmpHexString = ui-&gt;textEdit-&gt;<span class="built_in">toPlainText</span>();</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;读取的Hex数据String类型:&quot;</span> &lt;&lt; tmpHexString;</span><br><span class="line">        <span class="comment">//QString转QByteArray</span></span><br><span class="line">        QByteArray tmpHexByteArray = tmpHexString.<span class="built_in">toUtf8</span>();</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;转换前的Hex数据Byte类型:&quot;</span> &lt;&lt; tmpHexByteArray;</span><br><span class="line">        <span class="comment">//2.转换成16进制</span></span><br><span class="line">        <span class="comment">//字符QByteArray转成16进制QByteArray</span></span><br><span class="line">        QByteArray tmpByteArray = QByteArray::<span class="built_in">fromHex</span>(tmpHexByteArray);</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;转换后的字符数据Byte类型:&quot;</span> &lt;&lt; tmpByteArray;</span><br><span class="line">        <span class="comment">//3.显示在textEdit中</span></span><br><span class="line">        <span class="comment">//16进制QByteArray转成QString</span></span><br><span class="line">        QString tmpString = QString::<span class="built_in">fromUtf8</span>(tmpByteArray);</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;转换后的字符数据String类型:&quot;</span> &lt;&lt; tmpString;</span><br><span class="line">        ui-&gt;textEdit-&gt;<span class="built_in">setText</span>(tmpString);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>问题</strong></p>
<p>在Hex勾选时，老数据已转为Hex但是新数据还是字符。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_sendPushButton_clicked</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> writeCount = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;发送数据槽函数&quot;</span>;</span><br><span class="line">    <span class="comment">//获取发送数据</span></span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;ui框中数据:&quot;</span> &lt;&lt; ui-&gt;sendLineEdit-&gt;<span class="built_in">text</span>();</span><br><span class="line">    QString sendData = ui-&gt;sendLineEdit-&gt;<span class="built_in">text</span>();</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;串口对象写入的数据:&quot;</span> &lt;&lt; sendData.<span class="built_in">toUtf8</span>();</span><br><span class="line">    <span class="comment">//发送数据</span></span><br><span class="line">    writeCount = serialPort-&gt;<span class="built_in">write</span>(sendData.<span class="built_in">toUtf8</span>());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (writeCount == <span class="number">-1</span>)&#123;</span><br><span class="line">        <span class="comment">//状态栏</span></span><br><span class="line">        QFont font = ui-&gt;statusLabel-&gt;<span class="built_in">font</span>();</span><br><span class="line">        font.<span class="built_in">setBold</span>(<span class="literal">true</span>);</span><br><span class="line">        ui-&gt;statusLabel-&gt;<span class="built_in">setFont</span>(font);</span><br><span class="line">        ui-&gt;statusLabel-&gt;<span class="built_in">setText</span>(<span class="string">&quot;Send Failed!&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">//状态栏</span></span><br><span class="line">        <span class="keyword">this</span>-&gt;writeCount += writeCount;</span><br><span class="line">        QFont font = ui-&gt;statusLabel-&gt;<span class="built_in">font</span>();</span><br><span class="line">        font.<span class="built_in">setBold</span>(<span class="literal">true</span>);</span><br><span class="line">        ui-&gt;statusLabel-&gt;<span class="built_in">setFont</span>(font);</span><br><span class="line">        ui-&gt;statusLabel-&gt;<span class="built_in">setText</span>(<span class="string">&quot;Send OK!&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        ui-&gt;sentLabel-&gt;<span class="built_in">setText</span>(<span class="built_in">QString</span>(<span class="string">&quot;Sent: %1&quot;</span>).<span class="built_in">arg</span>(<span class="keyword">this</span>-&gt;writeCount)); <span class="comment">// setNum(this-&gt;writeCount);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//***************************************************** */</span></span><br><span class="line">    <span class="comment">//模拟串口自发自收</span></span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;接收数据槽函数&quot;</span>;</span><br><span class="line">    <span class="comment">//读取数据</span></span><br><span class="line">    <span class="comment">// QByteArray data = ui-&gt;sendLineEdit-&gt;text(); //serialPort-&gt;readAll();</span></span><br><span class="line">    <span class="comment">// qDebug() &lt;&lt; &quot;串口对象读取的Byte数据:&quot; &lt;&lt; data;</span></span><br><span class="line">    <span class="comment">// QString revMessage = QString::fromUtf8(data);</span></span><br><span class="line">    <span class="comment">// qDebug() &lt;&lt; &quot;串口对象读取的string数据:&quot; &lt;&lt; revMessage;</span></span><br><span class="line">    QString revMessage = ui-&gt;sendLineEdit-&gt;<span class="built_in">text</span>();</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;串口对象读取的string数据:&quot;</span> &lt;&lt; revMessage;</span><br><span class="line">    <span class="comment">//在HexBox选中状态下输入字符格式转成Hex格式</span></span><br><span class="line">    <span class="keyword">if</span> (ui-&gt;hexShowCheckBox-&gt;<span class="built_in">checkState</span>() == Qt::Checked)&#123;            <span class="comment">//&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span></span><br><span class="line">        <span class="comment">//添加换行符</span></span><br><span class="line">        revMessage = <span class="string">&quot;\n&quot;</span> + revMessage;</span><br><span class="line">        <span class="comment">//字符QString转QByteArray</span></span><br><span class="line">        QByteArray tmpByteArray = revMessage.<span class="built_in">toUtf8</span>();</span><br><span class="line">        <span class="comment">//字符QByteArray转成16进制QByteArray</span></span><br><span class="line">        QByteArray tmpHex = tmpByteArray.<span class="built_in">toHex</span>();</span><br><span class="line">        <span class="comment">//16进制QByteArray转成QString</span></span><br><span class="line">        revMessage = QString::<span class="built_in">fromUtf8</span>(tmpHex);</span><br><span class="line">    &#125;                                                                 <span class="comment">//&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span></span><br><span class="line">    <span class="comment">//显示在ui框中</span></span><br><span class="line">    <span class="keyword">if</span> (isTimeBoxChecked)&#123;</span><br><span class="line">        <span class="comment">//添加时间戳</span></span><br><span class="line">        <span class="built_in">getSystemTime</span>();</span><br><span class="line">        QString revTimeFormatMessage = <span class="string">&quot;【&quot;</span> + myTime + <span class="string">&quot;】 &quot;</span> + revMessage;</span><br><span class="line">        ui-&gt;textEdit-&gt;<span class="built_in">append</span>(revTimeFormatMessage);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        ui-&gt;textEdit-&gt;<span class="built_in">append</span>(revMessage);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//****************************************************** */</span></span><br><span class="line">    <span class="comment">//状态栏</span></span><br><span class="line">    <span class="keyword">if</span> (writeCount != <span class="number">-1</span>)&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;readCount += revMessage.<span class="built_in">toUtf8</span>().<span class="built_in">size</span>();</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;串口对象读取的字节数据:&quot;</span> &lt;&lt; revMessage.<span class="built_in">toUtf8</span>();</span><br><span class="line">        ui-&gt;RevLabel-&gt;<span class="built_in">setText</span>(<span class="built_in">QString</span>(<span class="string">&quot;Received: %1&quot;</span>).<span class="built_in">arg</span>(<span class="keyword">this</span>-&gt;readCount)); <span class="comment">//setNum(this-&gt;readCount);</span></span><br><span class="line">        <span class="comment">//显示在ui框中</span></span><br><span class="line">        <span class="comment">//在HexBox选中状态下使用输入的字符作为revMessage,而非Hex作为revMessage</span></span><br><span class="line">        <span class="keyword">if</span> (ui-&gt;hexShowCheckBox-&gt;<span class="built_in">checkState</span>() == Qt::Checked)&#123;        <span class="comment">//&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span></span><br><span class="line">            revMessage = ui-&gt;sendLineEdit-&gt;<span class="built_in">text</span>();</span><br><span class="line">        &#125;                                                             <span class="comment">//&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>-&gt;sendHis != revMessage)&#123;</span><br><span class="line">            <span class="keyword">this</span>-&gt;sendHis = revMessage;</span><br><span class="line">            ui-&gt;textEditHis-&gt;<span class="built_in">append</span>(revMessage);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Hex发送按钮"><strong>Hex发送按钮</strong></h4>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//mainwindow.cpp</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_sendPushButton_clicked</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> writeCount = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;发送数据槽函数&quot;</span>;</span><br><span class="line">    <span class="comment">//获取发送数据</span></span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;ui框中数据:&quot;</span> &lt;&lt; ui-&gt;sendLineEdit-&gt;<span class="built_in">text</span>();</span><br><span class="line">    QString sendData = ui-&gt;sendLineEdit-&gt;<span class="built_in">text</span>();</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;串口对象写入的数据:&quot;</span> &lt;&lt; sendData.<span class="built_in">toUtf8</span>();</span><br><span class="line">    <span class="comment">//发送数据</span></span><br><span class="line">  	<span class="comment">//&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span></span><br><span class="line">    <span class="keyword">if</span> (ui-&gt;HexSendCheckBox-&gt;<span class="built_in">isChecked</span>())&#123;</span><br><span class="line">        QByteArray sendDataHex = sendData.<span class="built_in">toUtf8</span>();</span><br><span class="line">        <span class="comment">//检测输入Hex是否符合Hex的位数为偶数</span></span><br><span class="line">        <span class="keyword">if</span> (sendData.<span class="built_in">size</span>() % <span class="number">2</span> != <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="comment">//状态栏</span></span><br><span class="line">            QFont font = ui-&gt;statusLabel-&gt;<span class="built_in">font</span>();</span><br><span class="line">            font.<span class="built_in">setBold</span>(<span class="literal">true</span>);</span><br><span class="line">            ui-&gt;statusLabel-&gt;<span class="built_in">setFont</span>(font);</span><br><span class="line">            ui-&gt;statusLabel-&gt;<span class="built_in">setText</span>(<span class="string">&quot;Hex Odd!&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//检测输入Hex是否符合Hex的取值范围</span></span><br><span class="line">        <span class="keyword">for</span> (QChar a: sendData)&#123;</span><br><span class="line">            <span class="keyword">if</span> (!(a.<span class="built_in">isDigit</span>() || (a &gt;= <span class="string">&#x27;A&#x27;</span> &amp;&amp; a &lt;= <span class="string">&#x27;F&#x27;</span>) || (a &gt;= <span class="string">&#x27;a&#x27;</span> &amp;&amp; a &lt;= <span class="string">&#x27;f&#x27;</span>)))&#123;</span><br><span class="line">                <span class="comment">//不合法</span></span><br><span class="line">                <span class="comment">//状态栏</span></span><br><span class="line">                QFont font = ui-&gt;statusLabel-&gt;<span class="built_in">font</span>();</span><br><span class="line">                font.<span class="built_in">setBold</span>(<span class="literal">true</span>);</span><br><span class="line">                ui-&gt;statusLabel-&gt;<span class="built_in">setFont</span>(font);</span><br><span class="line">                ui-&gt;statusLabel-&gt;<span class="built_in">setText</span>(<span class="string">&quot;Hex Out of Range!&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//将Hex编码转成ASSII编码</span></span><br><span class="line">        writeCount = serialPort-&gt;<span class="built_in">write</span>(QByteArray::<span class="built_in">fromHex</span>(sendDataHex));</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        writeCount = serialPort-&gt;<span class="built_in">write</span>(sendData.<span class="built_in">toUtf8</span>());</span><br><span class="line">    &#125;</span><br><span class="line">		<span class="comment">//&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span></span><br><span class="line">    <span class="keyword">if</span> (writeCount == <span class="number">-1</span>)&#123;</span><br><span class="line">        <span class="comment">//状态栏</span></span><br><span class="line">        QFont font = ui-&gt;statusLabel-&gt;<span class="built_in">font</span>();</span><br><span class="line">        font.<span class="built_in">setBold</span>(<span class="literal">true</span>);</span><br><span class="line">        ui-&gt;statusLabel-&gt;<span class="built_in">setFont</span>(font);</span><br><span class="line">        ui-&gt;statusLabel-&gt;<span class="built_in">setText</span>(<span class="string">&quot;Send Failed!&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">//状态栏</span></span><br><span class="line">        <span class="keyword">this</span>-&gt;writeCount += writeCount;</span><br><span class="line">        QFont font = ui-&gt;statusLabel-&gt;<span class="built_in">font</span>();</span><br><span class="line">        font.<span class="built_in">setBold</span>(<span class="literal">true</span>);</span><br><span class="line">        ui-&gt;statusLabel-&gt;<span class="built_in">setFont</span>(font);</span><br><span class="line">        ui-&gt;statusLabel-&gt;<span class="built_in">setText</span>(<span class="string">&quot;Send OK!&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        ui-&gt;sentLabel-&gt;<span class="built_in">setText</span>(<span class="built_in">QString</span>(<span class="string">&quot;Sent: %1&quot;</span>).<span class="built_in">arg</span>(<span class="keyword">this</span>-&gt;writeCount)); <span class="comment">// setNum(this-&gt;writeCount);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//***************************************************** */</span></span><br><span class="line">    <span class="comment">//模拟串口自发自收</span></span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;接收数据槽函数&quot;</span>;</span><br><span class="line">    <span class="comment">//读取数据</span></span><br><span class="line">    <span class="comment">// QByteArray data = ui-&gt;sendLineEdit-&gt;text(); //serialPort-&gt;readAll();</span></span><br><span class="line">    <span class="comment">// qDebug() &lt;&lt; &quot;串口对象读取的Byte数据:&quot; &lt;&lt; data;</span></span><br><span class="line">    <span class="comment">// QString revMessage = QString::fromUtf8(data);</span></span><br><span class="line">    <span class="comment">// qDebug() &lt;&lt; &quot;串口对象读取的string数据:&quot; &lt;&lt; revMessage;</span></span><br><span class="line">    QString revMessage = ui-&gt;sendLineEdit-&gt;<span class="built_in">text</span>();</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;串口对象读取的string数据:&quot;</span> &lt;&lt; revMessage;</span><br><span class="line">  	<span class="comment">//&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span></span><br><span class="line">    <span class="comment">//在HexBox选中状态下输入ASSII格式转成Hex格式</span></span><br><span class="line">    <span class="keyword">if</span> (ui-&gt;hexShowCheckBox-&gt;<span class="built_in">checkState</span>() == Qt::Checked &amp;&amp; ui-&gt;HexSendCheckBox-&gt;<span class="built_in">isChecked</span>() == <span class="literal">false</span>)&#123;</span><br><span class="line">        <span class="comment">//添加换行符</span></span><br><span class="line">        revMessage = <span class="string">&quot;\n&quot;</span> + revMessage;</span><br><span class="line">        <span class="comment">//ASSIIQString转QByteArray</span></span><br><span class="line">        QByteArray tmpByteArray = revMessage.<span class="built_in">toUtf8</span>();</span><br><span class="line">        <span class="comment">//ASSIIQByteArray转成16进制QByteArray</span></span><br><span class="line">        QByteArray tmpHex = tmpByteArray.<span class="built_in">toHex</span>();</span><br><span class="line">        <span class="comment">//16进制QByteArray转成QString</span></span><br><span class="line">        revMessage = QString::<span class="built_in">fromUtf8</span>(tmpHex).<span class="built_in">toUpper</span>();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (ui-&gt;hexShowCheckBox-&gt;<span class="built_in">isChecked</span>() == <span class="literal">false</span> &amp;&amp; ui-&gt;HexSendCheckBox-&gt;<span class="built_in">isChecked</span>() == <span class="literal">false</span>)&#123;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (ui-&gt;hexShowCheckBox-&gt;<span class="built_in">isChecked</span>() == <span class="literal">true</span> &amp;&amp; ui-&gt;HexSendCheckBox-&gt;<span class="built_in">isChecked</span>() == <span class="literal">true</span>)&#123;</span><br><span class="line">        <span class="comment">//添加换行符</span></span><br><span class="line">        QString newLine = <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="comment">//ASSIIQString转QByteArray</span></span><br><span class="line">        QByteArray tmpByteArray = newLine.<span class="built_in">toUtf8</span>();</span><br><span class="line">        <span class="comment">//ASSIIQByteArray转成16进制QByteArray</span></span><br><span class="line">        QByteArray tmpHex = tmpByteArray.<span class="built_in">toHex</span>();</span><br><span class="line">        <span class="comment">//16进制QByteArray转成QString</span></span><br><span class="line">        revMessage = QString::<span class="built_in">fromUtf8</span>(tmpHex) + revMessage;</span><br><span class="line">        revMessage = revMessage.<span class="built_in">toUpper</span>();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (ui-&gt;hexShowCheckBox-&gt;<span class="built_in">isChecked</span>() == <span class="literal">false</span> &amp;&amp; ui-&gt;HexSendCheckBox-&gt;<span class="built_in">isChecked</span>() == <span class="literal">true</span>)&#123;</span><br><span class="line">        <span class="comment">//将Hex解码转成ASSII解码</span></span><br><span class="line">        revMessage = QString::<span class="built_in">fromUtf8</span>(QByteArray::<span class="built_in">fromHex</span>(revMessage.<span class="built_in">toUtf8</span>()));</span><br><span class="line">    &#125;</span><br><span class="line">  	<span class="comment">//&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span></span><br><span class="line">    <span class="comment">//显示在ui框中</span></span><br><span class="line">    <span class="keyword">if</span> (isTimeBoxChecked)&#123;</span><br><span class="line">        <span class="comment">//添加时间戳</span></span><br><span class="line">        <span class="built_in">getSystemTime</span>();</span><br><span class="line">        QString revTimeFormatMessage = <span class="string">&quot;【&quot;</span> + myTime + <span class="string">&quot;】 &quot;</span> + revMessage;</span><br><span class="line">        ui-&gt;textEdit-&gt;<span class="built_in">append</span>(revTimeFormatMessage);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        ui-&gt;textEdit-&gt;<span class="built_in">append</span>(revMessage);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//****************************************************** */</span></span><br><span class="line">    <span class="comment">//状态栏</span></span><br><span class="line">    <span class="keyword">if</span> (writeCount != <span class="number">-1</span>)&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;readCount += revMessage.<span class="built_in">toUtf8</span>().<span class="built_in">size</span>();</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;串口对象读取的字节数据:&quot;</span> &lt;&lt; revMessage.<span class="built_in">toUtf8</span>();</span><br><span class="line">        ui-&gt;RevLabel-&gt;<span class="built_in">setText</span>(<span class="built_in">QString</span>(<span class="string">&quot;Received: %1&quot;</span>).<span class="built_in">arg</span>(<span class="keyword">this</span>-&gt;readCount)); <span class="comment">//setNum(this-&gt;readCount);</span></span><br><span class="line">        <span class="comment">//显示在ui框中</span></span><br><span class="line">      	<span class="comment">//&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span></span><br><span class="line">        <span class="comment">//在HexBox选中状态下使用输入的ASSII作为revMessage,而非Hex作为revMessage</span></span><br><span class="line">        <span class="keyword">if</span> (ui-&gt;hexShowCheckBox-&gt;<span class="built_in">checkState</span>() == Qt::Checked &amp;&amp; ui-&gt;HexSendCheckBox-&gt;<span class="built_in">isChecked</span>() == <span class="literal">false</span>)&#123;</span><br><span class="line">            revMessage = ui-&gt;sendLineEdit-&gt;<span class="built_in">text</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (ui-&gt;hexShowCheckBox-&gt;<span class="built_in">isChecked</span>() == <span class="literal">false</span> &amp;&amp; ui-&gt;HexSendCheckBox-&gt;<span class="built_in">isChecked</span>() == <span class="literal">false</span>)&#123;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (ui-&gt;hexShowCheckBox-&gt;<span class="built_in">isChecked</span>() == <span class="literal">true</span> &amp;&amp; ui-&gt;HexSendCheckBox-&gt;<span class="built_in">isChecked</span>() == <span class="literal">true</span>)&#123;</span><br><span class="line">            revMessage = QString::<span class="built_in">fromUtf8</span>(QByteArray::<span class="built_in">fromHex</span>(ui-&gt;sendLineEdit-&gt;<span class="built_in">text</span>().<span class="built_in">toUtf8</span>()));</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (ui-&gt;hexShowCheckBox-&gt;<span class="built_in">isChecked</span>() == <span class="literal">false</span> &amp;&amp; ui-&gt;HexSendCheckBox-&gt;<span class="built_in">isChecked</span>() == <span class="literal">true</span>)&#123;</span><br><span class="line">            <span class="comment">//将Hex解码转成ASSII解码</span></span><br><span class="line">            revMessage = QString::<span class="built_in">fromUtf8</span>(QByteArray::<span class="built_in">fromHex</span>(ui-&gt;sendLineEdit-&gt;<span class="built_in">text</span>().<span class="built_in">toUtf8</span>()));</span><br><span class="line">        &#125; </span><br><span class="line">      	<span class="comment">//&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>-&gt;sendHis != revMessage)&#123;</span><br><span class="line">            <span class="keyword">this</span>-&gt;sendHis = revMessage;</span><br><span class="line">            ui-&gt;textEditHis-&gt;<span class="built_in">append</span>(revMessage);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="新行checkbox"><strong>新行checkbox</strong></h4>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_sendPushButton_clicked</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> writeCount = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;发送数据槽函数&quot;</span>;</span><br><span class="line">    <span class="comment">//获取发送数据</span></span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;ui框中数据:&quot;</span> &lt;&lt; ui-&gt;sendLineEdit-&gt;<span class="built_in">text</span>();</span><br><span class="line">    QString sendData = ui-&gt;sendLineEdit-&gt;<span class="built_in">text</span>();</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;串口对象写入的数据:&quot;</span> &lt;&lt; sendData.<span class="built_in">toUtf8</span>();</span><br><span class="line">    <span class="comment">//发送数据</span></span><br><span class="line">    <span class="keyword">if</span> (ui-&gt;HexSendCheckBox-&gt;<span class="built_in">isChecked</span>())&#123;</span><br><span class="line">        QByteArray sendDataHex = sendData.<span class="built_in">toUtf8</span>();</span><br><span class="line">        <span class="comment">//检测输入Hex是否符合Hex的位数为偶数</span></span><br><span class="line">        <span class="keyword">if</span> (sendData.<span class="built_in">size</span>() % <span class="number">2</span> != <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="comment">//状态栏</span></span><br><span class="line">            QFont font = ui-&gt;statusLabel-&gt;<span class="built_in">font</span>();</span><br><span class="line">            font.<span class="built_in">setBold</span>(<span class="literal">true</span>);</span><br><span class="line">            ui-&gt;statusLabel-&gt;<span class="built_in">setFont</span>(font);</span><br><span class="line">            ui-&gt;statusLabel-&gt;<span class="built_in">setText</span>(<span class="string">&quot;Hex Odd!&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//检测输入Hex是否符合Hex的取值范围</span></span><br><span class="line">        <span class="keyword">for</span> (QChar a: sendData)&#123;</span><br><span class="line">            <span class="keyword">if</span> (!(a.<span class="built_in">isDigit</span>() || (a &gt;= <span class="string">&#x27;A&#x27;</span> &amp;&amp; a &lt;= <span class="string">&#x27;F&#x27;</span>) || (a &gt;= <span class="string">&#x27;a&#x27;</span> &amp;&amp; a &lt;= <span class="string">&#x27;f&#x27;</span>)))&#123;</span><br><span class="line">                <span class="comment">//不合法</span></span><br><span class="line">                <span class="comment">//状态栏</span></span><br><span class="line">                QFont font = ui-&gt;statusLabel-&gt;<span class="built_in">font</span>();</span><br><span class="line">                font.<span class="built_in">setBold</span>(<span class="literal">true</span>);</span><br><span class="line">                ui-&gt;statusLabel-&gt;<span class="built_in">setFont</span>(font);</span><br><span class="line">                ui-&gt;statusLabel-&gt;<span class="built_in">setText</span>(<span class="string">&quot;Hex Out of Range!&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//将Hex编码转成ASSII编码</span></span><br><span class="line">        writeCount = serialPort-&gt;<span class="built_in">write</span>(QByteArray::<span class="built_in">fromHex</span>(sendDataHex));</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        writeCount = serialPort-&gt;<span class="built_in">write</span>(sendData.<span class="built_in">toUtf8</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (writeCount == <span class="number">-1</span>)&#123;</span><br><span class="line">        <span class="comment">//状态栏</span></span><br><span class="line">        QFont font = ui-&gt;statusLabel-&gt;<span class="built_in">font</span>();</span><br><span class="line">        font.<span class="built_in">setBold</span>(<span class="literal">true</span>);</span><br><span class="line">        ui-&gt;statusLabel-&gt;<span class="built_in">setFont</span>(font);</span><br><span class="line">        ui-&gt;statusLabel-&gt;<span class="built_in">setText</span>(<span class="string">&quot;Send Failed!&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">//状态栏</span></span><br><span class="line">        <span class="keyword">this</span>-&gt;writeCount += writeCount;</span><br><span class="line">        QFont font = ui-&gt;statusLabel-&gt;<span class="built_in">font</span>();</span><br><span class="line">        font.<span class="built_in">setBold</span>(<span class="literal">true</span>);</span><br><span class="line">        ui-&gt;statusLabel-&gt;<span class="built_in">setFont</span>(font);</span><br><span class="line">        ui-&gt;statusLabel-&gt;<span class="built_in">setText</span>(<span class="string">&quot;Send OK!&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        ui-&gt;sentLabel-&gt;<span class="built_in">setText</span>(<span class="built_in">QString</span>(<span class="string">&quot;Sent: %1&quot;</span>).<span class="built_in">arg</span>(<span class="keyword">this</span>-&gt;writeCount)); <span class="comment">// setNum(this-&gt;writeCount);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//***************************************************** */</span></span><br><span class="line">    <span class="comment">//模拟串口自发自收</span></span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;接收数据槽函数&quot;</span>;</span><br><span class="line">    <span class="comment">//读取数据</span></span><br><span class="line">    <span class="comment">// QByteArray data = ui-&gt;sendLineEdit-&gt;text(); //serialPort-&gt;readAll();</span></span><br><span class="line">    <span class="comment">// qDebug() &lt;&lt; &quot;串口对象读取的Byte数据:&quot; &lt;&lt; data;</span></span><br><span class="line">    <span class="comment">// QString revMessage = QString::fromUtf8(data);</span></span><br><span class="line">    <span class="comment">// qDebug() &lt;&lt; &quot;串口对象读取的string数据:&quot; &lt;&lt; revMessage;</span></span><br><span class="line">    QString revMessage = ui-&gt;sendLineEdit-&gt;<span class="built_in">text</span>();</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;串口对象读取的string数据:&quot;</span> &lt;&lt; revMessage;</span><br><span class="line">    <span class="comment">//在HexBox选中状态下输入ASSII格式转成Hex格式</span></span><br><span class="line">    <span class="keyword">if</span> (ui-&gt;hexShowCheckBox-&gt;<span class="built_in">checkState</span>() == Qt::Checked &amp;&amp; ui-&gt;HexSendCheckBox-&gt;<span class="built_in">isChecked</span>() == <span class="literal">false</span>)&#123;</span><br><span class="line">      	<span class="comment">//&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span></span><br><span class="line">        <span class="comment">//添加换行符</span></span><br><span class="line">        <span class="keyword">if</span> (ui-&gt;nextLineCheckBox-&gt;<span class="built_in">isChecked</span>())&#123;</span><br><span class="line">            revMessage = <span class="string">&quot;\n&quot;</span> + revMessage;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (ui-&gt;newLineSendCheckBox-&gt;<span class="built_in">isChecked</span>())&#123;</span><br><span class="line">            revMessage = revMessage + <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//ASSIIQString转QByteArray</span></span><br><span class="line">        QByteArray tmpByteArray = revMessage.<span class="built_in">toUtf8</span>();</span><br><span class="line">        <span class="comment">//ASSIIQByteArray转成16进制QByteArray</span></span><br><span class="line">        QByteArray tmpHex = tmpByteArray.<span class="built_in">toHex</span>();</span><br><span class="line">        <span class="comment">//16进制QByteArray转成QString</span></span><br><span class="line">        revMessage = QString::<span class="built_in">fromUtf8</span>(tmpHex).<span class="built_in">toUpper</span>();</span><br><span class="line">      	<span class="comment">//&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (ui-&gt;hexShowCheckBox-&gt;<span class="built_in">isChecked</span>() == <span class="literal">false</span> &amp;&amp; ui-&gt;HexSendCheckBox-&gt;<span class="built_in">isChecked</span>() == <span class="literal">false</span>)&#123;</span><br><span class="line">      	<span class="comment">//&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span></span><br><span class="line">        <span class="comment">//添加换行符</span></span><br><span class="line">        <span class="keyword">if</span> (ui-&gt;nextLineCheckBox-&gt;<span class="built_in">isChecked</span>())&#123;</span><br><span class="line">            revMessage = <span class="string">&quot;\n&quot;</span> + revMessage;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (ui-&gt;newLineSendCheckBox-&gt;<span class="built_in">isChecked</span>())&#123;</span><br><span class="line">            revMessage = revMessage + <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      	<span class="comment">//&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (ui-&gt;hexShowCheckBox-&gt;<span class="built_in">isChecked</span>() == <span class="literal">true</span> &amp;&amp; ui-&gt;HexSendCheckBox-&gt;<span class="built_in">isChecked</span>() == <span class="literal">true</span>)&#123;</span><br><span class="line">      	<span class="comment">//&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span></span><br><span class="line">        <span class="comment">//添加换行符</span></span><br><span class="line">        QString newLine = <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="comment">//ASSIIQString转QByteArray</span></span><br><span class="line">        QByteArray tmpByteArray = newLine.<span class="built_in">toUtf8</span>();</span><br><span class="line">        <span class="comment">//ASSIIQByteArray转成16进制QByteArray</span></span><br><span class="line">        QByteArray tmpHex = tmpByteArray.<span class="built_in">toHex</span>();</span><br><span class="line">        <span class="keyword">if</span> (ui-&gt;nextLineCheckBox-&gt;<span class="built_in">isChecked</span>())&#123;</span><br><span class="line">            <span class="comment">//16进制QByteArray转成QString</span></span><br><span class="line">            revMessage = QString::<span class="built_in">fromUtf8</span>(tmpHex) + revMessage;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (ui-&gt;newLineSendCheckBox-&gt;<span class="built_in">isChecked</span>())&#123;</span><br><span class="line">            revMessage = revMessage + QString::<span class="built_in">fromUtf8</span>(tmpHex);</span><br><span class="line">        &#125;</span><br><span class="line">        revMessage = revMessage.<span class="built_in">toUpper</span>();</span><br><span class="line">      	<span class="comment">//&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (ui-&gt;hexShowCheckBox-&gt;<span class="built_in">isChecked</span>() == <span class="literal">false</span> &amp;&amp; ui-&gt;HexSendCheckBox-&gt;<span class="built_in">isChecked</span>() == <span class="literal">true</span>)&#123;</span><br><span class="line">      	<span class="comment">//&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span></span><br><span class="line">        <span class="comment">//添加换行符</span></span><br><span class="line">        QString newLine = <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="comment">//ASSIIQString转QByteArray</span></span><br><span class="line">        QByteArray tmpByteArray = newLine.<span class="built_in">toUtf8</span>();</span><br><span class="line">        <span class="comment">//ASSIIQByteArray转成16进制QByteArray</span></span><br><span class="line">        QByteArray tmpHex = tmpByteArray.<span class="built_in">toHex</span>();</span><br><span class="line">        <span class="keyword">if</span> (ui-&gt;nextLineCheckBox-&gt;<span class="built_in">isChecked</span>())&#123;</span><br><span class="line">            <span class="comment">//16进制QByteArray转成QString</span></span><br><span class="line">            revMessage = QString::<span class="built_in">fromUtf8</span>(tmpHex) + revMessage;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (ui-&gt;newLineSendCheckBox-&gt;<span class="built_in">isChecked</span>())&#123;</span><br><span class="line">            revMessage = revMessage + QString::<span class="built_in">fromUtf8</span>(tmpHex);</span><br><span class="line">        &#125;</span><br><span class="line">      	<span class="comment">//&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span></span><br><span class="line">        <span class="comment">//将Hex解码转成ASSII解码</span></span><br><span class="line">        revMessage = QString::<span class="built_in">fromUtf8</span>(QByteArray::<span class="built_in">fromHex</span>(revMessage.<span class="built_in">toUtf8</span>()));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//显示在ui框中</span></span><br><span class="line">  	<span class="comment">//&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span></span><br><span class="line">    <span class="keyword">if</span> (isTimeBoxChecked)&#123;</span><br><span class="line">        <span class="comment">//添加时间戳</span></span><br><span class="line">        <span class="built_in">getSystemTime</span>();</span><br><span class="line">        QString revTimeFormatMessage = <span class="string">&quot;【&quot;</span> + myTime + <span class="string">&quot;】 &quot;</span> + revMessage;</span><br><span class="line">        <span class="comment">// ui-&gt;textEdit-&gt;append(revTimeFormatMessage);</span></span><br><span class="line">        ui-&gt;textEdit-&gt;<span class="built_in">insertPlainText</span>(revTimeFormatMessage);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">// ui-&gt;textEdit-&gt;append(revMessage);</span></span><br><span class="line">        ui-&gt;textEdit-&gt;<span class="built_in">insertPlainText</span>(revMessage);</span><br><span class="line">    &#125;</span><br><span class="line">		<span class="comment">//&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span></span><br><span class="line">    <span class="comment">//****************************************************** */</span></span><br><span class="line">    <span class="comment">//状态栏</span></span><br><span class="line">    <span class="keyword">if</span> (writeCount != <span class="number">-1</span>)&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;readCount += revMessage.<span class="built_in">toUtf8</span>().<span class="built_in">size</span>();</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;串口对象读取的字节数据:&quot;</span> &lt;&lt; revMessage.<span class="built_in">toUtf8</span>();</span><br><span class="line">        ui-&gt;RevLabel-&gt;<span class="built_in">setText</span>(<span class="built_in">QString</span>(<span class="string">&quot;Received: %1&quot;</span>).<span class="built_in">arg</span>(<span class="keyword">this</span>-&gt;readCount)); <span class="comment">//setNum(this-&gt;readCount);</span></span><br><span class="line">        <span class="comment">//显示在ui框中</span></span><br><span class="line">        <span class="comment">//在HexBox选中状态下使用输入的ASSII作为revMessage,而非Hex作为revMessage</span></span><br><span class="line">        <span class="keyword">if</span> (ui-&gt;hexShowCheckBox-&gt;<span class="built_in">checkState</span>() == Qt::Checked &amp;&amp; ui-&gt;HexSendCheckBox-&gt;<span class="built_in">isChecked</span>() == <span class="literal">false</span>)&#123;</span><br><span class="line">            revMessage = ui-&gt;sendLineEdit-&gt;<span class="built_in">text</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (ui-&gt;hexShowCheckBox-&gt;<span class="built_in">isChecked</span>() == <span class="literal">false</span> &amp;&amp; ui-&gt;HexSendCheckBox-&gt;<span class="built_in">isChecked</span>() == <span class="literal">false</span>)&#123;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (ui-&gt;hexShowCheckBox-&gt;<span class="built_in">isChecked</span>() == <span class="literal">true</span> &amp;&amp; ui-&gt;HexSendCheckBox-&gt;<span class="built_in">isChecked</span>() == <span class="literal">true</span>)&#123;</span><br><span class="line">            revMessage = QString::<span class="built_in">fromUtf8</span>(QByteArray::<span class="built_in">fromHex</span>(ui-&gt;sendLineEdit-&gt;<span class="built_in">text</span>().<span class="built_in">toUtf8</span>()));</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (ui-&gt;hexShowCheckBox-&gt;<span class="built_in">isChecked</span>() == <span class="literal">false</span> &amp;&amp; ui-&gt;HexSendCheckBox-&gt;<span class="built_in">isChecked</span>() == <span class="literal">true</span>)&#123;</span><br><span class="line">            <span class="comment">//将Hex解码转成ASSII解码</span></span><br><span class="line">            revMessage = QString::<span class="built_in">fromUtf8</span>(QByteArray::<span class="built_in">fromHex</span>(ui-&gt;sendLineEdit-&gt;<span class="built_in">text</span>().<span class="built_in">toUtf8</span>()));</span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>-&gt;sendHis != revMessage)&#123;</span><br><span class="line">            <span class="keyword">this</span>-&gt;sendHis = revMessage;</span><br><span class="line">            ui-&gt;textEditHis-&gt;<span class="built_in">append</span>(revMessage);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="隐藏面板和隐藏历史pushbutton"><strong>隐藏面板和隐藏历史pushbutton</strong></h4>
<p><img src="/2025/02/24/QT-C/QT-C/image-20250512111100394.png" alt="image-20250512111100394">在Designer中隐藏历史/面板pushbutton中选择checkable。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_hideBoardPushButton_clicked</span><span class="params">(<span class="type">bool</span> checked)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (checked)&#123;</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;隐藏主窗口: &quot;</span> &lt;&lt; checked;</span><br><span class="line">        ui-&gt;hideBoardPushButton-&gt;<span class="built_in">setText</span>(<span class="string">&quot;拓展面板&quot;</span>);</span><br><span class="line">        ui-&gt;groupBoxMText-&gt;<span class="built_in">hide</span>();</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;显示主窗口: &quot;</span> &lt;&lt; checked;</span><br><span class="line">        ui-&gt;hideBoardPushButton-&gt;<span class="built_in">setText</span>(<span class="string">&quot;隐藏面板&quot;</span>);</span><br><span class="line">        ui-&gt;groupBoxMText-&gt;<span class="built_in">show</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_hideHisPushButton_clicked</span><span class="params">(<span class="type">bool</span> checked)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (checked)&#123;</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;隐藏历史: &quot;</span> &lt;&lt; checked;</span><br><span class="line">        ui-&gt;hideHisPushButton-&gt;<span class="built_in">setText</span>(<span class="string">&quot;拓展历史&quot;</span>);</span><br><span class="line">        ui-&gt;groupBoxHis-&gt;<span class="built_in">hide</span>();</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;显示历史: &quot;</span> &lt;&lt; checked;</span><br><span class="line">        ui-&gt;hideHisPushButton-&gt;<span class="built_in">setText</span>(<span class="string">&quot;隐藏历史&quot;</span>);</span><br><span class="line">        ui-&gt;groupBoxHis-&gt;<span class="built_in">show</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="串口combox刷新串口"><strong>串口combox刷新串口</strong></h4>
<p>没有合适的槽函数，需要自定义控件（事件）。采用多项目管理组织样板。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//comboxEvent.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> COMBOXEVENT_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> COMBOXEVENT_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QComboBox&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QWidget&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QMouseEvent&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ComboxEvent</span>: <span class="keyword">public</span> QComboBox</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">ComboxEvent</span>(QWidget* parent);</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">mousePressEvent</span><span class="params">(QMouseEvent* event)</span> <span class="keyword">override</span></span>;</span><br><span class="line">    </span><br><span class="line">signals:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">refresh</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// COMBOXEVENT_H</span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//comboxEvent.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;comboxEvent.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">ComboxEvent::<span class="built_in">ComboxEvent</span>(QWidget *parent): <span class="built_in">QComboBox</span>(parent)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ComboxEvent::mousePressEvent</span><span class="params">(QMouseEvent *event)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//发出信号</span></span><br><span class="line">    <span class="keyword">if</span> (event-&gt;<span class="built_in">button</span>() == Qt::LeftButton)&#123;</span><br><span class="line">        <span class="function">emit <span class="title">refresh</span><span class="params">()</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">    QComboBox::<span class="built_in">mousePressEvent</span>(event);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>串口combox控件提升类型为ComboxEvent。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//mainwindow.cpp</span></span><br><span class="line">MainWindow::<span class="built_in">MainWindow</span>(QWidget *parent)</span><br><span class="line">    : <span class="built_in">QMainWindow</span>(parent)</span><br><span class="line">    , <span class="built_in">ui</span>(<span class="keyword">new</span> Ui::MainWindow)</span><br><span class="line">&#123;</span><br><span class="line">    ui-&gt;<span class="built_in">setupUi</span>(<span class="keyword">this</span>);</span><br><span class="line">    <span class="comment">//窗口内容随窗口大小变化</span></span><br><span class="line">    ui-&gt;centralwidget-&gt;<span class="built_in">setLayout</span>(ui-&gt;windowGridLayout);<span class="comment">//ui-&gt;centralwidget</span></span><br><span class="line">    <span class="comment">//自动检测可用串口，并添加到comboBox中</span></span><br><span class="line">    QList&lt;QSerialPortInfo&gt; serialList = QSerialPortInfo::<span class="built_in">availablePorts</span>();</span><br><span class="line">    <span class="keyword">for</span> (QSerialPortInfo serial : serialList) &#123;</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; serial.<span class="built_in">portName</span>();</span><br><span class="line">        ui-&gt;chuanComboBox-&gt;<span class="built_in">addItem</span>(serial.<span class="built_in">portName</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//....</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置信号与槽</span></span><br><span class="line">    <span class="comment">//&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span></span><br><span class="line">    <span class="built_in">connect</span>(ui-&gt;chuanComboBox, &amp;ComboxEvent::refresh, <span class="keyword">this</span>, &amp;MainWindow::on_chuanComboBox_refresh);</span><br><span class="line">		<span class="comment">//&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_chuanComboBox_refresh</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;刷新串口&quot;</span>;</span><br><span class="line">    ui-&gt;chuanComboBox-&gt;<span class="built_in">clear</span>();</span><br><span class="line">    <span class="comment">//自动检测可用串口，并添加到comboBox中</span></span><br><span class="line">    QList&lt;QSerialPortInfo&gt; serialList = QSerialPortInfo::<span class="built_in">availablePorts</span>();</span><br><span class="line">    <span class="keyword">for</span> (QSerialPortInfo serial : serialList) &#123;</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; serial.<span class="built_in">portName</span>();</span><br><span class="line">        ui-&gt;chuanComboBox-&gt;<span class="built_in">addItem</span>(serial.<span class="built_in">portName</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//状态栏</span></span><br><span class="line">    QString str = <span class="string">&quot;&lt;b&gt;Refresh Serial Port&lt;/b&gt;&quot;</span>;</span><br><span class="line">    ui-&gt;statusLabel-&gt;<span class="built_in">setText</span>(str);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span></span><br></pre></td></tr></table></figure>
<h4 id="预定义命令发送"><strong>预定义命令发送</strong></h4>
<ul>
<li>使用循环生成控件名称</li>
<li>使用findChild根据控件名找到控件对象</li>
<li>在槽函数中使用sender()找到信号发送者</li>
<li>可借助控件属性在信号与槽机制中传递参数，设置自定义属性字典，例如设置控件id以及引用id时利用控件属性提取id</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//mainwindow.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> MAINWINDOW_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAINWINDOW_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QMainWindow&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QSerialPort&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;comboxEvent.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">QT_BEGIN_NAMESPACE</span><br><span class="line"><span class="keyword">namespace</span> Ui &#123;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MainWindow</span>;</span><br><span class="line">&#125;</span><br><span class="line">QT_END_NAMESPACE</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MainWindow</span> : <span class="keyword">public</span> QMainWindow</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">MainWindow</span>(QWidget *parent = <span class="literal">nullptr</span>);</span><br><span class="line">    ~<span class="built_in">MainWindow</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> slots:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_closePushButton_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_sendPushButton_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">onSerialDataReadyToRead</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_timeSendCheckBox_clicked</span><span class="params">(<span class="type">bool</span> checked)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_clearPushButton_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_saveRevPushButton_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">refreshStatusTime</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_revTimeCheckBox_clicked</span><span class="params">(<span class="type">bool</span> checked)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_hexShowCheckBox_clicked</span><span class="params">(<span class="type">bool</span> checked)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_hideBoardPushButton_clicked</span><span class="params">(<span class="type">bool</span> checked)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_hideHisPushButton_clicked</span><span class="params">(<span class="type">bool</span> checked)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_chuanComboBox_refresh</span><span class="params">()</span></span>;</span><br><span class="line">  <span class="comment">//&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_sendSerialTextCommand</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">// void on_pushButton1_clicked();</span></span><br><span class="line">    <span class="comment">// void on_pushButton2_clicked();</span></span><br><span class="line">    <span class="comment">// void on_pushButton3_clicked();</span></span><br><span class="line">    <span class="comment">// void on_pushButton4_clicked();</span></span><br><span class="line">    <span class="comment">// void on_pushButton5_clicked();</span></span><br><span class="line">    <span class="comment">// void on_pushButton6_clicked();</span></span><br><span class="line">    <span class="comment">// void on_pushButton7_clicked();</span></span><br><span class="line">    <span class="comment">// void on_pushButton8_clicked();</span></span><br><span class="line">    <span class="comment">// void on_pushButton9_clicked();</span></span><br><span class="line">    <span class="comment">// void on_pushButton10_clicked();</span></span><br><span class="line">    <span class="comment">// void on_pushButton11_clicked();</span></span><br><span class="line">    <span class="comment">// void on_pushButton12_clicked();</span></span><br><span class="line">    <span class="comment">// void on_pushButton13_clicked();</span></span><br><span class="line">  <span class="comment">//&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Ui::MainWindow *ui;</span><br><span class="line">    QSerialPort* serialPort;</span><br><span class="line">    <span class="type">int</span> writeCount;</span><br><span class="line">    <span class="type">int</span> readCount;</span><br><span class="line">    QString sendHis;</span><br><span class="line">    <span class="type">bool</span> isSerialPortOpen;</span><br><span class="line">    QTimer* timer;</span><br><span class="line">    QString myTime;</span><br><span class="line">    <span class="type">bool</span> isTimeBoxChecked;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">getSystemTime</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// MAINWINDOW_H</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//mainwindow.cpp</span></span><br><span class="line">MainWindow::<span class="built_in">MainWindow</span>(QWidget *parent)</span><br><span class="line">    : <span class="built_in">QMainWindow</span>(parent)</span><br><span class="line">    , <span class="built_in">ui</span>(<span class="keyword">new</span> Ui::MainWindow)</span><br><span class="line">&#123;</span><br><span class="line">    ui-&gt;<span class="built_in">setupUi</span>(<span class="keyword">this</span>);</span><br><span class="line">    <span class="comment">//窗口内容随窗口大小变化</span></span><br><span class="line">    ui-&gt;centralwidget-&gt;<span class="built_in">setLayout</span>(ui-&gt;windowGridLayout);<span class="comment">//ui-&gt;centralwidget</span></span><br><span class="line">    <span class="comment">//......</span></span><br><span class="line">    <span class="comment">//&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span></span><br><span class="line">    <span class="comment">//定义pushbutton数组</span></span><br><span class="line">    QList&lt;QPushButton*&gt; pushButtonList;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i &lt; <span class="number">12</span>; i++)&#123;</span><br><span class="line">        QString btnName = <span class="built_in">QString</span>(<span class="string">&quot;pushButton%1&quot;</span>).<span class="built_in">arg</span>(i+<span class="number">1</span>);</span><br><span class="line">        <span class="comment">//findChild找某类型的控件对象</span></span><br><span class="line">        QPushButton* btn = <span class="built_in">findChild</span>&lt;QPushButton*&gt;(btnName);</span><br><span class="line">        <span class="keyword">if</span> (btn != <span class="literal">nullptr</span>) &#123;</span><br><span class="line">            <span class="comment">//设置pushbutton属性，为了在槽函数引用ID</span></span><br><span class="line">            btn-&gt;<span class="built_in">setProperty</span>(<span class="string">&quot;pushButtonId&quot;</span>, i+<span class="number">1</span>);</span><br><span class="line">            pushButtonList.<span class="built_in">append</span>(btn);</span><br><span class="line">            <span class="comment">//设置信号与槽</span></span><br><span class="line">            <span class="built_in">connect</span>(btn, &amp;QPushButton::clicked, <span class="keyword">this</span>, &amp;MainWindow::on_sendSerialTextCommand);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;,</span></span><br><span class="line">		<span class="comment">//....</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_sendSerialTextCommand</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//sender()获取信号发出的控件</span></span><br><span class="line">    QPushButton* btn = <span class="built_in">qobject_cast</span>&lt;QPushButton*&gt;(<span class="built_in">sender</span>());</span><br><span class="line">    <span class="comment">//lineEdit控件</span></span><br><span class="line">    QString lineEditString = <span class="built_in">QString</span>(<span class="string">&quot;lineEdit&quot;</span>) + btn-&gt;<span class="built_in">property</span>(<span class="string">&quot;pushButtonId&quot;</span>).<span class="built_in">toString</span>();</span><br><span class="line">    QLineEdit* lineEdit = <span class="built_in">findChild</span>&lt;QLineEdit*&gt;(lineEditString);</span><br><span class="line">    <span class="comment">//checkBox控件</span></span><br><span class="line">    QString checkBoxString = <span class="built_in">QString</span>(<span class="string">&quot;checkBox&quot;</span>) + btn-&gt;<span class="built_in">property</span>(<span class="string">&quot;pushButtonId&quot;</span>).<span class="built_in">toString</span>();</span><br><span class="line">    QCheckBox* checkBox = <span class="built_in">findChild</span>&lt;QCheckBox*&gt;(checkBoxString);</span><br><span class="line">    <span class="comment">//业务逻辑</span></span><br><span class="line">    ui-&gt;sendLineEdit-&gt;<span class="built_in">setText</span>(lineEdit-&gt;<span class="built_in">text</span>());</span><br><span class="line">    ui-&gt;HexSendCheckBox-&gt;<span class="built_in">setChecked</span>(checkBox-&gt;<span class="built_in">isChecked</span>());</span><br><span class="line">    <span class="built_in">on_sendPushButton_clicked</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// void MainWindow::on_pushButton1_clicked()</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//     ui-&gt;sendLineEdit-&gt;setText(ui-&gt;lineEdit1-&gt;text());</span></span><br><span class="line"><span class="comment">//     if (ui-&gt;checkBox1-&gt;isChecked())&#123;</span></span><br><span class="line"><span class="comment">//         ui-&gt;HexSendCheckBox-&gt;setChecked(true);</span></span><br><span class="line"><span class="comment">//     &#125;else&#123;</span></span><br><span class="line"><span class="comment">//         ui-&gt;HexSendCheckBox-&gt;setChecked(false);</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">//     on_sendPushButton_clicked();</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// void MainWindow::on_pushButton2_clicked()</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//     ui-&gt;sendLineEdit-&gt;setText(ui-&gt;lineEdit2-&gt;text());</span></span><br><span class="line"><span class="comment">//     if (ui-&gt;checkBox2-&gt;isChecked())&#123;</span></span><br><span class="line"><span class="comment">//         ui-&gt;HexSendCheckBox-&gt;setChecked(true);</span></span><br><span class="line"><span class="comment">//     &#125;else&#123;</span></span><br><span class="line"><span class="comment">//         ui-&gt;HexSendCheckBox-&gt;setChecked(false);</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">//     on_sendPushButton_clicked();</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// void MainWindow::on_pushButton3_clicked()</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//     ui-&gt;sendLineEdit-&gt;setText(ui-&gt;lineEdit3-&gt;text());</span></span><br><span class="line"><span class="comment">//     if (ui-&gt;checkBox3-&gt;isChecked())&#123;</span></span><br><span class="line"><span class="comment">//         ui-&gt;HexSendCheckBox-&gt;setChecked(true);</span></span><br><span class="line"><span class="comment">//     &#125;else&#123;</span></span><br><span class="line"><span class="comment">//         ui-&gt;HexSendCheckBox-&gt;setChecked(false);</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">//     on_sendPushButton_clicked();</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// void MainWindow::on_pushButton4_clicked()</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//     ui-&gt;sendLineEdit-&gt;setText(ui-&gt;lineEdit4-&gt;text());</span></span><br><span class="line"><span class="comment">//     if (ui-&gt;checkBox4-&gt;isChecked())&#123;</span></span><br><span class="line"><span class="comment">//         ui-&gt;HexSendCheckBox-&gt;setChecked(true);</span></span><br><span class="line"><span class="comment">//     &#125;else&#123;</span></span><br><span class="line"><span class="comment">//         ui-&gt;HexSendCheckBox-&gt;setChecked(false);</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">//     on_sendPushButton_clicked();</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// void MainWindow::on_pushButton5_clicked()</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//     ui-&gt;sendLineEdit-&gt;setText(ui-&gt;lineEdit5-&gt;text());</span></span><br><span class="line"><span class="comment">//     if (ui-&gt;checkBox5-&gt;isChecked())&#123;</span></span><br><span class="line"><span class="comment">//         ui-&gt;HexSendCheckBox-&gt;setChecked(true);</span></span><br><span class="line"><span class="comment">//     &#125;else&#123;</span></span><br><span class="line"><span class="comment">//         ui-&gt;HexSendCheckBox-&gt;setChecked(false);</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">//     on_sendPushButton_clicked();</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// void MainWindow::on_pushButton6_clicked()</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//     ui-&gt;sendLineEdit-&gt;setText(ui-&gt;lineEdit6-&gt;text());</span></span><br><span class="line"><span class="comment">//     if (ui-&gt;checkBox6-&gt;isChecked())&#123;</span></span><br><span class="line"><span class="comment">//         ui-&gt;HexSendCheckBox-&gt;setChecked(true);</span></span><br><span class="line"><span class="comment">//     &#125;else&#123;</span></span><br><span class="line"><span class="comment">//         ui-&gt;HexSendCheckBox-&gt;setChecked(false);</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">//     on_sendPushButton_clicked();</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// void MainWindow::on_pushButton7_clicked()</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//     ui-&gt;sendLineEdit-&gt;setText(ui-&gt;lineEdit7-&gt;text());</span></span><br><span class="line"><span class="comment">//     if (ui-&gt;checkBox7-&gt;isChecked())&#123;</span></span><br><span class="line"><span class="comment">//         ui-&gt;HexSendCheckBox-&gt;setChecked(true);</span></span><br><span class="line"><span class="comment">//     &#125;else&#123;</span></span><br><span class="line"><span class="comment">//         ui-&gt;HexSendCheckBox-&gt;setChecked(false);</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">//     on_sendPushButton_clicked();</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// void MainWindow::on_pushButton8_clicked()</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//     ui-&gt;sendLineEdit-&gt;setText(ui-&gt;lineEdit8-&gt;text());</span></span><br><span class="line"><span class="comment">//     if (ui-&gt;checkBox8-&gt;isChecked())&#123;</span></span><br><span class="line"><span class="comment">//         ui-&gt;HexSendCheckBox-&gt;setChecked(true);</span></span><br><span class="line"><span class="comment">//     &#125;else&#123;</span></span><br><span class="line"><span class="comment">//         ui-&gt;HexSendCheckBox-&gt;setChecked(false);</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">//     on_sendPushButton_clicked();</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// void MainWindow::on_pushButton9_clicked()</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//     ui-&gt;sendLineEdit-&gt;setText(ui-&gt;lineEdit9-&gt;text());</span></span><br><span class="line"><span class="comment">//     if (ui-&gt;checkBox9-&gt;isChecked())&#123;</span></span><br><span class="line"><span class="comment">//         ui-&gt;HexSendCheckBox-&gt;setChecked(true);</span></span><br><span class="line"><span class="comment">//     &#125;else&#123;</span></span><br><span class="line"><span class="comment">//         ui-&gt;HexSendCheckBox-&gt;setChecked(false);</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">//     on_sendPushButton_clicked();</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// void MainWindow::on_pushButton10_clicked()</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//     ui-&gt;sendLineEdit-&gt;setText(ui-&gt;lineEdit10-&gt;text());</span></span><br><span class="line"><span class="comment">//     if (ui-&gt;checkBox10-&gt;isChecked())&#123;</span></span><br><span class="line"><span class="comment">//         ui-&gt;HexSendCheckBox-&gt;setChecked(true);</span></span><br><span class="line"><span class="comment">//     &#125;else&#123;</span></span><br><span class="line"><span class="comment">//         ui-&gt;HexSendCheckBox-&gt;setChecked(false);</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">//     on_sendPushButton_clicked();</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// void MainWindow::on_pushButton11_clicked()</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//     ui-&gt;sendLineEdit-&gt;setText(ui-&gt;lineEdit11-&gt;text());</span></span><br><span class="line"><span class="comment">//     if (ui-&gt;checkBox11-&gt;isChecked())&#123;</span></span><br><span class="line"><span class="comment">//         ui-&gt;HexSendCheckBox-&gt;setChecked(true);</span></span><br><span class="line"><span class="comment">//     &#125;else&#123;</span></span><br><span class="line"><span class="comment">//         ui-&gt;HexSendCheckBox-&gt;setChecked(false);</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">//     on_sendPushButton_clicked();</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// void MainWindow::on_pushButton12_clicked()</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//     ui-&gt;sendLineEdit-&gt;setText(ui-&gt;lineEdit12-&gt;text());</span></span><br><span class="line"><span class="comment">//     if (ui-&gt;checkBox12-&gt;isChecked())&#123;</span></span><br><span class="line"><span class="comment">//         ui-&gt;HexSendCheckBox-&gt;setChecked(true);</span></span><br><span class="line"><span class="comment">//     &#125;else&#123;</span></span><br><span class="line"><span class="comment">//         ui-&gt;HexSendCheckBox-&gt;setChecked(false);</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">//     on_sendPushButton_clicked();</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// void MainWindow::on_pushButton13_clicked()</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//     ui-&gt;sendLineEdit-&gt;setText(ui-&gt;lineEdit13-&gt;text());</span></span><br><span class="line"><span class="comment">//     if (ui-&gt;checkBox13-&gt;isChecked())&#123;</span></span><br><span class="line"><span class="comment">//         ui-&gt;HexSendCheckBox-&gt;setChecked(true);</span></span><br><span class="line"><span class="comment">//     &#125;else&#123;</span></span><br><span class="line"><span class="comment">//         ui-&gt;HexSendCheckBox-&gt;setChecked(false);</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">//     on_sendPushButton_clicked();</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">//&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span></span><br></pre></td></tr></table></figure>
<h4 id="循环发送预定义命令"><strong>循环发送预定义命令</strong></h4>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//mainwindow.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> MAINWINDOW_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAINWINDOW_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QMainWindow&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QSerialPort&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;comboxEvent.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QPushButton&gt;</span></span></span><br><span class="line"></span><br><span class="line">QT_BEGIN_NAMESPACE</span><br><span class="line"><span class="keyword">namespace</span> Ui &#123;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MainWindow</span>;</span><br><span class="line">&#125;</span><br><span class="line">QT_END_NAMESPACE</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MainWindow</span> : <span class="keyword">public</span> QMainWindow</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">MainWindow</span>(QWidget *parent = <span class="literal">nullptr</span>);</span><br><span class="line">    ~<span class="built_in">MainWindow</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> slots:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_closePushButton_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_sendPushButton_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">onSerialDataReadyToRead</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_timeSendCheckBox_clicked</span><span class="params">(<span class="type">bool</span> checked)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_clearPushButton_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_saveRevPushButton_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">refreshStatusTime</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_revTimeCheckBox_clicked</span><span class="params">(<span class="type">bool</span> checked)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_hexShowCheckBox_clicked</span><span class="params">(<span class="type">bool</span> checked)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_hideBoardPushButton_clicked</span><span class="params">(<span class="type">bool</span> checked)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_hideHisPushButton_clicked</span><span class="params">(<span class="type">bool</span> checked)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_chuanComboBox_refresh</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_sendSerialTextCommand</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">// void on_pushButton1_clicked();</span></span><br><span class="line">    <span class="comment">// void on_pushButton2_clicked();</span></span><br><span class="line">    <span class="comment">// void on_pushButton3_clicked();</span></span><br><span class="line">    <span class="comment">// void on_pushButton4_clicked();</span></span><br><span class="line">    <span class="comment">// void on_pushButton5_clicked();</span></span><br><span class="line">    <span class="comment">// void on_pushButton6_clicked();</span></span><br><span class="line">    <span class="comment">// void on_pushButton7_clicked();</span></span><br><span class="line">    <span class="comment">// void on_pushButton8_clicked();</span></span><br><span class="line">    <span class="comment">// void on_pushButton9_clicked();</span></span><br><span class="line">    <span class="comment">// void on_pushButton10_clicked();</span></span><br><span class="line">    <span class="comment">// void on_pushButton11_clicked();</span></span><br><span class="line">    <span class="comment">// void on_pushButton12_clicked();</span></span><br><span class="line">    <span class="comment">// void on_pushButton13_clicked();</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_xunhuanCheckBox_clicked</span><span class="params">(<span class="type">bool</span> checked)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Ui::MainWindow *ui;</span><br><span class="line">    QSerialPort* serialPort;</span><br><span class="line">    <span class="type">int</span> writeCount;</span><br><span class="line">    <span class="type">int</span> readCount;</span><br><span class="line">    QString sendHis;</span><br><span class="line">    <span class="type">bool</span> isSerialPortOpen;</span><br><span class="line">    QTimer* timer;</span><br><span class="line">    QString myTime;</span><br><span class="line">    <span class="type">bool</span> isTimeBoxChecked;</span><br><span class="line">    <span class="comment">//定义pushbutton数组</span></span><br><span class="line">    QList&lt;QPushButton*&gt; pushButtonList;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">getSystemTime</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// MAINWINDOW_H</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">MainWindow::<span class="built_in">MainWindow</span>(QWidget *parent)</span><br><span class="line">    : <span class="built_in">QMainWindow</span>(parent)</span><br><span class="line">    , <span class="built_in">ui</span>(<span class="keyword">new</span> Ui::MainWindow)</span><br><span class="line">&#123;</span><br><span class="line">    ui-&gt;<span class="built_in">setupUi</span>(<span class="keyword">this</span>);</span><br><span class="line">    <span class="comment">//窗口内容随窗口大小变化</span></span><br><span class="line">    ui-&gt;centralwidget-&gt;<span class="built_in">setLayout</span>(ui-&gt;windowGridLayout);<span class="comment">//ui-&gt;centralwidget</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i &lt; <span class="number">12</span>; i++)&#123;</span><br><span class="line">        QString btnName = <span class="built_in">QString</span>(<span class="string">&quot;pushButton%1&quot;</span>).<span class="built_in">arg</span>(i+<span class="number">1</span>);</span><br><span class="line">        <span class="comment">//findChild找某类型的控件对象</span></span><br><span class="line">        QPushButton* btn = <span class="built_in">findChild</span>&lt;QPushButton*&gt;(btnName);</span><br><span class="line">        <span class="keyword">if</span> (btn != <span class="literal">nullptr</span>) &#123;</span><br><span class="line">            <span class="comment">//设置pushbutton属性，为了在槽函数引用ID</span></span><br><span class="line">            btn-&gt;<span class="built_in">setProperty</span>(<span class="string">&quot;pushButtonId&quot;</span>, i+<span class="number">1</span>);</span><br><span class="line">            pushButtonList.<span class="built_in">append</span>(btn);</span><br><span class="line">            <span class="comment">//设置信号与槽</span></span><br><span class="line">            <span class="built_in">connect</span>(btn, &amp;QPushButton::clicked, <span class="keyword">this</span>, &amp;MainWindow::on_sendSerialTextCommand);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span></span><br><span class="line">    <span class="comment">//设置循环发送间隔默认值,单位ms</span></span><br><span class="line">    ui-&gt;xunhuanSpinBox-&gt;<span class="built_in">setValue</span>(<span class="number">1000</span>);</span><br><span class="line">    <span class="comment">//&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_xunhuanCheckBox_clicked</span><span class="params">(<span class="type">bool</span> checked)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (ui-&gt;xunhuanCheckBox-&gt;<span class="built_in">isChecked</span>())&#123;</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;循环发送数据槽函数, 是否勾选：&quot;</span> &lt;&lt; ui-&gt;xunhuanCheckBox-&gt;<span class="built_in">isChecked</span>();</span><br><span class="line">        <span class="comment">// while (true)&#123;</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;pushButtonList.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">            QPushButton* btnTmp = pushButtonList.<span class="built_in">at</span>(i);</span><br><span class="line">            emit btnTmp-&gt;<span class="built_in">clicked</span>();</span><br><span class="line">            QThread::<span class="built_in">msleep</span>(ui-&gt;xunhuanSpinBox-&gt;<span class="built_in">value</span>());<span class="comment">//不能在QT的UI线程中延时，否则导致UI页面刷新问题, 解决方案：1）定时器，2）多线程</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span></span><br></pre></td></tr></table></figure>
<p>不能在QT的UI线程中使用延时，否则导致UI页面刷新问题, 即页面卡住不更新，但是<code>on_xunhuanCheckBox_clicked</code>中的for循环不断执行着，当for循环执行完，UI页面才刷新内容, 解决方案：1）定时器，2）多线程</p>
<p><img src="/2025/02/24/QT-C/QT-C/image-20250516174104796.png" alt="image-20250516174104796"></p>
<ul>
<li>
<p>定时器</p>
<p>勾选槽函数<code>on_xunhuanCheckBox_clicked</code>：启动循环勾选时启动定时器，取消勾选关闭定时器并将pushbutton id置0。定时发送槽函数<code>xuhuanSend</code>：用定时器发送pushbutton click信号(这样序列命令发送槽函数被触发<code>on_sendSerialTextCommand</code>)和更新pushbutton id。</p>
  <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//mainwindow.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> MAINWINDOW_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAINWINDOW_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QMainWindow&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QSerialPort&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;comboxEvent.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QPushButton&gt;</span></span></span><br><span class="line"></span><br><span class="line">QT_BEGIN_NAMESPACE</span><br><span class="line"><span class="keyword">namespace</span> Ui &#123;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MainWindow</span>;</span><br><span class="line">&#125;</span><br><span class="line">QT_END_NAMESPACE</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MainWindow</span> : <span class="keyword">public</span> QMainWindow</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">MainWindow</span>(QWidget *parent = <span class="literal">nullptr</span>);</span><br><span class="line">    ~<span class="built_in">MainWindow</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> slots:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_closePushButton_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_sendPushButton_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">onSerialDataReadyToRead</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_timeSendCheckBox_clicked</span><span class="params">(<span class="type">bool</span> checked)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_clearPushButton_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_saveRevPushButton_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">refreshStatusTime</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_revTimeCheckBox_clicked</span><span class="params">(<span class="type">bool</span> checked)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_hexShowCheckBox_clicked</span><span class="params">(<span class="type">bool</span> checked)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_hideBoardPushButton_clicked</span><span class="params">(<span class="type">bool</span> checked)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_hideHisPushButton_clicked</span><span class="params">(<span class="type">bool</span> checked)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_chuanComboBox_refresh</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_sendSerialTextCommand</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">// void on_pushButton1_clicked();</span></span><br><span class="line">    <span class="comment">// void on_pushButton2_clicked();</span></span><br><span class="line">    <span class="comment">// void on_pushButton3_clicked();</span></span><br><span class="line">    <span class="comment">// void on_pushButton4_clicked();</span></span><br><span class="line">    <span class="comment">// void on_pushButton5_clicked();</span></span><br><span class="line">    <span class="comment">// void on_pushButton6_clicked();</span></span><br><span class="line">    <span class="comment">// void on_pushButton7_clicked();</span></span><br><span class="line">    <span class="comment">// void on_pushButton8_clicked();</span></span><br><span class="line">    <span class="comment">// void on_pushButton9_clicked();</span></span><br><span class="line">    <span class="comment">// void on_pushButton10_clicked();</span></span><br><span class="line">    <span class="comment">// void on_pushButton11_clicked();</span></span><br><span class="line">    <span class="comment">// void on_pushButton12_clicked();</span></span><br><span class="line">    <span class="comment">// void on_pushButton13_clicked();</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_xunhuanCheckBox_clicked</span><span class="params">(<span class="type">bool</span> checked)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">xuhuanSend</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Ui::MainWindow *ui;</span><br><span class="line">    <span class="comment">//定义串口对象</span></span><br><span class="line">    QSerialPort* serialPort;</span><br><span class="line">    <span class="comment">//状态栏写入的字符数</span></span><br><span class="line">    <span class="type">int</span> writeCount;</span><br><span class="line">    <span class="comment">//状态栏读取的字符数</span></span><br><span class="line">    <span class="type">int</span> readCount;</span><br><span class="line">    <span class="comment">//历史记录</span></span><br><span class="line">    QString sendHis;</span><br><span class="line">    <span class="comment">//定义串口是否打开</span></span><br><span class="line">    <span class="type">bool</span> isSerialPortOpen;</span><br><span class="line">    <span class="comment">//定时发送计时器</span></span><br><span class="line">    QTimer* timer;</span><br><span class="line">    <span class="comment">//显示时间格式</span></span><br><span class="line">    QString myTime;</span><br><span class="line">    <span class="comment">//定义是否勾选定时发送</span></span><br><span class="line">    <span class="type">bool</span> isTimeBoxChecked;</span><br><span class="line">    <span class="comment">//定义pushbutton数组</span></span><br><span class="line">    QList&lt;QPushButton*&gt; pushButtonList;</span><br><span class="line">    <span class="comment">//定义循环发送定时器</span></span><br><span class="line">    QTimer* xunhuanTimer;</span><br><span class="line">    <span class="comment">//循环发送计数</span></span><br><span class="line">    <span class="type">int</span> xunhuanCount;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">getSystemTime</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// MAINWINDOW_H</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
  <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//mainwindow.cpp</span></span><br><span class="line">MainWindow::<span class="built_in">MainWindow</span>(QWidget *parent)</span><br><span class="line">    : <span class="built_in">QMainWindow</span>(parent)</span><br><span class="line">    , <span class="built_in">ui</span>(<span class="keyword">new</span> Ui::MainWindow)</span><br><span class="line">&#123;</span><br><span class="line">    ui-&gt;<span class="built_in">setupUi</span>(<span class="keyword">this</span>);</span><br><span class="line">    <span class="comment">//窗口内容随窗口大小变化</span></span><br><span class="line">    ui-&gt;centralwidget-&gt;<span class="built_in">setLayout</span>(ui-&gt;windowGridLayout);<span class="comment">//ui-&gt;centralwidget</span></span><br><span class="line"><span class="comment">//&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;    </span></span><br><span class="line">    <span class="comment">//设置循环发送定时器</span></span><br><span class="line">    xunhuanTimer = <span class="keyword">new</span> <span class="built_in">QTimer</span>(<span class="keyword">this</span>);</span><br><span class="line">    xunhuanCount = <span class="number">0</span>;</span><br><span class="line"><span class="comment">//&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;    </span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i &lt; <span class="number">12</span>; i++)&#123;</span><br><span class="line">        QString btnName = <span class="built_in">QString</span>(<span class="string">&quot;pushButton%1&quot;</span>).<span class="built_in">arg</span>(i+<span class="number">1</span>);</span><br><span class="line">        <span class="comment">//findChild找某类型的控件对象</span></span><br><span class="line">        QPushButton* btn = <span class="built_in">findChild</span>&lt;QPushButton*&gt;(btnName);</span><br><span class="line">        <span class="keyword">if</span> (btn != <span class="literal">nullptr</span>) &#123;</span><br><span class="line">            <span class="comment">//设置pushbutton属性，为了在槽函数引用ID</span></span><br><span class="line">            btn-&gt;<span class="built_in">setProperty</span>(<span class="string">&quot;pushButtonId&quot;</span>, i+<span class="number">1</span>);</span><br><span class="line">            pushButtonList.<span class="built_in">append</span>(btn);</span><br><span class="line">            <span class="comment">//设置信号与槽</span></span><br><span class="line">            <span class="built_in">connect</span>(btn, &amp;QPushButton::clicked, <span class="keyword">this</span>, &amp;MainWindow::on_sendSerialTextCommand);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//设置循环发送间隔默认值,单位ms</span></span><br><span class="line">    ui-&gt;xunhuanSpinBox-&gt;<span class="built_in">setValue</span>(<span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置信号与槽</span></span><br><span class="line">    <span class="comment">//&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span></span><br><span class="line">    <span class="built_in">connect</span>(xunhuanTimer, &amp;QTimer::timeout, <span class="keyword">this</span>, &amp;MainWindow::xuhuanSend);</span><br><span class="line">		<span class="comment">//&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_xunhuanCheckBox_clicked</span><span class="params">(<span class="type">bool</span> checked)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (ui-&gt;xunhuanCheckBox-&gt;<span class="built_in">isChecked</span>())&#123;</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;循环发送数据槽函数, 是否勾选：&quot;</span> &lt;&lt; ui-&gt;xunhuanCheckBox-&gt;<span class="built_in">isChecked</span>();</span><br><span class="line">        xunhuanTimer-&gt;<span class="built_in">start</span>(ui-&gt;xunhuanSpinBox-&gt;<span class="built_in">value</span>());</span><br><span class="line">        </span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        xunhuanTimer-&gt;<span class="built_in">stop</span>();</span><br><span class="line">        xunhuanCount = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::xuhuanSend</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;循环发送数据定时槽函数&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (xunhuanCount &lt; pushButtonList.<span class="built_in">size</span>())&#123;</span><br><span class="line">        QPushButton* btnTmp = pushButtonList.<span class="built_in">at</span>(xunhuanCount);</span><br><span class="line">        emit btnTmp-&gt;<span class="built_in">clicked</span>();</span><br><span class="line">        xunhuanCount++;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        xunhuanCount = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>多线程</p>
<p>自定义一个线程类<code>CustomThread</code>，重写<code>run()</code>虚函数, 当自定义线程类对象<code>start()</code>时就会运行自定义<code>run()</code>函数发出自定义信号<code>threadTimeOut()</code>, 让UI类<code>MainWindow</code>对象捕获执行槽函数<code>xuhuanSend</code>。</p>
  <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//customThread.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> CUSTOMTHREAD_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CUSTOMTHREAD_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QThread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QWidget&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CustomThread</span> : <span class="keyword">public</span> QThread</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">CustomThread</span>(QWidget* parent);</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">run</span><span class="params">()</span> <span class="keyword">override</span></span>;</span><br><span class="line"></span><br><span class="line">signals:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">threadTimeOut</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// CUSTOMTHREAD_H</span></span></span><br></pre></td></tr></table></figure>
  <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//customThread.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;customThread.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">CustomThread::<span class="built_in">CustomThread</span>(QWidget *parent): <span class="built_in">QThread</span>(parent)</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">CustomThread::run</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">        <span class="built_in">msleep</span>(<span class="number">1000</span>);</span><br><span class="line">        <span class="function">emit <span class="title">threadTimeOut</span><span class="params">()</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
  <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//mainwindow.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> MAINWINDOW_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAINWINDOW_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QMainWindow&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QSerialPort&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;comboxEvent.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QPushButton&gt;</span></span></span><br><span class="line"><span class="comment">//&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;customThread.h&quot;</span></span></span><br><span class="line"><span class="comment">//&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span></span><br><span class="line"></span><br><span class="line">QT_BEGIN_NAMESPACE</span><br><span class="line"><span class="keyword">namespace</span> Ui &#123;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MainWindow</span>;</span><br><span class="line">&#125;</span><br><span class="line">QT_END_NAMESPACE</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MainWindow</span> : <span class="keyword">public</span> QMainWindow</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">MainWindow</span>(QWidget *parent = <span class="literal">nullptr</span>);</span><br><span class="line">    ~<span class="built_in">MainWindow</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> slots:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_closePushButton_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_sendPushButton_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">onSerialDataReadyToRead</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_timeSendCheckBox_clicked</span><span class="params">(<span class="type">bool</span> checked)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_clearPushButton_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_saveRevPushButton_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">refreshStatusTime</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_revTimeCheckBox_clicked</span><span class="params">(<span class="type">bool</span> checked)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_hexShowCheckBox_clicked</span><span class="params">(<span class="type">bool</span> checked)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_hideBoardPushButton_clicked</span><span class="params">(<span class="type">bool</span> checked)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_hideHisPushButton_clicked</span><span class="params">(<span class="type">bool</span> checked)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_chuanComboBox_refresh</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_sendSerialTextCommand</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">// void on_pushButton1_clicked();</span></span><br><span class="line">    <span class="comment">// void on_pushButton2_clicked();</span></span><br><span class="line">    <span class="comment">// void on_pushButton3_clicked();</span></span><br><span class="line">    <span class="comment">// void on_pushButton4_clicked();</span></span><br><span class="line">    <span class="comment">// void on_pushButton5_clicked();</span></span><br><span class="line">    <span class="comment">// void on_pushButton6_clicked();</span></span><br><span class="line">    <span class="comment">// void on_pushButton7_clicked();</span></span><br><span class="line">    <span class="comment">// void on_pushButton8_clicked();</span></span><br><span class="line">    <span class="comment">// void on_pushButton9_clicked();</span></span><br><span class="line">    <span class="comment">// void on_pushButton10_clicked();</span></span><br><span class="line">    <span class="comment">// void on_pushButton11_clicked();</span></span><br><span class="line">    <span class="comment">// void on_pushButton12_clicked();</span></span><br><span class="line">    <span class="comment">// void on_pushButton13_clicked();</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_xunhuanCheckBox_clicked</span><span class="params">(<span class="type">bool</span> checked)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">xuhuanSend</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Ui::MainWindow *ui;</span><br><span class="line">    <span class="comment">//定义串口对象</span></span><br><span class="line">    QSerialPort* serialPort;</span><br><span class="line">    <span class="comment">//状态栏写入的字符数</span></span><br><span class="line">    <span class="type">int</span> writeCount;</span><br><span class="line">    <span class="comment">//状态栏读取的字符数</span></span><br><span class="line">    <span class="type">int</span> readCount;</span><br><span class="line">    <span class="comment">//历史记录</span></span><br><span class="line">    QString sendHis;</span><br><span class="line">    <span class="comment">//定义串口是否打开</span></span><br><span class="line">    <span class="type">bool</span> isSerialPortOpen;</span><br><span class="line">    <span class="comment">//定时发送计时器</span></span><br><span class="line">    QTimer* timer;</span><br><span class="line">    <span class="comment">//显示时间格式</span></span><br><span class="line">    QString myTime;</span><br><span class="line">    <span class="comment">//定义是否勾选定时发送</span></span><br><span class="line">    <span class="type">bool</span> isTimeBoxChecked;</span><br><span class="line">    <span class="comment">//定义pushbutton数组</span></span><br><span class="line">    QList&lt;QPushButton*&gt; pushButtonList;</span><br><span class="line">    <span class="comment">//定义循环发送定时器</span></span><br><span class="line">    QTimer* xunhuanTimer;</span><br><span class="line">    <span class="comment">//循环发送计数</span></span><br><span class="line">    <span class="type">int</span> xunhuanCount;</span><br><span class="line">  	<span class="comment">//&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span></span><br><span class="line">    <span class="comment">//线程对象</span></span><br><span class="line">    CustomThread* myThread;</span><br><span class="line">  	<span class="comment">//&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">getSystemTime</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// MAINWINDOW_H</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
  <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//mainwindow.cpp</span></span><br><span class="line">MainWindow::<span class="built_in">MainWindow</span>(QWidget *parent)</span><br><span class="line">    : <span class="built_in">QMainWindow</span>(parent)</span><br><span class="line">    , <span class="built_in">ui</span>(<span class="keyword">new</span> Ui::MainWindow)</span><br><span class="line">&#123;</span><br><span class="line">    ui-&gt;<span class="built_in">setupUi</span>(<span class="keyword">this</span>);</span><br><span class="line">    <span class="comment">//窗口内容随窗口大小变化</span></span><br><span class="line">    ui-&gt;centralwidget-&gt;<span class="built_in">setLayout</span>(ui-&gt;windowGridLayout);<span class="comment">//ui-&gt;centralwidget</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//设置循环发送定时器</span></span><br><span class="line">    xunhuanTimer = <span class="keyword">new</span> <span class="built_in">QTimer</span>(<span class="keyword">this</span>);</span><br><span class="line">    xunhuanCount = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span></span><br><span class="line">    <span class="comment">//初始化线程对像</span></span><br><span class="line">    myThread = <span class="keyword">new</span> <span class="built_in">CustomThread</span>(<span class="keyword">this</span>);</span><br><span class="line">		<span class="comment">//&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span></span><br><span class="line">    <span class="comment">//设置初始化成员变量</span></span><br><span class="line">    isSerialPortOpen = <span class="literal">false</span>;</span><br><span class="line">    isTimeBoxChecked = <span class="literal">false</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i &lt; <span class="number">12</span>; i++)&#123;</span><br><span class="line">        QString btnName = <span class="built_in">QString</span>(<span class="string">&quot;pushButton%1&quot;</span>).<span class="built_in">arg</span>(i+<span class="number">1</span>);</span><br><span class="line">        <span class="comment">//findChild找某类型的控件对象</span></span><br><span class="line">        QPushButton* btn = <span class="built_in">findChild</span>&lt;QPushButton*&gt;(btnName);</span><br><span class="line">        <span class="keyword">if</span> (btn != <span class="literal">nullptr</span>) &#123;</span><br><span class="line">            <span class="comment">//设置pushbutton属性，为了在槽函数引用ID</span></span><br><span class="line">            btn-&gt;<span class="built_in">setProperty</span>(<span class="string">&quot;pushButtonId&quot;</span>, i+<span class="number">1</span>);</span><br><span class="line">            pushButtonList.<span class="built_in">append</span>(btn);</span><br><span class="line">            <span class="comment">//设置信号与槽</span></span><br><span class="line">            <span class="built_in">connect</span>(btn, &amp;QPushButton::clicked, <span class="keyword">this</span>, &amp;MainWindow::on_sendSerialTextCommand);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//设置循环发送间隔默认值,单位ms</span></span><br><span class="line">    ui-&gt;xunhuanSpinBox-&gt;<span class="built_in">setValue</span>(<span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置信号与槽</span></span><br><span class="line">    <span class="comment">//&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span></span><br><span class="line">    <span class="built_in">connect</span>(myThread, &amp;CustomThread::threadTimeOut, <span class="keyword">this</span>, &amp;MainWindow::xuhuanSend);</span><br><span class="line">		<span class="comment">//&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_sendSerialTextCommand</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//sender()获取信号发出的控件</span></span><br><span class="line">    QPushButton* btn = <span class="built_in">qobject_cast</span>&lt;QPushButton*&gt;(<span class="built_in">sender</span>());</span><br><span class="line">    <span class="comment">//lineEdit控件</span></span><br><span class="line">    QString lineEditString = <span class="built_in">QString</span>(<span class="string">&quot;lineEdit&quot;</span>) + btn-&gt;<span class="built_in">property</span>(<span class="string">&quot;pushButtonId&quot;</span>).<span class="built_in">toString</span>();</span><br><span class="line">    QLineEdit* lineEdit = <span class="built_in">findChild</span>&lt;QLineEdit*&gt;(lineEditString);</span><br><span class="line">    <span class="comment">//checkBox控件</span></span><br><span class="line">    QString checkBoxString = <span class="built_in">QString</span>(<span class="string">&quot;checkBox&quot;</span>) + btn-&gt;<span class="built_in">property</span>(<span class="string">&quot;pushButtonId&quot;</span>).<span class="built_in">toString</span>();</span><br><span class="line">    QCheckBox* checkBox = <span class="built_in">findChild</span>&lt;QCheckBox*&gt;(checkBoxString);</span><br><span class="line">    <span class="comment">//业务逻辑</span></span><br><span class="line">    <span class="keyword">if</span> (lineEdit-&gt;<span class="built_in">text</span>().<span class="built_in">size</span>() &lt;= <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ui-&gt;sendLineEdit-&gt;<span class="built_in">setText</span>(lineEdit-&gt;<span class="built_in">text</span>());</span><br><span class="line">    ui-&gt;HexSendCheckBox-&gt;<span class="built_in">setChecked</span>(checkBox-&gt;<span class="built_in">isChecked</span>());</span><br><span class="line">    <span class="built_in">on_sendPushButton_clicked</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_xunhuanCheckBox_clicked</span><span class="params">(<span class="type">bool</span> checked)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (ui-&gt;xunhuanCheckBox-&gt;<span class="built_in">isChecked</span>())&#123;</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;循环发送数据槽函数, 是否勾选：&quot;</span> &lt;&lt; ui-&gt;xunhuanCheckBox-&gt;<span class="built_in">isChecked</span>();</span><br><span class="line">        ui-&gt;xunhuanSpinBox-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">      	<span class="comment">//&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span></span><br><span class="line">        <span class="comment">// xunhuanTimer-&gt;start(ui-&gt;xunhuanSpinBox-&gt;value());</span></span><br><span class="line">        myThread-&gt;<span class="built_in">start</span>();</span><br><span class="line">        <span class="comment">//&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      	<span class="comment">//&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span></span><br><span class="line">        <span class="comment">// xunhuanTimer-&gt;stop();</span></span><br><span class="line">        <span class="comment">// myThread-&gt;deleteLater();</span></span><br><span class="line">        myThread-&gt;<span class="built_in">terminate</span>();</span><br><span class="line">      	<span class="comment">//&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span></span><br><span class="line">        ui-&gt;xunhuanSpinBox-&gt;<span class="built_in">setEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">        xunhuanCount = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::xuhuanSend</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;循环发送数据定时槽函数&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (xunhuanCount &lt; pushButtonList.<span class="built_in">size</span>())&#123;</span><br><span class="line">        QPushButton* btnTmp = pushButtonList.<span class="built_in">at</span>(xunhuanCount);</span><br><span class="line">        emit btnTmp-&gt;<span class="built_in">clicked</span>();</span><br><span class="line">        xunhuanCount++;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        xunhuanCount = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="重置pushButton"><strong>重置pushButton</strong></h4>
<pre><code>* 对话框提示
* 遍历lineEdit和checkBox
* 对话框yes和no用中文

<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//mainwindow.cpp</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_resetPushButton_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    QMessageBox msgBox;</span><br><span class="line">    msgBox.<span class="built_in">setWindowTitle</span>(<span class="string">&quot;提示&quot;</span>);</span><br><span class="line">    msgBox.<span class="built_in">setIcon</span>(QMessageBox::Question);</span><br><span class="line">    msgBox.<span class="built_in">setText</span>(<span class="string">&quot;重置列表不可逆，确认是否重置？&quot;</span>);</span><br><span class="line">    <span class="comment">// msgBox.setStandardButtons(QMessageBox::Yes | QMessageBox::No);</span></span><br><span class="line">    QPushButton* yesButton = msgBox.<span class="built_in">addButton</span>(<span class="string">&quot;是&quot;</span>, QMessageBox::YesRole);</span><br><span class="line">    QPushButton* noButton = msgBox.<span class="built_in">addButton</span>(<span class="string">&quot;否&quot;</span>, QMessageBox::NoRole);</span><br><span class="line">    <span class="type">int</span> ret = msgBox.<span class="built_in">exec</span>();</span><br><span class="line">    <span class="keyword">if</span> (msgBox.<span class="built_in">clickedButton</span>() == yesButton) &#123;</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;重置列表&quot;</span>;</span><br><span class="line">        <span class="comment">//遍历lineEdit,清空内容</span></span><br><span class="line">        <span class="comment">//遍历checkBox,取消勾选</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i &lt; pushButtonList.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">            QPushButton* btn = pushButtonList.<span class="built_in">at</span>(i);</span><br><span class="line">            <span class="comment">//lineEdit控件</span></span><br><span class="line">            QString lineEditString = <span class="built_in">QString</span>(<span class="string">&quot;lineEdit&quot;</span>) + btn-&gt;<span class="built_in">property</span>(<span class="string">&quot;pushButtonId&quot;</span>).<span class="built_in">toString</span>();</span><br><span class="line">            QLineEdit* lineEdit = <span class="built_in">findChild</span>&lt;QLineEdit*&gt;(lineEditString);</span><br><span class="line">            lineEdit-&gt;<span class="built_in">clear</span>();</span><br><span class="line">            <span class="comment">//checkBox控件</span></span><br><span class="line">            QString checkBoxString = <span class="built_in">QString</span>(<span class="string">&quot;checkBox&quot;</span>) + btn-&gt;<span class="built_in">property</span>(<span class="string">&quot;pushButtonId&quot;</span>).<span class="built_in">toString</span>();</span><br><span class="line">            QCheckBox* checkBox = <span class="built_in">findChild</span>&lt;QCheckBox*&gt;(checkBoxString);</span><br><span class="line">            checkBox-&gt;<span class="built_in">setChecked</span>(<span class="literal">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (msgBox.<span class="built_in">clickedButton</span>() == noButton) &#123;</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;取消重置列表&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</code></pre>
<h4 id="保存-载入pushButton-命令字符串"><strong>保存/载入pushButton 命令字符串</strong></h4>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//mainwindow.cpp</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//保存</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_loadPushButton_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">QFileDialog <span class="title">fileDialog</span><span class="params">(<span class="keyword">this</span>)</span></span>;</span><br><span class="line">    fileDialog.<span class="built_in">setFileMode</span>(QFileDialog::AnyFile);</span><br><span class="line">    QString fileName = fileDialog.<span class="built_in">getSaveFileName</span>(<span class="keyword">this</span>, <span class="built_in">tr</span>(<span class="string">&quot;Save File&quot;</span>), <span class="string">&quot;./&quot;</span>, <span class="built_in">tr</span>(<span class="string">&quot;All Files (*)&quot;</span>));</span><br><span class="line">    <span class="function">QFile <span class="title">file</span><span class="params">(fileName)</span></span>;</span><br><span class="line">    <span class="type">bool</span> fileFlag = file.<span class="built_in">open</span>(QIODevice::WriteOnly | QIODevice::Text);</span><br><span class="line">    <span class="keyword">if</span> (!fileFlag) &#123;</span><br><span class="line">        QMessageBox::<span class="built_in">warning</span>(<span class="keyword">this</span>, <span class="built_in">tr</span>(<span class="string">&quot;Error&quot;</span>), <span class="built_in">tr</span>(<span class="string">&quot;Cannot open file for writing: %1&quot;</span>).<span class="built_in">arg</span>(file.<span class="built_in">errorString</span>()));</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">QTextStream <span class="title">out</span><span class="params">(&amp;file)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;pushButtonList.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">        QPushButton* btn = pushButtonList.<span class="built_in">at</span>(i);</span><br><span class="line">        <span class="comment">//lineEdit控件</span></span><br><span class="line">        QString lineEditString = <span class="built_in">QString</span>(<span class="string">&quot;lineEdit&quot;</span>) + btn-&gt;<span class="built_in">property</span>(<span class="string">&quot;pushButtonId&quot;</span>).<span class="built_in">toString</span>();</span><br><span class="line">        QLineEdit* lineEdit = <span class="built_in">findChild</span>&lt;QLineEdit*&gt;(lineEditString);</span><br><span class="line">        QString checkBoxString = <span class="built_in">QString</span>(<span class="string">&quot;checkBox&quot;</span>) + btn-&gt;<span class="built_in">property</span>(<span class="string">&quot;pushButtonId&quot;</span>).<span class="built_in">toString</span>();</span><br><span class="line">        QCheckBox* checkBox = <span class="built_in">findChild</span>&lt;QCheckBox*&gt;(checkBoxString);</span><br><span class="line">        out &lt;&lt; checkBox-&gt;<span class="built_in">isChecked</span>() &lt;&lt; <span class="string">&#x27;,&#x27;</span> &lt;&lt; lineEdit-&gt;<span class="built_in">text</span>() &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    file.<span class="built_in">close</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//载入</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_savePushButton_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">QFileDialog <span class="title">fileDialog</span><span class="params">(<span class="keyword">this</span>)</span></span>;</span><br><span class="line">    fileDialog.<span class="built_in">setFileMode</span>(QFileDialog::AnyFile);</span><br><span class="line">    QString fileName = fileDialog.<span class="built_in">getOpenFileName</span>(<span class="keyword">this</span>, <span class="built_in">tr</span>(<span class="string">&quot;Open File&quot;</span>), <span class="string">&quot;./&quot;</span>, <span class="built_in">tr</span>(<span class="string">&quot;All Files (*)&quot;</span>));</span><br><span class="line">    <span class="function">QFile <span class="title">file</span><span class="params">(fileName)</span></span>;</span><br><span class="line">    <span class="type">bool</span> fileFlag = file.<span class="built_in">open</span>(QIODevice::ReadOnly | QIODevice::Text);</span><br><span class="line">    <span class="keyword">if</span> (!fileFlag) &#123;</span><br><span class="line">        QMessageBox::<span class="built_in">warning</span>(<span class="keyword">this</span>, <span class="built_in">tr</span>(<span class="string">&quot;Error&quot;</span>), <span class="built_in">tr</span>(<span class="string">&quot;Cannot open file for writing: %1&quot;</span>).<span class="built_in">arg</span>(file.<span class="built_in">errorString</span>()));</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">QTextStream <span class="title">in</span><span class="params">(&amp;file)</span></span>;</span><br><span class="line">    <span class="type">int</span> lineCount = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (!in.<span class="built_in">atEnd</span>() &amp;&amp; lineCount &lt; pushButtonList.<span class="built_in">size</span>())&#123;</span><br><span class="line">        lineCount++;</span><br><span class="line">        QString line = in.<span class="built_in">readLine</span>();</span><br><span class="line">        QStringList list = line.<span class="built_in">split</span>(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (list.<span class="built_in">size</span>() != <span class="number">2</span>)&#123;</span><br><span class="line">            QMessageBox::<span class="built_in">warning</span>(<span class="keyword">this</span>, <span class="built_in">tr</span>(<span class="string">&quot;Error&quot;</span>), <span class="built_in">tr</span>(<span class="string">&quot;文档格式错误&quot;</span>));</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">bool</span> checkBoxChecked = list.<span class="built_in">at</span>(<span class="number">0</span>).<span class="built_in">toInt</span>();</span><br><span class="line">        QString lineEditText = list.<span class="built_in">at</span>(<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="comment">//lineEdit控件</span></span><br><span class="line">            QString lineEditString = <span class="built_in">QString</span>(<span class="string">&quot;lineEdit&quot;</span>) + QString::<span class="built_in">number</span>(lineCount);</span><br><span class="line">            QLineEdit* lineEdit = <span class="built_in">findChild</span>&lt;QLineEdit*&gt;(lineEditString);</span><br><span class="line">            lineEdit-&gt;<span class="built_in">setText</span>(lineEditText);</span><br><span class="line">            <span class="comment">//checkBox控件</span></span><br><span class="line">            QString checkBoxString = <span class="built_in">QString</span>(<span class="string">&quot;checkBox&quot;</span>) + QString::<span class="built_in">number</span>(lineCount);</span><br><span class="line">            QCheckBox* checkBox = <span class="built_in">findChild</span>&lt;QCheckBox*&gt;(checkBoxString);</span><br><span class="line">            checkBox-&gt;<span class="built_in">setChecked</span>(checkBoxChecked);</span><br><span class="line">        &#125;<span class="built_in">catch</span> (std::exception&amp; e)&#123;</span><br><span class="line">            QMessageBox::<span class="built_in">warning</span>(<span class="keyword">this</span>, <span class="built_in">tr</span>(<span class="string">&quot;Error&quot;</span>), <span class="built_in">tr</span>(<span class="string">&quot;载入文档的数据行超过窗口设定行&quot;</span>));</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;<span class="built_in">catch</span> (...)&#123;</span><br><span class="line">            QMessageBox::<span class="built_in">warning</span>(<span class="keyword">this</span>, <span class="built_in">tr</span>(<span class="string">&quot;Error&quot;</span>), <span class="built_in">tr</span>(<span class="string">&quot;未知错误&quot;</span>));</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    file.<span class="built_in">close</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="显示框中内容过多时显示的内容不在最新位置"><strong>显示框中内容过多时显示的内容不在最新位置</strong></h4>
<ul>
<li>光标移动到文档末尾</li>
<li>光标可视化</li>
<li>光标焦点（更新太快的话会影响光标点其他地方，响应不过来）</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//mainwindow.cpp</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_sendPushButton_clicked</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> writeCount = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;发送数据槽函数&quot;</span>;</span><br><span class="line">    <span class="comment">//获取发送数据</span></span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;ui框中数据:&quot;</span> &lt;&lt; ui-&gt;sendLineEdit-&gt;<span class="built_in">text</span>();</span><br><span class="line">    QString sendData = ui-&gt;sendLineEdit-&gt;<span class="built_in">text</span>();</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;串口对象写入的数据:&quot;</span> &lt;&lt; sendData.<span class="built_in">toUtf8</span>();</span><br><span class="line">    <span class="comment">//发送数据</span></span><br><span class="line">    <span class="keyword">if</span> (ui-&gt;HexSendCheckBox-&gt;<span class="built_in">isChecked</span>())&#123;</span><br><span class="line">        QByteArray sendDataHex = sendData.<span class="built_in">toUtf8</span>();</span><br><span class="line">        <span class="comment">//检测输入Hex是否符合Hex的位数为偶数</span></span><br><span class="line">        <span class="keyword">if</span> (sendData.<span class="built_in">size</span>() % <span class="number">2</span> != <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="comment">//状态栏</span></span><br><span class="line">            QFont font = ui-&gt;statusLabel-&gt;<span class="built_in">font</span>();</span><br><span class="line">            font.<span class="built_in">setBold</span>(<span class="literal">true</span>);</span><br><span class="line">            ui-&gt;statusLabel-&gt;<span class="built_in">setFont</span>(font);</span><br><span class="line">            ui-&gt;statusLabel-&gt;<span class="built_in">setText</span>(<span class="string">&quot;Hex Odd!&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//检测输入Hex是否符合Hex的取值范围</span></span><br><span class="line">        <span class="keyword">for</span> (QChar a: sendData)&#123;</span><br><span class="line">            <span class="keyword">if</span> (!(a.<span class="built_in">isDigit</span>() || (a &gt;= <span class="string">&#x27;A&#x27;</span> &amp;&amp; a &lt;= <span class="string">&#x27;F&#x27;</span>) || (a &gt;= <span class="string">&#x27;a&#x27;</span> &amp;&amp; a &lt;= <span class="string">&#x27;f&#x27;</span>)))&#123;</span><br><span class="line">                <span class="comment">//不合法</span></span><br><span class="line">                <span class="comment">//状态栏</span></span><br><span class="line">                QFont font = ui-&gt;statusLabel-&gt;<span class="built_in">font</span>();</span><br><span class="line">                font.<span class="built_in">setBold</span>(<span class="literal">true</span>);</span><br><span class="line">                ui-&gt;statusLabel-&gt;<span class="built_in">setFont</span>(font);</span><br><span class="line">                ui-&gt;statusLabel-&gt;<span class="built_in">setText</span>(<span class="string">&quot;Hex Out of Range!&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//将Hex编码转成ASSII编码</span></span><br><span class="line">        writeCount = serialPort-&gt;<span class="built_in">write</span>(QByteArray::<span class="built_in">fromHex</span>(sendDataHex));</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        writeCount = serialPort-&gt;<span class="built_in">write</span>(sendData.<span class="built_in">toUtf8</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (writeCount == <span class="number">-1</span>)&#123;</span><br><span class="line">        <span class="comment">//状态栏</span></span><br><span class="line">        QFont font = ui-&gt;statusLabel-&gt;<span class="built_in">font</span>();</span><br><span class="line">        font.<span class="built_in">setBold</span>(<span class="literal">true</span>);</span><br><span class="line">        ui-&gt;statusLabel-&gt;<span class="built_in">setFont</span>(font);</span><br><span class="line">        ui-&gt;statusLabel-&gt;<span class="built_in">setText</span>(<span class="string">&quot;Send Failed!&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">//状态栏</span></span><br><span class="line">        <span class="keyword">this</span>-&gt;writeCount += writeCount;</span><br><span class="line">        QFont font = ui-&gt;statusLabel-&gt;<span class="built_in">font</span>();</span><br><span class="line">        font.<span class="built_in">setBold</span>(<span class="literal">true</span>);</span><br><span class="line">        ui-&gt;statusLabel-&gt;<span class="built_in">setFont</span>(font);</span><br><span class="line">        ui-&gt;statusLabel-&gt;<span class="built_in">setText</span>(<span class="string">&quot;Send OK!&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        ui-&gt;sentLabel-&gt;<span class="built_in">setText</span>(<span class="built_in">QString</span>(<span class="string">&quot;Sent: %1&quot;</span>).<span class="built_in">arg</span>(<span class="keyword">this</span>-&gt;writeCount)); <span class="comment">// setNum(this-&gt;writeCount);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//***************************************************** */</span></span><br><span class="line">    <span class="comment">//模拟串口自发自收</span></span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;接收数据槽函数&quot;</span>;</span><br><span class="line">    <span class="comment">//读取数据</span></span><br><span class="line">    <span class="comment">// QByteArray data = ui-&gt;sendLineEdit-&gt;text(); //serialPort-&gt;readAll();</span></span><br><span class="line">    <span class="comment">// qDebug() &lt;&lt; &quot;串口对象读取的Byte数据:&quot; &lt;&lt; data;</span></span><br><span class="line">    <span class="comment">// QString revMessage = QString::fromUtf8(data);</span></span><br><span class="line">    <span class="comment">// qDebug() &lt;&lt; &quot;串口对象读取的string数据:&quot; &lt;&lt; revMessage;</span></span><br><span class="line">    QString revMessage = ui-&gt;sendLineEdit-&gt;<span class="built_in">text</span>();</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;串口对象读取的string数据:&quot;</span> &lt;&lt; revMessage;</span><br><span class="line">    <span class="comment">//在HexBox选中状态下输入ASSII格式转成Hex格式</span></span><br><span class="line">    <span class="keyword">if</span> (ui-&gt;hexShowCheckBox-&gt;<span class="built_in">checkState</span>() == Qt::Checked &amp;&amp; ui-&gt;HexSendCheckBox-&gt;<span class="built_in">isChecked</span>() == <span class="literal">false</span>)&#123;</span><br><span class="line">        <span class="comment">//添加换行符</span></span><br><span class="line">        <span class="keyword">if</span> (ui-&gt;nextLineCheckBox-&gt;<span class="built_in">isChecked</span>())&#123;</span><br><span class="line">            revMessage = <span class="string">&quot;\n&quot;</span> + revMessage;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (ui-&gt;newLineSendCheckBox-&gt;<span class="built_in">isChecked</span>())&#123;</span><br><span class="line">            revMessage = revMessage + <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//ASSIIQString转QByteArray</span></span><br><span class="line">        QByteArray tmpByteArray = revMessage.<span class="built_in">toUtf8</span>();</span><br><span class="line">        <span class="comment">//ASSIIQByteArray转成16进制QByteArray</span></span><br><span class="line">        QByteArray tmpHex = tmpByteArray.<span class="built_in">toHex</span>();</span><br><span class="line">        <span class="comment">//16进制QByteArray转成QString</span></span><br><span class="line">        revMessage = QString::<span class="built_in">fromUtf8</span>(tmpHex).<span class="built_in">toUpper</span>();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (ui-&gt;hexShowCheckBox-&gt;<span class="built_in">isChecked</span>() == <span class="literal">false</span> &amp;&amp; ui-&gt;HexSendCheckBox-&gt;<span class="built_in">isChecked</span>() == <span class="literal">false</span>)&#123;</span><br><span class="line">        <span class="comment">//添加换行符</span></span><br><span class="line">        <span class="keyword">if</span> (ui-&gt;nextLineCheckBox-&gt;<span class="built_in">isChecked</span>())&#123;</span><br><span class="line">            revMessage = <span class="string">&quot;\n&quot;</span> + revMessage;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (ui-&gt;newLineSendCheckBox-&gt;<span class="built_in">isChecked</span>())&#123;</span><br><span class="line">            revMessage = revMessage + <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (ui-&gt;hexShowCheckBox-&gt;<span class="built_in">isChecked</span>() == <span class="literal">true</span> &amp;&amp; ui-&gt;HexSendCheckBox-&gt;<span class="built_in">isChecked</span>() == <span class="literal">true</span>)&#123;</span><br><span class="line">        <span class="comment">//添加换行符</span></span><br><span class="line">        QString newLine = <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="comment">//ASSIIQString转QByteArray</span></span><br><span class="line">        QByteArray tmpByteArray = newLine.<span class="built_in">toUtf8</span>();</span><br><span class="line">        <span class="comment">//ASSIIQByteArray转成16进制QByteArray</span></span><br><span class="line">        QByteArray tmpHex = tmpByteArray.<span class="built_in">toHex</span>();</span><br><span class="line">        <span class="keyword">if</span> (ui-&gt;nextLineCheckBox-&gt;<span class="built_in">isChecked</span>())&#123;</span><br><span class="line">            <span class="comment">//16进制QByteArray转成QString</span></span><br><span class="line">            revMessage = QString::<span class="built_in">fromUtf8</span>(tmpHex) + revMessage;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (ui-&gt;newLineSendCheckBox-&gt;<span class="built_in">isChecked</span>())&#123;</span><br><span class="line">            revMessage = revMessage + QString::<span class="built_in">fromUtf8</span>(tmpHex);</span><br><span class="line">        &#125;</span><br><span class="line">        revMessage = revMessage.<span class="built_in">toUpper</span>();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (ui-&gt;hexShowCheckBox-&gt;<span class="built_in">isChecked</span>() == <span class="literal">false</span> &amp;&amp; ui-&gt;HexSendCheckBox-&gt;<span class="built_in">isChecked</span>() == <span class="literal">true</span>)&#123;</span><br><span class="line">        <span class="comment">//添加换行符</span></span><br><span class="line">        QString newLine = <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="comment">//ASSIIQString转QByteArray</span></span><br><span class="line">        QByteArray tmpByteArray = newLine.<span class="built_in">toUtf8</span>();</span><br><span class="line">        <span class="comment">//ASSIIQByteArray转成16进制QByteArray</span></span><br><span class="line">        QByteArray tmpHex = tmpByteArray.<span class="built_in">toHex</span>();</span><br><span class="line">        <span class="keyword">if</span> (ui-&gt;nextLineCheckBox-&gt;<span class="built_in">isChecked</span>())&#123;</span><br><span class="line">            <span class="comment">//16进制QByteArray转成QString</span></span><br><span class="line">            revMessage = QString::<span class="built_in">fromUtf8</span>(tmpHex) + revMessage;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (ui-&gt;newLineSendCheckBox-&gt;<span class="built_in">isChecked</span>())&#123;</span><br><span class="line">            revMessage = revMessage + QString::<span class="built_in">fromUtf8</span>(tmpHex);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//将Hex解码转成ASSII解码</span></span><br><span class="line">        revMessage = QString::<span class="built_in">fromUtf8</span>(QByteArray::<span class="built_in">fromHex</span>(revMessage.<span class="built_in">toUtf8</span>()));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//显示在ui框中</span></span><br><span class="line">    <span class="keyword">if</span> (isTimeBoxChecked)&#123;</span><br><span class="line">        <span class="comment">//添加时间戳</span></span><br><span class="line">        <span class="built_in">getSystemTime</span>();</span><br><span class="line">        QString revTimeFormatMessage = <span class="string">&quot;【&quot;</span> + myTime + <span class="string">&quot;】 &quot;</span> + revMessage;</span><br><span class="line">        <span class="comment">// ui-&gt;textEdit-&gt;append(revTimeFormatMessage);</span></span><br><span class="line">        ui-&gt;textEdit-&gt;<span class="built_in">insertPlainText</span>(revTimeFormatMessage);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">// ui-&gt;textEdit-&gt;append(revMessage);</span></span><br><span class="line">        ui-&gt;textEdit-&gt;<span class="built_in">insertPlainText</span>(revMessage);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//****************************************************** */</span></span><br><span class="line">    <span class="comment">//状态栏</span></span><br><span class="line">    <span class="keyword">if</span> (writeCount != <span class="number">-1</span>)&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;readCount += revMessage.<span class="built_in">toUtf8</span>().<span class="built_in">size</span>();</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;串口对象读取的字节数据:&quot;</span> &lt;&lt; revMessage.<span class="built_in">toUtf8</span>();</span><br><span class="line">        ui-&gt;RevLabel-&gt;<span class="built_in">setText</span>(<span class="built_in">QString</span>(<span class="string">&quot;Received: %1&quot;</span>).<span class="built_in">arg</span>(<span class="keyword">this</span>-&gt;readCount)); <span class="comment">//setNum(this-&gt;readCount);</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">//在HexBox选中状态下使用输入的ASSII作为revMessage,而非Hex作为revMessage</span></span><br><span class="line">        <span class="keyword">if</span> (ui-&gt;hexShowCheckBox-&gt;<span class="built_in">checkState</span>() == Qt::Checked &amp;&amp; ui-&gt;HexSendCheckBox-&gt;<span class="built_in">isChecked</span>() == <span class="literal">false</span>)&#123;</span><br><span class="line">            revMessage = ui-&gt;sendLineEdit-&gt;<span class="built_in">text</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (ui-&gt;hexShowCheckBox-&gt;<span class="built_in">isChecked</span>() == <span class="literal">false</span> &amp;&amp; ui-&gt;HexSendCheckBox-&gt;<span class="built_in">isChecked</span>() == <span class="literal">false</span>)&#123;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (ui-&gt;hexShowCheckBox-&gt;<span class="built_in">isChecked</span>() == <span class="literal">true</span> &amp;&amp; ui-&gt;HexSendCheckBox-&gt;<span class="built_in">isChecked</span>() == <span class="literal">true</span>)&#123;</span><br><span class="line">            revMessage = QString::<span class="built_in">fromUtf8</span>(QByteArray::<span class="built_in">fromHex</span>(ui-&gt;sendLineEdit-&gt;<span class="built_in">text</span>().<span class="built_in">toUtf8</span>()));</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (ui-&gt;hexShowCheckBox-&gt;<span class="built_in">isChecked</span>() == <span class="literal">false</span> &amp;&amp; ui-&gt;HexSendCheckBox-&gt;<span class="built_in">isChecked</span>() == <span class="literal">true</span>)&#123;</span><br><span class="line">            <span class="comment">//将Hex解码转成ASSII解码</span></span><br><span class="line">            revMessage = QString::<span class="built_in">fromUtf8</span>(QByteArray::<span class="built_in">fromHex</span>(ui-&gt;sendLineEdit-&gt;<span class="built_in">text</span>().<span class="built_in">toUtf8</span>()));</span><br><span class="line">        &#125; </span><br><span class="line">        <span class="comment">//显示在历史ui框中</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>-&gt;sendHis != revMessage)&#123;</span><br><span class="line">            <span class="keyword">this</span>-&gt;sendHis = revMessage;</span><br><span class="line">            ui-&gt;textEditHis-&gt;<span class="built_in">append</span>(revMessage);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span></span><br><span class="line">        <span class="comment">//光标位于文本框最新位置</span></span><br><span class="line">        ui-&gt;textEdit-&gt;<span class="built_in">moveCursor</span>(QTextCursor::End);</span><br><span class="line">        ui-&gt;textEditHis-&gt;<span class="built_in">moveCursor</span>(QTextCursor::End);</span><br><span class="line">        <span class="comment">//光标可视化</span></span><br><span class="line">        ui-&gt;textEdit-&gt;<span class="built_in">ensureCursorVisible</span>();</span><br><span class="line">        ui-&gt;textEditHis-&gt;<span class="built_in">ensureCursorVisible</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span></span><br></pre></td></tr></table></figure>
<h2 id="网络调试助手">网络调试助手</h2>
<h3 id="项目概述">项目概述</h3>
<ul>
<li>网络基础概念</li>
<li>QTcpServer</li>
<li>QTcpClient</li>
<li>TextEdit特定位置输入文字颜色</li>
<li>网络通信相关知识</li>
<li>复习UI控件</li>
</ul>
<p><img src="/2025/02/24/QT-C/QT-C/image-20250523192421864.png" alt="image-20250523192421864" style="zoom: 25%;">      <img src="/2025/02/24/QT-C/QT-C/image-20250523192322422.png" alt="image-20250523192322422" style="zoom:33%;"></p>
<h3 id="开发流程">开发流程</h3>
<p><img src="/2025/02/24/QT-C/QT-C/image-20250519175206691.png" alt="image-20250519175206691"></p>
<h4 id="建立服务器对像、开始监听和newConnect信号"><strong>建立服务器对像、开始监听和newConnect信号</strong></h4>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//mainwindow.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> MAINWINDOW_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAINWINDOW_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QMainWindow&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QTcpServer&gt;</span></span></span><br><span class="line"></span><br><span class="line">QT_BEGIN_NAMESPACE</span><br><span class="line"><span class="keyword">namespace</span> Ui &#123;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MainWindow</span>;</span><br><span class="line">&#125;</span><br><span class="line">QT_END_NAMESPACE</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MainWindow</span> : <span class="keyword">public</span> QMainWindow</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">MainWindow</span>(QWidget *parent = <span class="literal">nullptr</span>);</span><br><span class="line">    ~<span class="built_in">MainWindow</span>();</span><br><span class="line">		<span class="comment">//服务器对象</span></span><br><span class="line">    QTcpServer* server;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Ui::MainWindow *ui;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> slots:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_newClient_connect</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_startPushButton_clicked</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// MAINWINDOW_H</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//mainwindow.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;mainwindow.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ui_mainwindow.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QTcpSocket&gt;</span></span></span><br><span class="line"></span><br><span class="line">MainWindow::<span class="built_in">MainWindow</span>(QWidget *parent)</span><br><span class="line">    : <span class="built_in">QMainWindow</span>(parent)</span><br><span class="line">      , <span class="built_in">ui</span>(<span class="keyword">new</span> Ui::MainWindow) &#123;</span><br><span class="line">    ui-&gt;<span class="built_in">setupUi</span>(<span class="keyword">this</span>);</span><br><span class="line">    ui-&gt;centralwidget-&gt;<span class="built_in">setLayout</span>(ui-&gt;widgetVL);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    server = <span class="keyword">new</span> <span class="built_in">QTcpServer</span>(<span class="keyword">this</span>);</span><br><span class="line">    <span class="comment">// //监听</span></span><br><span class="line">    <span class="comment">// QHostAddress host(&quot;192.168.1.9&quot;);</span></span><br><span class="line">    <span class="comment">// if (!server-&gt;listen(host, 8888)) &#123;</span></span><br><span class="line">    <span class="comment">//     qDebug() &lt;&lt; &quot;Server listen failed&quot;;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    <span class="comment">//按键初始设置为不可按</span></span><br><span class="line">    ui-&gt;stopPushButton-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">    ui-&gt;interruptPushButton-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">    <span class="comment">//信号与槽</span></span><br><span class="line">    <span class="built_in">connect</span>(server, &amp;QTcpServer::newConnection, <span class="keyword">this</span>, &amp;MainWindow::on_newClient_connect);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MainWindow::~<span class="built_in">MainWindow</span>() &#123;</span><br><span class="line">    <span class="keyword">delete</span> ui;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_newClient_connect</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;有新客户端连接&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (server-&gt;<span class="built_in">hasPendingConnections</span>()) &#123;</span><br><span class="line">        QTcpSocket *socket = server-&gt;<span class="built_in">nextPendingConnection</span>();</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;Client host: &quot;</span> &lt;&lt; socket-&gt;<span class="built_in">peerAddress</span>().<span class="built_in">toString</span>() &lt;&lt; <span class="string">&quot; port: &quot;</span> &lt;&lt; socket-&gt;<span class="built_in">peerPort</span>();</span><br><span class="line">        ui-&gt;showTextEdit-&gt;<span class="built_in">insertPlainText</span>(<span class="string">&quot;客户端地址：&quot;</span>+socket-&gt;<span class="built_in">peerAddress</span>().<span class="built_in">toString</span>()+<span class="string">&quot;, 客户端端口：&quot;</span>+QString::<span class="built_in">number</span>(socket-&gt;<span class="built_in">peerPort</span>()));</span><br><span class="line">    &#125;</span><br><span class="line">  	<span class="comment">//光标位置</span></span><br><span class="line">    QTextCursor cursor = ui-&gt;showTextEdit-&gt;<span class="built_in">textCursor</span>();</span><br><span class="line">    cursor.<span class="built_in">movePosition</span>(QTextCursor::End);</span><br><span class="line">    ui-&gt;showTextEdit-&gt;<span class="built_in">setTextCursor</span>(cursor);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_startPushButton_clicked</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;服务器开始监听&quot;</span>;</span><br><span class="line">    <span class="comment">//监听</span></span><br><span class="line">    <span class="type">int</span> port = ui-&gt;portLineEdit-&gt;<span class="built_in">text</span>().<span class="built_in">toInt</span>();</span><br><span class="line">    <span class="comment">// QHostAddress host(&quot;192.168.1.9&quot;);</span></span><br><span class="line">    <span class="keyword">if</span> (!server-&gt;<span class="built_in">listen</span>(QHostAddress::Any, port)) &#123;</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;Server listen failed&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//按键设置为可按</span></span><br><span class="line">    ui-&gt;stopPushButton-&gt;<span class="built_in">setEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">    ui-&gt;interruptPushButton-&gt;<span class="built_in">setEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">    <span class="comment">//按键设置为不可按</span></span><br><span class="line">    ui-&gt;startPushButton-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="显示服务器的IP并监听显示的IP"><strong>显示服务器的IP并监听显示的IP</strong></h4>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//mainwindow.cpp</span></span><br><span class="line">MainWindow::<span class="built_in">MainWindow</span>(QWidget *parent)</span><br><span class="line">    : <span class="built_in">QMainWindow</span>(parent)</span><br><span class="line">      , <span class="built_in">ui</span>(<span class="keyword">new</span> Ui::MainWindow) &#123;</span><br><span class="line">    ui-&gt;<span class="built_in">setupUi</span>(<span class="keyword">this</span>);</span><br><span class="line">    ui-&gt;centralwidget-&gt;<span class="built_in">setLayout</span>(ui-&gt;widgetVL);</span><br><span class="line">		<span class="comment">//....</span></span><br><span class="line">    <span class="comment">//&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span></span><br><span class="line">    <span class="comment">//服务器端可用的ip地址</span></span><br><span class="line">    QList&lt;QHostAddress&gt; serverAddresses = QNetworkInterface::<span class="built_in">allAddresses</span>();</span><br><span class="line">    <span class="keyword">for</span> (QHostAddress address: serverAddresses) &#123;</span><br><span class="line">        <span class="comment">//筛选ipv4</span></span><br><span class="line">        <span class="keyword">if</span> (address.<span class="built_in">protocol</span>() == QAbstractSocket::IPv4Protocol) &#123;</span><br><span class="line">            ui-&gt;ipComboBox-&gt;<span class="built_in">addItem</span>(address.<span class="built_in">toString</span>());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;,</span></span><br><span class="line">    <span class="comment">//信号与槽</span></span><br><span class="line">    <span class="built_in">connect</span>(server, &amp;QTcpServer::newConnection, <span class="keyword">this</span>, &amp;MainWindow::on_newClient_connect);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_startPushButton_clicked</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;服务器开始监听&quot;</span>;</span><br><span class="line">    <span class="comment">//监听</span></span><br><span class="line">    <span class="type">int</span> port = ui-&gt;portLineEdit-&gt;<span class="built_in">text</span>().<span class="built_in">toInt</span>();</span><br><span class="line">    <span class="comment">// QHostAddress host(&quot;192.168.1.9&quot;);</span></span><br><span class="line">    <span class="comment">//监听所有ip</span></span><br><span class="line">    <span class="comment">// if (!server-&gt;listen(QHostAddress::Any, port)) &#123;</span></span><br><span class="line">  	<span class="comment">//&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span></span><br><span class="line">    <span class="comment">//只监听combox中的ip</span></span><br><span class="line">    <span class="function">QHostAddress <span class="title">host</span><span class="params">(ui-&gt;ipComboBox-&gt;currentText())</span></span>;</span><br><span class="line">  	<span class="comment">//&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span></span><br><span class="line">    <span class="keyword">if</span> (!server-&gt;<span class="built_in">listen</span>(host, port)) &#123;</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;Server listen failed&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//按键设置为可按</span></span><br><span class="line">    ui-&gt;stopPushButton-&gt;<span class="built_in">setEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">    ui-&gt;interruptPushButton-&gt;<span class="built_in">setEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">    <span class="comment">//按键设置为不可按</span></span><br><span class="line">    ui-&gt;startPushButton-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="在建立的客户连接-socket-中处理数据接收的readyRead信号"><strong>在建立的客户连接(socket)中处理数据接收的readyRead信号</strong></h4>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//mainwindow.cpp</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_newClient_connect</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;有新客户端连接socket&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (server-&gt;<span class="built_in">hasPendingConnections</span>()) &#123;</span><br><span class="line">        QTcpSocket *socket = server-&gt;<span class="built_in">nextPendingConnection</span>();</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;Client host: &quot;</span> &lt;&lt; socket-&gt;<span class="built_in">peerAddress</span>().<span class="built_in">toString</span>() &lt;&lt; <span class="string">&quot; port: &quot;</span> &lt;&lt; socket-&gt;<span class="built_in">peerPort</span>();</span><br><span class="line">        ui-&gt;showTextEdit-&gt;<span class="built_in">insertPlainText</span>(<span class="string">&quot;客户端地址：&quot;</span>+socket-&gt;<span class="built_in">peerAddress</span>().<span class="built_in">toString</span>()+<span class="string">&quot;, 客户端端口：&quot;</span>+QString::<span class="built_in">number</span>(socket-&gt;<span class="built_in">peerPort</span>())+<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">      	<span class="comment">//&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span></span><br><span class="line">        <span class="built_in">connect</span>(socket, &amp;QTcpSocket::readyRead, <span class="keyword">this</span>, &amp;MainWindow::on_readyRead_handler);</span><br><span class="line">      <span class="comment">//&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_startPushButton_clicked</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;服务器开始监听&quot;</span>;</span><br><span class="line">    <span class="comment">//监听</span></span><br><span class="line">    <span class="type">int</span> port = ui-&gt;portLineEdit-&gt;<span class="built_in">text</span>().<span class="built_in">toInt</span>();</span><br><span class="line">    <span class="comment">// QHostAddress host(&quot;192.168.1.9&quot;);</span></span><br><span class="line">    <span class="comment">//监听所有ip</span></span><br><span class="line">    <span class="comment">// if (!server-&gt;listen(QHostAddress::Any, port)) &#123;</span></span><br><span class="line">    <span class="comment">//只监听combox中的ip</span></span><br><span class="line">    <span class="function">QHostAddress <span class="title">host</span><span class="params">(ui-&gt;ipComboBox-&gt;currentText())</span></span>;</span><br><span class="line">    <span class="keyword">if</span> (!server-&gt;<span class="built_in">listen</span>(host, port)) &#123;</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;Server listen failed&quot;</span>;</span><br><span class="line">      	<span class="comment">//&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span></span><br><span class="line">        QMessageBox msgBox;</span><br><span class="line">        msgBox.<span class="built_in">setWindowTitle</span>(<span class="string">&quot;监听失败&quot;</span>);</span><br><span class="line">        msgBox.<span class="built_in">setText</span>(<span class="string">&quot;端口号被占用&quot;</span>);</span><br><span class="line">        msgBox.<span class="built_in">exec</span>();</span><br><span class="line">      	<span class="comment">//&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//按键设置为可按</span></span><br><span class="line">    ui-&gt;stopPushButton-&gt;<span class="built_in">setEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">    ui-&gt;interruptPushButton-&gt;<span class="built_in">setEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">    <span class="comment">//按键设置为不可按</span></span><br><span class="line">    ui-&gt;startPushButton-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_readyRead_handler</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;在socket连接中接收客服端数据&quot;</span>;</span><br><span class="line">    <span class="comment">//获取socket连接</span></span><br><span class="line">     QTcpSocket* socket = <span class="built_in">qobject_cast</span>&lt;QTcpSocket*&gt;(<span class="built_in">sender</span>());</span><br><span class="line">    <span class="comment">//读发送的数据</span></span><br><span class="line">    QByteArray revData = socket-&gt;<span class="built_in">readAll</span>();</span><br><span class="line">    <span class="comment">//显示到窗口</span></span><br><span class="line">    ui-&gt;showTextEdit-&gt;<span class="built_in">insertPlainText</span>( QString::<span class="built_in">fromUtf8</span>(revData)+<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span></span><br></pre></td></tr></table></figure>
<h4 id="服务端检测客户端socket是否断开">服务端检测客户端socket是否断开</h4>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_newClient_connect</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;有新客户端连接socket&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (server-&gt;<span class="built_in">hasPendingConnections</span>()) &#123;</span><br><span class="line">        QTcpSocket *socket = server-&gt;<span class="built_in">nextPendingConnection</span>();</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;Client host: &quot;</span> &lt;&lt; socket-&gt;<span class="built_in">peerAddress</span>().<span class="built_in">toString</span>() &lt;&lt; <span class="string">&quot; port: &quot;</span> &lt;&lt; socket-&gt;<span class="built_in">peerPort</span>();</span><br><span class="line">        ui-&gt;showTextEdit-&gt;<span class="built_in">insertPlainText</span>(<span class="string">&quot;客户端地址：&quot;</span>+socket-&gt;<span class="built_in">peerAddress</span>().<span class="built_in">toString</span>()+<span class="string">&quot;, 客户端端口：&quot;</span>+QString::<span class="built_in">number</span>(socket-&gt;<span class="built_in">peerPort</span>())+<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        <span class="comment">//信号与槽：接收数据</span></span><br><span class="line">        <span class="built_in">connect</span>(socket, &amp;QTcpSocket::readyRead, <span class="keyword">this</span>, &amp;MainWindow::on_readyRead_handler);</span><br><span class="line">      	<span class="comment">//&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span></span><br><span class="line">      	<span class="comment">//以下二选一</span></span><br><span class="line">        <span class="comment">//信号与槽：检测socket连接</span></span><br><span class="line">        <span class="built_in">connect</span>(socket, &amp;QAbstractSocket::disconnected, <span class="keyword">this</span>, &amp;MainWindow::on_disconnected_handler);</span><br><span class="line">        <span class="comment">//信号与槽：检测socket状态</span></span><br><span class="line">        <span class="built_in">connect</span>(socket, &amp;QAbstractSocket::stateChanged, <span class="keyword">this</span>, &amp;MainWindow::on_socketStateChanged_handler);</span><br><span class="line">    &#125;</span><br><span class="line">  			<span class="comment">//&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_disconnected_handler</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;客户端socket断开&quot;</span>;</span><br><span class="line">    ui-&gt;showTextEdit-&gt;<span class="built_in">insertPlainText</span>(<span class="string">&quot;客户端断开\n&quot;</span>);</span><br><span class="line">    <span class="comment">//释放socket资源</span></span><br><span class="line">    QTcpSocket* socket = <span class="built_in">qobject_cast</span>&lt;QTcpSocket*&gt;(<span class="built_in">sender</span>());</span><br><span class="line">    socket-&gt;<span class="built_in">deleteLater</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_socketStateChanged_handler</span><span class="params">(QAbstractSocket::SocketState socketState)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;客户端socket状态改变: &quot;</span>+socketState;</span><br><span class="line">    <span class="keyword">if</span> (socketState == QAbstractSocket::UnconnectedState || socketState == QAbstractSocket::ClosingState) &#123;</span><br><span class="line">        ui-&gt;showTextEdit-&gt;<span class="built_in">insertPlainText</span>(<span class="string">&quot;客户端断开\n&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span> (socketState == QAbstractSocket::ConnectedState || socketState == QAbstractSocket::ConnectingState) &#123;</span><br><span class="line">        ui-&gt;showTextEdit-&gt;<span class="built_in">insertPlainText</span>(<span class="string">&quot;客户端连接\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//光标位置</span></span><br><span class="line">    QTextCursor cursor = ui-&gt;showTextEdit-&gt;<span class="built_in">textCursor</span>();</span><br><span class="line">    cursor.<span class="built_in">movePosition</span>(QTextCursor::End);</span><br><span class="line">    ui-&gt;showTextEdit-&gt;<span class="built_in">setTextCursor</span>(cursor);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="服务端发送数据">服务端发送数据</h4>
<p>之前的服务端监听的socket连接是局部变量，需要改成全局变量，或者使用全局的server记录的连接过的socket。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//mainwindow.cpp</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_sendPushButton_clicked</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;服务端发送&quot;</span>;</span><br><span class="line"></span><br><span class="line">    QList&lt;QTcpSocket*&gt; tcpSocketClients = server-&gt;<span class="built_in">findChildren</span>&lt;QTcpSocket*&gt;();</span><br><span class="line">    <span class="keyword">if</span> (tcpSocketClients.<span class="built_in">size</span>() &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        QMessageBox msgBox;</span><br><span class="line">        msgBox.<span class="built_in">setWindowTitle</span>(<span class="string">&quot;无客户端连接&quot;</span>);</span><br><span class="line">        msgBox.<span class="built_in">setText</span>(<span class="string">&quot;服务端没有监听到客户端socket连接&quot;</span>);</span><br><span class="line">        msgBox.<span class="built_in">exec</span>();</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (QTcpSocket* tcpSocketClient: tcpSocketClients) &#123;</span><br><span class="line">        tcpSocketClient-&gt;<span class="built_in">write</span>(ui-&gt;sendTextEdit-&gt;<span class="built_in">toPlainText</span>().<span class="built_in">toUtf8</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="服务端选择指定的socket发送数据">服务端选择指定的socket发送数据</h4>
<p><img src="/2025/02/24/QT-C/QT-C/image-20250521150519891.png" alt="image-20250521150519891"></p>
<ul>
<li>自定义ComboBox组件类并覆盖原<code>mousePressEvent</code>事件, 当发生<code>LeftButton</code>时发射自定义信号信号<code>on_comboBox_clicked()</code>。</li>
<li>UI界面<code>MainWindow</code>实现自定义ComboBox组件<code>socketComboBox</code>的信号与槽的连接，并实现槽函数<code>on_socketComboBox_handler</code>。</li>
<li>定义一个全局ComboBox的项索引<code>socketIndex</code>，通过<code>on_socketComboBox_activated(int index)</code>槽函数更新当前项的索引<code>socketIndex</code>。</li>
<li>通过ComboBox的项索引确认选择哪一个socket连接并发送服务端数据</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//socketComboBox.h</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Created by chauchy on 25-5-21.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> SOCKETCOMBOBOX_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SOCKETCOMBOBOX_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QComboBox&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QWidget&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SocketComboBox</span> : <span class="keyword">public</span> QComboBox &#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">SocketComboBox</span>(QWidget* parent);</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">mousePressEvent</span><span class="params">(QMouseEvent* event)</span> <span class="keyword">override</span></span>;</span><br><span class="line"></span><br><span class="line">signals:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_ComboBox_clicked</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">//SOCKETCOMBOBOX_H</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//socketComboBox.cpp</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Created by chauchy on 25-5-21.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;socketComboBox.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QMouseEvent&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SocketComboBox::<span class="built_in">SocketComboBox</span>(QWidget* parent): <span class="built_in">QComboBox</span>(parent) &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">SocketComboBox::mousePressEvent</span><span class="params">(QMouseEvent *event)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (event-&gt;<span class="built_in">button</span>() == Qt::LeftButton) &#123;</span><br><span class="line">        <span class="function">emit <span class="title">on_ComboBox_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//向父类传递该事件</span></span><br><span class="line">    QComboBox::<span class="built_in">mousePressEvent</span>(event);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//mainwindow.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> MAINWINDOW_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAINWINDOW_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QMainWindow&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QTcpServer&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;socketComboBox.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">QT_BEGIN_NAMESPACE</span><br><span class="line"><span class="keyword">namespace</span> Ui &#123;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MainWindow</span>;</span><br><span class="line">&#125;</span><br><span class="line">QT_END_NAMESPACE</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MainWindow</span> : <span class="keyword">public</span> QMainWindow</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">MainWindow</span>(QWidget *parent = <span class="literal">nullptr</span>);</span><br><span class="line">    ~<span class="built_in">MainWindow</span>();</span><br><span class="line"></span><br><span class="line">    QTcpServer* server;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Ui::MainWindow *ui;</span><br><span class="line">  	<span class="comment">//&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span></span><br><span class="line">    <span class="type">int</span> socketIndex;</span><br><span class="line">  	<span class="comment">//&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> slots:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_newClient_connect</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_startPushButton_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_readyRead_handler</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_disconnected_handler</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_socketStateChanged_handler</span><span class="params">(QAbstractSocket::SocketState socketState)</span></span>;</span><br><span class="line">  <span class="comment">//&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;  </span></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">on_sendPushButton_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_socketComboBox_handler</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_socketComboBox_activated</span><span class="params">(<span class="type">int</span> index)</span></span>;</span><br><span class="line">  <span class="comment">//&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span></span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// MAINWINDOW_H</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//mainwindow.cpp</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_sendPushButton_clicked</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;服务端发送&quot;</span>;</span><br><span class="line">    QList&lt;QTcpSocket*&gt; tcpSocketClients = server-&gt;<span class="built_in">findChildren</span>&lt;QTcpSocket*&gt;();</span><br><span class="line">    <span class="keyword">if</span> (socketIndex == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (QTcpSocket* tcpSocketClient: tcpSocketClients) &#123;</span><br><span class="line">            tcpSocketClient-&gt;<span class="built_in">write</span>(ui-&gt;sendTextEdit-&gt;<span class="built_in">toPlainText</span>().<span class="built_in">toUtf8</span>());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        tcpSocketClients[socketIndex<span class="number">-1</span>]-&gt;<span class="built_in">write</span>(ui-&gt;sendTextEdit-&gt;<span class="built_in">toPlainText</span>().<span class="built_in">toUtf8</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_socketComboBox_handler</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;筛选目标socket&quot;</span>;</span><br><span class="line">    <span class="comment">//清除原有项</span></span><br><span class="line">    ui-&gt;socketComboBox-&gt;<span class="built_in">clear</span>();</span><br><span class="line">    <span class="keyword">if</span> (server-&gt;<span class="built_in">isListening</span>()) &#123;</span><br><span class="line">        QList&lt;QTcpSocket *&gt; tcpSocketClients = server-&gt;<span class="built_in">findChildren</span>&lt;QTcpSocket *&gt;();</span><br><span class="line">        <span class="keyword">if</span> (tcpSocketClients.<span class="built_in">size</span>() &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            QMessageBox msgBox;</span><br><span class="line">            msgBox.<span class="built_in">setWindowTitle</span>(<span class="string">&quot;无客户端连接&quot;</span>);</span><br><span class="line">            msgBox.<span class="built_in">setText</span>(<span class="string">&quot;服务端没有监听到客户端socket连接&quot;</span>);</span><br><span class="line">            msgBox.<span class="built_in">exec</span>();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//可以发送</span></span><br><span class="line">        ui-&gt;sendPushButton-&gt;<span class="built_in">setEnabled</span>(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//可用连接</span></span><br><span class="line">        ui-&gt;socketComboBox-&gt;<span class="built_in">addItem</span>(<span class="string">&quot;all&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (QTcpSocket *tcpSocketClient: tcpSocketClients) &#123;</span><br><span class="line">            ui-&gt;socketComboBox-&gt;<span class="built_in">addItem</span>(tcpSocketClient-&gt;<span class="built_in">peerAddress</span>().<span class="built_in">toString</span>() + <span class="string">&#x27;:&#x27;</span> + QString::<span class="built_in">number</span>(tcpSocketClient-&gt;<span class="built_in">peerPort</span>()));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_socketComboBox_activated</span><span class="params">(<span class="type">int</span> index)</span> </span>&#123;</span><br><span class="line">    socketIndex = index;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="停止监听和断开服务器">停止监听和断开服务器</h4>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//mainwindow.cpp</span></span><br><span class="line"></span><br><span class="line">MainWindow::<span class="built_in">MainWindow</span>(QWidget *parent)</span><br><span class="line">    : <span class="built_in">QMainWindow</span>(parent)</span><br><span class="line">      , <span class="built_in">ui</span>(<span class="keyword">new</span> Ui::MainWindow) &#123;</span><br><span class="line">    ui-&gt;<span class="built_in">setupUi</span>(<span class="keyword">this</span>);</span><br><span class="line">    ui-&gt;centralwidget-&gt;<span class="built_in">setLayout</span>(ui-&gt;widgetVL);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    <span class="comment">//按键初始设置为不可按</span></span><br><span class="line">    ui-&gt;stopPushButton-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">    ui-&gt;interruptPushButton-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">    ui-&gt;sendPushButton-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">    ui-&gt;socketComboBox-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_startPushButton_clicked</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;服务器开始监听&quot;</span>;</span><br><span class="line">    <span class="comment">//监听</span></span><br><span class="line">    <span class="type">int</span> port = ui-&gt;portLineEdit-&gt;<span class="built_in">text</span>().<span class="built_in">toInt</span>();</span><br><span class="line">    <span class="comment">// QHostAddress host(&quot;192.168.1.9&quot;);</span></span><br><span class="line">    <span class="comment">//监听所有ip</span></span><br><span class="line">    <span class="comment">// if (!server-&gt;listen(QHostAddress::Any, port)) &#123;</span></span><br><span class="line">    <span class="comment">//只监听combox中的ip</span></span><br><span class="line">    <span class="function">QHostAddress <span class="title">host</span><span class="params">(ui-&gt;ipComboBox-&gt;currentText())</span></span>;</span><br><span class="line">    <span class="keyword">if</span> (!server-&gt;<span class="built_in">listen</span>(host, port)) &#123;</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;Server listen failed&quot;</span>;</span><br><span class="line">        QMessageBox msgBox;</span><br><span class="line">        msgBox.<span class="built_in">setWindowTitle</span>(<span class="string">&quot;监听失败&quot;</span>);</span><br><span class="line">        msgBox.<span class="built_in">setText</span>(<span class="string">&quot;端口号被占用&quot;</span>);</span><br><span class="line">        msgBox.<span class="built_in">exec</span>();</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//按键设置为可按</span></span><br><span class="line">    ui-&gt;stopPushButton-&gt;<span class="built_in">setEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">    ui-&gt;interruptPushButton-&gt;<span class="built_in">setEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">    <span class="comment">//按键设置为不可按</span></span><br><span class="line">    ui-&gt;startPushButton-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">    ui-&gt;protocolComboBox-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">    ui-&gt;ipComboBox-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">    ui-&gt;portLineEdit-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">    ui-&gt;socketComboBox-&gt;<span class="built_in">setEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_stopPushButton_clicked</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;服务器断开连接&quot;</span>;</span><br><span class="line">    <span class="comment">//客户端回收</span></span><br><span class="line">    <span class="keyword">if</span> (server-&gt;<span class="built_in">isListening</span>()) &#123;</span><br><span class="line">        QList&lt;QTcpSocket *&gt; tcpSocketClients = server-&gt;<span class="built_in">findChildren</span>&lt;QTcpSocket *&gt;();</span><br><span class="line">        <span class="keyword">for</span> (QTcpSocket *tcpSocketClient: tcpSocketClients) &#123;</span><br><span class="line">            tcpSocketClient-&gt;<span class="built_in">close</span>();</span><br><span class="line">          	tcpSocketClient-&gt;<span class="built_in">deleteLater</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//关闭服务端</span></span><br><span class="line">        server-&gt;<span class="built_in">close</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    ui-&gt;startPushButton-&gt;<span class="built_in">setEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">    ui-&gt;stopPushButton-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">    ui-&gt;interruptPushButton-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">    ui-&gt;protocolComboBox-&gt;<span class="built_in">setEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">    ui-&gt;ipComboBox-&gt;<span class="built_in">setEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">    ui-&gt;portLineEdit-&gt;<span class="built_in">setEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">    ui-&gt;sendPushButton-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">    ui-&gt;socketComboBox-&gt;<span class="built_in">clear</span>();</span><br><span class="line">    ui-&gt;socketComboBox-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_interruptPushButton_clicked</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;退出程序&quot;</span>;</span><br><span class="line">    <span class="built_in">on_stopPushButton_clicked</span>();</span><br><span class="line">    <span class="keyword">delete</span> server;</span><br><span class="line">    <span class="keyword">this</span>-&gt;<span class="built_in">close</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="客户端">客户端</h4>
<ul>
<li>出现的问题是当服务端处在未监听状态时如果客户端建立连接，那么将永远连接不了，即使之后又把服务端设成监听状态</li>
<li>解决方法是不在构造函数中分配client socket而是在建立连接时，将上一次的client分配的socket删除，建一个新的。</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//mainwindow.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> MAINWINDOW_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAINWINDOW_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QMainWindow&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QTcpSocket&gt;</span></span></span><br><span class="line"></span><br><span class="line">QT_BEGIN_NAMESPACE</span><br><span class="line"><span class="keyword">namespace</span> Ui &#123;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MainWindow</span>;</span><br><span class="line">&#125;</span><br><span class="line">QT_END_NAMESPACE</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MainWindow</span> : <span class="keyword">public</span> QMainWindow</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">MainWindow</span>(QWidget *parent = <span class="literal">nullptr</span>);</span><br><span class="line">    ~<span class="built_in">MainWindow</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Ui::MainWindow *ui;</span><br><span class="line">    QTcpSocket* client;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> slots:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_connectPushButton_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_receiveData_handler</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_sendPushButton_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_interruptPushButton_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_stateChange_handler</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// MAINWINDOW_H</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//mainwindow.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;mainwindow.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ui_mainwindow.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QNetworkInterface&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QMessageBox&gt;</span></span></span><br><span class="line"></span><br><span class="line">MainWindow::<span class="built_in">MainWindow</span>(QWidget *parent)</span><br><span class="line">    : <span class="built_in">QMainWindow</span>(parent)</span><br><span class="line">    , <span class="built_in">ui</span>(<span class="keyword">new</span> Ui::MainWindow)</span><br><span class="line">&#123;</span><br><span class="line">    ui-&gt;<span class="built_in">setupUi</span>(<span class="keyword">this</span>);</span><br><span class="line">    ui-&gt;centralwidget-&gt;<span class="built_in">setLayout</span>(ui-&gt;widgetVL);</span><br><span class="line">    <span class="comment">// //建立一个客户端</span></span><br><span class="line">    client = <span class="literal">nullptr</span>;<span class="comment">//new QTcpSocket(this);</span></span><br><span class="line">    <span class="comment">//客户端可用IP</span></span><br><span class="line">    QList&lt;QHostAddress&gt; clientAddresses = QNetworkInterface::<span class="built_in">allAddresses</span>();</span><br><span class="line">    <span class="keyword">for</span> (QHostAddress address: clientAddresses) &#123;</span><br><span class="line">        <span class="comment">//筛选ipv4</span></span><br><span class="line">        <span class="keyword">if</span> (address.<span class="built_in">protocol</span>() == QAbstractSocket::IPv4Protocol) &#123;</span><br><span class="line">            ui-&gt;ipClientComboBox-&gt;<span class="built_in">addItem</span>(address.<span class="built_in">toString</span>());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//按键不可选</span></span><br><span class="line">    ui-&gt;interruptPushButton-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MainWindow::~<span class="built_in">MainWindow</span>()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">delete</span> ui;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_connectPushButton_clicked</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;客户端连接&quot;</span>;</span><br><span class="line">    <span class="comment">//client的分配不能放到构造函数中，因为当服务端处在未监听状态时client建立的连接会一直处在未连接状态，即使之后服务端处在监听状态，因此需要重新分配一个client删除原有client</span></span><br><span class="line">    <span class="keyword">if</span> (!client) &#123;</span><br><span class="line">        client = <span class="keyword">new</span> <span class="built_in">QTcpSocket</span>(<span class="keyword">this</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">delete</span> client;</span><br><span class="line">        client = <span class="keyword">new</span> <span class="built_in">QTcpSocket</span>(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//信号与槽</span></span><br><span class="line">    <span class="built_in">connect</span>(client, &amp;QAbstractSocket::readyRead, <span class="keyword">this</span>, &amp;MainWindow::on_receiveData_handler);</span><br><span class="line">    <span class="built_in">connect</span>(client, &amp;QAbstractSocket::stateChanged, <span class="keyword">this</span>, &amp;MainWindow::on_stateChange_handler);</span><br><span class="line">    <span class="comment">//取消已有连接</span></span><br><span class="line">    <span class="comment">// client-&gt;abort();</span></span><br><span class="line">    <span class="comment">// client-&gt;close();</span></span><br><span class="line">    <span class="comment">// client-&gt;disconnectFromHost();</span></span><br><span class="line">    <span class="keyword">if</span> (ui-&gt;ipClientComboBox-&gt;<span class="built_in">currentText</span>().<span class="built_in">isEmpty</span>()  || ui-&gt;portClientLineEdit-&gt;<span class="built_in">text</span>().<span class="built_in">isEmpty</span>() || ui-&gt;portServerLineEdit-&gt;<span class="built_in">text</span>().<span class="built_in">isEmpty</span>() || ui-&gt;ipServerLineEdit-&gt;<span class="built_in">text</span>().<span class="built_in">isEmpty</span>()) &#123;</span><br><span class="line">        QMessageBox msgBox;</span><br><span class="line">        msgBox.<span class="built_in">setWindowTitle</span>(<span class="string">&quot;提醒&quot;</span>);</span><br><span class="line">        msgBox.<span class="built_in">setText</span>(<span class="string">&quot;请设定客户端和服务端的IP和端口号&quot;</span>);</span><br><span class="line">        msgBox.<span class="built_in">exec</span>();</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    QHostAddress ipClient = <span class="built_in">QHostAddress</span>(ui-&gt;ipClientComboBox-&gt;<span class="built_in">currentText</span>());</span><br><span class="line">    <span class="type">int</span> portClient = ui-&gt;portClientLineEdit-&gt;<span class="built_in">text</span>().<span class="built_in">toInt</span>();</span><br><span class="line">    <span class="comment">//socket绑定客户端ip和端口号</span></span><br><span class="line">    client-&gt;<span class="built_in">bind</span>(ipClient, portClient);</span><br><span class="line">    <span class="comment">//连接服务端ip和端口号</span></span><br><span class="line">    client-&gt;<span class="built_in">connectToHost</span>(ui-&gt;ipServerLineEdit-&gt;<span class="built_in">text</span>(), ui-&gt;portServerLineEdit-&gt;<span class="built_in">text</span>().<span class="built_in">toInt</span>());</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_receiveData_handler</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;客户端接收服务端的数据&quot;</span>;</span><br><span class="line">    <span class="comment">//客户端socket读取服务端发送的数据</span></span><br><span class="line">    QByteArray revData = client-&gt;<span class="built_in">readAll</span>();</span><br><span class="line">    <span class="comment">//显示到窗口</span></span><br><span class="line">    ui-&gt;showTextEdit-&gt;<span class="built_in">insertPlainText</span>(QString::<span class="built_in">fromUtf8</span>(revData)+<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    <span class="comment">// ui-&gt;showTextEdit-&gt;moveCursor(QTextCursor::End);</span></span><br><span class="line">    <span class="comment">// ui-&gt;showTextEdit-&gt;setTextCursor(ui-&gt;showTextEdit-&gt;textCursor());</span></span><br><span class="line">    <span class="comment">//光标位置</span></span><br><span class="line">    QTextCursor cursor = ui-&gt;showTextEdit-&gt;<span class="built_in">textCursor</span>();</span><br><span class="line">    cursor.<span class="built_in">movePosition</span>(QTextCursor::End);</span><br><span class="line">    ui-&gt;showTextEdit-&gt;<span class="built_in">setTextCursor</span>(cursor);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_sendPushButton_clicked</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;客户端发送数据&quot;</span>;</span><br><span class="line">    client-&gt;<span class="built_in">write</span>(ui-&gt;sendTextEdit-&gt;<span class="built_in">toPlainText</span>().<span class="built_in">toUtf8</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_interruptPushButton_clicked</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;客户端断开连接&quot;</span>;</span><br><span class="line">    client-&gt;<span class="built_in">close</span>();</span><br><span class="line">    ui-&gt;showTextEdit-&gt;<span class="built_in">append</span>(<span class="string">&quot;客户端断开连接!&quot;</span>);</span><br><span class="line">    <span class="comment">// ui-&gt;showTextEdit-&gt;moveCursor(QTextCursor::End);</span></span><br><span class="line">    <span class="comment">// ui-&gt;showTextEdit-&gt;setTextCursor(ui-&gt;showTextEdit-&gt;textCursor());</span></span><br><span class="line">    <span class="comment">//光标位置</span></span><br><span class="line">    QTextCursor cursor = ui-&gt;showTextEdit-&gt;<span class="built_in">textCursor</span>();</span><br><span class="line">    cursor.<span class="built_in">movePosition</span>(QTextCursor::End);</span><br><span class="line">    ui-&gt;showTextEdit-&gt;<span class="built_in">setTextCursor</span>(cursor);</span><br><span class="line">    <span class="comment">//设定不可选按钮</span></span><br><span class="line">    ui-&gt;ipClientComboBox-&gt;<span class="built_in">setEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">    ui-&gt;portClientLineEdit-&gt;<span class="built_in">setEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">    ui-&gt;ipServerLineEdit-&gt;<span class="built_in">setEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">    ui-&gt;portServerLineEdit-&gt;<span class="built_in">setEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">    ui-&gt;interruptPushButton-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">    ui-&gt;connectPushButton-&gt;<span class="built_in">setEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_stateChange_handler</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;客户端和服务端的连接状态发生改变&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (client-&gt;<span class="built_in">state</span>() == QAbstractSocket::UnconnectedState) &#123;</span><br><span class="line">        ui-&gt;showTextEdit-&gt;<span class="built_in">append</span>(<span class="string">&quot;服务端断开连接!\n&quot;</span>);</span><br><span class="line">        <span class="comment">//光标位置</span></span><br><span class="line">        QTextCursor cursor = ui-&gt;showTextEdit-&gt;<span class="built_in">textCursor</span>();</span><br><span class="line">        cursor.<span class="built_in">movePosition</span>(QTextCursor::End);</span><br><span class="line">        ui-&gt;showTextEdit-&gt;<span class="built_in">setTextCursor</span>(cursor);</span><br><span class="line">        <span class="comment">//设定不可选按钮</span></span><br><span class="line">        ui-&gt;ipClientComboBox-&gt;<span class="built_in">setEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">        ui-&gt;portClientLineEdit-&gt;<span class="built_in">setEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">        ui-&gt;ipServerLineEdit-&gt;<span class="built_in">setEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">        ui-&gt;portServerLineEdit-&gt;<span class="built_in">setEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">        ui-&gt;interruptPushButton-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">        ui-&gt;connectPushButton-&gt;<span class="built_in">setEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">//如果删除socket会编程空指针，在用client时内存访问出错</span></span><br><span class="line">        <span class="comment">// client-&gt;deleteLater();</span></span><br><span class="line">        <span class="comment">// client-&gt;abort();</span></span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span> (client-&gt;<span class="built_in">state</span>() == QAbstractSocket::ClosingState)&#123;</span><br><span class="line">        ui-&gt;showTextEdit-&gt;<span class="built_in">append</span>(<span class="string">&quot;正在断开服务端连接!\n&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(client-&gt;<span class="built_in">state</span>() == QAbstractSocket::ConnectedState) &#123;</span><br><span class="line">        ui-&gt;showTextEdit-&gt;<span class="built_in">append</span>(<span class="built_in">QString</span>(<span class="string">&quot;连接成功!\n&quot;</span>).<span class="built_in">arg</span>(ui-&gt;ipServerLineEdit-&gt;<span class="built_in">text</span>()).<span class="built_in">arg</span>(ui-&gt;portServerLineEdit-&gt;<span class="built_in">text</span>()));</span><br><span class="line">        <span class="comment">// ui-&gt;showTextEdit-&gt;moveCursor(QTextCursor::End);</span></span><br><span class="line">        <span class="comment">// ui-&gt;showTextEdit-&gt;setTextCursor(ui-&gt;showTextEdit-&gt;textCursor());</span></span><br><span class="line">        <span class="comment">//光标位置</span></span><br><span class="line">        QTextCursor cursor = ui-&gt;showTextEdit-&gt;<span class="built_in">textCursor</span>();</span><br><span class="line">        cursor.<span class="built_in">movePosition</span>(QTextCursor::End);</span><br><span class="line">        ui-&gt;showTextEdit-&gt;<span class="built_in">setTextCursor</span>(cursor);</span><br><span class="line">        <span class="comment">//设定不可选按钮</span></span><br><span class="line">        ui-&gt;ipClientComboBox-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">        ui-&gt;portClientLineEdit-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">        ui-&gt;ipServerLineEdit-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">        ui-&gt;portServerLineEdit-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">        ui-&gt;interruptPushButton-&gt;<span class="built_in">setEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">        ui-&gt;connectPushButton-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span> (client-&gt;<span class="built_in">state</span>() == QAbstractSocket::ConnectingState) &#123;</span><br><span class="line">        ui-&gt;showTextEdit-&gt;<span class="built_in">append</span>(<span class="built_in">QString</span>(<span class="string">&quot;正连接服务端IP: %1, 端口: %2\n&quot;</span>).<span class="built_in">arg</span>(ui-&gt;ipServerLineEdit-&gt;<span class="built_in">text</span>()).<span class="built_in">arg</span>(ui-&gt;portServerLineEdit-&gt;<span class="built_in">text</span>()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="客户端设置接收和发送用不同的颜色展示以及左右对齐">客户端设置接收和发送用不同的颜色展示以及左右对齐</h4>
<ul>
<li>光标级文本格式设置而非全局文本设置</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//mainwindow.cpp</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_receiveData_handler</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;客户端接收服务端的数据&quot;</span>;</span><br><span class="line">    <span class="comment">//客户端socket读取服务端发送的数据</span></span><br><span class="line">    QByteArray revData = client-&gt;<span class="built_in">readAll</span>();</span><br><span class="line">    <span class="comment">//显示到窗口</span></span><br><span class="line">    <span class="comment">// ui-&gt;showTextEdit-&gt;insertPlainText(QString::fromUtf8(revData)+&quot;\n&quot;);</span></span><br><span class="line">    <span class="comment">//&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span></span><br><span class="line">    QTextCursor cursor = ui-&gt;showTextEdit-&gt;<span class="built_in">textCursor</span>();</span><br><span class="line">    cursor.<span class="built_in">movePosition</span>(QTextCursor::End);</span><br><span class="line">    ui-&gt;showTextEdit-&gt;<span class="built_in">setAlignment</span>(Qt::AlignLeft);</span><br><span class="line">    QTextCharFormat format;</span><br><span class="line">    format.<span class="built_in">setForeground</span>(<span class="built_in">QBrush</span>(<span class="built_in">QColor</span>(Qt::black)));</span><br><span class="line">    cursor.<span class="built_in">setCharFormat</span>(format);</span><br><span class="line">    cursor.<span class="built_in">insertText</span>(QString::<span class="built_in">fromUtf8</span>(revData)+<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">  	<span class="comment">//&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span></span><br><span class="line">    <span class="comment">// ui-&gt;showTextEdit-&gt;moveCursor(QTextCursor::End);</span></span><br><span class="line">    <span class="comment">// ui-&gt;showTextEdit-&gt;setTextCursor(ui-&gt;showTextEdit-&gt;textCursor());</span></span><br><span class="line">    <span class="comment">//光标位置</span></span><br><span class="line">    <span class="comment">// QTextCursor cursor = ui-&gt;showTextEdit-&gt;textCursor();</span></span><br><span class="line">    cursor.<span class="built_in">movePosition</span>(QTextCursor::End);</span><br><span class="line">    ui-&gt;showTextEdit-&gt;<span class="built_in">setTextCursor</span>(cursor);</span><br><span class="line">    ui-&gt;showTextEdit-&gt;<span class="built_in">ensureCursorVisible</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="服务端检测到客户端断连后将comboBox中的项删除，检测到新连接也加入该项，发送pushButton检测到没有客户端连接时不发送信息">服务端检测到客户端断连后将comboBox中的项删除，检测到新连接也加入该项，发送pushButton检测到没有客户端连接时不发送信息</h4>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//mainwindow.cpp</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_newClient_connect</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;有新客户端连接socket&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (server-&gt;<span class="built_in">hasPendingConnections</span>()) &#123;</span><br><span class="line">        QTcpSocket *socket = server-&gt;<span class="built_in">nextPendingConnection</span>();</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;Client host: &quot;</span> &lt;&lt; socket-&gt;<span class="built_in">peerAddress</span>().<span class="built_in">toString</span>() &lt;&lt; <span class="string">&quot; port: &quot;</span> &lt;&lt; socket-&gt;<span class="built_in">peerPort</span>();</span><br><span class="line">        ui-&gt;showTextEdit-&gt;<span class="built_in">insertPlainText</span>(</span><br><span class="line">            <span class="string">&quot;客户端地址：&quot;</span> + socket-&gt;<span class="built_in">peerAddress</span>().<span class="built_in">toString</span>() + <span class="string">&quot;, 客户端端口：&quot;</span> + QString::<span class="built_in">number</span>(socket-&gt;<span class="built_in">peerPort</span>()) + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        <span class="comment">// ui-&gt;showTextEdit-&gt;moveCursor(QTextCursor::End);</span></span><br><span class="line">        <span class="comment">// ui-&gt;showTextEdit-&gt;setTextCursor(ui-&gt;showTextEdit-&gt;textCursor());</span></span><br><span class="line">        <span class="comment">//光标位置</span></span><br><span class="line">        QTextCursor cursor = ui-&gt;showTextEdit-&gt;<span class="built_in">textCursor</span>();</span><br><span class="line">        cursor.<span class="built_in">movePosition</span>(QTextCursor::End);</span><br><span class="line">        ui-&gt;showTextEdit-&gt;<span class="built_in">setTextCursor</span>(cursor);</span><br><span class="line">        ui-&gt;showTextEdit-&gt;<span class="built_in">ensureCursorVisible</span>();</span><br><span class="line">      	<span class="comment">//&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span></span><br><span class="line">        <span class="comment">//添加新socket到comboBox</span></span><br><span class="line">        <span class="keyword">if</span> (ui-&gt;socketComboBox-&gt;<span class="built_in">count</span>() == <span class="number">0</span>) &#123;</span><br><span class="line">            ui-&gt;socketComboBox-&gt;<span class="built_in">addItem</span>(<span class="string">&quot;all&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        ui-&gt;socketComboBox-&gt;<span class="built_in">addItem</span>(socket-&gt;<span class="built_in">peerAddress</span>().<span class="built_in">toString</span>()+<span class="string">&quot;:&quot;</span>+QString::<span class="built_in">number</span>(socket-&gt;<span class="built_in">peerPort</span>()));</span><br><span class="line">        <span class="comment">// 设置默认项为第一个选项（索引为0）</span></span><br><span class="line">        ui-&gt;socketComboBox-&gt;<span class="built_in">setCurrentIndex</span>(ui-&gt;socketComboBox-&gt;<span class="built_in">count</span>()<span class="number">-1</span>);</span><br><span class="line">        socketIndex = ui-&gt;socketComboBox-&gt;<span class="built_in">currentIndex</span>();</span><br><span class="line">        <span class="comment">//信号与槽：接收数据</span></span><br><span class="line">        <span class="built_in">connect</span>(socket, &amp;QTcpSocket::readyRead, <span class="keyword">this</span>, &amp;MainWindow::on_readyRead_handler);</span><br><span class="line">        <span class="comment">//发送pushButton可按</span></span><br><span class="line">        ui-&gt;sendPushButton-&gt;<span class="built_in">setEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">      	<span class="comment">//&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span></span><br><span class="line">        <span class="comment">//信号与槽：检测socket连接</span></span><br><span class="line">        <span class="comment">// connect(socket, &amp;QAbstractSocket::disconnected, this, &amp;MainWindow::on_disconnected_handler);</span></span><br><span class="line">        <span class="comment">//信号与槽：检测socket状态</span></span><br><span class="line">        <span class="built_in">connect</span>(socket, &amp;QAbstractSocket::stateChanged, <span class="keyword">this</span>, &amp;MainWindow::on_socketStateChanged_handler);</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        ui-&gt;sendPushButton-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_socketStateChanged_handler</span><span class="params">(QAbstractSocket::SocketState socketState)</span> </span>&#123;</span><br><span class="line">    QMetaObject  mo = QAbstractSocket::staticMetaObject;</span><br><span class="line">    QMetaEnum me = mo.<span class="built_in">enumerator</span>(mo.<span class="built_in">indexOfEnumerator</span>(<span class="string">&quot;SocketState&quot;</span>));</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;客户端socket状态改变: &quot;</span> + <span class="built_in">QString</span>(me.<span class="built_in">valueToKey</span>(socketState));</span><br><span class="line">    QTcpSocket *socket = <span class="built_in">qobject_cast</span>&lt;QTcpSocket *&gt;(<span class="built_in">sender</span>());</span><br><span class="line">    <span class="keyword">if</span> (socketState == QAbstractSocket::UnconnectedState || socketState == QAbstractSocket::ClosingState) &#123;</span><br><span class="line">        <span class="comment">// ui-&gt;showTextEdit-&gt;insertPlainText(&quot;socketStateChanged信号引起的客户端断开\n&quot;);</span></span><br><span class="line">        QTextCursor cursor = ui-&gt;showTextEdit-&gt;<span class="built_in">textCursor</span>();</span><br><span class="line">        cursor.<span class="built_in">movePosition</span>(QTextCursor::End);</span><br><span class="line">        ui-&gt;showTextEdit-&gt;<span class="built_in">setAlignment</span>(Qt::AlignLeft);</span><br><span class="line">        QTextCharFormat format;</span><br><span class="line">        format.<span class="built_in">setForeground</span>(<span class="built_in">QBrush</span>(<span class="built_in">QColor</span>(Qt::red)));</span><br><span class="line">        cursor.<span class="built_in">setCharFormat</span>(format);</span><br><span class="line">        cursor.<span class="built_in">insertText</span>( <span class="built_in">QString</span>(me.<span class="built_in">valueToKey</span>(socketState))+<span class="built_in">QString</span>(<span class="string">&quot;信号引起的客户端断开\n&quot;</span>));</span><br><span class="line">      	<span class="comment">//&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span></span><br><span class="line">        <span class="keyword">if</span> (socketState == QAbstractSocket::UnconnectedState) &#123;</span><br><span class="line">            QString deleteSocket = socket-&gt;<span class="built_in">peerAddress</span>().<span class="built_in">toString</span>()+<span class="string">&#x27;:&#x27;</span>+QString::<span class="built_in">number</span>(socket-&gt;<span class="built_in">peerPort</span>());</span><br><span class="line">            <span class="type">int</span> deleteIndex = ui-&gt;socketComboBox-&gt;<span class="built_in">findText</span>(deleteSocket);</span><br><span class="line">            <span class="keyword">if</span> (deleteIndex != <span class="number">-1</span>) &#123;</span><br><span class="line">                ui-&gt;socketComboBox-&gt;<span class="built_in">removeItem</span>(deleteIndex);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// QList&lt;QTcpSocket*&gt; clientSockets = server-&gt;findChildren&lt;QTcpSocket*&gt;();</span></span><br><span class="line">            <span class="comment">// if (clientSockets.size() == 0) &#123;</span></span><br><span class="line">            <span class="comment">//     ui-&gt;socketComboBox-&gt;clear();</span></span><br><span class="line">            <span class="comment">// &#125;</span></span><br><span class="line">            <span class="keyword">if</span> (ui-&gt;socketComboBox-&gt;<span class="built_in">count</span>() == <span class="number">1</span>) &#123;</span><br><span class="line">                ui-&gt;socketComboBox-&gt;<span class="built_in">clear</span>();</span><br><span class="line">                ui-&gt;sendPushButton-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        socket-&gt;<span class="built_in">deleteLater</span>();</span><br><span class="line">      	<span class="comment">//&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (socketState == QAbstractSocket::ConnectedState || socketState == QAbstractSocket::ConnectingState) &#123;</span><br><span class="line">        <span class="comment">// ui-&gt;showTextEdit-&gt;insertPlainText(&quot;socketStateChanged信号引起的客户端连接\n&quot;);</span></span><br><span class="line">        QTextCursor cursor = ui-&gt;showTextEdit-&gt;<span class="built_in">textCursor</span>();</span><br><span class="line">        cursor.<span class="built_in">movePosition</span>(QTextCursor::End);</span><br><span class="line">        ui-&gt;showTextEdit-&gt;<span class="built_in">setAlignment</span>(Qt::AlignLeft);</span><br><span class="line">        QTextCharFormat format;</span><br><span class="line">        format.<span class="built_in">setForeground</span>(<span class="built_in">QBrush</span>(<span class="built_in">QColor</span>(Qt::red)));</span><br><span class="line">        cursor.<span class="built_in">setCharFormat</span>(format);</span><br><span class="line">        cursor.<span class="built_in">insertText</span>( <span class="built_in">QString</span>(me.<span class="built_in">valueToKey</span>(socketState))+<span class="built_in">QString</span>(<span class="string">&quot;信号引起的客户端连接\n&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ui-&gt;showTextEdit-&gt;moveCursor(QTextCursor::End);</span></span><br><span class="line">    <span class="comment">// ui-&gt;showTextEdit-&gt;setTextCursor(ui-&gt;showTextEdit-&gt;textCursor());</span></span><br><span class="line">    <span class="comment">//光标位置</span></span><br><span class="line">    QTextCursor cursor = ui-&gt;showTextEdit-&gt;<span class="built_in">textCursor</span>();</span><br><span class="line">    cursor.<span class="built_in">movePosition</span>(QTextCursor::End);</span><br><span class="line">    ui-&gt;showTextEdit-&gt;<span class="built_in">setTextCursor</span>(cursor);</span><br><span class="line">    ui-&gt;showTextEdit-&gt;<span class="built_in">ensureCursorVisible</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_sendPushButton_clicked</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;服务端发送&quot;</span>;</span><br><span class="line">  	<span class="comment">//&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span></span><br><span class="line">    QList&lt;QTcpSocket *&gt; tcpSocketClients = server-&gt;<span class="built_in">findChildren</span>&lt;QTcpSocket *&gt;();</span><br><span class="line">    <span class="keyword">if</span> (tcpSocketClients.<span class="built_in">size</span>() &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        QMessageBox msgBox;</span><br><span class="line">        msgBox.<span class="built_in">setWindowTitle</span>(<span class="string">&quot;发送错误&quot;</span>);</span><br><span class="line">        msgBox.<span class="built_in">setText</span>(<span class="string">&quot;未指定客户端连接&quot;</span>);</span><br><span class="line">        msgBox.<span class="built_in">exec</span>();</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  	<span class="comment">//&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span></span><br><span class="line">    <span class="keyword">if</span> (socketIndex == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (QTcpSocket *tcpSocketClient: tcpSocketClients) &#123;</span><br><span class="line">            tcpSocketClient-&gt;<span class="built_in">write</span>(ui-&gt;sendTextEdit-&gt;<span class="built_in">toPlainText</span>().<span class="built_in">toUtf8</span>());</span><br><span class="line">            QTextCursor cursor = ui-&gt;showTextEdit-&gt;<span class="built_in">textCursor</span>();</span><br><span class="line">            cursor.<span class="built_in">movePosition</span>(QTextCursor::End);</span><br><span class="line">            ui-&gt;showTextEdit-&gt;<span class="built_in">setAlignment</span>(Qt::AlignRight);</span><br><span class="line">            QTextCharFormat format;</span><br><span class="line">            format.<span class="built_in">setForeground</span>(<span class="built_in">QBrush</span>(<span class="built_in">QColor</span>(Qt::black)));</span><br><span class="line">            cursor.<span class="built_in">setCharFormat</span>(format);</span><br><span class="line">            cursor.<span class="built_in">insertText</span>(ui-&gt;sendTextEdit-&gt;<span class="built_in">toPlainText</span>()+<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        tcpSocketClients[socketIndex - <span class="number">1</span>]-&gt;<span class="built_in">write</span>(ui-&gt;sendTextEdit-&gt;<span class="built_in">toPlainText</span>().<span class="built_in">toUtf8</span>());</span><br><span class="line">        QTextCursor cursor = ui-&gt;showTextEdit-&gt;<span class="built_in">textCursor</span>();</span><br><span class="line">        cursor.<span class="built_in">movePosition</span>(QTextCursor::End);</span><br><span class="line">        ui-&gt;showTextEdit-&gt;<span class="built_in">setAlignment</span>(Qt::AlignRight);</span><br><span class="line">        QTextCharFormat format;</span><br><span class="line">        format.<span class="built_in">setForeground</span>(<span class="built_in">QBrush</span>(<span class="built_in">QColor</span>(Qt::black)));</span><br><span class="line">        cursor.<span class="built_in">setCharFormat</span>(format);</span><br><span class="line">        cursor.<span class="built_in">insertText</span>(ui-&gt;sendTextEdit-&gt;<span class="built_in">toPlainText</span>()+<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="自定义可视化控件">自定义可视化控件</h2>
<h3 id="QPaintEvent绘图事件">QPaintEvent绘图事件</h3>
<p>QPaintEvent是Qt框架中一个重要的事件类，专门用于处理绘图。当Qt视图组件需要重绘自己的一部分时，就会产生QPainterEvent事件。这通常发生以下几种情况：</p>
<ol>
<li>窗口第一次显示时：当窗口或控件第一次出现在屏幕上时，系统会生成一个QPainter事件，通知窗口进行自身的绘制。</li>
<li>窗口大小改变时：当用户改变窗口的大小时，窗口的内容通常需要重新绘制以适应新的尺寸。</li>
<li>窗口部分被遮挡后又重新显示时：如果窗口被其他窗口遮挡，然后又重新露出来，被遮挡的部分通常需要重新绘制。</li>
<li>与控件有互动时：</li>
<li>手动请求重绘：通过调用QWidget的<code>update()</code>或者<code>repaint()</code>方法，可以手动触发重绘事件。</li>
</ol>
<p>在Qt应用程序中，通常通过重写QWidget的<code>paintEvent(QPaintEvent*)</code>方法来处理绘制逻辑。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyWidget</span>: <span class="keyword">public</span> QWidget&#123;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">paintEvent</span><span class="params">(QPaintEvent* event)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">    <span class="function">QPainter <span class="title">painter</span><span class="params">(<span class="keyword">this</span>)</span></span>;</span><br><span class="line">    <span class="comment">//绘制逻辑</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在painEvent方法中，您可以创建一个QPainter对象并使用它来执行绘制操作。QPainter可以绘制各种基本图形，如线条、矩形、椭圆等，还可以绘制文本和图像。重写<code>paintEvent()</code>是在Qt中进行自定义绘制的标准。</p>
<h3 id="QPainter画家">QPainter画家</h3>
<h4 id="概述">概述</h4>
<p>QPainter可以绘制各种基本图形，如线条、矩形、椭圆等，还可以绘制文本和图像。</p>
<ol>
<li>
<p>初始化QPainter: 首先，需要一个QPaintDevice, 比如一个QWidget或QPixmap,然后使用它来初始化QPainter对象。</p>
 <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">QPainter <span class="title">painter</span><span class="params">(<span class="keyword">this</span>)</span></span>;<span class="comment">//假设在QWidget的子类中</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>设置画笔和面刷：你可以设置画笔（用于描边）和画刷（用于填充）的颜色、样式等。</p>
 <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">painter.<span class="built_in">setPen</span>(Qt::blue); <span class="comment">//设置画笔颜色为蓝色, setRenderHint抗锯齿</span></span><br><span class="line">painter.<span class="built_in">setBrush</span>(Qt::yellow);<span class="comment">//设置画刷颜色为黄色</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>绘制图形：使用QPainter的方法来绘制线条、矩形、圆形、文本。</p>
 <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.drawLine(QLineF&amp; line)</span></span><br><span class="line"><span class="comment">//2.drawLine(QLine&amp; line)</span></span><br><span class="line"><span class="comment">//3.drawLine(int x1, int y1, int x2, int y2)</span></span><br><span class="line"><span class="comment">//4.drawLine(QPoint&amp; p1, QPoint&amp; p2)</span></span><br><span class="line"><span class="comment">//5.drawLine(QPointF&amp; p1, QPointF&amp; p2)</span></span><br><span class="line">painter.<span class="built_in">drawLine</span>(<span class="number">10</span>, <span class="number">10</span>, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line"><span class="comment">//1.drawRect(QRectF&amp; rect)</span></span><br><span class="line"><span class="comment">//2.drawRect(int x, int y, int width, int height)</span></span><br><span class="line"><span class="comment">//3.drawRect(QRect&amp; rect)</span></span><br><span class="line">painter.<span class="built_in">drawRect</span>(<span class="number">10</span>, <span class="number">10</span>, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line"><span class="comment">//1.drawEllipse(QRectF&amp; r)</span></span><br><span class="line"><span class="comment">//2.drawEllipse(QRect&amp; r)</span></span><br><span class="line"><span class="comment">//3.drawEllipse(int x, int y, int w, int h)</span></span><br><span class="line"><span class="comment">//4.drawEllipse(QPointF&amp; center, qreal rx, qreal ry)</span></span><br><span class="line"><span class="comment">//5.drawEllipse(QPoint&amp; center, int rx, int ry)</span></span><br><span class="line">painter.<span class="built_in">drawEllipse</span>(<span class="number">10</span>,<span class="number">10</span>,<span class="number">40</span>,<span class="number">50</span>)<span class="comment">//矩形内画椭圆</span></span><br><span class="line"><span class="comment">//1.drawText(int x,int y,QString text)</span></span><br><span class="line"><span class="comment">//2.drawText(QRect rect, QString text)</span></span><br><span class="line"><span class="comment">//3.drawText(QRectF rect, QString text)</span></span><br><span class="line"><span class="comment">//4.drawText(int x, int y, int width, int height, QString text)</span></span><br><span class="line">painter.<span class="built_in">drawText</span>(<span class="number">10</span>, <span class="number">10</span>, <span class="string">&quot;Hello, Qt&quot;</span>); </span><br><span class="line"><span class="comment">//圆弧规定起始角和伸缩角单位是1/16度，所以Qt认为的整圆的度数是5760=360*16。角度正值表示逆时针，负值表示顺时针。零度在3点钟方向。</span></span><br><span class="line"><span class="comment">//1.drawArc(QRect&amp; r, int startAngle, int spanAngle)</span></span><br><span class="line"><span class="comment">//2.drawArc(int x, int y, int w, int h, int startAngle, int spanAngle)</span></span><br><span class="line">painter.<span class="built_in">drawArc</span>(<span class="number">10</span>, <span class="number">10</span>, <span class="number">60</span>, <span class="number">90</span>, <span class="number">45</span>*<span class="number">16</span>, <span class="number">90</span>*<span class="number">16</span>)<span class="comment">//矩形中截取弧线</span></span><br><span class="line"><span class="comment">//扇形</span></span><br><span class="line"><span class="comment">//1.drawPie(QRectF&amp; r, int startAngle, int spanAngle)</span></span><br><span class="line"><span class="comment">//2.drawPie(int x, int y, int width, int height, int startAngle, int spanAngle)</span></span><br><span class="line">painter.<span class="built_in">drawPie</span>(<span class="number">30</span>, <span class="number">50</span>, <span class="number">100</span>, <span class="number">180</span>, <span class="number">30</span>*<span class="number">16</span>, <span class="number">120</span>*<span class="number">16</span>)</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>结束绘制：完成绘制后，QPainter对象会在其析构函数中自动结束绘制。</p>
</li>
</ol>
<p>注意：QPainter的使用依赖于Qt 的事件循环，因此通常在QWidget的paintEvent或者类似的事件处理函数中使用它。如果你在Qt应用程序中使用QPainter, 请确保你遵循Qt的事件驱动机制。</p>
<h4 id="渐变色">渐变色</h4>
<h5 id="线性渐变色">线性渐变色</h5>
<p>QLinearGradient是Qt框架中用于创建线性渐变的类。线性渐变是一种从一个颜色过渡到另一个颜色的效果，其变化沿着两个点之间的直线进行。它用于添加深度、立体或动态效果。</p>
<ul>
<li>基本用法
<ol>
<li>创建QLinearGradient对象：指定渐变的起点和终点坐标。</li>
<li>设置颜色停靠点：在渐变线上定义颜色和相应的位置。</li>
<li>使用渐变创建QBrush:用QLinearGradient对象来创建一个QBrush,然后用QBrush在QPainter中进行绘制。</li>
</ol>
</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QPainter&gt;</span></span></span><br><span class="line"><span class="meta">#incldue <span class="string">&lt;QLinearGradient&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MyWidget::paintEvent</span><span class="params">(QPaintEvent*)</span></span>&#123;</span><br><span class="line">  <span class="comment">//创建QLinearGradient</span></span><br><span class="line">  <span class="function">QLinearGradient <span class="title">linearGradient</span><span class="params">(<span class="number">0</span>,<span class="number">0</span>,<span class="number">100</span>,<span class="number">100</span>)</span></span>;<span class="comment">//起点（0，0）终点（100，100）</span></span><br><span class="line">  <span class="comment">//设置颜色停靠点</span></span><br><span class="line">  linearGradient.<span class="built_in">setColorAt</span>(<span class="number">0</span>, Qt::red);<span class="comment">//起点色 QColor(r,g,b,transparent)</span></span><br><span class="line">  linearGradient.<span class="built_in">setColorAt</span>(<span class="number">1</span>, Qt::blue);<span class="comment">//终点色</span></span><br><span class="line">  <span class="comment">//使用该渐变色创建QBrush</span></span><br><span class="line">  <span class="function">QBrush <span class="title">brush</span><span class="params">(linearGradient)</span></span>;</span><br><span class="line">  <span class="comment">//使用QBrush绘图</span></span><br><span class="line">  <span class="function">QPainter <span class="title">painter</span><span class="params">(<span class="keyword">this</span>)</span></span>;</span><br><span class="line">  painter.<span class="built_in">setBrush</span>(brush);</span><br><span class="line">  painter.<span class="built_in">setPen</span>(Qt::NoPen);<span class="comment">//无边框</span></span><br><span class="line">  painter.<span class="built_in">drawRect</span>(<span class="keyword">this</span>-&gt;<span class="built_in">rect</span>());<span class="comment">//绘制矩形覆盖整个部件</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>QLinearGradient创建了一个从红色到蓝色的渐变，其方向是从小部件的左上角（0，0）到右下角（100，100）。</p>
<p><strong>注意</strong>：</p>
<ul>
<li>QLinearGradient的颜色变化是岩着两个指定点之间的直线进行的。通过改变这些点的位置，你可以控制渐变的方向和长度。</li>
<li><code>setColorAt()</code>方法的第一个参数是一个介于0.0和1.0之间的浮点数，表示颜色在渐变线上的位置。0.0通常对应于起点，1.0对应于终点。</li>
<li>你可以设置多个颜色停靠点来创建更复杂的渐变效果。例如，可以在0.0处设置一种颜色，在0.5处设置一种颜色，在1.0处在设置一种颜色。</li>
<li>使用QLi nearGradient创建的QBrush可以用于填充任何形状，如矩形、椭圆、多边形。</li>
<li>为了获取更好的视觉效果，可以启用QPainter的抗锯齿选项(QPainter::Antialiasing).</li>
<li>当窗口部件的大小发生变化时，渐变的效果可能也会随之改变，除非你相应地调整渐变的起点和终点坐标或使用其他方法来适应大小变化。</li>
</ul>
<h5 id="径向渐变">径向渐变</h5>
<p>QRadialGradient是Qt框架中用于创建径向渐变的类，径向渐变是从中心向周围辐射的颜色渐变，通常在中心点有一种颜色，外围设置另一种颜色，该渐变适合模拟光源、阴影或创建圆形立体感。</p>
<ul>
<li>基本用法
<ol>
<li>创建QRadialGradient对象：指定渐变中心，半径和焦点（可选）。</li>
<li>设置颜色停靠点：在径向渐变中定义颜色和对应的位置。</li>
<li>使用渐变创建QBrush之后用QPainter绘制。</li>
</ol>
</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QPainter&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QRadialGradient&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Mywidget::paintEvent</span><span class="params">(QPaintEvent* e)</span></span>&#123;</span><br><span class="line">  <span class="comment">//创建QRadialGradient对象</span></span><br><span class="line">  <span class="function">QRadialGradient <span class="title">radialGradient</span><span class="params">(<span class="number">50</span>, <span class="number">50</span>, <span class="number">50</span>)</span></span>; <span class="comment">//中心（50，50）半径50</span></span><br><span class="line">  <span class="comment">//设置焦点</span></span><br><span class="line">  radialGradient.<span class="built_in">setFocalPoint</span>(<span class="number">30</span>,<span class="number">30</span>);</span><br><span class="line">  <span class="comment">//设置颜色停靠点</span></span><br><span class="line">  radialGradient.<span class="built_in">setColorAt</span>(<span class="number">0.0</span>, Qt::yellow);<span class="comment">//中心颜色</span></span><br><span class="line">  radialGradient.<span class="built_in">setColorAt</span>(<span class="number">1.0</span>, Qt::black); <span class="comment">//外部圆环处颜色</span></span><br><span class="line">  <span class="comment">//创建QBrush</span></span><br><span class="line">  <span class="function">QBrush <span class="title">brush</span><span class="params">(radialGradient)</span></span>;</span><br><span class="line">  <span class="comment">//QPainter绘图</span></span><br><span class="line">  <span class="function">QPainter <span class="title">painter</span><span class="params">(<span class="keyword">this</span>)</span></span>;</span><br><span class="line">  painter.<span class="built_in">setBrush</span>(brush);</span><br><span class="line">  painter.<span class="built_in">setPen</span>(Qt::NoPen)<span class="comment">//无边框</span></span><br><span class="line">  painter.<span class="built_in">drawRect</span>(<span class="keyword">this</span>-&gt;<span class="built_in">rect</span>());<span class="comment">//绘制矩形</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>注意</strong>：</p>
<ul>
<li><code>setColorAt()</code>方法的第一个参数是一个介于0.0和1.0之间的浮点数，表示颜色在径向渐变中的位置，0.0通常对应于中心点，1.0对应于边缘。</li>
<li>通过添加多个颜色停靠点，可以创建复杂的径向渐变效果。</li>
<li><code>setFocalPoint()</code>方法允许你设置焦点位置，这是渐变颜色开始变化的点，可以与中心点不同。</li>
<li>使用<code>QRadialGradient</code>创建的QBrush可以用于填充任何形状，如矩形、椭圆、多边形等。</li>
<li>为了获取更好的视觉效果，可以启用QPainter的抗锯齿项<code>QPainter::Antialiasing</code>。</li>
<li>当绘制较大区域时，可以通过调整渐变的半径和中心点来控制渐变效果的扩展。</li>
<li><code>QRadialGradient</code>非常适用于创建按钮、指示灯或其他需要有深度感和立体感的界面元素。</li>
</ul>
<h5 id="圆锥形渐变">圆锥形渐变</h5>
<p>QConicalGradient是用于创建圆锥渐变的类。圆锥渐变颜色沿方位角变化，以中心点和初始角为基线 ，颜色沿圆周渐变分布，适合富有动感的视觉效果。</p>
<ul>
<li>基本用法
<ol>
<li>创建QConicalGradient对象：指定渐变中心和起始方位角。</li>
<li>设置颜色停靠点：为渐变添加不同的颜色和方位角。</li>
<li>创建Brush之后用QPainter绘图。</li>
</ol>
</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QPainter&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QConicalGradient&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Mywidget::paintEvent</span><span class="params">(QPaintEvent*)</span></span>&#123;</span><br><span class="line">  <span class="function">QConicalGradient <span class="title">conical</span><span class="params">(<span class="number">100</span>, <span class="number">100</span>, <span class="number">0</span>)</span></span>; <span class="comment">//中心点（100，100），起始角0</span></span><br><span class="line">  conical.<span class="built_in">setColorAt</span>(<span class="number">0.0</span>, Qt::red); </span><br><span class="line">  conical.<span class="built_in">setColorAt</span>(<span class="number">0.5</span>, Qt::blue);</span><br><span class="line">  conical.<span class="built_in">setColorAt</span>(<span class="number">0.0</span>, Qt::red); </span><br><span class="line">  <span class="function">QBrush <span class="title">brush</span><span class="params">(conical)</span></span>;</span><br><span class="line">  <span class="function">QPainter <span class="title">painter</span><span class="params">(<span class="keyword">this</span>)</span></span>;</span><br><span class="line">  painter.<span class="built_in">setBrush</span>(brush);</span><br><span class="line">  painter.<span class="built_in">setPen</span>(Qt::NoPen);</span><br><span class="line">  painter.<span class="built_in">drawRect</span>(<span class="keyword">this</span>-&gt;<span class="built_in">rect</span>());</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>注意</strong>：</p>
<ul>
<li>QConicalGradient颜色是沿着圆周即辐角分布，其中0.0和1.0在圆周上是相同的位置即转一圈。</li>
<li>角度正顺时针，角度负逆时针，角度的单位是度，0度3点钟方向。</li>
<li>适用于创建旋转或动态效果图，如加载指示器，进度条等。</li>
</ul>
<h3 id="雷达">雷达</h3>
<p><img src="/2025/02/24/QT-C/QT-C/%E9%9B%B7%E8%BE%BE.gif" alt="雷达"></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//mainwindow.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> MAINWINDOW_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAINWINDOW_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QMainWindow&gt;</span></span></span><br><span class="line"></span><br><span class="line">QT_BEGIN_NAMESPACE</span><br><span class="line"><span class="keyword">namespace</span> Ui &#123;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MainWindow</span>;</span><br><span class="line">&#125;</span><br><span class="line">QT_END_NAMESPACE</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MainWindow</span> : <span class="keyword">public</span> QMainWindow</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">MainWindow</span>(QWidget *parent = <span class="literal">nullptr</span>);</span><br><span class="line">    ~<span class="built_in">MainWindow</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Ui::MainWindow *ui;</span><br><span class="line">    QTimer* timer;</span><br><span class="line">    <span class="type">int</span> startAngleGlobal;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">paintEvent</span><span class="params">(QPaintEvent *event)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// MAINWINDOW_H</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//mainwindow.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;mainwindow.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ui_mainwindow.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QPainter&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QTimer&gt;</span></span></span><br><span class="line"></span><br><span class="line">MainWindow::<span class="built_in">MainWindow</span>(QWidget *parent)</span><br><span class="line">    : <span class="built_in">QMainWindow</span>(parent)</span><br><span class="line">    , <span class="built_in">ui</span>(<span class="keyword">new</span> Ui::MainWindow)</span><br><span class="line">&#123;</span><br><span class="line">    ui-&gt;<span class="built_in">setupUi</span>(<span class="keyword">this</span>);</span><br><span class="line">    ui-&gt;centralwidget-&gt;<span class="built_in">setLayout</span>(ui-&gt;regionGridLayout);</span><br><span class="line">    startAngleGlobal = <span class="number">0</span>;</span><br><span class="line">    timer = <span class="keyword">new</span> <span class="built_in">QTimer</span>(<span class="keyword">this</span>);</span><br><span class="line">    timer-&gt;<span class="built_in">setInterval</span>(<span class="number">500</span>);</span><br><span class="line">    timer-&gt;<span class="built_in">start</span>();</span><br><span class="line">    <span class="built_in">connect</span>(timer, &amp;QTimer::timeout, [=]()&#123;<span class="built_in">update</span>();&#125;);<span class="comment">//定时器超时触发update(),update()又触发paintEvent事件</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MainWindow::~<span class="built_in">MainWindow</span>()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">delete</span> ui;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::paintEvent</span><span class="params">(QPaintEvent *event)</span> </span>&#123;</span><br><span class="line">    <span class="function">QPainter <span class="title">painter</span><span class="params">(<span class="keyword">this</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">QPen <span class="title">pen</span><span class="params">(QColor(<span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>), <span class="number">3</span>)</span></span>;</span><br><span class="line">    <span class="comment">// painter.setPen(Qt::NoPen);</span></span><br><span class="line">    painter.<span class="built_in">setRenderHint</span>(QPainter::Antialiasing, <span class="literal">true</span>);</span><br><span class="line">    painter.<span class="built_in">setPen</span>(pen);</span><br><span class="line">    painter.<span class="built_in">save</span>();</span><br><span class="line"></span><br><span class="line">    <span class="function">QBrush <span class="title">brush</span><span class="params">(QColor(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">220</span>))</span></span>;</span><br><span class="line">    painter.<span class="built_in">setBrush</span>(brush);</span><br><span class="line"></span><br><span class="line">    QRect rect =  ui-&gt;centralwidget-&gt;<span class="built_in">rect</span>(); <span class="comment">//(0,0, 60, 60);</span></span><br><span class="line">    painter.<span class="built_in">setPen</span>(Qt::NoPen);</span><br><span class="line">    painter.<span class="built_in">drawRect</span>(rect);</span><br><span class="line">    painter.<span class="built_in">restore</span>();</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> circleNum = <span class="number">5</span>;</span><br><span class="line">    <span class="type">int</span> side = (rect.<span class="built_in">width</span>()/<span class="number">2</span>&lt;rect.<span class="built_in">height</span>()/<span class="number">2</span>)?(rect.<span class="built_in">width</span>()/<span class="number">2</span>):(rect.<span class="built_in">height</span>()/<span class="number">2</span>);</span><br><span class="line">    <span class="type">int</span> interval = side/circleNum;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>; i&lt;=circleNum; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (side-i*interval&gt;=<span class="number">0</span>) &#123;</span><br><span class="line">            painter.<span class="built_in">drawEllipse</span>(rect.<span class="built_in">center</span>(), i*interval, i*interval);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//除不尽所以有露头</span></span><br><span class="line">    <span class="comment">// painter.drawLine(rect.center().x()-side, rect.center().y(), rect.center().x()+side, rect.center().y());</span></span><br><span class="line">    <span class="comment">// painter.drawLine(rect.center().x(), rect.center().y()+side, rect.center().x(), rect.center().y()-side);</span></span><br><span class="line">    painter.<span class="built_in">drawLine</span>(rect.<span class="built_in">center</span>().<span class="built_in">x</span>()-interval*circleNum, rect.<span class="built_in">center</span>().<span class="built_in">y</span>(), rect.<span class="built_in">center</span>().<span class="built_in">x</span>()+interval*circleNum, rect.<span class="built_in">center</span>().<span class="built_in">y</span>());</span><br><span class="line">    painter.<span class="built_in">drawLine</span>(rect.<span class="built_in">center</span>().<span class="built_in">x</span>(), rect.<span class="built_in">center</span>().<span class="built_in">y</span>()+interval*circleNum, rect.<span class="built_in">center</span>().<span class="built_in">x</span>(), rect.<span class="built_in">center</span>().<span class="built_in">y</span>()-interval*circleNum);</span><br><span class="line">    <span class="comment">//画扇形</span></span><br><span class="line">    <span class="keyword">if</span> (startAngleGlobal &gt; <span class="number">360</span>) startAngleGlobal -= <span class="number">360</span>;</span><br><span class="line">    <span class="type">int</span> startAngle = startAngleGlobal;</span><br><span class="line">    <span class="type">int</span> spanAngle = <span class="number">-90</span>;</span><br><span class="line">    <span class="function">QRect <span class="title">rectPie</span><span class="params">(rect.center().x()-interval*circleNum, rect.center().y()-interval*circleNum, interval*circleNum*<span class="number">2</span>, interval*circleNum*<span class="number">2</span>)</span></span>;</span><br><span class="line">  	<span class="comment">//锥形渐变</span></span><br><span class="line">    <span class="function">QConicalGradient <span class="title">conicalGradient</span><span class="params">(rect.center(), startAngle)</span></span>;</span><br><span class="line">    conicalGradient.<span class="built_in">setColorAt</span>(<span class="number">0.0</span>, <span class="built_in">QColor</span>(<span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>));</span><br><span class="line">    conicalGradient.<span class="built_in">setColorAt</span>(<span class="number">0.8</span>, <span class="built_in">QColor</span>(<span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>));</span><br><span class="line">    conicalGradient.<span class="built_in">setColorAt</span>(<span class="number">0.9</span>, <span class="built_in">QColor</span>(<span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">50</span>));</span><br><span class="line">    conicalGradient.<span class="built_in">setColorAt</span>(<span class="number">1.0</span>, <span class="built_in">QColor</span>(<span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">100</span>));</span><br><span class="line">    <span class="function">QBrush <span class="title">brushPie</span><span class="params">(conicalGradient)</span></span>;</span><br><span class="line">    painter.<span class="built_in">setBrush</span>(brushPie);</span><br><span class="line">    painter.<span class="built_in">setPen</span>(Qt::NoPen);</span><br><span class="line">    painter.<span class="built_in">drawPie</span>(rectPie, startAngle*<span class="number">16</span>, spanAngle*<span class="number">16</span>);</span><br><span class="line">    startAngleGlobal += <span class="built_in">abs</span>(<span class="number">30</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="简易仪表盘">简易仪表盘</h3>
<p><img src="/2025/02/24/QT-C/QT-C/%E4%BB%AA%E8%A1%A8%E7%9B%98.gif" alt="仪表盘"></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//mainwindow.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> MAINWINDOW_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAINWINDOW_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QMainWindow&gt;</span></span></span><br><span class="line"></span><br><span class="line">QT_BEGIN_NAMESPACE</span><br><span class="line"><span class="keyword">namespace</span> Ui &#123;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MainWindow</span>;</span><br><span class="line">&#125;</span><br><span class="line">QT_END_NAMESPACE</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MainWindow</span> : <span class="keyword">public</span> QMainWindow</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">MainWindow</span>(QWidget *parent = <span class="literal">nullptr</span>);</span><br><span class="line">    ~<span class="built_in">MainWindow</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">paintEvent</span><span class="params">(QPaintEvent *event)</span> <span class="keyword">override</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Ui::MainWindow *ui;</span><br><span class="line">    QTimer* timer;</span><br><span class="line">    <span class="type">float</span> currentAngleGlobal=<span class="number">0</span>;</span><br><span class="line">    <span class="comment">//刻度范围</span></span><br><span class="line">    <span class="type">int</span> maxAngle = <span class="number">210</span>;</span><br><span class="line">    <span class="type">int</span> minAngle = <span class="number">-30</span>;<span class="comment">//330;</span></span><br><span class="line">    <span class="comment">//顺时针和逆时针切换</span></span><br><span class="line">    <span class="type">int</span> mark = <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// MAINWINDOW_H</span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//mainwindow.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;mainwindow.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ui_mainwindow.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QPainter&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QTimer&gt;</span></span></span><br><span class="line"></span><br><span class="line">MainWindow::<span class="built_in">MainWindow</span>(QWidget *parent)</span><br><span class="line">    : <span class="built_in">QMainWindow</span>(parent)</span><br><span class="line">    , <span class="built_in">ui</span>(<span class="keyword">new</span> Ui::MainWindow)</span><br><span class="line">&#123;</span><br><span class="line">    ui-&gt;<span class="built_in">setupUi</span>(<span class="keyword">this</span>);</span><br><span class="line">    ui-&gt;centralwidget-&gt;<span class="built_in">setLayout</span>(ui-&gt;centralGL);</span><br><span class="line">    timer = <span class="keyword">new</span> <span class="built_in">QTimer</span>(<span class="keyword">this</span>);</span><br><span class="line">    timer-&gt;<span class="built_in">setInterval</span>(<span class="number">500</span>);</span><br><span class="line">    timer-&gt;<span class="built_in">start</span>();</span><br><span class="line">    <span class="built_in">connect</span>(timer, &amp;QTimer::timeout, [=]() &#123;</span><br><span class="line">        <span class="keyword">if</span> (mark == <span class="number">0</span>) &#123; <span class="comment">//顺时针</span></span><br><span class="line">            currentAngleGlobal -= <span class="number">30</span>;</span><br><span class="line">            <span class="comment">// if ()</span></span><br><span class="line">            <span class="keyword">if</span> (currentAngleGlobal &lt; minAngle) &#123;</span><br><span class="line">                currentAngleGlobal = minAngle;</span><br><span class="line">                mark = <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (mark==<span class="number">1</span>) &#123; <span class="comment">//逆时针</span></span><br><span class="line">            currentAngleGlobal += <span class="number">40</span>;</span><br><span class="line">            <span class="keyword">if</span> (currentAngleGlobal &gt; maxAngle) &#123;</span><br><span class="line">                currentAngleGlobal = maxAngle;</span><br><span class="line">                mark = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">update</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MainWindow::~<span class="built_in">MainWindow</span>()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">delete</span> ui;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::paintEvent</span><span class="params">(QPaintEvent *event)</span> </span>&#123;</span><br><span class="line">    QMainWindow::<span class="built_in">paintEvent</span>(event);</span><br><span class="line">    <span class="function">QPainter <span class="title">painter</span><span class="params">(<span class="keyword">this</span>)</span></span>;</span><br><span class="line">    <span class="comment">//绘图区域</span></span><br><span class="line">    <span class="comment">//不要用mainwindow的rect(),而是mainwindow里的centralwidget的rect()</span></span><br><span class="line">    QRect rect = ui-&gt;centralwidget-&gt;<span class="built_in">rect</span>();</span><br><span class="line">    <span class="comment">//抗锯齿</span></span><br><span class="line">    painter.<span class="built_in">setRenderHint</span>(QPainter::Antialiasing, <span class="literal">true</span>);</span><br><span class="line">    <span class="comment">//底色黑色</span></span><br><span class="line">    painter.<span class="built_in">setBrush</span>(Qt::black);</span><br><span class="line">    painter.<span class="built_in">drawRect</span>(rect);</span><br><span class="line">    painter.<span class="built_in">setBrush</span>(Qt::BrushStyle::NoBrush);</span><br><span class="line">    <span class="comment">//坐标系平移到中心, 矩形内切圆</span></span><br><span class="line">    <span class="comment">// painter.translate(rect().center());</span></span><br><span class="line">    <span class="comment">//1.画大圆</span></span><br><span class="line">    <span class="type">int</span> radius = (rect.<span class="built_in">center</span>().<span class="built_in">x</span>()&gt;rect.<span class="built_in">center</span>().<span class="built_in">y</span>())?rect.<span class="built_in">center</span>().<span class="built_in">y</span>():rect.<span class="built_in">center</span>().<span class="built_in">x</span>();</span><br><span class="line">    <span class="comment">// painter.setPen(Qt::red);</span></span><br><span class="line">    <span class="comment">//径向渐变色</span></span><br><span class="line">    <span class="function">QRadialGradient <span class="title">radGradient</span><span class="params">(rect.center(), radius)</span></span>;</span><br><span class="line">    <span class="comment">//颜色停靠点</span></span><br><span class="line">    radGradient.<span class="built_in">setColorAt</span>(<span class="number">0.0</span>, <span class="built_in">QColor</span>(<span class="number">255</span>,<span class="number">0</span>,<span class="number">0</span>, <span class="number">50</span>));</span><br><span class="line">    radGradient.<span class="built_in">setColorAt</span>(<span class="number">1.0</span>, <span class="built_in">QColor</span>(<span class="number">255</span>,<span class="number">0</span>,<span class="number">0</span>, <span class="number">250</span>));</span><br><span class="line">    painter.<span class="built_in">drawEllipse</span>(rect.<span class="built_in">center</span>(), radius, radius);</span><br><span class="line">    <span class="comment">//新Brush</span></span><br><span class="line">    <span class="function">QBrush <span class="title">brush</span><span class="params">(radGradient)</span></span>;</span><br><span class="line">    painter.<span class="built_in">setBrush</span>(brush);</span><br><span class="line">    painter.<span class="built_in">drawEllipse</span>(rect.<span class="built_in">center</span>(), radius, radius);</span><br><span class="line">    painter.<span class="built_in">setBrush</span>(Qt::BrushStyle::NoBrush);</span><br><span class="line">    <span class="comment">//2.画小圆</span></span><br><span class="line">    <span class="type">float</span> ratio = <span class="number">1.</span>/<span class="number">5</span>;</span><br><span class="line">    <span class="type">int</span> smallRadius = (<span class="type">int</span>)(radius*ratio);</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;smallRadius:&quot;</span> &lt;&lt; smallRadius &lt;&lt; <span class="string">&quot;, radio: &quot;</span> &lt;&lt; ratio &lt;&lt; <span class="string">&quot;, Radius: &quot;</span> &lt;&lt; radius;</span><br><span class="line">    <span class="function">QPen <span class="title">pen</span><span class="params">(Qt::white)</span></span>;</span><br><span class="line">    pen.<span class="built_in">setWidth</span>(<span class="number">3</span>);</span><br><span class="line">    painter.<span class="built_in">setPen</span>(pen);</span><br><span class="line">    painter.<span class="built_in">drawEllipse</span>(rect.<span class="built_in">center</span>(), smallRadius, smallRadius);</span><br><span class="line">    painter.<span class="built_in">setPen</span>(Qt::NoPen);</span><br><span class="line">    <span class="comment">//3.画刻度</span></span><br><span class="line">    <span class="type">int</span> textNum = <span class="number">8</span>;<span class="comment">//必须被360整除</span></span><br><span class="line">    <span class="comment">// qDebug() &lt;&lt; &quot;sin30: &quot; &lt;&lt; sin(30*M_PI/180);</span></span><br><span class="line">    pen.<span class="built_in">setWidth</span>(<span class="number">2</span>);</span><br><span class="line">    painter.<span class="built_in">setPen</span>(pen);</span><br><span class="line">    <span class="type">float</span> bigTick = (<span class="number">1</span><span class="number">-0.9</span>)*radius;</span><br><span class="line">    <span class="type">float</span> midTick = (<span class="number">1</span><span class="number">-0.93</span>)*radius;</span><br><span class="line">    <span class="type">float</span> smallTick = (<span class="number">1</span><span class="number">-0.96</span>)*radius;</span><br><span class="line">    <span class="type">float</span> textRadius = <span class="number">0.8</span>*radius;</span><br><span class="line">    <span class="comment">//刻度范围</span></span><br><span class="line">    <span class="comment">// int maxAngle = 210;</span></span><br><span class="line">    <span class="comment">// int minAngle = -30;//330;</span></span><br><span class="line">    <span class="type">int</span> tickInterval = (<span class="type">int</span>)(<span class="number">360.</span>/textNum/<span class="number">10</span>);</span><br><span class="line">    <span class="type">int</span> tickCount = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = maxAngle; i &gt;= minAngle; i-=tickInterval) &#123;</span><br><span class="line">        <span class="type">float</span> xOut = <span class="built_in">cos</span>(i*M_PI/<span class="number">180</span>)*radius+rect.<span class="built_in">center</span>().<span class="built_in">x</span>();</span><br><span class="line">        <span class="type">float</span> yOut = -<span class="built_in">sin</span>(i*M_PI/<span class="number">180</span>)*radius+rect.<span class="built_in">center</span>().<span class="built_in">y</span>();</span><br><span class="line">        <span class="type">float</span> xIn;</span><br><span class="line">        <span class="type">float</span> yIn;</span><br><span class="line">        <span class="type">float</span> xText;</span><br><span class="line">        <span class="type">float</span> yText;</span><br><span class="line">        <span class="keyword">if</span> (tickCount%<span class="number">5</span> == <span class="number">0</span> &amp;&amp; tickCount%<span class="number">10</span> == <span class="number">0</span>) &#123;</span><br><span class="line">            xIn = <span class="built_in">cos</span>(i*M_PI/<span class="number">180</span>)*(radius-bigTick)+rect.<span class="built_in">center</span>().<span class="built_in">x</span>();</span><br><span class="line">            yIn = -<span class="built_in">sin</span>(i*M_PI/<span class="number">180</span>)*(radius-bigTick)+rect.<span class="built_in">center</span>().<span class="built_in">y</span>();</span><br><span class="line">            xText = <span class="built_in">cos</span>(i*M_PI/<span class="number">180</span>)*textRadius+rect.<span class="built_in">center</span>().<span class="built_in">x</span>();</span><br><span class="line">            yText = -<span class="built_in">sin</span>(i*M_PI/<span class="number">180</span>)*textRadius+rect.<span class="built_in">center</span>().<span class="built_in">y</span>();</span><br><span class="line">            <span class="comment">//作为文字矩形框的中心点</span></span><br><span class="line">            <span class="function">QPointF <span class="title">pointText</span><span class="params">(xText, yText)</span></span>;</span><br><span class="line">            <span class="comment">//半长，半宽</span></span><br><span class="line">            <span class="type">float</span> halfWidth = <span class="number">1.5</span>*bigTick;</span><br><span class="line">            <span class="type">float</span> halfHeight = <span class="number">1.5</span>*bigTick;</span><br><span class="line">            QFont font;</span><br><span class="line">            font.<span class="built_in">setPointSize</span>(bigTick);</span><br><span class="line">            font.<span class="built_in">setWeight</span>(QFont::Thin);</span><br><span class="line">            painter.<span class="built_in">setFont</span>(font);</span><br><span class="line">            <span class="function">QRectF <span class="title">rectText</span><span class="params">(pointText.x()-halfWidth, pointText.y()-halfHeight, <span class="number">2</span>*halfWidth, <span class="number">2</span>*halfHeight)</span></span>;</span><br><span class="line">            painter.<span class="built_in">drawText</span>(rectText, Qt::AlignCenter, QString::<span class="built_in">number</span>(tickCount));</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (tickCount%<span class="number">5</span> == <span class="number">0</span> &amp;&amp; tickCount%<span class="number">10</span> != <span class="number">0</span>) &#123;</span><br><span class="line">            xIn = <span class="built_in">cos</span>(i*M_PI/<span class="number">180</span>)*(radius-midTick)+rect.<span class="built_in">center</span>().<span class="built_in">x</span>();</span><br><span class="line">            yIn = -<span class="built_in">sin</span>(i*M_PI/<span class="number">180</span>)*(radius-midTick)+rect.<span class="built_in">center</span>().<span class="built_in">y</span>();</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            xIn = <span class="built_in">cos</span>(i*M_PI/<span class="number">180</span>)*(radius-smallTick)+rect.<span class="built_in">center</span>().<span class="built_in">x</span>();</span><br><span class="line">            yIn = -<span class="built_in">sin</span>(i*M_PI/<span class="number">180</span>)*(radius-smallTick)+rect.<span class="built_in">center</span>().<span class="built_in">y</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        tickCount++;</span><br><span class="line">        <span class="function">QPointF <span class="title">pointOut</span><span class="params">(xOut, yOut)</span></span>;</span><br><span class="line">        <span class="function">QPointF <span class="title">pointIn</span><span class="params">(xIn, yIn)</span></span>;</span><br><span class="line">        painter.<span class="built_in">drawLine</span>(pointIn, pointOut);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//4.画指针</span></span><br><span class="line">    <span class="comment">// if (currentAngleGlobal &gt; maxAngle || currentAngleGlobal &lt; minAngle) &#123;</span></span><br><span class="line">    <span class="comment">//     currentAngleGlobal = maxAngle;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    <span class="type">float</span> currentAngle = currentAngleGlobal;<span class="comment">//190;</span></span><br><span class="line">    <span class="type">float</span> arrowRadius = <span class="number">0.68</span>*radius;</span><br><span class="line">    <span class="type">float</span> xArrowOut = <span class="built_in">cos</span>(currentAngle*M_PI/<span class="number">180</span>)*arrowRadius+rect.<span class="built_in">center</span>().<span class="built_in">x</span>();</span><br><span class="line">    <span class="type">float</span> yArrowOut = -<span class="built_in">sin</span>(currentAngle*M_PI/<span class="number">180</span>)*arrowRadius+rect.<span class="built_in">center</span>().<span class="built_in">y</span>();</span><br><span class="line">    <span class="type">float</span> xArrowIn = <span class="built_in">cos</span>(currentAngle*M_PI/<span class="number">180</span>)*smallRadius+rect.<span class="built_in">center</span>().<span class="built_in">x</span>();</span><br><span class="line">    <span class="type">float</span> yArrowIn = -<span class="built_in">sin</span>(currentAngle*M_PI/<span class="number">180</span>)*smallRadius+rect.<span class="built_in">center</span>().<span class="built_in">y</span>();</span><br><span class="line">    <span class="function">QPointF <span class="title">pointArrowOut</span><span class="params">(xArrowOut, yArrowOut)</span></span>;</span><br><span class="line">    <span class="function">QPointF <span class="title">pointArrowIn</span><span class="params">(xArrowIn, yArrowIn)</span></span>;</span><br><span class="line">    painter.<span class="built_in">drawLine</span>(pointArrowIn, pointArrowOut);</span><br><span class="line">    <span class="comment">//5.画扇形</span></span><br><span class="line">    <span class="function">QRectF <span class="title">rectPie</span><span class="params">(rect.center().x()-arrowRadius, rect.center().y()-arrowRadius, arrowRadius*<span class="number">2</span>, arrowRadius*<span class="number">2</span>)</span></span>;</span><br><span class="line">    painter.<span class="built_in">setPen</span>(Qt::NoPen);</span><br><span class="line">    <span class="function">QRadialGradient <span class="title">arrowRG</span><span class="params">(rectPie.center(), arrowRadius)</span></span>;</span><br><span class="line">    arrowRG.<span class="built_in">setColorAt</span>(<span class="number">0.0</span>, <span class="built_in">QColor</span>(<span class="number">255</span>,<span class="number">153</span>,<span class="number">18</span>, <span class="number">0</span>));</span><br><span class="line">    arrowRG.<span class="built_in">setColorAt</span>(<span class="number">0.3</span>, <span class="built_in">QColor</span>(<span class="number">255</span>,<span class="number">153</span>,<span class="number">18</span>, <span class="number">0</span>));</span><br><span class="line">    arrowRG.<span class="built_in">setColorAt</span>(<span class="number">1.0</span>, <span class="built_in">QColor</span>(<span class="number">255</span>,<span class="number">153</span>,<span class="number">18</span>, <span class="number">200</span>));</span><br><span class="line">    <span class="function">QBrush <span class="title">arrowBrush</span><span class="params">(arrowRG)</span></span>;</span><br><span class="line">    painter.<span class="built_in">setBrush</span>(arrowBrush);</span><br><span class="line">    painter.<span class="built_in">drawPie</span>(rectPie, currentAngle*<span class="number">16</span>, (maxAngle-currentAngle)*<span class="number">16</span>);</span><br><span class="line">    <span class="comment">//6.显示刻度值</span></span><br><span class="line">    <span class="comment">//作为文字矩形框的中心点</span></span><br><span class="line">    <span class="function">QPointF <span class="title">pointText</span><span class="params">(rect.center().x(), rect.center().y())</span></span>;</span><br><span class="line">    <span class="comment">//半长，半宽</span></span><br><span class="line">    <span class="type">float</span> halfWidth = smallRadius;</span><br><span class="line">    <span class="type">float</span> halfHeight = smallRadius;</span><br><span class="line">    QFont font;</span><br><span class="line">    font.<span class="built_in">setPointSize</span>(smallRadius*<span class="number">0.8</span>);</span><br><span class="line">    font.<span class="built_in">setWeight</span>(QFont::Bold);</span><br><span class="line">    painter.<span class="built_in">setFont</span>(font);</span><br><span class="line">    <span class="function">QRectF <span class="title">rectText</span><span class="params">(pointText.x()-halfWidth, pointText.y()-halfHeight, <span class="number">2</span>*halfWidth, <span class="number">2</span>*halfHeight)</span></span>;</span><br><span class="line">    painter.<span class="built_in">setPen</span>(Qt::white);</span><br><span class="line">    painter.<span class="built_in">drawText</span>(rectText, Qt::AlignCenter, QString::<span class="built_in">number</span>((maxAngle-currentAngle)/tickInterval));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="汽车仪表盘">汽车仪表盘</h3>
<p><img src="/2025/02/24/QT-C/QT-C/%E6%B1%BD%E8%BD%A6%E4%BB%AA%E8%A1%A8.gif" alt="汽车仪表"></p>
<p>文字沿着圆周绘制方法：</p>
<ol>
<li>
<p>使用平移和旋转操作坐标轴再绘制文字</p>
<p><code>painter.save()</code>-&gt;<code>painter.translate(x,y)</code>-&gt;<code>painter.rotate(</code>$\theta$<code>)</code>-&gt;painter.restore()</p>
</li>
<li>
<p>使用QPainterPath路径对象</p>
</li>
</ol>
<ul>
<li>
<p>设置路径形状path.addEllipse(center, radius, radius);</p>
</li>
<li>
<p>根据路径的位置过去坐标点和角度。</p>
<p>QPointF point = path.pointAtPercent(pos)</p>
<p>qreal angle = path.angleAtPercent(pos)</p>
</li>
<li>
<p>使用translate平移和rotate旋转坐标系。</p>
</li>
<li>
<p>drawText绘制文本。</p>
</li>
</ul>
<p>多边形画指针</p>
<ul>
<li>画指针用到多边形<code>drawPolygon(QPointF* points, int pointCount, Qt::FillRule fillRule)</code></li>
</ul>
<p>使用资源文件插入商标。</p>
<ul>
<li><code>drawPixmap(QPixmap(&quot;:logol/images/porch.png&quot;))</code></li>
<li>cmakeLists.txt中必须在<code>add_executable</code>文件中使用涵盖.qrc文件路径的变量<code>$&#123;QRC&#125;</code>, 如果在<code>add_library</code>中使用<code>$&#123;QRC&#125;</code>不显示logol。</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//mainwindow.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> MAINWINDOW_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAINWINDOW_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QMainWindow&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;tuple&gt;</span></span></span><br><span class="line"></span><br><span class="line">QT_BEGIN_NAMESPACE</span><br><span class="line"><span class="keyword">namespace</span> Ui &#123;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MainWindow</span>;</span><br><span class="line">&#125;</span><br><span class="line">QT_END_NAMESPACE</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MainWindow</span> : <span class="keyword">public</span> QMainWindow</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">MainWindow</span>(QWidget *parent = <span class="literal">nullptr</span>);</span><br><span class="line">    ~<span class="built_in">MainWindow</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">paintEvent</span><span class="params">(QPaintEvent *event)</span> <span class="keyword">override</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Ui::MainWindow *ui;</span><br><span class="line">    QTimer* timer;</span><br><span class="line">    <span class="type">float</span> currentAngleGlobal=<span class="number">0</span>;</span><br><span class="line">    <span class="comment">//刻度范围</span></span><br><span class="line">    <span class="type">int</span> maxAngle = <span class="number">210</span>;</span><br><span class="line">    <span class="type">int</span> minAngle = <span class="number">-30</span>;<span class="comment">//330;</span></span><br><span class="line">    <span class="comment">//高速刻度范围</span></span><br><span class="line">    <span class="type">int</span> maxHighSpeed = <span class="number">-30</span>;</span><br><span class="line">    <span class="type">int</span> minHighSpeed = <span class="number">50</span>;<span class="comment">//330;</span></span><br><span class="line">    <span class="comment">//顺时针和逆时针切换</span></span><br><span class="line">    <span class="type">int</span> mark = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">QRect <span class="title">initCanvas</span><span class="params">(QPainter &amp;painter)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">drawCircle</span><span class="params">(QPainter &amp;painter, QRect &amp;rect, <span class="type">int</span> radius, QPen &amp;pen, <span class="type">float</span> ratio)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">std::tuple&lt;<span class="type">int</span>, <span class="type">int</span>&gt; <span class="title">drawTick</span><span class="params">(QPainter &amp;painter, QRect &amp;rect, QPen &amp;pen, <span class="type">int</span> radius)</span></span>;</span><br><span class="line"></span><br><span class="line">     <span class="function">std::tuple&lt;<span class="type">float</span>, <span class="type">float</span>&gt; <span class="title">drawArrow</span><span class="params">(QPainter &amp;painter, QRect &amp;rect, <span class="type">int</span> &amp;radius, <span class="type">int</span> &amp;smallRadius)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">drawPie</span><span class="params">(QPainter &amp;painter, QRect &amp;rect, <span class="type">int</span> &amp;radius, <span class="type">float</span> &amp;arrowRadius, <span class="type">float</span> &amp;currentAngle)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">drawSpeed</span><span class="params">(QPainter &amp;painter, QRect &amp;rect, <span class="type">int</span> &amp;textRatio, <span class="type">int</span> &amp;tickInterval, <span class="type">float</span> &amp;currentAngle,</span></span></span><br><span class="line"><span class="params"><span class="function">                   <span class="type">int</span> &amp;smallRadius)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">drawShinePie</span><span class="params">(QPainter &amp;painter, QRect &amp;rect, <span class="type">float</span> radius, <span class="type">float</span> arrowRadius, <span class="type">float</span> currentAngle)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">drawLogol</span><span class="params">(QPainter &amp;painter, QRect &amp;rect, <span class="type">float</span> radius)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// MAINWINDOW_H</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//mainwindow.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;mainwindow.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ui_mainwindow.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QPainter&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QTimer&gt;</span></span></span><br><span class="line"></span><br><span class="line">MainWindow::<span class="built_in">MainWindow</span>(QWidget *parent)</span><br><span class="line">    : <span class="built_in">QMainWindow</span>(parent)</span><br><span class="line">    , <span class="built_in">ui</span>(<span class="keyword">new</span> Ui::MainWindow)</span><br><span class="line">&#123;</span><br><span class="line">    ui-&gt;<span class="built_in">setupUi</span>(<span class="keyword">this</span>);</span><br><span class="line">    ui-&gt;centralwidget-&gt;<span class="built_in">setLayout</span>(ui-&gt;centralGL);</span><br><span class="line">    <span class="built_in">setFixedSize</span>(<span class="number">800</span>, <span class="number">600</span>);</span><br><span class="line">    timer = <span class="keyword">new</span> <span class="built_in">QTimer</span>(<span class="keyword">this</span>);</span><br><span class="line">    timer-&gt;<span class="built_in">setInterval</span>(<span class="number">500</span>);</span><br><span class="line">    timer-&gt;<span class="built_in">start</span>();</span><br><span class="line">    <span class="built_in">connect</span>(timer, &amp;QTimer::timeout, [=]() &#123;</span><br><span class="line">        <span class="keyword">if</span> (mark == <span class="number">0</span>) &#123; <span class="comment">//顺时针</span></span><br><span class="line">            currentAngleGlobal -= <span class="number">30</span>;</span><br><span class="line">            <span class="comment">// if ()</span></span><br><span class="line">            <span class="keyword">if</span> (currentAngleGlobal &lt; minAngle) &#123;</span><br><span class="line">                currentAngleGlobal = minAngle;</span><br><span class="line">                mark = <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (mark==<span class="number">1</span>) &#123; <span class="comment">//逆时针</span></span><br><span class="line">            currentAngleGlobal += <span class="number">40</span>;</span><br><span class="line">            <span class="keyword">if</span> (currentAngleGlobal &gt; maxAngle) &#123;</span><br><span class="line">                currentAngleGlobal = maxAngle;</span><br><span class="line">                mark = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">update</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MainWindow::~<span class="built_in">MainWindow</span>()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">delete</span> ui;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::paintEvent</span><span class="params">(QPaintEvent *event)</span> </span>&#123;</span><br><span class="line">    QMainWindow::<span class="built_in">paintEvent</span>(event);</span><br><span class="line">    <span class="function">QPainter <span class="title">painter</span><span class="params">(<span class="keyword">this</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置画布</span></span><br><span class="line">    QRect rect = <span class="built_in">initCanvas</span>(painter);</span><br><span class="line">    <span class="comment">//1.画大圆</span></span><br><span class="line">    <span class="type">int</span> radius = (rect.<span class="built_in">center</span>().<span class="built_in">x</span>()&gt;rect.<span class="built_in">center</span>().<span class="built_in">y</span>())?rect.<span class="built_in">center</span>().<span class="built_in">y</span>():rect.<span class="built_in">center</span>().<span class="built_in">x</span>();</span><br><span class="line">    radius =(<span class="type">int</span>)(radius*<span class="number">0.7</span>);</span><br><span class="line">    <span class="comment">// painter.setPen(Qt::red);</span></span><br><span class="line">    <span class="comment">// //径向渐变色</span></span><br><span class="line">    <span class="comment">// QRadialGradient radGradient(rect.center(), radius);</span></span><br><span class="line">    <span class="comment">// //颜色停靠点</span></span><br><span class="line">    <span class="comment">// radGradient.setColorAt(0.0, QColor(255,0,0, 50));</span></span><br><span class="line">    <span class="comment">// radGradient.setColorAt(1.0, QColor(255,0,0, 250));</span></span><br><span class="line">    <span class="comment">// painter.drawEllipse(rect.center(), radius, radius);</span></span><br><span class="line">    <span class="comment">// //新Brush</span></span><br><span class="line">    <span class="comment">// QBrush brush(radGradient);</span></span><br><span class="line">    <span class="comment">// painter.setBrush(brush);</span></span><br><span class="line">    <span class="comment">// painter.drawEllipse(rect.center(), radius, radius);</span></span><br><span class="line">    painter.<span class="built_in">setBrush</span>(Qt::BrushStyle::NoBrush);</span><br><span class="line">    <span class="comment">//2.画小圆</span></span><br><span class="line">    <span class="function">QPen <span class="title">pen</span><span class="params">(QColor(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>,<span class="number">0</span>))</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">float</span> ratio = <span class="number">1.</span>/<span class="number">5</span>;</span><br><span class="line">    <span class="type">int</span> smallRadius = <span class="built_in">drawCircle</span>(painter, rect, radius, pen, ratio);</span><br><span class="line">    <span class="comment">//3.画刻度</span></span><br><span class="line">    pen.<span class="built_in">setColor</span>(Qt::white);</span><br><span class="line">    std::tuple&lt;<span class="type">int</span>, <span class="type">int</span> &gt; paramTuple = <span class="built_in">drawTick</span>(painter, rect, pen, radius);</span><br><span class="line">    <span class="type">int</span> textRatio = std::<span class="built_in">get</span>&lt;<span class="number">0</span>&gt;(paramTuple);</span><br><span class="line">    <span class="type">int</span> tickInterval = std::<span class="built_in">get</span>&lt;<span class="number">1</span>&gt;(paramTuple);</span><br><span class="line">    <span class="comment">//4.画指针</span></span><br><span class="line">    std::tuple&lt;<span class="type">float</span>, <span class="type">float</span>&gt; arrowTuple = <span class="built_in">drawArrow</span>(painter, rect, radius, smallRadius);</span><br><span class="line">    <span class="type">float</span> currentAngle = std::<span class="built_in">get</span>&lt;<span class="number">0</span>&gt;(arrowTuple);</span><br><span class="line">    <span class="type">float</span> arrowRadius = std::<span class="built_in">get</span>&lt;<span class="number">1</span>&gt;(arrowTuple);</span><br><span class="line">    <span class="comment">//5.画扇形</span></span><br><span class="line">    <span class="built_in">drawPie</span>(painter, rect, radius, arrowRadius, currentAngle);</span><br><span class="line">    <span class="comment">//6.中圆渐变</span></span><br><span class="line">    <span class="comment">// painter.setPen(Qt::NoPen);</span></span><br><span class="line">    pen.<span class="built_in">setColor</span>(<span class="built_in">QColor</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>));</span><br><span class="line">    ratio = <span class="number">1.</span>/<span class="number">3</span>;</span><br><span class="line">    <span class="comment">//径向渐变色</span></span><br><span class="line">    <span class="function">QRadialGradient <span class="title">radGradient</span><span class="params">(rect.center(), ratio*radius)</span></span>;</span><br><span class="line">    <span class="comment">//颜色停靠点</span></span><br><span class="line">    radGradient.<span class="built_in">setColorAt</span>(<span class="number">0.0</span>, <span class="built_in">QColor</span>(<span class="number">255</span>,<span class="number">0</span>,<span class="number">0</span>, <span class="number">200</span>));</span><br><span class="line">    radGradient.<span class="built_in">setColorAt</span>(<span class="number">1.0</span>, <span class="built_in">QColor</span>(<span class="number">0</span>,<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>));</span><br><span class="line">    <span class="comment">//新Brush</span></span><br><span class="line">    <span class="function">QBrush <span class="title">brush</span><span class="params">(radGradient)</span></span>;</span><br><span class="line">    painter.<span class="built_in">setBrush</span>(brush);</span><br><span class="line">    <span class="type">int</span> midRadius = <span class="built_in">drawCircle</span>(painter, rect, radius, pen, ratio);</span><br><span class="line">    <span class="comment">//7.内圆黑</span></span><br><span class="line">    painter.<span class="built_in">setBrush</span>(Qt::black);</span><br><span class="line">    ratio = <span class="number">1.</span>/<span class="number">5</span>;</span><br><span class="line">    smallRadius = <span class="built_in">drawCircle</span>(painter, rect, radius, pen, ratio);</span><br><span class="line">    <span class="comment">//8.显示刻度值</span></span><br><span class="line">    painter.<span class="built_in">setPen</span>(Qt::white);</span><br><span class="line">    <span class="built_in">drawSpeed</span>(painter, rect, textRatio, tickInterval, currentAngle, smallRadius);</span><br><span class="line">    <span class="comment">//9.发光外环</span></span><br><span class="line">    <span class="built_in">drawShinePie</span>(painter, rect, radius*<span class="number">1.1</span>, radius*<span class="number">1.1</span>, minAngle);</span><br><span class="line">    <span class="comment">//10.汽车logol</span></span><br><span class="line">    <span class="built_in">drawLogol</span>(painter, rect, radius);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="function">QRect <span class="title">MainWindow::initCanvas</span><span class="params">(QPainter &amp;painter)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//绘图区域</span></span><br><span class="line">    <span class="comment">//不要用mainwindow的rect(),而是mainwindow里的centralwidget的rect()</span></span><br><span class="line">    QRect rect = ui-&gt;centralwidget-&gt;<span class="built_in">rect</span>();</span><br><span class="line">    <span class="comment">//抗锯齿</span></span><br><span class="line">    painter.<span class="built_in">setRenderHint</span>(QPainter::Antialiasing, <span class="literal">true</span>);</span><br><span class="line">    <span class="comment">//底色黑色</span></span><br><span class="line">    painter.<span class="built_in">setBrush</span>(Qt::black);</span><br><span class="line">    painter.<span class="built_in">drawRect</span>(rect);</span><br><span class="line">    painter.<span class="built_in">setBrush</span>(Qt::BrushStyle::NoBrush);</span><br><span class="line">    <span class="comment">//坐标系平移到中心, 矩形内切圆</span></span><br><span class="line">    <span class="comment">// painter.translate(rect().center());</span></span><br><span class="line">    <span class="keyword">return</span> rect;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">MainWindow::drawCircle</span><span class="params">(QPainter&amp; painter, QRect&amp; rect, <span class="type">int</span> radius, QPen&amp; pen, <span class="type">float</span> ratio)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> smallRadius = (<span class="type">int</span>)(radius*ratio);</span><br><span class="line">    <span class="comment">// qDebug() &lt;&lt; &quot;smallRadius:&quot; &lt;&lt; smallRadius &lt;&lt; &quot;, radio: &quot; &lt;&lt; ratio &lt;&lt; &quot;, Radius: &quot; &lt;&lt; radius;</span></span><br><span class="line">    <span class="comment">// QPen pen(Qt::white);</span></span><br><span class="line">    pen.<span class="built_in">setWidth</span>(<span class="number">3</span>);</span><br><span class="line">    painter.<span class="built_in">setPen</span>(pen);</span><br><span class="line">    painter.<span class="built_in">drawEllipse</span>(rect.<span class="built_in">center</span>(), smallRadius, smallRadius);</span><br><span class="line">    painter.<span class="built_in">setPen</span>(Qt::NoPen);</span><br><span class="line">    <span class="keyword">return</span> smallRadius;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::tuple&lt;<span class="type">int</span>, <span class="type">int</span>&gt; <span class="title">MainWindow::drawTick</span><span class="params">(QPainter&amp; painter,QRect&amp; rect, QPen&amp; pen, <span class="type">int</span> radius)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> textNum = <span class="number">13</span>;<span class="comment">//</span></span><br><span class="line">    <span class="type">int</span> smallTickNum = <span class="number">5</span>;</span><br><span class="line">    <span class="type">int</span> textRatio = <span class="number">4</span>;</span><br><span class="line">    <span class="comment">// qDebug() &lt;&lt; &quot;sin30: &quot; &lt;&lt; sin(30*M_PI/180);</span></span><br><span class="line">    pen.<span class="built_in">setWidth</span>(<span class="number">2</span>);</span><br><span class="line">    painter.<span class="built_in">setPen</span>(pen);</span><br><span class="line">    <span class="type">float</span> bigTick = (<span class="number">1</span><span class="number">-0.9</span>)*radius;</span><br><span class="line">    <span class="comment">// float midTick = (1-0.93)*radius;</span></span><br><span class="line">    <span class="type">float</span> smallTick = (<span class="number">1</span><span class="number">-0.96</span>)*radius;</span><br><span class="line">    <span class="type">float</span> textRadius = <span class="number">0.8</span>*radius;</span><br><span class="line">    <span class="comment">//刻度范围</span></span><br><span class="line">    <span class="comment">// int maxAngle = 210;</span></span><br><span class="line">    <span class="comment">// int minAngle = -30;//330;</span></span><br><span class="line">    <span class="type">int</span> tickInterval = (<span class="type">int</span>)((maxAngle-minAngle)/(textNum<span class="number">-1.</span>)/smallTickNum);</span><br><span class="line">    <span class="type">int</span> tickCount = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = maxAngle; i &gt;= minAngle; i-=tickInterval) &#123;</span><br><span class="line">        <span class="type">float</span> xOut = <span class="built_in">cos</span>(i*M_PI/<span class="number">180</span>)*radius+rect.<span class="built_in">center</span>().<span class="built_in">x</span>();</span><br><span class="line">        <span class="type">float</span> yOut = -<span class="built_in">sin</span>(i*M_PI/<span class="number">180</span>)*radius+rect.<span class="built_in">center</span>().<span class="built_in">y</span>();</span><br><span class="line">        <span class="type">float</span> xIn;</span><br><span class="line">        <span class="type">float</span> yIn;</span><br><span class="line">        <span class="type">float</span> xText;</span><br><span class="line">        <span class="type">float</span> yText;</span><br><span class="line">        <span class="keyword">if</span> (tickCount%<span class="number">5</span> == <span class="number">0</span>) &#123;</span><br><span class="line">            xIn = <span class="built_in">cos</span>(i*M_PI/<span class="number">180</span>)*(radius-bigTick)+rect.<span class="built_in">center</span>().<span class="built_in">x</span>();</span><br><span class="line">            yIn = -<span class="built_in">sin</span>(i*M_PI/<span class="number">180</span>)*(radius-bigTick)+rect.<span class="built_in">center</span>().<span class="built_in">y</span>();</span><br><span class="line">            xText = <span class="built_in">cos</span>(i*M_PI/<span class="number">180</span>)*textRadius+rect.<span class="built_in">center</span>().<span class="built_in">x</span>();</span><br><span class="line">            yText = -<span class="built_in">sin</span>(i*M_PI/<span class="number">180</span>)*textRadius+rect.<span class="built_in">center</span>().<span class="built_in">y</span>();</span><br><span class="line">            <span class="comment">//作为文字矩形框的中心点</span></span><br><span class="line">            <span class="function">QPointF <span class="title">pointText</span><span class="params">(xText, yText)</span></span>;</span><br><span class="line">            <span class="comment">//半长，半宽</span></span><br><span class="line">            <span class="type">float</span> halfWidth = <span class="number">1.5</span>*bigTick;</span><br><span class="line">            <span class="type">float</span> halfHeight = <span class="number">1.5</span>*bigTick;</span><br><span class="line">            QFont font;</span><br><span class="line">            font.<span class="built_in">setPointSize</span>(bigTick);</span><br><span class="line">            font.<span class="built_in">setWeight</span>(QFont::Bold);</span><br><span class="line">            painter.<span class="built_in">setFont</span>(font);</span><br><span class="line">            painter.<span class="built_in">save</span>();</span><br><span class="line">            painter.<span class="built_in">translate</span>(pointText);</span><br><span class="line">            painter.<span class="built_in">rotate</span>(-(i<span class="number">-90</span>));</span><br><span class="line">            <span class="function">QRectF <span class="title">rectText</span><span class="params">(-halfWidth, -halfHeight, <span class="number">2</span>*halfWidth, <span class="number">2</span>*halfHeight)</span></span>;</span><br><span class="line">            painter.<span class="built_in">drawText</span>(rectText, Qt::AlignCenter, QString::<span class="built_in">number</span>(tickCount*textRatio));</span><br><span class="line">            <span class="comment">// qDebug()&lt;&lt;QString::number(tickCount*textRatio);</span></span><br><span class="line">            painter.<span class="built_in">restore</span>();</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            xIn = <span class="built_in">cos</span>(i*M_PI/<span class="number">180</span>)*(radius-smallTick)+rect.<span class="built_in">center</span>().<span class="built_in">x</span>();</span><br><span class="line">            yIn = -<span class="built_in">sin</span>(i*M_PI/<span class="number">180</span>)*(radius-smallTick)+rect.<span class="built_in">center</span>().<span class="built_in">y</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (i &gt;= maxHighSpeed &amp;&amp; i &lt;= minHighSpeed) &#123;</span><br><span class="line">            pen.<span class="built_in">setColor</span>(Qt::red);</span><br><span class="line">        &#125;</span><br><span class="line">        tickCount++;</span><br><span class="line">        <span class="function">QPointF <span class="title">pointOut</span><span class="params">(xOut, yOut)</span></span>;</span><br><span class="line">        <span class="function">QPointF <span class="title">pointIn</span><span class="params">(xIn, yIn)</span></span>;</span><br><span class="line"></span><br><span class="line">        pen.<span class="built_in">setWidth</span>(<span class="number">3</span>);</span><br><span class="line">        painter.<span class="built_in">setPen</span>(pen);</span><br><span class="line">        painter.<span class="built_in">drawLine</span>(pointIn, pointOut);</span><br><span class="line">        pen.<span class="built_in">setColor</span>(Qt::white);</span><br><span class="line">        painter.<span class="built_in">setPen</span>(pen);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> std::<span class="built_in">make_tuple</span>(textRatio, tickInterval);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">std::tuple&lt;<span class="type">float</span>, <span class="type">float</span>&gt; <span class="title">MainWindow::drawArrow</span><span class="params">(QPainter&amp; painter, QRect&amp; rect, <span class="type">int</span>&amp; radius, <span class="type">int</span>&amp; smallRadius)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// if (currentAngleGlobal &gt; maxAngle || currentAngleGlobal &lt; minAngle) &#123;</span></span><br><span class="line">    <span class="comment">//     currentAngleGlobal = maxAngle;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    <span class="type">float</span> currentAngle = currentAngleGlobal;<span class="comment">//(maxAngle-currentAngleGlobal)*4;//190;</span></span><br><span class="line">    <span class="type">float</span> arrowRadius = <span class="number">0.68</span>*radius;</span><br><span class="line">    <span class="type">float</span> epsilon = <span class="number">5.1</span>;</span><br><span class="line">    <span class="type">float</span> xArrowOut = <span class="built_in">cos</span>(currentAngle*M_PI/<span class="number">180</span>)*arrowRadius+rect.<span class="built_in">center</span>().<span class="built_in">x</span>();</span><br><span class="line">    <span class="type">float</span> yArrowOut = -<span class="built_in">sin</span>(currentAngle*M_PI/<span class="number">180</span>)*arrowRadius+rect.<span class="built_in">center</span>().<span class="built_in">y</span>();</span><br><span class="line">    <span class="type">float</span> xArrowIn1 = <span class="built_in">cos</span>((currentAngle-epsilon)*M_PI/<span class="number">180</span>)*smallRadius+rect.<span class="built_in">center</span>().<span class="built_in">x</span>();</span><br><span class="line">    <span class="type">float</span> yArrowIn1 = -<span class="built_in">sin</span>((currentAngle-epsilon)*M_PI/<span class="number">180</span>)*smallRadius+rect.<span class="built_in">center</span>().<span class="built_in">y</span>();</span><br><span class="line">    <span class="type">float</span> xArrowIn2 = <span class="built_in">cos</span>((currentAngle+epsilon)*M_PI/<span class="number">180</span>)*smallRadius+rect.<span class="built_in">center</span>().<span class="built_in">x</span>();</span><br><span class="line">    <span class="type">float</span> yArrowIn2 = -<span class="built_in">sin</span>((currentAngle+epsilon)*M_PI/<span class="number">180</span>)*smallRadius+rect.<span class="built_in">center</span>().<span class="built_in">y</span>();</span><br><span class="line">    <span class="function">QPointF <span class="title">pointArrowOut</span><span class="params">(xArrowOut, yArrowOut)</span></span>;</span><br><span class="line">    <span class="function">QPointF <span class="title">pointArrowIn1</span><span class="params">(xArrowIn1, yArrowIn1)</span></span>;</span><br><span class="line">    <span class="function">QPointF <span class="title">pointArrowIn2</span><span class="params">(xArrowIn2, yArrowIn2)</span></span>;</span><br><span class="line">    QPointF pointArrows[<span class="number">3</span>] = &#123;pointArrowOut, pointArrowIn1, pointArrowIn2&#125;;</span><br><span class="line">    <span class="comment">// painter.drawLine(pointArrowIn, pointArrowOut);</span></span><br><span class="line">    painter.<span class="built_in">setBrush</span>(Qt::white);</span><br><span class="line">    painter.<span class="built_in">drawPolygon</span>(pointArrows, <span class="number">3</span>);</span><br><span class="line">    <span class="keyword">return</span> std::<span class="built_in">make_tuple</span>(currentAngle, arrowRadius);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::drawPie</span><span class="params">(QPainter&amp; painter, QRect&amp; rect, <span class="type">int</span>&amp; radius, <span class="type">float</span>&amp; arrowRadius, <span class="type">float</span>&amp; currentAngle)</span> </span>&#123;</span><br><span class="line">    <span class="type">float</span> ratio = <span class="number">1.08</span>;</span><br><span class="line">    <span class="function">QRectF <span class="title">rectPie</span><span class="params">(rect.center().x()-radius*ratio, rect.center().y()-radius*ratio, radius*ratio*<span class="number">2</span>, radius*ratio*<span class="number">2</span>)</span></span>;</span><br><span class="line">    painter.<span class="built_in">setPen</span>(Qt::NoPen);</span><br><span class="line">    <span class="function">QRadialGradient <span class="title">arrowRG</span><span class="params">(rectPie.center(), radius*ratio)</span></span>;<span class="comment">//arrowRadius</span></span><br><span class="line">    arrowRG.<span class="built_in">setColorAt</span>(<span class="number">0.0</span>, <span class="built_in">QColor</span>(<span class="number">255</span>,<span class="number">153</span>,<span class="number">18</span>, <span class="number">0</span>));</span><br><span class="line">    arrowRG.<span class="built_in">setColorAt</span>(<span class="number">0.3</span>, <span class="built_in">QColor</span>(<span class="number">255</span>,<span class="number">153</span>,<span class="number">18</span>, <span class="number">0</span>));</span><br><span class="line">    arrowRG.<span class="built_in">setColorAt</span>(<span class="number">1.0</span>, <span class="built_in">QColor</span>(<span class="number">255</span>,<span class="number">153</span>,<span class="number">18</span>, <span class="number">100</span>));</span><br><span class="line">    <span class="function">QBrush <span class="title">arrowBrush</span><span class="params">(arrowRG)</span></span>;</span><br><span class="line">    painter.<span class="built_in">setBrush</span>(arrowBrush);</span><br><span class="line">    painter.<span class="built_in">drawPie</span>(rectPie, currentAngle*<span class="number">16</span>, (maxAngle-currentAngle)*<span class="number">16</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::drawSpeed</span><span class="params">(QPainter&amp; painter, QRect&amp; rect, <span class="type">int</span>&amp; textRatio, <span class="type">int</span>&amp; tickInterval, <span class="type">float</span>&amp; currentAngle, <span class="type">int</span>&amp; smallRadius)</span> </span>&#123;</span><br><span class="line">    <span class="type">float</span> value = (maxAngle-currentAngle)*textRatio/tickInterval;</span><br><span class="line">    <span class="comment">//作为文字矩形框的中心点</span></span><br><span class="line">    <span class="function">QPointF <span class="title">pointText</span><span class="params">(rect.center().x(), rect.center().y())</span></span>;</span><br><span class="line">    <span class="comment">//半长，半宽</span></span><br><span class="line">    <span class="type">float</span> halfWidth = smallRadius;</span><br><span class="line">    <span class="type">float</span> halfHeight = smallRadius;</span><br><span class="line">    <span class="type">float</span> offsize = <span class="number">1.5</span>; <span class="comment">//0到2</span></span><br><span class="line">    QFont font;</span><br><span class="line">    font.<span class="built_in">setPointSize</span>(smallRadius*<span class="number">0.8</span>);</span><br><span class="line">    font.<span class="built_in">setWeight</span>(QFont::Bold);</span><br><span class="line">    painter.<span class="built_in">setFont</span>(font);</span><br><span class="line">    <span class="function">QRectF <span class="title">rectText</span><span class="params">(pointText.x()-halfWidth, pointText.y()-halfHeight, <span class="number">2</span>*halfWidth, offsize*halfHeight)</span></span>;</span><br><span class="line">    painter.<span class="built_in">setPen</span>(Qt::white);</span><br><span class="line">    QString valueString = QString::<span class="built_in">number</span>(value);</span><br><span class="line">    painter.<span class="built_in">drawText</span>(rectText, Qt::AlignCenter, valueString);</span><br><span class="line">    <span class="function">QRectF <span class="title">rectTextUnit</span><span class="params">(pointText.x()-halfWidth/<span class="number">2</span>, pointText.y()+(offsize<span class="number">-1</span>), halfWidth, halfHeight)</span></span>;</span><br><span class="line">    font.<span class="built_in">setPointSize</span>(smallRadius*<span class="number">0.4</span>);</span><br><span class="line">    painter.<span class="built_in">setFont</span>(font);</span><br><span class="line">    painter.<span class="built_in">drawText</span>(rectTextUnit, Qt::AlignCenter, <span class="string">&quot;Km/h&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::drawShinePie</span><span class="params">(QPainter&amp; painter, QRect&amp; rect, <span class="type">float</span> radius, <span class="type">float</span> arrowRadius, <span class="type">float</span> currentAngle)</span> </span>&#123;</span><br><span class="line">    <span class="function">QRectF <span class="title">rectPie</span><span class="params">(rect.center().x()-radius, rect.center().y()-radius, radius*<span class="number">2</span>, radius*<span class="number">2</span>)</span></span>;</span><br><span class="line">    painter.<span class="built_in">setPen</span>(Qt::NoPen);</span><br><span class="line">    <span class="function">QRadialGradient <span class="title">arrowRG</span><span class="params">(rectPie.center(), arrowRadius)</span></span>;</span><br><span class="line">    arrowRG.<span class="built_in">setColorAt</span>(<span class="number">0.0</span>, <span class="built_in">QColor</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>, <span class="number">0</span>));</span><br><span class="line">    arrowRG.<span class="built_in">setColorAt</span>(<span class="number">0.3</span>, <span class="built_in">QColor</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>, <span class="number">0</span>));</span><br><span class="line">    arrowRG.<span class="built_in">setColorAt</span>(<span class="number">0.9</span>, <span class="built_in">QColor</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>, <span class="number">10</span>));</span><br><span class="line">    arrowRG.<span class="built_in">setColorAt</span>(<span class="number">0.95</span>, <span class="built_in">QColor</span>(<span class="number">255</span>,<span class="number">0</span>,<span class="number">0</span>, <span class="number">50</span>));</span><br><span class="line">    arrowRG.<span class="built_in">setColorAt</span>(<span class="number">1.0</span>, <span class="built_in">QColor</span>(<span class="number">255</span>,<span class="number">0</span>,<span class="number">0</span>, <span class="number">100</span>));</span><br><span class="line">    <span class="function">QBrush <span class="title">arrowBrush</span><span class="params">(arrowRG)</span></span>;</span><br><span class="line">    painter.<span class="built_in">setBrush</span>(arrowBrush);</span><br><span class="line">    painter.<span class="built_in">drawPie</span>(rectPie, currentAngle*<span class="number">16</span>, (maxAngle-currentAngle)*<span class="number">16</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::drawLogol</span><span class="params">(QPainter&amp; painter, QRect&amp; rect, <span class="type">float</span> radius)</span> </span>&#123;</span><br><span class="line">    <span class="type">float</span> logolCenterX = rect.<span class="built_in">center</span>().<span class="built_in">x</span>();</span><br><span class="line">    <span class="type">float</span> logolCenterY = rect.<span class="built_in">center</span>().<span class="built_in">y</span>()+radius*<span class="number">0.5</span>;</span><br><span class="line">    <span class="type">float</span> halfWidth = radius*<span class="number">0.1</span>;</span><br><span class="line">    <span class="type">float</span> halfHeight = radius*<span class="number">0.12</span>;</span><br><span class="line">    <span class="function">QRect <span class="title">rectLogol</span><span class="params">(logolCenterX-halfWidth, logolCenterY-halfHeight, halfWidth*<span class="number">2</span>, halfHeight*<span class="number">2</span>)</span></span>;</span><br><span class="line">    painter.<span class="built_in">drawPixmap</span>(rectLogol, <span class="built_in">QPixmap</span>(<span class="string">&quot;:/logol/images/porch.png&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="显示自定义按钮">显示自定义按钮</h3>
<p><strong>显示控件的方式</strong></p>
<ul>
<li>代码：在<code>MainWindow</code>中创建<code>MyButton</code>对象，在<code>MyButton</code>中用<code>QPainterEvent</code>绘图。</li>
<li>UI Designer: 插入一个<code>wdiget</code>控件，将它提升为<code>MyButton</code>。</li>
<li>插件：</li>
</ul>
<p><strong>显示动画效果</strong><code>QProperyAnimation</code></p>
<p><img src="/2025/02/24/QT-C/QT-C/mybutton-1418907.gif" alt="mybutton"></p>
<h2 id="自定义插件">自定义插件</h2>
<h3 id="动态链接库">动态链接库</h3>
<p>使用插件面向接口编程：</p>
<p>1、自定义插件的工程中包括插件类和插件接口类并将整个项目生成动态库或静态库，而不是可执行文件。</p>
<p>2、将生成的库文件(.dylib, dll, .a, .so等)放到qt的designer下例如/opt/homebrew/Cellar/qt/6.9.0/share/qt/plugins/designer/</p>
<p>3、在使用插件的项目中配置CMakeLists.txt,：（1）target_link_libraries链接生成的插件库，（2）target_include_directories导入生成的库使用到的函数的头文件。</p>
<p><strong>动态库</strong>:</p>
<ol>
<li>编译：编译器将.h和.cpp文件生成.o目标文件</li>
<li>编译时链接：链接器将.o链接到动态文件.dylib  <s>可执行文件(例如.exe)</s></li>
<li>运行时链接：将动态库文件.dylib链接到可执行文件。</li>
<li>当需要修改某个动态文件时<strong>不需要重新编译整个项目的可执行文件</strong>，只需执行1、2、3 步。</li>
</ol>
<h4 id="动态库特例插件不光其他项目使用qt-designer也使用">动态库特例插件不光其他项目使用qt designer也使用</h4>
<p><strong>Windows</strong>+qt creator</p>
<p><img src="/2025/02/24/QT-C/QT-C/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-08-29%20161651.png" alt="屏幕截图 2025-08-29 161651"></p>
<p>在cmake构建时链接通过target_link_libraries完成而不是LIB文件。</p>
<p><img src="/2025/02/24/QT-C/QT-C/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-08-29%20160904.png" alt="屏幕截图 2025-08-29 160904"></p>
<p><img src="/2025/02/24/QT-C/QT-C/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-09-01%20100043.png" alt="屏幕截图 2025-09-01 100043"></p>
<p><img src="/2025/02/24/QT-C/QT-C/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-09-01%20101601.png" alt="屏幕截图 2025-09-01 101601"></p>
<p><img src="/2025/02/24/QT-C/QT-C/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-09-01%20100827.png" alt="屏幕截图 2025-09-01 100827"></p>
<p><img src="/2025/02/24/QT-C/QT-C/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-09-01%20101535.png" alt="屏幕截图 2025-09-01 101535"></p>
<p><strong>linux or macOS</strong>+cmake</p>
<p>假设你的插件项目目录如下：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">|---plugin</span><br><span class="line"></span><br><span class="line">​      |---CMakeLists.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#​      |---app                                   注释掉应用入口</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#​           |---src</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#​                |---main.cpp                                  </span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#​           |---CMakeLists.txt    </span></span><br><span class="line"></span><br><span class="line">​      |---widget                             插件类，自定义的UI图</span><br><span class="line"></span><br><span class="line">​           |---CMakeLists.txt</span><br><span class="line"></span><br><span class="line">​           |---<span class="keyword">include</span></span><br><span class="line"></span><br><span class="line">​                |---widget.h                 头文件中要添加导出宏定义头文件&lt;QtUiPlugin/QDesignerExportWidget&gt;并在widget类名前添加，否则lib文件链接不到widget.h文件</span><br><span class="line"></span><br><span class="line">​           |---src</span><br><span class="line"></span><br><span class="line">​                |---widget.cpp</span><br><span class="line"></span><br><span class="line">​           |---resources</span><br><span class="line"></span><br><span class="line">​           |---form</span><br><span class="line"></span><br><span class="line">​                |---mainwindow.ui</span><br><span class="line"></span><br><span class="line">​      |---widgetPlugin                         插件接口模块（让qtdesigner认识插件）,使用qt creator生成的模版</span><br><span class="line"></span><br><span class="line">​           |---<span class="keyword">include</span></span><br><span class="line"></span><br><span class="line">​                |---widgetPlugin.h          </span><br><span class="line"></span><br><span class="line">​           |---src</span><br><span class="line"></span><br><span class="line">​                |---widgetPlugin.cpp</span><br><span class="line"></span><br><span class="line">​           |---resources</span><br><span class="line"></span><br><span class="line">​                |---images</span><br><span class="line"></span><br><span class="line">​                     |---*.png</span><br><span class="line"></span><br><span class="line">​                |---icons.qrc                    插件显示的图标</span><br><span class="line"></span><br><span class="line">​           |---CMakeLists.txt</span><br></pre></td></tr></table></figure>
<p><strong>说明</strong></p>
<hr>
<p>**widget.h **文件中要引入&lt;QtDesigner/QDesignerExportWidget&gt;包，并且类名前加宏QDESIGNER_WIDGET_EXPORT目的是在创建自定义 Qt 控件时，确保控件类能够被 Qt Designer 正确识别和加载。</p>
<p><strong>cmake</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left">特性</th>
<th style="text-align:left"><code>target_sources</code></th>
<th style="text-align:left"><code>target_include_directories</code></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><strong>目的</strong></td>
<td style="text-align:left">定义哪些文件属于目标</td>
<td style="text-align:left">定义在哪里查找头文件</td>
</tr>
<tr>
<td style="text-align:left"><strong>影响对象</strong></td>
<td style="text-align:left">CMake 构建系统</td>
<td style="text-align:left">C++ 编译器</td>
</tr>
<tr>
<td style="text-align:left"><strong>文件类型</strong></td>
<td style="text-align:left">.cpp, .h, .hpp, .c 等</td>
<td style="text-align:left">不直接添加文件，只添加目录</td>
</tr>
<tr>
<td style="text-align:left"><strong>Qt MOC</strong></td>
<td style="text-align:left">必需（用于找到 Q_OBJECT 头文件）</td>
<td style="text-align:left">不需要（但需要包含生成目录）</td>
</tr>
<tr>
<td style="text-align:left"><strong>IDE 支持</strong></td>
<td style="text-align:left">让IDE知道文件属于项目</td>
<td style="text-align:left">让IDE知道在哪里查找头文件</td>
</tr>
</tbody>
</table>
<p>不能在子目录中生成动态库，在用父目录连接动态库的方式生成插件动态库</p>
<ul>
<li>
<p>使用add_library方式生成插件使用，将插件项目中的头文件和生成的动态库battery.dylib放入其他项目中使用插件。例如头文件放在mainwindow目录下的include目录，动态文件放在mainwindow目录下的lib目录，target_link_library链接lib目录下的文件。</p>
</li>
<li>
<p>将battery.dylib放入designer的插件库中在designer中显示插件。</p>
</li>
</ul>
<p><strong>qt_add_plugin</strong>生成的是目标文件不是动态文件虽然.dylib结尾，无法链接到其他项目中</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#/plugin/CMakeLists.txt</span></span><br><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.16</span>)</span><br><span class="line"><span class="comment">#项目名</span></span><br><span class="line"><span class="keyword">set</span>(<span class="keyword">PROJECT</span> Plugin)</span><br><span class="line"><span class="keyword">project</span>(<span class="variable">$&#123;PROJECT&#125;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 插件类接口名</span></span><br><span class="line"><span class="keyword">set</span>(PLN widgetPlugin)</span><br><span class="line"><span class="comment"># 插件类名</span></span><br><span class="line"><span class="keyword">set</span>(PLNCLASS widget)</span><br><span class="line"></span><br><span class="line"><span class="comment">#系统信息</span></span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;操作系统$&#123;CMAKE_SYSTEM&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#CMake信息</span></span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;当前CMake工具所在目录：$&#123;CMAKE_COMMAND&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;CMake版本号: $&#123;CMAKE_MAJOR_VERSION&#125;.$&#123;CMAKE_MINOR_VERSION&#125;.$&#123;CMAKE_PATCH_VERSION&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#编译类型</span></span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;编译类型$&#123;CMAKE_BUILD_TYPE&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#设置环境：如果很多库你都安装了多个版本，一定要先把库的安装路径追加到 “CMAKE_PREFIX_PATH” 变量中, 这个变量影响 CMake 在查找包（包括库和程序）时应考虑哪些路径，它可以被设置为一个或多个路径，这些路径使用分号 (;) 分隔，在find_package()，注意使用 “版本号 EXACT” 关键字修饰，帮你判断是否找到指定版本</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_PREFIX_PATH <span class="string">&quot;$(brew --prefix qt@6);&quot;</span>) <span class="comment"># /opt/homebrew/Cellar/qt/5.9.0/lib/cmake/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置为自动运行 moc, uic, rcc 等 Qt 工具</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_AUTOMOC <span class="keyword">ON</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_AUTOUIC <span class="keyword">ON</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_AUTORCC <span class="keyword">ON</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Needed to compile against ui and moc generated files</span></span><br><span class="line"><span class="comment">#include_directories($&#123;CMAKE_CURRENT_BINARY_DIR&#125;)</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_INCLUDE_CURRENT_DIR <span class="keyword">ON</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置 C++ 标准</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_STANDARD <span class="number">17</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_STANDARD_REQUIRED <span class="keyword">ON</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># This is experimental, it works but it may be not optimal, don&#x27;t hesitate to change this</span></span><br><span class="line"><span class="keyword">find_package</span>(Qt6 REQUIRED Core Gui Widgets Designer UiPlugin) <span class="comment">#Core</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 搭建项目工程</span></span><br><span class="line"><span class="comment">#set($&#123;PLNCLASS&#125;_SRC)</span></span><br><span class="line"><span class="comment">#set($&#123;PLNCLASS&#125;_INC)</span></span><br><span class="line"><span class="comment">#set($&#123;PLNCLASS&#125;_QRC)</span></span><br><span class="line"><span class="comment">#set($&#123;PLN&#125;_SRC)</span></span><br><span class="line"><span class="comment">#set($&#123;PLN&#125;_INC)</span></span><br><span class="line"><span class="comment">#set($&#123;PLN&#125;_QRC)</span></span><br><span class="line"><span class="keyword">set</span>(ROOTSRC <span class="string">&quot;&quot;</span> CACHE INTERNAL <span class="string">&quot;global source&quot;</span>)</span><br><span class="line"><span class="keyword">set</span>(ROOTINC <span class="string">&quot;&quot;</span> CACHE INTERNAL <span class="string">&quot;global include&quot;</span>)</span><br><span class="line"><span class="keyword">set</span>(ROOTQRC <span class="string">&quot;&quot;</span> CACHE INTERNAL <span class="string">&quot;global resource&quot;</span>)</span><br><span class="line"><span class="keyword">set</span>(ROOTFORM <span class="string">&quot;&quot;</span> CACHE INTERNAL <span class="string">&quot;global ui dir&quot;</span>)</span><br><span class="line"><span class="keyword">set</span>(ROOTINCDIR <span class="string">&quot;&quot;</span> CACHE INTERNAL <span class="string">&quot;global include dir&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">add_subdirectory</span>(<span class="variable">$&#123;PLNCLASS&#125;</span>)</span><br><span class="line"><span class="keyword">add_subdirectory</span>(<span class="variable">$&#123;PLN&#125;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;\n##############打印CMAKE_CURRENT_SOURCE_DIR路径$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;################&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;\n==========所有头文件：$&#123;ROOTINC&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;\n==========所有源文件：$&#123;ROOTSRC&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;\n==========所有qrc文件：$&#123;ROOTQRC&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;\n==========所有ui文件所在目录：$&#123;ROOTFORMDIR&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;\n==========所有头文件所在目录：$&#123;ROOTINCDIR&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置默认构建类型为 Release（如果未指定）</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">NOT</span> CMAKE_BUILD_TYPE)</span><br><span class="line">    <span class="keyword">set</span>(CMAKE_BUILD_TYPE Release)</span><br><span class="line"><span class="keyword">endif</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置输出目录</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_BINARY_DIR <span class="variable">$&#123;CMAKE_SOURCE_DIR&#125;</span>/cmake-build-release)</span><br><span class="line"></span><br><span class="line"><span class="comment">#set(PROJECT_SOURCES</span></span><br><span class="line"><span class="comment">#        # $&#123;SOURCE_DIR&#125;/main.cpp</span></span><br><span class="line"><span class="comment">#        # $&#123;SOURCE_DIR&#125;/mainwindow.cpp</span></span><br><span class="line"><span class="comment">#        # $&#123;UI_HEADERS&#125;</span></span><br><span class="line"><span class="comment">#        # $&#123;HEADER_DIR&#125;</span></span><br><span class="line"><span class="comment">#        $&#123;SRC&#125;</span></span><br><span class="line"><span class="comment">#        # $&#123;INC&#125;</span></span><br><span class="line"><span class="comment">#        $&#123;QRC&#125;</span></span><br><span class="line"><span class="comment">#)</span></span><br><span class="line"><span class="comment">##生成库文件</span></span><br><span class="line"><span class="comment">#add_library($&#123;PROJECT&#125; SHARED</span></span><br><span class="line"><span class="comment">#        #MANUAL_FINALIZATION</span></span><br><span class="line"><span class="comment">##        $&#123;PROJECT_SOURCES&#125;</span></span><br><span class="line"><span class="comment">#)</span></span><br><span class="line">qt_add_plugin(<span class="variable">$&#123;PROJECT&#125;</span>)<span class="comment">#生成的是目标文件不是动态库虽然是.dylib</span></span><br><span class="line"><span class="comment">#当前项目依赖库中使用到的头文件目录</span></span><br><span class="line"><span class="comment">#target_include_directories($&#123;PROJECT&#125; PUBLIC $&#123;CMAKE_CURRENT_SOURCE_DIR&#125;/$&#123;PLNCLASS&#125;/include/ $&#123;CMAKE_CURRENT_SOURCE_DIR&#125;/$&#123;PLN&#125;/include/)</span></span><br><span class="line"><span class="comment">#添加编译器c++搜索头文件的目录，告诉编译器在哪里查找 #include 指令中的文件。</span></span><br><span class="line"><span class="keyword">target_include_directories</span>(<span class="variable">$&#123;PROJECT&#125;</span> PUBLIC <span class="variable">$&#123;ROOTINCDIR&#125;</span>)</span><br><span class="line"><span class="keyword">list</span>(APPEND CMAKE_AUTOUIC_SEARCH_PATHS <span class="variable">$&#123;ROOTFORM&#125;</span>)</span><br><span class="line"><span class="comment">#CMake 构建系统时Qt MOC 处理: 包含 Q_OBJECT 的头文件需要被添加到 target_sources 以便 AUTOMOC 能找到它们</span></span><br><span class="line"><span class="comment">#IDE 支持: 让 IDE 知道这些头文件属于项目，便于导航和代码分析</span></span><br><span class="line"><span class="comment">#安装目标: 头文件会被包含在安装目标中</span></span><br><span class="line"><span class="keyword">target_sources</span>(<span class="variable">$&#123;PROJECT&#125;</span> PUBLIC <span class="variable">$&#123;ROOTSRC&#125;</span>  <span class="variable">$&#123;ROOTQRC&#125;</span> <span class="variable">$&#123;ROOTINC&#125;</span>) <span class="comment">#添加头文件主要为了IDE支持和MOC处理</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#当前项目链接相关依赖库</span></span><br><span class="line"><span class="comment">#target_link_libraries($&#123;PROJECT&#125; PUBLIC $&#123;PLNCLASS&#125; $&#123;PLN&#125;) # Core Gui Widgets Designer</span></span><br><span class="line"><span class="keyword">target_link_libraries</span>(<span class="variable">$&#123;PROJECT&#125;</span> PUBLIC Qt<span class="variable">$&#123;QT_VERSION_MAJOR&#125;</span>::Widgets Qt<span class="variable">$&#123;QT_VERSION_MAJOR&#125;</span>::Designer Qt<span class="variable">$&#123;QT_VERSION_MAJOR&#125;</span>::Gui Qt<span class="variable">$&#123;QT_VERSION_MAJOR&#125;</span>::Core Qt<span class="variable">$&#123;QT_VERSION_MAJOR&#125;</span>::UiPlugin) <span class="comment"># Core Gui Widgets Designer</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Here too, I&#x27;m not sure every define is necessary</span></span><br><span class="line"><span class="comment">#include_directories($&#123;CMAKE_CURRENT_BINARY_DIR&#125;)</span></span><br><span class="line"><span class="comment">#add_definitions(-DQT_PLUGIN)</span></span><br><span class="line"><span class="comment">#add_definitions(-DQT_NO_DEBUG)</span></span><br><span class="line"><span class="comment">#add_definitions(-DQT_SHARED)</span></span><br><span class="line"><span class="comment">## I&#x27;m no expert in libraries so, intuitively I&#x27;d say this is useless but it won&#x27;t compile if I don&#x27;t define it.</span></span><br><span class="line"><span class="comment">## This clearly needs to get fixed.</span></span><br><span class="line"><span class="comment">#add_definitions(-DQDESIGNER_EXPORT_WIDGETS)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#add_library($&#123;PROJECT&#125; SHARED</span></span><br><span class="line"><span class="comment">#    $&#123;SOURCES&#125;</span></span><br><span class="line"><span class="comment">#    $&#123;HEADERS_MOC&#125;</span></span><br><span class="line"><span class="comment">#    $&#123;FORMS_HEADERS&#125;</span></span><br><span class="line"><span class="comment">#    $&#123;RESOURCES_RCC&#125;</span></span><br><span class="line"><span class="comment">#)</span></span><br><span class="line"><span class="comment">#target_link_libraries($&#123;PROJECT&#125; $&#123;QT_LIBRARIES&#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置插件的输出目录（可选，但推荐）</span></span><br><span class="line"><span class="comment"># 这样构建后，插件库.dylib,.dll会直接生成到 Qt Designer 能加载的目录，方便测试</span></span><br><span class="line"><span class="comment">#在构建过程中（编译链接之后），将生成的目标文件（你的自定义插件库）输出到一个你指定的、自定义的目录中，而不是默认的CMake构建目录结构里。</span></span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;\nCMAKE_CURRENT_BINARY_DIR: $&#123;CMAKE_CURRENT_BINARY_DIR&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;\nCMAKE_BINARY_DIR: $&#123;CMAKE_BINARY_DIR&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">set_target_properties</span>(<span class="variable">$&#123;PROJECT_NAME&#125;</span> PROPERTIES</span><br><span class="line">        <span class="comment"># 在 Windows 上，LIBRARY_OUTPUT_DIRECTORY 控制 .dll 的输出路径</span></span><br><span class="line">        <span class="comment">#LIBRARY_OUTPUT_DIRECTORY $&#123;CMAKE_BINARY_DIR&#125;/output</span></span><br><span class="line">        <span class="comment"># 在 macOS 上，需要设置 BUNDLE 属性，但通常 LIBRARY_OUTPUT_DIRECTORY 也有效</span></span><br><span class="line">        MACOSX_BUNDLE <span class="keyword">TRUE</span></span><br><span class="line">        MACOSX_BUNDLE_INFO_PLIST <span class="variable">$&#123;CMAKE_CURRENT_BINARY_DIR&#125;</span>/Info.plist</span><br><span class="line">        BUNDLE_OUTPUT_DIRECTORY <span class="variable">$&#123;CMAKE_CURRENT_BINARY_DIR&#125;</span>/bin</span><br><span class="line">        OUTPUT_NAME <span class="string">&quot;app&quot;</span>  <span class="comment">#libapp.dylib</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Install the library in QtDesigner plugin directory</span></span><br><span class="line"><span class="comment">#在用户执行 make install（或等价的安装命令）时，将构建好的自定义 Designer 插件库文件（$&#123;PROJECT_NAME&#125;）复制到系统上的一个目录中例如$&#123;QT_PLUGINS_DIR&#125;/designer，使得 Qt Designer 或 Qt Creator 能够自动发现并加载它。</span></span><br><span class="line"><span class="comment">#$&#123;QT_PLUGINS_DIR&#125; 是一个 CMake 变量，它指向当前使用的 Qt 版本的插件安装目录。这个变量通常在调用 find_package(Qt6) 后自动设置。</span></span><br><span class="line"><span class="comment">#install(TARGETS $&#123;PROJECT&#125;</span></span><br><span class="line"><span class="comment">#    DESTINATION $&#123;QT_PLUGINS_DIR&#125;/designer</span></span><br><span class="line"><span class="comment">#)</span></span><br><span class="line"><span class="comment">#install(TARGETS $&#123;PROJECT&#125;</span></span><br><span class="line"><span class="comment">#        LIBRARY DESTINATION $&#123;CMAKE_CURRENT_BINARY_DIR&#125;/lib</span></span><br><span class="line"><span class="comment">#)</span></span><br><span class="line"><span class="comment">#install(DIRECTORY include/ DESTINATION $&#123;CMAKE_CURRENT_BINARY_DIR&#125;/include)</span></span><br><span class="line"><span class="comment"># 收集所有.dylib文件</span></span><br><span class="line"><span class="comment">#file(GLOB DYLIBS &quot;$&#123;CMAKE_CURRENT_BINARY_DIR&#125;/*.dylib&quot;)</span></span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;\nqt安装目录：$&#123;QT6_INSTALL_PREFIX&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;\ndesigner插件目录：$&#123;QT6_INSTALL_PLUGINS&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">set</span>(INSTALL_EXAMPLEDIR <span class="string">&quot;$&#123;QT6_INSTALL_PREFIX&#125;/$&#123;QT6_INSTALL_PLUGINS&#125;/designer&quot;</span>)</span><br><span class="line"><span class="comment">#install(FILES $&#123;DYLIBS&#125;</span></span><br><span class="line"><span class="comment">#        DESTINATION &quot;$&#123;QT6_INSTALL_PREFIX&#125;/$&#123;QT6_INSTALL_PLUGINS&#125;/designer&quot;</span></span><br><span class="line"><span class="comment">##        DESTINATION /Applications/Qt\ Creator.app/Contents/PlugIns/designer/</span></span><br><span class="line"><span class="comment">#)</span></span><br><span class="line"><span class="keyword">install</span>(TARGETS <span class="variable">$&#123;PROJECT&#125;</span></span><br><span class="line">        <span class="comment">#安装可执行文件, 例如.exe</span></span><br><span class="line">        RUNTIME DESTINATION <span class="string">&quot;$&#123;INSTALL_EXAMPLEDIR&#125;&quot;</span></span><br><span class="line">        <span class="comment">#安装macos应用程序包bundle, *.app</span></span><br><span class="line">        BUNDLE DESTINATION <span class="string">&quot;$&#123;INSTALL_EXAMPLEDIR&#125;&quot;</span></span><br><span class="line">        <span class="comment">#安装动态库.dll, .so, .dylib</span></span><br><span class="line">        LIBRARY DESTINATION <span class="string">&quot;$&#123;INSTALL_EXAMPLEDIR&#125;&quot;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p><strong>add_library</strong>生成动态库可以链接到其他项目中使用</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#/plugin/CMakeLists.txt</span></span><br><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.16</span>)</span><br><span class="line"><span class="comment">#项目名</span></span><br><span class="line"><span class="keyword">set</span>(<span class="keyword">PROJECT</span> Plugin)</span><br><span class="line"><span class="keyword">project</span>(<span class="variable">$&#123;PROJECT&#125;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 插件类接口名</span></span><br><span class="line"><span class="keyword">set</span>(PLN widgetPlugin)</span><br><span class="line"><span class="comment"># 插件类名</span></span><br><span class="line"><span class="keyword">set</span>(PLNCLASS widget)</span><br><span class="line"></span><br><span class="line"><span class="comment">#系统信息</span></span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;操作系统$&#123;CMAKE_SYSTEM&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#CMake信息</span></span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;当前CMake工具所在目录：$&#123;CMAKE_COMMAND&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;CMake版本号: $&#123;CMAKE_MAJOR_VERSION&#125;.$&#123;CMAKE_MINOR_VERSION&#125;.$&#123;CMAKE_PATCH_VERSION&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#编译类型</span></span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;编译类型$&#123;CMAKE_BUILD_TYPE&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#设置环境：如果很多库你都安装了多个版本，一定要先把库的安装路径追加到 “CMAKE_PREFIX_PATH” 变量中, 这个变量影响 CMake 在查找包（包括库和程序）时应考虑哪些路径，它可以被设置为一个或多个路径，这些路径使用分号 (;) 分隔，在find_package()，注意使用 “版本号 EXACT” 关键字修饰，帮你判断是否找到指定版本</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_PREFIX_PATH <span class="string">&quot;$(brew --prefix qt@6);&quot;</span>) <span class="comment"># /opt/homebrew/Cellar/qt/5.9.0/lib/cmake/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置为自动运行 moc, uic, rcc 等 Qt 工具</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_AUTOMOC <span class="keyword">ON</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_AUTOUIC <span class="keyword">ON</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_AUTORCC <span class="keyword">ON</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Needed to compile against ui and moc generated files</span></span><br><span class="line"><span class="comment">#include_directories($&#123;CMAKE_CURRENT_BINARY_DIR&#125;)</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_INCLUDE_CURRENT_DIR <span class="keyword">ON</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置 C++ 标准</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_STANDARD <span class="number">17</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_STANDARD_REQUIRED <span class="keyword">ON</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># This is experimental, it works but it may be not optimal, don&#x27;t hesitate to change this</span></span><br><span class="line"><span class="keyword">find_package</span>(Qt6 REQUIRED Core Gui Widgets Designer UiPlugin) <span class="comment">#Core</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 搭建项目工程</span></span><br><span class="line"><span class="comment">#set($&#123;PLNCLASS&#125;_SRC)</span></span><br><span class="line"><span class="comment">#set($&#123;PLNCLASS&#125;_INC)</span></span><br><span class="line"><span class="comment">#set($&#123;PLNCLASS&#125;_QRC)</span></span><br><span class="line"><span class="comment">#set($&#123;PLN&#125;_SRC)</span></span><br><span class="line"><span class="comment">#set($&#123;PLN&#125;_INC)</span></span><br><span class="line"><span class="comment">#set($&#123;PLN&#125;_QRC)</span></span><br><span class="line"><span class="keyword">set</span>(ROOTSRC <span class="string">&quot;&quot;</span> CACHE INTERNAL <span class="string">&quot;global source&quot;</span>)</span><br><span class="line"><span class="keyword">set</span>(ROOTINC <span class="string">&quot;&quot;</span> CACHE INTERNAL <span class="string">&quot;global include&quot;</span>)</span><br><span class="line"><span class="keyword">set</span>(ROOTQRC <span class="string">&quot;&quot;</span> CACHE INTERNAL <span class="string">&quot;global resource&quot;</span>)</span><br><span class="line"><span class="keyword">set</span>(ROOTFORM <span class="string">&quot;&quot;</span> CACHE INTERNAL <span class="string">&quot;global ui dir&quot;</span>)</span><br><span class="line"><span class="keyword">set</span>(ROOTINCDIR <span class="string">&quot;&quot;</span> CACHE INTERNAL <span class="string">&quot;global include dir&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">add_subdirectory</span>(<span class="variable">$&#123;PLNCLASS&#125;</span>)</span><br><span class="line"><span class="keyword">add_subdirectory</span>(<span class="variable">$&#123;PLN&#125;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;\n##############打印CMAKE_CURRENT_SOURCE_DIR路径$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;################&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;\n==========所有头文件：$&#123;ROOTINC&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;\n==========所有源文件：$&#123;ROOTSRC&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;\n==========所有qrc文件：$&#123;ROOTQRC&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;\n==========所有ui文件所在目录：$&#123;ROOTFORMDIR&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;\n==========所有头文件所在目录：$&#123;ROOTINCDIR&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置默认构建类型为 Release（如果未指定）</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">NOT</span> CMAKE_BUILD_TYPE)</span><br><span class="line">    <span class="keyword">set</span>(CMAKE_BUILD_TYPE Release)</span><br><span class="line"><span class="keyword">endif</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置输出目录</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_BINARY_DIR <span class="variable">$&#123;CMAKE_SOURCE_DIR&#125;</span>/cmake-build-release)</span><br><span class="line"></span><br><span class="line"><span class="comment">#set(PROJECT_SOURCES</span></span><br><span class="line"><span class="comment">#        # $&#123;SOURCE_DIR&#125;/main.cpp</span></span><br><span class="line"><span class="comment">#        # $&#123;SOURCE_DIR&#125;/mainwindow.cpp</span></span><br><span class="line"><span class="comment">#        # $&#123;UI_HEADERS&#125;</span></span><br><span class="line"><span class="comment">#        # $&#123;HEADER_DIR&#125;</span></span><br><span class="line"><span class="comment">#        $&#123;SRC&#125;</span></span><br><span class="line"><span class="comment">#        # $&#123;INC&#125;</span></span><br><span class="line"><span class="comment">#        $&#123;QRC&#125;</span></span><br><span class="line"><span class="comment">#)</span></span><br><span class="line"><span class="comment">##生成库文件</span></span><br><span class="line"><span class="comment">#add_library($&#123;PROJECT&#125; SHARED</span></span><br><span class="line"><span class="comment">#        #MANUAL_FINALIZATION</span></span><br><span class="line"><span class="comment">##        $&#123;PROJECT_SOURCES&#125;</span></span><br><span class="line"><span class="comment">#)</span></span><br><span class="line"><span class="comment">#qt_add_plugin($&#123;PROJECT&#125;)</span></span><br><span class="line"><span class="keyword">add_library</span>(<span class="variable">$&#123;PROJECT&#125;</span> SHARED  <span class="variable">$&#123;ROOTSRC&#125;</span>  <span class="variable">$&#123;ROOTQRC&#125;</span> <span class="variable">$&#123;ROOTINC&#125;</span>)</span><br><span class="line"><span class="comment">#当前项目依赖库中使用到的头文件目录</span></span><br><span class="line"><span class="comment">#target_include_directories($&#123;PROJECT&#125; PUBLIC $&#123;CMAKE_CURRENT_SOURCE_DIR&#125;/$&#123;PLNCLASS&#125;/include/ $&#123;CMAKE_CURRENT_SOURCE_DIR&#125;/$&#123;PLN&#125;/include/)</span></span><br><span class="line"><span class="comment">#添加编译器c++搜索头文件的目录，告诉编译器在哪里查找 #include 指令中的文件。</span></span><br><span class="line"><span class="keyword">target_include_directories</span>(<span class="variable">$&#123;PROJECT&#125;</span> PUBLIC <span class="variable">$&#123;ROOTINCDIR&#125;</span>)</span><br><span class="line"><span class="keyword">list</span>(APPEND CMAKE_AUTOUIC_SEARCH_PATHS <span class="variable">$&#123;ROOTFORM&#125;</span>)</span><br><span class="line"><span class="comment">#CMake 构建系统时Qt MOC 处理: 包含 Q_OBJECT 的头文件需要被添加到 target_sources 以便 AUTOMOC 能找到它们</span></span><br><span class="line"><span class="comment">#IDE 支持: 让 IDE 知道这些头文件属于项目，便于导航和代码分析</span></span><br><span class="line"><span class="comment">#安装目标: 头文件会被包含在安装目标中</span></span><br><span class="line"><span class="comment">#target_sources($&#123;PROJECT&#125; PUBLIC $&#123;ROOTSRC&#125;  $&#123;ROOTQRC&#125; $&#123;ROOTINC&#125;) #添加头文件主要为了IDE支持和MOC处理</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#当前项目链接相关依赖库</span></span><br><span class="line"><span class="comment">#target_link_libraries($&#123;PROJECT&#125; PUBLIC $&#123;PLNCLASS&#125; $&#123;PLN&#125;) # Core Gui Widgets Designer</span></span><br><span class="line"><span class="keyword">target_link_libraries</span>(<span class="variable">$&#123;PROJECT&#125;</span> PUBLIC Qt<span class="variable">$&#123;QT_VERSION_MAJOR&#125;</span>::Widgets Qt<span class="variable">$&#123;QT_VERSION_MAJOR&#125;</span>::Designer Qt<span class="variable">$&#123;QT_VERSION_MAJOR&#125;</span>::Gui Qt<span class="variable">$&#123;QT_VERSION_MAJOR&#125;</span>::Core Qt<span class="variable">$&#123;QT_VERSION_MAJOR&#125;</span>::UiPlugin) <span class="comment"># Core Gui Widgets Designer</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Here too, I&#x27;m not sure every define is necessary</span></span><br><span class="line"><span class="comment">#include_directories($&#123;CMAKE_CURRENT_BINARY_DIR&#125;)</span></span><br><span class="line"><span class="comment">#add_definitions(-DQT_PLUGIN)</span></span><br><span class="line"><span class="comment">#add_definitions(-DQT_NO_DEBUG)</span></span><br><span class="line"><span class="comment">#add_definitions(-DQT_SHARED)</span></span><br><span class="line"><span class="comment">## I&#x27;m no expert in libraries so, intuitively I&#x27;d say this is useless but it won&#x27;t compile if I don&#x27;t define it.</span></span><br><span class="line"><span class="comment">## This clearly needs to get fixed.</span></span><br><span class="line"><span class="comment">#add_definitions(-DQDESIGNER_EXPORT_WIDGETS)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#add_library($&#123;PROJECT&#125; SHARED</span></span><br><span class="line"><span class="comment">#    $&#123;SOURCES&#125;</span></span><br><span class="line"><span class="comment">#    $&#123;HEADERS_MOC&#125;</span></span><br><span class="line"><span class="comment">#    $&#123;FORMS_HEADERS&#125;</span></span><br><span class="line"><span class="comment">#    $&#123;RESOURCES_RCC&#125;</span></span><br><span class="line"><span class="comment">#)</span></span><br><span class="line"><span class="comment">#target_link_libraries($&#123;PROJECT&#125; $&#123;QT_LIBRARIES&#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置插件的输出目录（可选，但推荐）</span></span><br><span class="line"><span class="comment"># 这样构建后，插件库.dylib,.dll会直接生成到 Qt Designer 能加载的目录，方便测试</span></span><br><span class="line"><span class="comment">#在构建过程中（编译链接之后），将生成的目标文件（你的自定义插件库）输出到一个你指定的、自定义的目录中，而不是默认的CMake构建目录结构里。</span></span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;\nCMAKE_CURRENT_BINARY_DIR: $&#123;CMAKE_CURRENT_BINARY_DIR&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;\nCMAKE_BINARY_DIR: $&#123;CMAKE_BINARY_DIR&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">set_target_properties</span>(<span class="variable">$&#123;PROJECT_NAME&#125;</span> PROPERTIES</span><br><span class="line">        <span class="comment"># 在 Windows 上，LIBRARY_OUTPUT_DIRECTORY 控制 .dll 的输出路径</span></span><br><span class="line">        <span class="comment">#LIBRARY_OUTPUT_DIRECTORY $&#123;CMAKE_BINARY_DIR&#125;/output</span></span><br><span class="line">        <span class="comment"># 在 macOS 上，需要设置 BUNDLE 属性，但通常 LIBRARY_OUTPUT_DIRECTORY 也有效</span></span><br><span class="line">        MACOSX_BUNDLE <span class="keyword">TRUE</span></span><br><span class="line">        MACOSX_BUNDLE_INFO_PLIST <span class="variable">$&#123;CMAKE_CURRENT_BINARY_DIR&#125;</span>/Info.plist</span><br><span class="line">        BUNDLE_OUTPUT_DIRECTORY <span class="variable">$&#123;CMAKE_CURRENT_BINARY_DIR&#125;</span>/bin</span><br><span class="line">        OUTPUT_NAME <span class="string">&quot;battery&quot;</span>  <span class="comment">#libapp.dylib</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Install the library in QtDesigner plugin directory</span></span><br><span class="line"><span class="comment">#在用户执行 make install（或等价的安装命令）时，将构建好的自定义 Designer 插件库文件（$&#123;PROJECT_NAME&#125;）复制到系统上的一个目录中例如$&#123;QT_PLUGINS_DIR&#125;/designer，使得 Qt Designer 或 Qt Creator 能够自动发现并加载它。</span></span><br><span class="line"><span class="comment">#$&#123;QT_PLUGINS_DIR&#125; 是一个 CMake 变量，它指向当前使用的 Qt 版本的插件安装目录。这个变量通常在调用 find_package(Qt6) 后自动设置。</span></span><br><span class="line"><span class="comment">#install(TARGETS $&#123;PROJECT&#125;</span></span><br><span class="line"><span class="comment">#    DESTINATION $&#123;QT_PLUGINS_DIR&#125;/designer</span></span><br><span class="line"><span class="comment">#)</span></span><br><span class="line"><span class="comment">#install(TARGETS $&#123;PROJECT&#125;</span></span><br><span class="line"><span class="comment">#        LIBRARY DESTINATION $&#123;CMAKE_CURRENT_BINARY_DIR&#125;/lib</span></span><br><span class="line"><span class="comment">#)</span></span><br><span class="line"><span class="comment">#install(DIRECTORY include/ DESTINATION $&#123;CMAKE_CURRENT_BINARY_DIR&#125;/include)</span></span><br><span class="line"><span class="comment"># 收集所有.dylib文件</span></span><br><span class="line"><span class="keyword">file</span>(GLOB DYLIBS <span class="string">&quot;$&#123;CMAKE_CURRENT_BINARY_DIR&#125;/*.dylib&quot;</span>)</span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;\nqt安装目录：$&#123;QT6_INSTALL_PREFIX&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;\ndesigner插件目录：$&#123;QT6_INSTALL_PLUGINS&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">set</span>(INSTALL_EXAMPLEDIR <span class="string">&quot;$&#123;QT6_INSTALL_PREFIX&#125;/$&#123;QT6_INSTALL_PLUGINS&#125;/designer&quot;</span>)</span><br><span class="line"><span class="keyword">install</span>(FILES <span class="variable">$&#123;DYLIBS&#125;</span></span><br><span class="line">        DESTINATION <span class="string">&quot;$&#123;QT6_INSTALL_PREFIX&#125;/$&#123;QT6_INSTALL_PLUGINS&#125;/designer&quot;</span></span><br><span class="line"><span class="comment">#        DESTINATION /Applications/Qt\ Creator.app/Contents/PlugIns/designer/</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">#install(TARGETS $&#123;PROJECT&#125;</span></span><br><span class="line"><span class="comment">#        #安装可执行文件, 例如.exe</span></span><br><span class="line"><span class="comment">#        RUNTIME DESTINATION &quot;$&#123;INSTALL_EXAMPLEDIR&#125;&quot;</span></span><br><span class="line"><span class="comment">#        #安装macos应用程序包bundle, *.app</span></span><br><span class="line"><span class="comment">#        BUNDLE DESTINATION &quot;$&#123;INSTALL_EXAMPLEDIR&#125;&quot;</span></span><br><span class="line"><span class="comment">#        #安装动态库.dll, .so, .dylib</span></span><br><span class="line"><span class="comment">#        LIBRARY DESTINATION &quot;$&#123;INSTALL_EXAMPLEDIR&#125;&quot;</span></span><br><span class="line"><span class="comment">#)</span></span><br></pre></td></tr></table></figure>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#/plugin/widgetPlugin/CMakeLists.txt</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;\n##############打印CMAKE_CURRENT_SOURCE_DIR路径$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;################&quot;</span>)</span><br><span class="line"><span class="comment"># 查找某个路径下的所有源文件，此处将src目录下的所有文件名赋给SRC变量</span></span><br><span class="line"><span class="comment">#aux_source_directory(src SRC)</span></span><br><span class="line"><span class="keyword">FILE</span>(GLOB SRC <span class="string">&quot;$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;/SRC/*.cpp&quot;</span> )</span><br><span class="line"><span class="comment"># file(GLOB/GLOB_RECURSE 变量名 要搜索的文件路径和文件类型)</span></span><br><span class="line"><span class="comment">#GLOB: 将指定目录下搜索到的满足条件的所有文件名生成一个列表，并将其存储到变量中。</span></span><br><span class="line"><span class="comment">#GLOB_RECURSE：递归搜索指定目录，将搜索到的满足条件的文件名生成一个列表，并将其存储到变量中。</span></span><br><span class="line"><span class="comment">#CMAKE_CURRENT_SOURCE_DIR 宏表示当前访问的 CMakeLists.txt 文件所在的路径。</span></span><br><span class="line"><span class="keyword">FILE</span>(GLOB INC <span class="string">&quot;$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;/include/*.h&quot;</span> ) <span class="comment">#&quot;$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;/../$&#123;PLNCLASS&#125;/include/*.h&quot;</span></span><br><span class="line"><span class="comment"># 添加qrc文件</span></span><br><span class="line"><span class="keyword">file</span>(GLOB QRC <span class="string">&quot;$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;/resources/*.qrc&quot;</span>)</span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;src目录下CmakeList中QRC文件路径：$&#123;QRC&#125;&quot;</span>)</span><br><span class="line"><span class="comment">#CMAKE_AUTOUIC_SEARCH_PATHS告诉 CMake 哪些目录下的 .ui 文件应该被 AutoUic 处理。设置了这个变量后，CMake 将会在这些指定的目录下搜索 .ui 文件，并将它们转换为相应的头文件.h。当有新添加的.ui文件这条cmake语句先注释在启用否则构建时新添加的.ui文件找不到生成的.h文件</span></span><br><span class="line"><span class="comment">#message(&quot;打印AUTOUIC路径: $&#123;CMAKE_AUTOUIC_SEARCH_PATHS&#125;&quot;)</span></span><br><span class="line"><span class="keyword">list</span>(APPEND CMAKE_AUTOUIC_SEARCH_PATHS <span class="string">&quot;$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;/form&quot;</span>)</span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;打印AUTOUIC路径: $&#123;CMAKE_AUTOUIC_SEARCH_PATHS&#125;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span>(ROOTSRC <span class="variable">$&#123;ROOTSRC&#125;</span> <span class="variable">$&#123;SRC&#125;</span> CACHE INTERNAL <span class="string">&quot;Update&quot;</span> FORCE)</span><br><span class="line"><span class="keyword">set</span>(ROOTINC <span class="variable">$&#123;ROOTINC&#125;</span> <span class="variable">$&#123;INC&#125;</span> CACHE INTERNAL <span class="string">&quot;Update&quot;</span> FORCE)</span><br><span class="line"><span class="keyword">set</span>(ROOTQRC <span class="variable">$&#123;ROOTQRC&#125;</span> <span class="variable">$&#123;QRC&#125;</span> CACHE INTERNAL <span class="string">&quot;Update&quot;</span> FORCE)</span><br><span class="line"><span class="keyword">set</span>(ROOTFORM <span class="variable">$&#123;ROOTFORMDIR&#125;</span> <span class="variable">$&#123;CMAKE_AUTOUIC_SEARCH_PATHS&#125;</span> CACHE INTERNAL <span class="string">&quot;Update&quot;</span> FORCE)</span><br><span class="line"><span class="keyword">set</span>(ROOTINCDIR <span class="variable">$&#123;ROOTINCDIR&#125;</span> <span class="variable">$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;</span>/<span class="keyword">include</span>/ CACHE INTERNAL <span class="string">&quot;Update&quot;</span> FORCE)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成链接库</span></span><br><span class="line"><span class="comment">#add_library ($&#123;PLN&#125; SHARED $&#123;SRC&#125; $&#123;INC&#125; $&#123;QRC&#125;)</span></span><br><span class="line"><span class="comment">#target_include_directories($&#123;PLN&#125; PUBLIC $&#123;CMAKE_CURRENT_SOURCE_DIR&#125;/include/  $&#123;CMAKE_CURRENT_SOURCE_DIR&#125;/../$&#123;PLNCLASS&#125;/include/) # 必须是目录</span></span><br><span class="line"><span class="comment">#target_link_libraries($&#123;PLN&#125; PUBLIC Qt$&#123;QT_VERSION_MAJOR&#125;::Widgets Qt$&#123;QT_VERSION_MAJOR&#125;::Designer Qt$&#123;QT_VERSION_MAJOR&#125;::Gui Qt$&#123;QT_VERSION_MAJOR&#125;::Core Qt$&#123;QT_VERSION_MAJOR&#125;::UiPlugin $&#123;PLNCLASS&#125;) # Qt$&#123;QT_VERSION_MAJOR&#125;::Core</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#install(TARGETS $&#123;PLN&#125;</span></span><br><span class="line"><span class="comment">#        LIBRARY DESTINATION $&#123;CMAKE_BINARY_DIR&#125;/lib</span></span><br><span class="line"><span class="comment">#)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">install</span>(FILES <span class="variable">$&#123;INC&#125;</span> DESTINATION <span class="variable">$&#123;CMAKE_BINARY_DIR&#125;</span>/<span class="keyword">include</span>/)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#/plugin/PLNCLASS/CMakeLists.txt</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;\n#############打印CMAKE_CURRENT_SOURCE_DIR路径$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;##########&quot;</span>)</span><br><span class="line"><span class="comment"># 查找某个路径下的所有源文件，此处将src目录下的所有文件名赋给SRC变量</span></span><br><span class="line"><span class="comment">#aux_source_directory(src SRC)</span></span><br><span class="line"><span class="keyword">FILE</span>(GLOB SRC <span class="string">&quot;$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;/SRC/*.cpp&quot;</span> )</span><br><span class="line"><span class="comment"># file(GLOB/GLOB_RECURSE 变量名 要搜索的文件路径和文件类型)</span></span><br><span class="line"><span class="comment">#GLOB: 将指定目录下搜索到的满足条件的所有文件名生成一个列表，并将其存储到变量中。</span></span><br><span class="line"><span class="comment">#GLOB_RECURSE：递归搜索指定目录，将搜索到的满足条件的文件名生成一个列表，并将其存储到变量中。</span></span><br><span class="line"><span class="comment">#CMAKE_CURRENT_SOURCE_DIR 宏表示当前访问的 CMakeLists.txt 文件所在的路径。</span></span><br><span class="line"><span class="keyword">FILE</span>(GLOB INC <span class="string">&quot;$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;/include/*.h&quot;</span>)</span><br><span class="line"><span class="comment"># 添加qrc文件</span></span><br><span class="line"><span class="keyword">file</span>(GLOB QRC <span class="string">&quot;$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;/resources/*.qrc&quot;</span>)</span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;src目录下CmakeList中QRC文件路径：$&#123;QRC&#125;&quot;</span>)</span><br><span class="line"><span class="comment">#CMAKE_AUTOUIC_SEARCH_PATHS告诉 CMake 哪些目录下的 .ui 文件应该被 AutoUic 处理。设置了这个变量后，CMake 将会在这些指定的目录下搜索 .ui 文件，并将它们转换为相应的头文件.h。当有新添加的.ui文件这条cmake语句先注释在启用否则构建时新添加的.ui文件找不到生成的.h文件</span></span><br><span class="line"><span class="comment">#message(&quot;打印AUTOUIC路径: $&#123;CMAKE_AUTOUIC_SEARCH_PATHS&#125;&quot;)</span></span><br><span class="line"><span class="keyword">list</span>(APPEND CMAKE_AUTOUIC_SEARCH_PATHS <span class="string">&quot;$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;/form&quot;</span>)</span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;打印AUTOUIC路径: $&#123;CMAKE_AUTOUIC_SEARCH_PATHS&#125;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span>(ROOTSRC <span class="variable">$&#123;ROOTSRC&#125;</span> <span class="variable">$&#123;SRC&#125;</span> CACHE INTERNAL <span class="string">&quot;Update&quot;</span> FORCE)</span><br><span class="line"><span class="keyword">set</span>(ROOTINC <span class="variable">$&#123;ROOTINC&#125;</span> <span class="variable">$&#123;INC&#125;</span> CACHE INTERNAL <span class="string">&quot;Update&quot;</span> FORCE)</span><br><span class="line"><span class="keyword">set</span>(ROOTQRC <span class="variable">$&#123;ROOTQRC&#125;</span> <span class="variable">$&#123;QRC&#125;</span> CACHE INTERNAL <span class="string">&quot;Update&quot;</span> FORCE)</span><br><span class="line"><span class="keyword">set</span>(ROOTFORM <span class="variable">$&#123;ROOTFORMDIR&#125;</span> <span class="variable">$&#123;CMAKE_AUTOUIC_SEARCH_PATHS&#125;</span> CACHE INTERNAL <span class="string">&quot;Update&quot;</span> FORCE)</span><br><span class="line"><span class="keyword">set</span>(ROOTINCDIR <span class="variable">$&#123;ROOTINCDIR&#125;</span> <span class="variable">$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;</span>/<span class="keyword">include</span>/ CACHE INTERNAL <span class="string">&quot;Update&quot;</span> FORCE)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成链接库</span></span><br><span class="line"><span class="comment">#add_library ($&#123;PLNCLASS&#125; SHARED $&#123;SRC&#125; $&#123;INC&#125; $&#123;QRC&#125;)</span></span><br><span class="line"><span class="comment">#target_include_directories($&#123;PLNCLASS&#125; PUBLIC $&#123;CMAKE_CURRENT_SOURCE_DIR&#125;/include/) # 必须是目录</span></span><br><span class="line"><span class="comment">#target_link_libraries($&#123;PLNCLASS&#125; PUBLIC Qt$&#123;QT_VERSION_MAJOR&#125;::Widgets Qt$&#123;QT_VERSION_MAJOR&#125;::Designer Qt$&#123;QT_VERSION_MAJOR&#125;::Gui Qt$&#123;QT_VERSION_MAJOR&#125;::Core)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#install(TARGETS $&#123;PLNCLASS&#125;</span></span><br><span class="line"><span class="comment">#        LIBRARY DESTINATION $&#123;CMAKE_BINARY_DIR&#125;/lib</span></span><br><span class="line"><span class="comment">#)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">install</span>(FILES <span class="variable">$&#123;INC&#125;</span> DESTINATION <span class="variable">$&#123;CMAKE_BINARY_DIR&#125;</span>/<span class="keyword">include</span>/)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="/2025/02/24/QT-C/QT-C/%E6%88%AA%E5%B1%8F2025-09-12%2016.19.32.png" alt="截屏2025-09-12 16.19.32"></p>
<p><img src="/2025/02/24/QT-C/QT-C/libbattery.gif" alt="libbattery"></p>
<h4 id="显式调用动态库">显式调用动态库</h4>
<p>QLibrary</p>
<h3 id="静态链接库">静态链接库</h3>
<p><strong>静态库</strong>:</p>
<ol>
<li>编译：编译器将.h和.cpp文件生成.o目标文件</li>
<li>编译时链接：链接器将.o链接到动态文件.a  <s>可执行文件(例如.exe)</s></li>
<li>编译时链接：将动态库文件.a链接到可执行文件。</li>
<li>当需要修改某个静态文件时<strong>需要重新编译整个项目的可执行文件</strong>。</li>
</ol>
<p><strong>目录结构</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">|- staticLib/</span><br><span class="line">|  |- dialog/</span><br><span class="line">|     |- form/</span><br><span class="line">|        |- dialogopen.ui</span><br><span class="line">|     |- include/</span><br><span class="line">|        |- dialogopen.h</span><br><span class="line">|     |- src/</span><br><span class="line">|        |- dialogopen.cpp</span><br><span class="line">|     |- CMakeLists.txt</span><br><span class="line">|  |- CMakeLists.txt</span><br></pre></td></tr></table></figure>
<p><strong>cmake</strong>生成第三方库并让其他项目使用find_package导入该库，而不是直接导入静态库文件</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#/staticLib/CMakeLists.txt</span></span><br><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.16</span>)</span><br><span class="line"><span class="comment">#项目名</span></span><br><span class="line"><span class="keyword">set</span>(<span class="keyword">PROJECT</span> Dialog)</span><br><span class="line"><span class="keyword">project</span>(<span class="variable">$&#123;PROJECT&#125;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 插件类接口名</span></span><br><span class="line"><span class="comment">#set(PLN widgetPlugin)</span></span><br><span class="line"><span class="comment"># 插件类名</span></span><br><span class="line"><span class="keyword">set</span>(PLNCLASS dialog)</span><br><span class="line"></span><br><span class="line"><span class="comment">#输出库名</span></span><br><span class="line"><span class="keyword">set</span>(LIBNAME dialogExport)</span><br><span class="line"></span><br><span class="line"><span class="comment">#系统信息</span></span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;操作系统$&#123;CMAKE_SYSTEM&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#CMake信息</span></span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;当前CMake工具所在目录：$&#123;CMAKE_COMMAND&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;CMake版本号: $&#123;CMAKE_MAJOR_VERSION&#125;.$&#123;CMAKE_MINOR_VERSION&#125;.$&#123;CMAKE_PATCH_VERSION&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#编译类型</span></span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;编译类型$&#123;CMAKE_BUILD_TYPE&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#设置环境：如果很多库你都安装了多个版本，一定要先把库的安装路径追加到 “CMAKE_PREFIX_PATH” 变量中, 这个变量影响 CMake 在查找包（包括库和程序）时应考虑哪些路径，它可以被设置为一个或多个路径，这些路径使用分号 (;) 分隔，在find_package()，注意使用 “版本号 EXACT” 关键字修饰，帮你判断是否找到指定版本</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_PREFIX_PATH <span class="string">&quot;$(brew --prefix qt@6);&quot;</span>) <span class="comment"># /opt/homebrew/Cellar/qt/5.9.0/lib/cmake/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置为自动运行 moc, uic, rcc 等 Qt 工具</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_AUTOMOC <span class="keyword">ON</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_AUTOUIC <span class="keyword">ON</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_AUTORCC <span class="keyword">ON</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Needed to compile against ui and moc generated files</span></span><br><span class="line"><span class="comment">#include_directories($&#123;CMAKE_CURRENT_BINARY_DIR&#125;)</span></span><br><span class="line"><span class="comment">#set(CMAKE_INCLUDE_CURRENT_DIR ON)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置 C++ 标准</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_STANDARD <span class="number">17</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_STANDARD_REQUIRED <span class="keyword">ON</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#包导出跟目录</span></span><br><span class="line"><span class="keyword">get_filename_component</span>(CMAKE_INSTALL_PREFIX <span class="variable">$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;</span> DIRECTORY)</span><br><span class="line"></span><br><span class="line"><span class="comment"># This is experimental, it works but it may be not optimal, don&#x27;t hesitate to change this</span></span><br><span class="line"><span class="keyword">find_package</span>(Qt6 REQUIRED Core Gui Widgets) <span class="comment">#Core</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 搭建项目工程</span></span><br><span class="line"><span class="comment">#set($&#123;PLNCLASS&#125;_SRC)</span></span><br><span class="line"><span class="comment">#set($&#123;PLNCLASS&#125;_INC)</span></span><br><span class="line"><span class="comment">#set($&#123;PLNCLASS&#125;_QRC)</span></span><br><span class="line"><span class="comment">#set($&#123;PLN&#125;_SRC)</span></span><br><span class="line"><span class="comment">#set($&#123;PLN&#125;_INC)</span></span><br><span class="line"><span class="comment">#set($&#123;PLN&#125;_QRC)</span></span><br><span class="line"><span class="keyword">set</span>(ROOTSRC <span class="string">&quot;&quot;</span> CACHE INTERNAL <span class="string">&quot;global source&quot;</span>)</span><br><span class="line"><span class="keyword">set</span>(ROOTINC <span class="string">&quot;&quot;</span> CACHE INTERNAL <span class="string">&quot;global include&quot;</span>)</span><br><span class="line"><span class="keyword">set</span>(ROOTQRC <span class="string">&quot;&quot;</span> CACHE INTERNAL <span class="string">&quot;global resource&quot;</span>)</span><br><span class="line"><span class="keyword">set</span>(ROOTFORMDIR <span class="string">&quot;&quot;</span> CACHE INTERNAL <span class="string">&quot;global ui dir&quot;</span>)</span><br><span class="line"><span class="keyword">set</span>(ROOTINCDIR <span class="string">&quot;&quot;</span> CACHE INTERNAL <span class="string">&quot;global include dir&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">add_subdirectory</span>(<span class="variable">$&#123;PLNCLASS&#125;</span>)</span><br><span class="line"><span class="comment">#add_subdirectory($&#123;PLN&#125;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;\n##############打印CMAKE_CURRENT_SOURCE_DIR路径$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;################&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;\n==========所有头文件：$&#123;ROOTINC&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;\n==========所有源文件：$&#123;ROOTSRC&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;\n==========所有qrc文件：$&#123;ROOTQRC&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;\n==========所有ui文件所在目录：$&#123;ROOTFORMDIR&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;\n==========所有头文件所在目录：$&#123;ROOTINCDIR&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置默认构建类型为 Release（如果未指定）</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">NOT</span> CMAKE_BUILD_TYPE)</span><br><span class="line">    <span class="keyword">set</span>(CMAKE_BUILD_TYPE Release)</span><br><span class="line"><span class="keyword">endif</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置输出目录</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_BINARY_DIR <span class="variable">$&#123;CMAKE_SOURCE_DIR&#125;</span>/cmake-build-release)</span><br><span class="line"></span><br><span class="line"><span class="comment">#set(PROJECT_SOURCES</span></span><br><span class="line"><span class="comment">#        # $&#123;SOURCE_DIR&#125;/main.cpp</span></span><br><span class="line"><span class="comment">#        # $&#123;SOURCE_DIR&#125;/mainwindow.cpp</span></span><br><span class="line"><span class="comment">#        # $&#123;UI_HEADERS&#125;</span></span><br><span class="line"><span class="comment">#        # $&#123;HEADER_DIR&#125;</span></span><br><span class="line"><span class="comment">#        $&#123;SRC&#125;</span></span><br><span class="line"><span class="comment">#        # $&#123;INC&#125;</span></span><br><span class="line"><span class="comment">#        $&#123;QRC&#125;</span></span><br><span class="line"><span class="comment">#)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">list</span>(APPEND CMAKE_AUTOUIC_SEARCH_PATHS <span class="variable">$&#123;ROOTFORMDIR&#125;</span>)</span><br><span class="line"><span class="comment">#CMake 构建系统时Qt MOC 处理: 包含 Q_OBJECT 的头文件需要被添加到 target_sources 以便 AUTOMOC 能找到它们</span></span><br><span class="line"><span class="comment">#IDE 支持: 让 IDE 知道这些头文件属于项目，便于导航和代码分析</span></span><br><span class="line"><span class="comment">#安装目标: 头文件会被包含在安装目标中</span></span><br><span class="line"><span class="comment">#target_sources($&#123;PROJECT&#125; PUBLIC $&#123;ROOTSRC&#125;  $&#123;ROOTQRC&#125; $&#123;ROOTINC&#125;) #添加头文件主要为了IDE支持和MOC处理</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##生成库文件</span></span><br><span class="line"><span class="comment">#add_library($&#123;PROJECT&#125; SHARED</span></span><br><span class="line"><span class="comment">#        #MANUAL_FINALIZATION</span></span><br><span class="line"><span class="comment">##        $&#123;PROJECT_SOURCES&#125;</span></span><br><span class="line"><span class="comment">#)</span></span><br><span class="line"><span class="comment">#qt_add_plugin($&#123;PROJECT&#125;)</span></span><br><span class="line"><span class="keyword">add_library</span>(<span class="variable">$&#123;PROJECT&#125;</span> STATIC  <span class="variable">$&#123;ROOTSRC&#125;</span>  <span class="variable">$&#123;ROOTQRC&#125;</span> <span class="variable">$&#123;ROOTINC&#125;</span>)</span><br><span class="line"><span class="comment">#当前项目依赖库中使用到的头文件目录</span></span><br><span class="line"><span class="comment">#target_include_directories($&#123;PROJECT&#125; PUBLIC $&#123;CMAKE_CURRENT_SOURCE_DIR&#125;/$&#123;PLNCLASS&#125;/include/ $&#123;CMAKE_CURRENT_SOURCE_DIR&#125;/$&#123;PLN&#125;/include/)</span></span><br><span class="line"><span class="comment">#添加编译器c++搜索头文件的目录，告诉编译器在哪里查找 #include 指令中的文件。</span></span><br><span class="line"><span class="keyword">target_include_directories</span>(<span class="variable">$&#123;PROJECT&#125;</span> PUBLIC</span><br><span class="line">    <span class="comment">#构建时路径</span></span><br><span class="line">    $&lt;BUILD_INTERFACE:<span class="variable">$&#123;ROOTINCDIR&#125;</span>&gt;</span><br><span class="line">    <span class="comment">#安装时路径</span></span><br><span class="line">    $&lt;INSTALL_INTERFACE:<span class="keyword">include</span>&gt;</span><br><span class="line"><span class="comment">#    $&#123;ROOTINCDIR&#125;</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">#当前项目链接相关依赖库</span></span><br><span class="line"><span class="comment">#target_link_libraries($&#123;PROJECT&#125; PUBLIC $&#123;PLNCLASS&#125; $&#123;PLN&#125;) # Core Gui Widgets Designer</span></span><br><span class="line"><span class="keyword">target_link_libraries</span>(<span class="variable">$&#123;PROJECT&#125;</span> PUBLIC  Qt<span class="variable">$&#123;QT_VERSION_MAJOR&#125;</span>::Gui Qt<span class="variable">$&#123;QT_VERSION_MAJOR&#125;</span>::Core Qt<span class="variable">$&#123;QT_VERSION_MAJOR&#125;</span>::Widgets) <span class="comment"># Core Gui Widgets Designer</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Here too, I&#x27;m not sure every define is necessary</span></span><br><span class="line"><span class="comment">#include_directories($&#123;CMAKE_CURRENT_BINARY_DIR&#125;)</span></span><br><span class="line"><span class="comment">#add_definitions(-DQT_PLUGIN)</span></span><br><span class="line"><span class="comment">#add_definitions(-DQT_NO_DEBUG)</span></span><br><span class="line"><span class="comment">#add_definitions(-DQT_SHARED)</span></span><br><span class="line"><span class="comment">## I&#x27;m no expert in libraries so, intuitively I&#x27;d say this is useless but it won&#x27;t compile if I don&#x27;t define it.</span></span><br><span class="line"><span class="comment">## This clearly needs to get fixed.</span></span><br><span class="line"><span class="comment">#add_definitions(-DQDESIGNER_EXPORT_WIDGETS)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#add_library($&#123;PROJECT&#125; SHARED</span></span><br><span class="line"><span class="comment">#    $&#123;SOURCES&#125;</span></span><br><span class="line"><span class="comment">#    $&#123;HEADERS_MOC&#125;</span></span><br><span class="line"><span class="comment">#    $&#123;FORMS_HEADERS&#125;</span></span><br><span class="line"><span class="comment">#    $&#123;RESOURCES_RCC&#125;</span></span><br><span class="line"><span class="comment">#)</span></span><br><span class="line"><span class="comment">#target_link_libraries($&#123;PROJECT&#125; $&#123;QT_LIBRARIES&#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置插件的输出目录（可选，但推荐）</span></span><br><span class="line"><span class="comment"># 这样构建后，插件库.dylib,.dll会直接生成到 Qt Designer 能加载的目录，方便测试</span></span><br><span class="line"><span class="comment">#在构建过程中（编译链接之后），将生成的目标文件（你的自定义插件库）输出到一个你指定的、自定义的目录中，而不是默认的CMake构建目录结构里。</span></span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;\nCMAKE_CURRENT_BINARY_DIR: $&#123;CMAKE_CURRENT_BINARY_DIR&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;\nCMAKE_BINARY_DIR: $&#123;CMAKE_BINARY_DIR&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">set_target_properties</span>(<span class="variable">$&#123;PROJECT_NAME&#125;</span> PROPERTIES</span><br><span class="line">        <span class="comment"># 在 Windows 上，LIBRARY_OUTPUT_DIRECTORY 控制 .dll 的输出路径</span></span><br><span class="line">        <span class="comment">#LIBRARY_OUTPUT_DIRECTORY $&#123;CMAKE_BINARY_DIR&#125;/output</span></span><br><span class="line">        <span class="comment"># 在 macOS 上，需要设置 BUNDLE 属性，但通常 LIBRARY_OUTPUT_DIRECTORY 也有效</span></span><br><span class="line">        MACOSX_BUNDLE <span class="keyword">TRUE</span></span><br><span class="line">        MACOSX_BUNDLE_INFO_PLIST <span class="variable">$&#123;CMAKE_CURRENT_BINARY_DIR&#125;</span>/Info.plist</span><br><span class="line">        BUNDLE_OUTPUT_DIRECTORY <span class="variable">$&#123;CMAKE_CURRENT_BINARY_DIR&#125;</span>/bin</span><br><span class="line">        OUTPUT_NAME <span class="variable">$&#123;LIBNAME&#125;</span>  <span class="comment">#libapp.dylib</span></span><br><span class="line"><span class="comment">#        IMPORTED_LOCATION $&#123;CMAKE_INSTALL_PREFIX&#125;/lib/lib$&#123;LIBNAME&#125;.a</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Install the library in QtDesigner plugin directory</span></span><br><span class="line"><span class="comment">#在用户执行 make install（或等价的安装命令）时，将构建好的自定义 Designer 插件库文件（$&#123;PROJECT_NAME&#125;）复制到系统上的一个目录中例如$&#123;QT_PLUGINS_DIR&#125;/designer，使得 Qt Designer 或 Qt Creator 能够自动发现并加载它。</span></span><br><span class="line"><span class="comment">#$&#123;QT_PLUGINS_DIR&#125; 是一个 CMake 变量，它指向当前使用的 Qt 版本的插件安装目录。这个变量通常在调用 find_package(Qt6) 后自动设置。</span></span><br><span class="line"><span class="comment">#install(TARGETS $&#123;PROJECT&#125;</span></span><br><span class="line"><span class="comment">#    DESTINATION $&#123;QT_PLUGINS_DIR&#125;/designer</span></span><br><span class="line"><span class="comment">#)</span></span><br><span class="line"><span class="comment">#install(TARGETS $&#123;PROJECT&#125;</span></span><br><span class="line"><span class="comment">#        LIBRARY DESTINATION $&#123;CMAKE_CURRENT_BINARY_DIR&#125;/lib</span></span><br><span class="line"><span class="comment">#)</span></span><br><span class="line"><span class="comment">#install(DIRECTORY include/ DESTINATION $&#123;CMAKE_CURRENT_BINARY_DIR&#125;/include)</span></span><br><span class="line"><span class="comment"># 收集所有.dylib文件 或 .a</span></span><br><span class="line"><span class="keyword">file</span>(GLOB DYLIBS <span class="string">&quot;$&#123;CMAKE_CURRENT_BINARY_DIR&#125;/*.a&quot;</span>)</span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;\nqt安装目录：$&#123;QT6_INSTALL_PREFIX&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;\ndesigner插件目录：$&#123;QT6_INSTALL_PLUGINS&#125;&quot;</span>)</span><br><span class="line"><span class="comment">#set(INSTALL_EXAMPLEDIR &quot;$&#123;QT6_INSTALL_PREFIX&#125;/$&#123;QT6_INSTALL_PLUGINS&#125;/designer&quot;)</span></span><br><span class="line"><span class="comment">#install(FILES $&#123;DYLIBS&#125;</span></span><br><span class="line"><span class="comment">#        DESTINATION &quot;$&#123;QT6_INSTALL_PREFIX&#125;/$&#123;QT6_INSTALL_PLUGINS&#125;/designer&quot;</span></span><br><span class="line"><span class="comment">##        DESTINATION /Applications/Qt\ Creator.app/Contents/PlugIns/designer/</span></span><br><span class="line"><span class="comment">#)</span></span><br><span class="line"><span class="comment">#set(CMAKE_INSTALL_PREFIX $&#123;CMAKE_CURRENT_BINARY_DIR&#125;/../../)</span></span><br><span class="line"><span class="comment">#string(REGEX REPLACE &quot;(.+)\\learn/basic.*&quot; &quot;\\1&quot; CMAKE_INSTALL_PREFIX $&#123;CMAKE_CURRENT_SOURCE_DIR&#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;\nCMAKE_INSTALL_PREFIX: $&#123;CMAKE_INSTALL_PREFIX&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">install</span>(TARGETS <span class="variable">$&#123;PROJECT&#125;</span></span><br><span class="line">        <span class="keyword">EXPORT</span> <span class="variable">$&#123;LIBNAME&#125;</span>Targets</span><br><span class="line">        <span class="comment">#安装可执行文件, 例如.exe</span></span><br><span class="line">        RUNTIME DESTINATION <span class="variable">$&#123;CMAKE_INSTALL_PREFIX&#125;</span>/bin<span class="comment">#&quot;$&#123;INSTALL_EXAMPLEDIR&#125;&quot;</span></span><br><span class="line">        <span class="comment">#安装macos应用程序包bundle, *.app</span></span><br><span class="line">        BUNDLE DESTINATION <span class="variable">$&#123;CMAKE_INSTALL_PREFIX&#125;</span>/bin<span class="comment">#&quot;$&#123;INSTALL_EXAMPLEDIR&#125;&quot;</span></span><br><span class="line">        <span class="comment">#安装动态库.dll, .so, .dylib</span></span><br><span class="line">        LIBRARY DESTINATION <span class="variable">$&#123;CMAKE_INSTALL_PREFIX&#125;</span>/lib<span class="comment">#&quot;$&#123;INSTALL_EXAMPLEDIR&#125;&quot;</span></span><br><span class="line">        ARCHIVE DESTINATION <span class="variable">$&#123;CMAKE_INSTALL_PREFIX&#125;</span>/lib</span><br><span class="line">        INCLUDES DESTINATION <span class="variable">$&#123;CMAKE_INSTALL_PREFIX&#125;</span>/<span class="keyword">include</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">#message(&quot;\nINTERFACE_INCLUDE_DIRECTORIES: $&#123;INTERFACE_INCLUDE_DIRECTORIES&#125;&quot;)</span></span><br><span class="line"><span class="keyword">install</span>(<span class="keyword">EXPORT</span> <span class="variable">$&#123;LIBNAME&#125;</span>Targets</span><br><span class="line">    <span class="keyword">FILE</span> <span class="variable">$&#123;LIBNAME&#125;</span>Config.cmake</span><br><span class="line">    NAMESPACE <span class="variable">$&#123;LIBNAME&#125;</span>::</span><br><span class="line">    DESTINATION <span class="variable">$&#123;CMAKE_INSTALL_PREFIX&#125;</span>/lib/cmake/<span class="variable">$&#123;LIBNAME&#125;</span><span class="comment">#&quot;/Users/liuchuanxi/项目/QT/Qt-project/动态库和静态库/静态库/staticLib/lib/cmake/$&#123;LIBNAME&#125;&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">install</span>(DIRECTORY <span class="variable">$&#123;ROOTINCDIR&#125;</span> DESTINATION <span class="keyword">include</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#/static/dialog/CMakeLists.txt</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;\n#############打印CMAKE_CURRENT_SOURCE_DIR路径$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;##########&quot;</span>)</span><br><span class="line"><span class="comment"># 查找某个路径下的所有源文件，此处将src目录下的所有文件名赋给SRC变量</span></span><br><span class="line"><span class="comment">#aux_source_directory(src SRC)</span></span><br><span class="line"><span class="keyword">FILE</span>(GLOB SRC <span class="string">&quot;$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;/SRC/*.cpp&quot;</span> )</span><br><span class="line"><span class="comment"># file(GLOB/GLOB_RECURSE 变量名 要搜索的文件路径和文件类型)</span></span><br><span class="line"><span class="comment">#GLOB: 将指定目录下搜索到的满足条件的所有文件名生成一个列表，并将其存储到变量中。</span></span><br><span class="line"><span class="comment">#GLOB_RECURSE：递归搜索指定目录，将搜索到的满足条件的文件名生成一个列表，并将其存储到变量中。</span></span><br><span class="line"><span class="comment">#CMAKE_CURRENT_SOURCE_DIR 宏表示当前访问的 CMakeLists.txt 文件所在的路径。</span></span><br><span class="line"><span class="keyword">FILE</span>(GLOB INC <span class="string">&quot;$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;/include/*.h&quot;</span>)</span><br><span class="line"><span class="comment"># 添加qrc文件</span></span><br><span class="line"><span class="keyword">file</span>(GLOB QRC <span class="string">&quot;$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;/resources/*.qrc&quot;</span>)</span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;src目录下CmakeList中QRC文件路径：$&#123;QRC&#125;&quot;</span>)</span><br><span class="line"><span class="comment">#CMAKE_AUTOUIC_SEARCH_PATHS告诉 CMake 哪些目录下的 .ui 文件应该被 AutoUic 处理。设置了这个变量后，CMake 将会在这些指定的目录下搜索 .ui 文件，并将它们转换为相应的头文件.h。当有新添加的.ui文件这条cmake语句先注释在启用否则构建时新添加的.ui文件找不到生成的.h文件</span></span><br><span class="line"><span class="comment">#message(&quot;打印AUTOUIC路径: $&#123;CMAKE_AUTOUIC_SEARCH_PATHS&#125;&quot;)</span></span><br><span class="line"><span class="keyword">list</span>(APPEND CMAKE_AUTOUIC_SEARCH_PATHS <span class="string">&quot;$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;/form&quot;</span>)</span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;打印AUTOUIC路径: $&#123;CMAKE_AUTOUIC_SEARCH_PATHS&#125;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span>(ROOTSRC <span class="variable">$&#123;ROOTSRC&#125;</span> <span class="variable">$&#123;SRC&#125;</span> CACHE INTERNAL <span class="string">&quot;Update&quot;</span> FORCE)</span><br><span class="line"><span class="keyword">set</span>(ROOTINC <span class="variable">$&#123;ROOTINC&#125;</span> <span class="variable">$&#123;INC&#125;</span> CACHE INTERNAL <span class="string">&quot;Update&quot;</span> FORCE)</span><br><span class="line"><span class="keyword">set</span>(ROOTQRC <span class="variable">$&#123;ROOTQRC&#125;</span> <span class="variable">$&#123;QRC&#125;</span> CACHE INTERNAL <span class="string">&quot;Update&quot;</span> FORCE)</span><br><span class="line"><span class="keyword">set</span>(ROOTFORMDIR <span class="variable">$&#123;ROOTFORMDIR&#125;</span> <span class="variable">$&#123;CMAKE_AUTOUIC_SEARCH_PATHS&#125;</span> CACHE INTERNAL <span class="string">&quot;Update&quot;</span> FORCE)</span><br><span class="line"><span class="keyword">set</span>(ROOTINCDIR <span class="variable">$&#123;ROOTINCDIR&#125;</span> <span class="variable">$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;</span>/<span class="keyword">include</span>/ CACHE INTERNAL <span class="string">&quot;Update&quot;</span> FORCE)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成链接库</span></span><br><span class="line"><span class="comment">#add_library ($&#123;PLNCLASS&#125; SHARED $&#123;SRC&#125; $&#123;INC&#125; $&#123;QRC&#125;)</span></span><br><span class="line"><span class="comment">#target_include_directories($&#123;PLNCLASS&#125; PUBLIC $&#123;CMAKE_CURRENT_SOURCE_DIR&#125;/include/) # 必须是目录</span></span><br><span class="line"><span class="comment">#target_link_libraries($&#123;PLNCLASS&#125; PUBLIC Qt$&#123;QT_VERSION_MAJOR&#125;::Widgets Qt$&#123;QT_VERSION_MAJOR&#125;::Designer Qt$&#123;QT_VERSION_MAJOR&#125;::Gui Qt$&#123;QT_VERSION_MAJOR&#125;::Core)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#install(TARGETS $&#123;PLNCLASS&#125;</span></span><br><span class="line"><span class="comment">#        LIBRARY DESTINATION $&#123;CMAKE_BINARY_DIR&#125;/lib</span></span><br><span class="line"><span class="comment">#)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#install(FILES $&#123;INC&#125; DESTINATION $&#123;CMAKE_BINARY_DIR&#125;/include/)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>其他项目使用find_package导入生成库</strong></p>
<ol>
<li>
<pre><code class="language-cmake"> find_package(dialogExport REQUIRED PATHS &quot;/Users/liuchuanxi/项目/QT/Qt-project/动态库和静态库/静态库/&quot;)
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">2. ```cmake</span><br><span class="line">	target_link_libraries(MainWindow PUBLIC Qt$&#123;QT_VERSION_MAJOR&#125;::Widgets dialogExport::Dialog)</span><br></pre></td></tr></table></figure>

</code></pre>
</li>
</ol>
<p><strong>注：</strong> 链接时使用命名空间+项目名称而不是命名空间+导出库名</p>
<h2 id="天气预报">天气预报</h2>
<h4 id="概述-2">概述</h4>
<ul>
<li>stylesheet界面美化</li>
<li>json数据解析</li>
<li>HTTP通信</li>
<li>自定义控件绘制温度</li>
<li>多控件</li>
<li>代码整合调试能力</li>
</ul>
<p><img src="/2025/02/24/QT-C/QT-C/image-20250530095611373.png" alt="image-20250530095611373"></p>
<h4 id="stylesheet样式">stylesheet样式</h4>
<p>设置边框弧度</p>
<p><code>QLabel &#123;background-color: rgb(123, 191, 197); border-radius: 5px;; border-top-left-radius:0px; border-top-right-radius:0px&#125;</code></p>
<h4 id="应用窗体拖动：鼠标坐标">应用窗体拖动：鼠标坐标</h4>
<p><img src="/2025/02/24/QT-C/QT-C/image-20250610094250536.png" alt="image-20250610094250536"></p>
<p>鼠标点击事件<code>mousePressEvent</code>和鼠标移动事件<code>mouseMoveEvent</code></p>
<h4 id="天气数据获取">天气数据获取</h4>
<p><img src="/2025/02/24/QT-C/QT-C/image-20250610134819840.png" alt="image-20250610134819840"></p>
<h4 id="QT的HTTP编程">QT的HTTP编程</h4>
<p>涉及QT的网络模块来进行HTTP请求和处理HTTP响应。用到<code>QNetWorkAccessManager</code>,<code>QNetworkRequest</code>, <code>QNetworkReply</code>类</p>
<p><strong>步骤1: 包含必要头文件</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QCoreApplication&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QNetworkAccessManager&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QNetworkRequest&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QNetworkReply&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QObject&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QDebug&gt;</span></span></span><br></pre></td></tr></table></figure>
<p><strong>步骤2:发送HTTP请求</strong></p>
<p>创建一个<code>QNetworkAccessManager</code>对象，并使用它发送HTTP请求。<code>QNetworkAccessManager</code>对象会异步的处理请求，并返回一个<code>QNetworkReply</code>对象。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* arg[])</span></span>&#123;</span><br><span class="line">  <span class="function">QCoreApplication <span class="title">a</span><span class="params">(argc, argv)</span></span>;</span><br><span class="line">  QNetworkAccessManager manager;</span><br><span class="line">  <span class="function">QNetworkRequest <span class="title">requests</span><span class="params">(QUrl(<span class="string">&quot;http://example.com&quot;</span>))</span></span>;</span><br><span class="line">  QNetworkReply* reply = manager.<span class="built_in">get</span>(requests);</span><br><span class="line">  QObject::<span class="built_in">connect</span>(reply, &amp;QNectworkReply::finished, [&amp;]()&#123;</span><br><span class="line">    <span class="keyword">if</span> (reply-&gt;<span class="built_in">error</span>())&#123;</span><br><span class="line">      qDebug &lt;&lt; <span class="string">&quot;Error:&quot;</span> &lt;&lt; reply-&gt;<span class="built_in">errorString</span>();</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    QString responts = reply-&gt;<span class="built_in">readAll</span>();</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;Response:&quot;</span> &lt;&lt; response;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> a.<span class="built_in">exec</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用<code>QNetworkAccessManager</code>的<code>get</code>方法发送一个HTTP请求到“<a target="_blank" rel="noopener" href="http://example.com">http://example.com</a>”。然后我们连接了<code>QNetworkReply</code>对象的<code>finished</code>信号到一个lambda函数，该函数在收到HTTP响应时被调用。</p>
<p>注：</p>
<ol>
<li>异步处理：<code>QNetworkAccessManager</code>的请求是异步的。这意味着<code>get</code>方法会立即返回，而HTTP响应将在稍后通过信号来处理。</li>
<li>错误处理：应该检查<code>QNetworkReply</code>对象是否有错误，并相应处理。</li>
<li>内存管理：<code>QNetworkReply</code>对象需要被正确地管理，以避免内存泄漏，通常使用<code>QObject::deleteLater</code>来安排删除它是一个好方法。</li>
</ol>
<h4 id="事件滤波器">事件滤波器</h4>
<p>为搜索QLabel、输入城市的QLineEdit添加鼠标点击事件搜索执行搜索槽函数和鼠标首次点击搜索框删除城市名的事件</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br></pre></td><td class="code"><pre><span class="line">MainWindow::<span class="built_in">MainWindow</span>(QWidget *parent)</span><br><span class="line">    : <span class="built_in">QMainWindow</span>(parent)</span><br><span class="line">    , <span class="built_in">ui</span>(<span class="keyword">new</span> Ui::MainWindow)</span><br><span class="line">&#123;</span><br><span class="line">    ui-&gt;<span class="built_in">setupUi</span>(<span class="keyword">this</span>);</span><br><span class="line">    ui-&gt;centralwidget-&gt;<span class="built_in">setLayout</span>(ui-&gt;wholeVL);</span><br><span class="line">    <span class="comment">// ui-&gt;widget2-&gt;setLayout(ui-&gt;widget2);</span></span><br><span class="line">    <span class="comment">//固定应用窗体尺寸</span></span><br><span class="line">    <span class="built_in">setFixedSize</span>(<span class="number">432</span>, <span class="number">784</span>);</span><br><span class="line">    <span class="comment">//设置右键后的弹出菜单</span></span><br><span class="line">    menu = <span class="keyword">new</span> <span class="built_in">QMenu</span>(<span class="keyword">this</span>);</span><br><span class="line">    actionClose = <span class="keyword">new</span> <span class="built_in">QAction</span>(<span class="built_in">QIcon</span>(<span class="string">&quot;:weather/images/close.png&quot;</span>), <span class="built_in">tr</span>(<span class="string">&quot;退出&quot;</span>), <span class="keyword">this</span>);</span><br><span class="line">    menu-&gt;<span class="built_in">addAction</span>(actionClose);</span><br><span class="line">    <span class="comment">//设置右键菜单颜色</span></span><br><span class="line">    menu-&gt;<span class="built_in">setStyleSheet</span>(<span class="string">&quot;QMenu::item &#123;color:white; background-color:gray&#125;&quot;</span>);</span><br><span class="line">    <span class="comment">//设置搜索label的事件过滤器</span></span><br><span class="line">    ui-&gt;searchLabel-&gt;<span class="built_in">installEventFilter</span>(<span class="keyword">this</span>);</span><br><span class="line">    ui-&gt;searchLineEdit-&gt;<span class="built_in">installEventFilter</span>(<span class="keyword">this</span>);</span><br><span class="line">    <span class="comment">//网络请求</span></span><br><span class="line">    <span class="comment">//QNetworkAccessManager对象发起请求</span></span><br><span class="line">    manager = <span class="keyword">new</span> <span class="built_in">QNetworkAccessManager</span>(<span class="keyword">this</span>);</span><br><span class="line">    <span class="comment">//请求信息</span></span><br><span class="line">    urlStr = <span class="string">&quot;http://gfeljm.tianqiapi.com/api?unescape=1&amp;version=v9&amp;appid=21676181&amp;appsecret=CfbYCU9k&quot;</span>;</span><br><span class="line">    QUrl urlUrl = <span class="built_in">QUrl</span>(urlStr);</span><br><span class="line">    <span class="function">QNetworkRequest <span class="title">request</span><span class="params">(urlUrl)</span></span>;</span><br><span class="line">    <span class="comment">// QNetworkRequest request(QUrl(&quot;http://gfeljm.tianqiap.com/api?unescape=1&amp;version=v9&amp;appid=21676181&amp;appsecret=CfbYCU9k&quot;));</span></span><br><span class="line">    <span class="comment">//接收信息</span></span><br><span class="line">    response = manager-&gt;<span class="built_in">get</span>(request);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//信号与槽</span></span><br><span class="line">    <span class="built_in">connect</span>(menu, &amp;QMenu::triggered, [=]()&#123;<span class="keyword">this</span>-&gt;<span class="built_in">close</span>();&#125;);</span><br><span class="line">    <span class="comment">// connect(manager, &amp;QNetworkAccessManager::finished, [=](QNetworkReply *reply) &#123;</span></span><br><span class="line">    <span class="comment">//     qDebug() &lt;&lt; &quot;==============manager finish!==============&quot; ;//&lt;&lt; response-&gt;errorString();</span></span><br><span class="line">    <span class="comment">// &#125;);</span></span><br><span class="line">    <span class="comment">// connect(response, &amp;QNetworkReply::finished, this, &amp;MainWindow::onHttpReply);</span></span><br><span class="line">    <span class="built_in">connect</span>(manager, &amp;QNetworkAccessManager::finished, <span class="keyword">this</span>, &amp;MainWindow::onHttpReply);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">MainWindow::eventFilter</span><span class="params">(QObject *obj, QEvent *event)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;使用⌚️过滤器增加事件触发信号eventFilter:&quot;</span> &lt;&lt; obj;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;使用⌚️过滤器增加事件触发信号type:&quot;</span> &lt;&lt; event-&gt;<span class="built_in">type</span>();</span><br><span class="line">    <span class="keyword">if</span> (event-&gt;<span class="built_in">type</span>() == QEvent::MouseButtonPress) &#123;</span><br><span class="line">        QMouseEvent *mouseEvent = <span class="built_in">static_cast</span>&lt;QMouseEvent *&gt;(event);</span><br><span class="line">        <span class="keyword">if</span> (mouseEvent-&gt;<span class="built_in">button</span>() == Qt::LeftButton &amp;&amp; obj-&gt;<span class="built_in">objectName</span>() == <span class="string">&quot;searchLabel&quot;</span>) &#123;</span><br><span class="line">            <span class="built_in">on_searchLabel_clicked</span>();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (mouseEvent-&gt;<span class="built_in">button</span>()  == Qt::LeftButton  &amp;&amp; obj-&gt;<span class="built_in">objectName</span>() == <span class="string">&quot;searchLineEdit&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (firstFocus == <span class="literal">true</span>) &#123;</span><br><span class="line">                ui-&gt;searchLineEdit-&gt;<span class="built_in">clear</span>();</span><br><span class="line">                firstFocus = <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (event-&gt;<span class="built_in">type</span>() == QEvent::KeyPress &amp;&amp; obj-&gt;<span class="built_in">objectName</span>() == <span class="string">&quot;searchLineEdit&quot;</span>) &#123;</span><br><span class="line">        QKeyEvent* keyEvent = <span class="built_in">static_cast</span>&lt;QKeyEvent *&gt;(event);</span><br><span class="line">        <span class="keyword">if</span> (keyEvent-&gt;<span class="built_in">key</span>() == Qt::Key_Return) &#123;</span><br><span class="line">            <span class="built_in">on_searchLabel_clicked</span>();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (event-&gt;<span class="built_in">type</span>() == QEvent::Enter &amp;&amp; obj-&gt;<span class="built_in">objectName</span>() == <span class="string">&quot;searchLineEdit&quot;</span>) &#123;</span><br><span class="line">        QEnterEvent* focusEvent = <span class="built_in">static_cast</span>&lt;QEnterEvent *&gt;(event);</span><br><span class="line">        QPointF pos = focusEvent-&gt;<span class="built_in">pos</span>();</span><br><span class="line">        QRect lineEditRect = ui-&gt;searchLineEdit-&gt;<span class="built_in">frameGeometry</span>();</span><br><span class="line">        <span class="keyword">if</span> (pos.<span class="built_in">x</span>() &gt; lineEditRect.<span class="built_in">x</span>() &amp;&amp; pos.<span class="built_in">y</span>() &gt; lineEditRect.<span class="built_in">y</span>() &amp;&amp; pos.<span class="built_in">x</span>() &lt; lineEditRect.<span class="built_in">x</span>()+lineEditRect.<span class="built_in">width</span>() &amp;&amp; pos.<span class="built_in">y</span>() &lt; lineEditRect.<span class="built_in">y</span>()+lineEditRect.<span class="built_in">height</span>()) &#123;</span><br><span class="line">            firstFocus = <span class="literal">true</span>;</span><br><span class="line">        &#125;<span class="comment">/*else &#123;</span></span><br><span class="line"><span class="comment">            firstFocus = false;</span></span><br><span class="line"><span class="comment">        &#125;*/</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// return MainWindow::eventFilter(obj, event);</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::onHttpReply</span><span class="params">(QNetworkReply* reply)</span> </span>&#123;</span><br><span class="line">    QVariant status = reply-&gt;<span class="built_in">attribute</span>(QNetworkRequest::HttpStatusCodeAttribute);<span class="comment">//response-&gt;attribute(QNetworkRequest::HttpStatusCodeAttribute);</span></span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;http reply:&quot;</span> &lt;&lt; reply-&gt;<span class="built_in">error</span>() &lt;&lt; <span class="string">&quot;, status:&quot;</span> &lt;&lt; status.<span class="built_in">toInt</span>();</span><br><span class="line">    <span class="keyword">if</span> (reply-&gt;<span class="built_in">error</span>() == QNetworkReply::NoError &amp;&amp; status.<span class="built_in">toInt</span>() == <span class="number">200</span>) &#123;</span><br><span class="line">        QByteArray data = reply-&gt;<span class="built_in">readAll</span>();</span><br><span class="line">        <span class="comment">//转成字符串</span></span><br><span class="line">        <span class="comment">// qDebug() &lt;&lt; &quot;data:&quot; &lt;&lt; QString::fromUtf8(data);</span></span><br><span class="line">        <span class="comment">//解析json</span></span><br><span class="line">        <span class="built_in">parseWeatherJson</span>(data);</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        QMessageBox msg;</span><br><span class="line">        msg.<span class="built_in">setWindowTitle</span>(<span class="string">&quot;网络错误&quot;</span>);</span><br><span class="line">        msg.<span class="built_in">setText</span>(<span class="built_in">QString</span>(<span class="string">&quot;当前网络状态为：%1&quot;</span>).<span class="built_in">arg</span>(status.<span class="built_in">toInt</span>()));</span><br><span class="line">        msg.<span class="built_in">setIconPixmap</span>(<span class="built_in">QPixmap</span>(<span class="string">&quot;:weather/images/alert.png&quot;</span>).<span class="built_in">scaled</span>(<span class="number">20</span>,<span class="number">20</span>, Qt::KeepAspectRatio, Qt::SmoothTransformation));</span><br><span class="line">        msg.<span class="built_in">setStyleSheet</span>(<span class="string">&quot;QPushButton &#123;color:white; display:grid; justify-content: center; place-items: center;&#125;&quot;</span>);</span><br><span class="line">        msg.<span class="built_in">setStyleSheet</span>(<span class="string">&quot;QLabel &#123;color:black; alignment: center;&#125;&quot;</span>);</span><br><span class="line">        msg.<span class="built_in">exec</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//一般函数</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::parseWeatherJson</span><span class="params">(QByteArray data)</span> </span>&#123;</span><br><span class="line">    QJsonDocument jsonDoc = QJsonDocument::<span class="built_in">fromJson</span>(data);</span><br><span class="line">    <span class="keyword">if</span> (!jsonDoc.<span class="built_in">isNull</span>() &amp;&amp; jsonDoc.<span class="built_in">isObject</span>()) &#123;</span><br><span class="line">        QJsonObject json = jsonDoc.<span class="built_in">object</span>();</span><br><span class="line">        <span class="comment">// qDebug() &lt;&lt; &quot;json格式：\n&quot;&lt;&lt;json;</span></span><br><span class="line">        <span class="keyword">if</span> (data.<span class="built_in">contains</span>(<span class="string">&quot;data&quot;</span>) &amp;&amp; json[<span class="string">&quot;data&quot;</span>].<span class="built_in">isArray</span>()) &#123;</span><br><span class="line">            QJsonArray dataArray = json[<span class="string">&quot;data&quot;</span>].<span class="built_in">toArray</span>();</span><br><span class="line">            QJsonObject element = dataArray[<span class="number">0</span>].<span class="built_in">toObject</span>();</span><br><span class="line">            <span class="comment">//解析日期</span></span><br><span class="line">            QString date = element[<span class="string">&quot;date&quot;</span>].<span class="built_in">toString</span>();</span><br><span class="line">            ui-&gt;dateLabel-&gt;<span class="built_in">setText</span>(date);</span><br><span class="line">            QString week = element[<span class="string">&quot;week&quot;</span>].<span class="built_in">toString</span>();</span><br><span class="line">            ui-&gt;weekLabel-&gt;<span class="built_in">setText</span>(week);</span><br><span class="line">            <span class="comment">//解析城市名称</span></span><br><span class="line">            QString city = element[<span class="string">&quot;city&quot;</span>].<span class="built_in">toString</span>();</span><br><span class="line">            ui-&gt;cityLabel-&gt;<span class="built_in">setText</span>(city);</span><br><span class="line">            <span class="comment">//解析温度</span></span><br><span class="line">            QString temp = element[<span class="string">&quot;tem&quot;</span>].<span class="built_in">toString</span>();</span><br><span class="line">            ui-&gt;degreeLabel-&gt;<span class="built_in">setText</span>(temp);</span><br><span class="line">            QString tempMax = element[<span class="string">&quot;tem1&quot;</span>].<span class="built_in">toString</span>();</span><br><span class="line">            QString tempMin = element[<span class="string">&quot;tem2&quot;</span>].<span class="built_in">toString</span>();</span><br><span class="line">            ui-&gt;weatherdegreeLabel-&gt;<span class="built_in">setText</span>(tempMin+<span class="string">&quot;~&quot;</span>+tempMax+<span class="string">&quot;°C&quot;</span>);</span><br><span class="line">            <span class="comment">//天气类型</span></span><br><span class="line">           QString weatherType = element[<span class="string">&quot;wea&quot;</span>].<span class="built_in">toString</span>();</span><br><span class="line">            ui-&gt;weatherTextLabel-&gt;<span class="built_in">setText</span>(weatherType);</span><br><span class="line">            <span class="comment">//感冒指数</span></span><br><span class="line">            QString airTip = element[<span class="string">&quot;air_tips&quot;</span>].<span class="built_in">toString</span>();</span><br><span class="line">            ui-&gt;widet3Label-&gt;<span class="built_in">setText</span>(<span class="built_in">QString</span>(<span class="string">&quot;感冒指数：&quot;</span>)+airTip);</span><br><span class="line">            <span class="comment">//风向</span></span><br><span class="line">            QString windDir = element[<span class="string">&quot;win&quot;</span>].<span class="built_in">toArray</span>()[<span class="number">0</span>].<span class="built_in">toString</span>();</span><br><span class="line">            ui-&gt;windDirectLabel-&gt;<span class="built_in">setText</span>(windDir);</span><br><span class="line">            <span class="comment">//风力</span></span><br><span class="line">            QString windPower = element[<span class="string">&quot;win_speed&quot;</span>].<span class="built_in">toString</span>();</span><br><span class="line">            ui-&gt;windLevelLabel-&gt;<span class="built_in">setText</span>(windPower);</span><br><span class="line">            <span class="comment">//pm2.5</span></span><br><span class="line">            QString pm2_5 = json[<span class="string">&quot;aqi&quot;</span>].<span class="built_in">toObject</span>()[<span class="string">&quot;pm25&quot;</span>].<span class="built_in">toString</span>();</span><br><span class="line">            ui-&gt;pmLevelLabel-&gt;<span class="built_in">setText</span>(pm2_5);</span><br><span class="line">            <span class="comment">//humid</span></span><br><span class="line">            QString humidity =  element[<span class="string">&quot;humidity&quot;</span>].<span class="built_in">toString</span>();</span><br><span class="line">            ui-&gt;humidLevelLabel-&gt;<span class="built_in">setText</span>(humidity);</span><br><span class="line">            <span class="comment">//空气质量</span></span><br><span class="line">            QString airQuality = element[<span class="string">&quot;air_level&quot;</span>].<span class="built_in">toString</span>();</span><br><span class="line">            ui-&gt;airLevelLabel-&gt;<span class="built_in">setText</span>(airQuality);</span><br><span class="line">            <span class="comment">//一周6天的天气</span></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">QString <span class="title">getCityCodeFromJson</span><span class="params">(QString cityName)</span> </span>&#123;</span><br><span class="line">    <span class="function">QFile <span class="title">file</span><span class="params">(<span class="string">&quot;/Users/liuchuanxi/项目/QT/Qt-project/天气预报/weather/cityCode.json&quot;</span>)</span></span>;</span><br><span class="line">    <span class="type">bool</span> fileFlag = file.<span class="built_in">open</span>(QIODevice::ReadOnly|QIODevice::Text);</span><br><span class="line">    <span class="keyword">if</span> (!fileFlag) &#123;</span><br><span class="line">        QMessageBox msg;</span><br><span class="line">        msg.<span class="built_in">setWindowTitle</span>(<span class="string">&quot;城市数据文件错误&quot;</span>);</span><br><span class="line">        msg.<span class="built_in">setText</span>(<span class="string">&quot;打开文件失败&quot;</span>);</span><br><span class="line">        msg.<span class="built_in">setIconPixmap</span>(<span class="built_in">QPixmap</span>(<span class="string">&quot;:weather/images/alert.png&quot;</span>).<span class="built_in">scaled</span>(<span class="number">20</span>,<span class="number">20</span>, Qt::KeepAspectRatio, Qt::SmoothTransformation));</span><br><span class="line">        msg.<span class="built_in">setStyleSheet</span>(<span class="string">&quot;QPushButton &#123;color:white; display:grid; justify-content: center; place-items: center;&#125;&quot;</span>);</span><br><span class="line">        msg.<span class="built_in">setStyleSheet</span>(<span class="string">&quot;QLabel &#123;color:black; alignment: center;&#125;&quot;</span>);</span><br><span class="line">        msg.<span class="built_in">exec</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">QString</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    QJsonDocument jsonDoc = QJsonDocument::<span class="built_in">fromJson</span>(file.<span class="built_in">readAll</span>());</span><br><span class="line">    file.<span class="built_in">close</span>();</span><br><span class="line">    <span class="keyword">if</span> (!jsonDoc.<span class="built_in">isNull</span>() &amp;&amp; jsonDoc.<span class="built_in">isArray</span>()) &#123;</span><br><span class="line">        QJsonArray provinces = jsonDoc.<span class="built_in">array</span>();</span><br><span class="line">        <span class="keyword">for</span> (QJsonValue province: provinces) &#123;</span><br><span class="line">            <span class="keyword">if</span> (province.<span class="built_in">isObject</span>()) &#123;</span><br><span class="line">                QString provinceNameLocal = province[<span class="string">&quot;name&quot;</span>].<span class="built_in">toString</span>();</span><br><span class="line">                <span class="keyword">if</span> (provinceNameLocal == cityName) &#123;</span><br><span class="line">                    <span class="keyword">return</span> province[<span class="string">&quot;code&quot;</span>].<span class="built_in">toString</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            QJsonArray cities = province[<span class="string">&quot;city&quot;</span>].<span class="built_in">toArray</span>();</span><br><span class="line">            <span class="keyword">for</span> (QJsonValue city: cities) &#123;</span><br><span class="line">                <span class="keyword">if</span> (city.<span class="built_in">isObject</span>()) &#123;</span><br><span class="line">                    QString cityNameLocal = city[<span class="string">&quot;name&quot;</span>].<span class="built_in">toString</span>();</span><br><span class="line">                    <span class="keyword">if</span> (cityNameLocal == cityName) &#123;</span><br><span class="line">                        <span class="keyword">return</span> city[<span class="string">&quot;code&quot;</span>].<span class="built_in">toString</span>();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">QString</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_searchLabel_clicked</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    QString cityNameFromUser = ui-&gt;searchLineEdit-&gt;<span class="built_in">text</span>();</span><br><span class="line">    QString cityCode;</span><br><span class="line">    QString enterShortcut = <span class="built_in">QString</span>();</span><br><span class="line">    <span class="keyword">if</span> (cityNameFromUser.<span class="built_in">contains</span>(<span class="string">&quot;市&quot;</span>)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (cityNameFromUser.<span class="built_in">contains</span>(<span class="string">&quot;\n&quot;</span>)) &#123;</span><br><span class="line">            enterShortcut = <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">            cityNameFromUser.<span class="built_in">chop</span>(<span class="number">1</span>);</span><br><span class="line">            cityCode = <span class="built_in">getCityCodeFromJson</span>(cityNameFromUser);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            cityCode = <span class="built_in">getCityCodeFromJson</span>(cityNameFromUser);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (cityNameFromUser.<span class="built_in">contains</span>(<span class="string">&quot;\n&quot;</span>)) &#123;</span><br><span class="line">            enterShortcut = <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">            cityNameFromUser.<span class="built_in">chop</span>(<span class="number">1</span>);</span><br><span class="line">            cityCode = <span class="built_in">getCityCodeFromJson</span>(cityNameFromUser+<span class="string">&quot;市&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            cityCode = <span class="built_in">getCityCodeFromJson</span>(cityNameFromUser+<span class="string">&quot;市&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (cityCode != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        urlStr = urlStr + <span class="string">&quot;&amp;cityid=&quot;</span> + cityCode;</span><br><span class="line">        <span class="function">QUrl <span class="title">urlUrl</span><span class="params">(urlStr)</span></span>;</span><br><span class="line">        <span class="function">QNetworkRequest <span class="title">request</span><span class="params">(urlUrl)</span></span>;</span><br><span class="line">        <span class="comment">// QNetworkReply* reply = manager-&gt;get(request);</span></span><br><span class="line">        manager-&gt;<span class="built_in">get</span>(request);</span><br><span class="line">        ui-&gt;cityLabel-&gt;<span class="built_in">setText</span>(cityNameFromUser);</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        QMessageBox msg;</span><br><span class="line">        msg.<span class="built_in">setWindowTitle</span>(<span class="string">&quot;城市搜索&quot;</span>);</span><br><span class="line">        msg.<span class="built_in">setText</span>(<span class="built_in">QString</span>(<span class="string">&quot;%1不在搜索列表中&quot;</span>).<span class="built_in">arg</span>(cityNameFromUser));</span><br><span class="line">        msg.<span class="built_in">setIconPixmap</span>(<span class="built_in">QPixmap</span>(<span class="string">&quot;:weather/images/alert.png&quot;</span>).<span class="built_in">scaled</span>(<span class="number">20</span>,<span class="number">20</span>, Qt::KeepAspectRatio, Qt::SmoothTransformation));</span><br><span class="line">        msg.<span class="built_in">setStyleSheet</span>(<span class="string">&quot;QPushButton &#123;color:white; display:grid; justify-content: center; place-items: center;&#125;&quot;</span>);</span><br><span class="line">        msg.<span class="built_in">setStyleSheet</span>(<span class="string">&quot;QLabel &#123;color:black; alignment: center;&#125;&quot;</span>);</span><br><span class="line">        msg.<span class="built_in">exec</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="天气图缩放匹配窗口">天气图缩放匹配窗口</h4>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::parseWeatherJson</span><span class="params">(QByteArray data)</span> </span>&#123;</span><br><span class="line"><span class="comment">// void MainWindow::parseWeatherJson(QString dataStr) &#123;</span></span><br><span class="line">    <span class="comment">// QByteArray data = dataStr.toUtf8();</span></span><br><span class="line">    QJsonDocument jsonDoc = QJsonDocument::<span class="built_in">fromJson</span>(data);</span><br><span class="line">    <span class="keyword">if</span> (!jsonDoc.<span class="built_in">isNull</span>() &amp;&amp; jsonDoc.<span class="built_in">isObject</span>()) &#123;</span><br><span class="line">        QJsonObject json = jsonDoc.<span class="built_in">object</span>();</span><br><span class="line">        <span class="comment">// qDebug() &lt;&lt; &quot;json格式：\n&quot;&lt;&lt;json;</span></span><br><span class="line">        <span class="keyword">if</span> (data.<span class="built_in">contains</span>(<span class="string">&quot;data&quot;</span>) &amp;&amp; json[<span class="string">&quot;data&quot;</span>].<span class="built_in">isArray</span>()) &#123;</span><br><span class="line">            QJsonArray dataArray = json[<span class="string">&quot;data&quot;</span>].<span class="built_in">toArray</span>();</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; dataArray.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">                QJsonObject element = dataArray[i].<span class="built_in">toObject</span>();</span><br><span class="line">                QString date = element[<span class="string">&quot;date&quot;</span>].<span class="built_in">toString</span>();</span><br><span class="line">                QString week = element[<span class="string">&quot;week&quot;</span>].<span class="built_in">toString</span>();</span><br><span class="line">                QString city = json[<span class="string">&quot;city&quot;</span>].<span class="built_in">toString</span>();</span><br><span class="line">                QString temp = element[<span class="string">&quot;tem&quot;</span>].<span class="built_in">toString</span>();</span><br><span class="line">                QString tempMax = element[<span class="string">&quot;tem1&quot;</span>].<span class="built_in">toString</span>();</span><br><span class="line">                QString tempMin = element[<span class="string">&quot;tem2&quot;</span>].<span class="built_in">toString</span>();</span><br><span class="line">                QString weatherType = element[<span class="string">&quot;wea&quot;</span>].<span class="built_in">toString</span>();</span><br><span class="line">                QString airTip = element[<span class="string">&quot;air_tips&quot;</span>].<span class="built_in">toString</span>();</span><br><span class="line">                QString windDir = element[<span class="string">&quot;win&quot;</span>].<span class="built_in">toArray</span>()[<span class="number">0</span>].<span class="built_in">toString</span>();</span><br><span class="line">                QString windPower = element[<span class="string">&quot;win_speed&quot;</span>].<span class="built_in">toString</span>();</span><br><span class="line">                QString pm2_5 = json[<span class="string">&quot;aqi&quot;</span>].<span class="built_in">toObject</span>()[<span class="string">&quot;pm25&quot;</span>].<span class="built_in">toString</span>();</span><br><span class="line">                QString humidity =  element[<span class="string">&quot;humidity&quot;</span>].<span class="built_in">toString</span>();</span><br><span class="line">                QString airQuality = element[<span class="string">&quot;air_level&quot;</span>].<span class="built_in">toString</span>();</span><br><span class="line">                <span class="keyword">if</span> (i==<span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="comment">//解析日期</span></span><br><span class="line">                    ui-&gt;dateLabel-&gt;<span class="built_in">setText</span>(date);</span><br><span class="line">                    ui-&gt;weekLabel-&gt;<span class="built_in">setText</span>(week);</span><br><span class="line">                    <span class="comment">//解析城市名称</span></span><br><span class="line">                    ui-&gt;cityLabel-&gt;<span class="built_in">setText</span>(city);</span><br><span class="line">                    <span class="comment">//解析温度</span></span><br><span class="line">                    ui-&gt;degreeLabel-&gt;<span class="built_in">setText</span>(temp+<span class="string">&quot;°C&quot;</span>);</span><br><span class="line">                    ui-&gt;weatherdegreeLabel-&gt;<span class="built_in">setText</span>(tempMin+<span class="string">&quot;~&quot;</span>+tempMax+<span class="string">&quot;°C&quot;</span>);</span><br><span class="line">                    <span class="comment">//天气类型</span></span><br><span class="line">                    ui-&gt;weatherTextLabel-&gt;<span class="built_in">setText</span>(weatherType);</span><br><span class="line">                    <span class="built_in">qDebug</span>() &lt;&lt; city &lt;&lt; <span class="string">&quot;:&quot;</span> &lt;&lt; weatherType;</span><br><span class="line">                    <span class="comment">// if (weatherIconMap.find(weatherType) == weatherIconMap.end()) &#123;</span></span><br><span class="line">                    <span class="comment">//     ui-&gt;weatherLabel-&gt;setPixmap(QPixmap(&quot;:weather/images/cloud1.png&quot;));</span></span><br><span class="line">                    <span class="comment">// &#125; else &#123;</span></span><br><span class="line">                    <span class="comment">//     ui-&gt;weatherLabel-&gt;setPixmap(QPixmap(weatherIconMap[weatherType]).scaled(ui-&gt;weatherLabel-&gt;size(), Qt::KeepAspectRatio, Qt::SmoothTransformation));</span></span><br><span class="line">                    <span class="comment">// &#125;</span></span><br><span class="line">                    <span class="keyword">if</span> (weatherIconMap.<span class="built_in">find</span>(weatherType) == weatherIconMap.<span class="built_in">end</span>()) &#123;</span><br><span class="line">                        <span class="comment">// ui-&gt;weatherLabel-&gt;setPixmap(QPixmap(&quot;:weather/images/cloud1.png&quot;));</span></span><br><span class="line">                        <span class="keyword">if</span> (weatherType.<span class="built_in">contains</span>(<span class="string">&quot;转&quot;</span>)) &#123;</span><br><span class="line">                            <span class="type">int</span> index = weatherType.<span class="built_in">indexOf</span>(<span class="string">&quot;转&quot;</span>);</span><br><span class="line">                            <span class="keyword">if</span> (weatherIconMap.<span class="built_in">find</span>(weatherType.<span class="built_in">left</span>(index)) == weatherIconMap.<span class="built_in">end</span>()) &#123;</span><br><span class="line">                                ui-&gt;weatherLabel-&gt;<span class="built_in">setPixmap</span>(<span class="built_in">QPixmap</span>(<span class="string">&quot;:weather/images/cloud1.png&quot;</span>).<span class="built_in">scaled</span>(ui-&gt;weatherLabel-&gt;<span class="built_in">size</span>()*<span class="number">0.5</span>, Qt::KeepAspectRatio, Qt::SmoothTransformation));</span><br><span class="line">                            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                                ui-&gt;weatherLabel-&gt;<span class="built_in">setPixmap</span>(<span class="built_in">QPixmap</span>(weatherIconMap[weatherType.<span class="built_in">left</span>(index)]).<span class="built_in">scaled</span>(ui-&gt;weatherLabel-&gt;<span class="built_in">size</span>()*<span class="number">0.5</span>, Qt::KeepAspectRatio, Qt::SmoothTransformation));</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                            ui-&gt;weatherLabel-&gt;<span class="built_in">setPixmap</span>(<span class="built_in">QPixmap</span>(<span class="string">&quot;:weather/images/cloud1.png&quot;</span>).<span class="built_in">scaled</span>(ui-&gt;weatherLabel-&gt;<span class="built_in">size</span>()*<span class="number">0.5</span>, Qt::KeepAspectRatio, Qt::SmoothTransformation));</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="comment">// ui-&gt;weatherLabel-&gt;setPixmap(QPixmap(weatherIconMap[weatherType]));</span></span><br><span class="line">                        ui-&gt;weatherLabel-&gt;<span class="built_in">setPixmap</span>(<span class="built_in">QPixmap</span>(weatherIconMap[weatherType]).<span class="built_in">scaled</span>(ui-&gt;weatherLabel-&gt;<span class="built_in">size</span>()*<span class="number">0.5</span>, Qt::KeepAspectRatio, Qt::SmoothTransformation));</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">//感冒指数</span></span><br><span class="line">                    ui-&gt;widet3Label-&gt;<span class="built_in">setText</span>(<span class="built_in">QString</span>(<span class="string">&quot;感冒指数：&quot;</span>)+airTip);</span><br><span class="line">                    <span class="comment">//风向</span></span><br><span class="line">                    ui-&gt;windDirectLabel-&gt;<span class="built_in">setText</span>(windDir);</span><br><span class="line">                    <span class="comment">//风力</span></span><br><span class="line">                    ui-&gt;windLevelLabel-&gt;<span class="built_in">setText</span>(windPower);</span><br><span class="line">                    <span class="comment">//pm2.5</span></span><br><span class="line">                    ui-&gt;pmLevelLabel-&gt;<span class="built_in">setText</span>(pm2_5);</span><br><span class="line">                    <span class="comment">//humid</span></span><br><span class="line">                    ui-&gt;humidLevelLabel-&gt;<span class="built_in">setText</span>(humidity);</span><br><span class="line">                    <span class="comment">//空气质量</span></span><br><span class="line">                    ui-&gt;airLevelLabel-&gt;<span class="built_in">setText</span>(airQuality);</span><br><span class="line">                &#125;</span><br><span class="line">                days[i].mAirq = airQuality;</span><br><span class="line">                days[i].mCity = city;</span><br><span class="line">                days[i].mDate = date;</span><br><span class="line">                days[i].mWeek = week;</span><br><span class="line">                days[i].mFl = windPower;</span><br><span class="line">                days[i].mFx = windDir;</span><br><span class="line">                days[i].mHumidity = humidity;</span><br><span class="line">                days[i].mPm2_5 = pm2_5;</span><br><span class="line">                days[i].mTemp = temp;</span><br><span class="line">                days[i].mTempHigh = tempMax;</span><br><span class="line">                days[i].mTempLow = tempMin;</span><br><span class="line">                days[i].mTips = airTip;</span><br><span class="line">                days[i].mWeatherType = weatherType;</span><br><span class="line">                <span class="keyword">if</span> (weatherIconMap.<span class="built_in">find</span>(weatherType) == weatherIconMap.<span class="built_in">end</span>()) &#123;</span><br><span class="line">                    <span class="comment">// ui-&gt;weatherLabel-&gt;setPixmap(QPixmap(&quot;:weather/images/cloud1.png&quot;));</span></span><br><span class="line">                    <span class="keyword">if</span> (weatherType.<span class="built_in">contains</span>(<span class="string">&quot;转&quot;</span>)) &#123;</span><br><span class="line">                        <span class="type">int</span> index = weatherType.<span class="built_in">indexOf</span>(<span class="string">&quot;转&quot;</span>);</span><br><span class="line">                        <span class="keyword">if</span> (weatherIconMap.<span class="built_in">find</span>(weatherType.<span class="built_in">left</span>(index)) == weatherIconMap.<span class="built_in">end</span>()) &#123;</span><br><span class="line">                            days[i].mFileName = <span class="built_in">QString</span>(<span class="string">&quot;:weather/images/cloud1.png&quot;</span>);</span><br><span class="line">                        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                            days[i].mFileName = weatherIconMap[weatherType.<span class="built_in">left</span>(index)];</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                        days[i].mFileName = <span class="built_in">QString</span>(<span class="string">&quot;:weather/images/cloud1.png&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// ui-&gt;weatherLabel-&gt;setPixmap(QPixmap(weatherIconMap[weatherType]));</span></span><br><span class="line">                    days[i].mFileName = weatherIconMap[weatherType];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="作图被布局遮挡">作图被布局遮挡</h4>
<p>如果用整个窗体控件的事件重载方式作图，作得图会被其他控件遮盖掉，需要专门在某个字控件上作图可以为它安装事件过滤器。</p>
<h1>Graphics View架构</h1>
<ul>
<li>
<p>QPainter不能实现图件的选择、编辑、拖放、修改功能。</p>
</li>
<li>
<p>QGraphicsView 视图（管理）： 关联场景可以让场景中的所有图形项可视化，view坐标左上点 （0，0）。</p>
</li>
<li>
<p>QGraphicsScene 场景（容器）：可以管理多个图形项,  scene坐标中心点 (0,0)， 创建scene时放置位置的坐标是在scene坐标系中的坐标。</p>
</li>
<li>
<p>QGraphicsItem 图形项（图元）：称为图元，支持鼠标事件响应等, 创建item时放置位置的坐标是在scene坐标系中的坐标。item坐标系原点是以创建item时原点坐在位置确定的（即item坐标原点在item中的相对位置关系在item创建时就固定了），之后设置item-&gt;setPos的位置时都是移动item坐标原点在scene中的位置。</p>
</li>
<li>
<p>QGraphicsView 和QGraphicsScene的坐标相互转化，view-&gt;mapToScene(viewPos), view-&gt;mapFromScene(scenePos)。</p>
</li>
<li>
<p>QGraphicsScene和QGraphicsItem的坐标相互转化， item-&gt;mapFromScene(scenePos), item-&gt;mapToScene(itemPos)</p>
</li>
</ul>
<p><img src="/2025/02/24/QT-C/QT-C/QGraphicsView.png" alt="QGraphicsView"></p>
<p>要想实现<code>mouseMoveEvent</code>，则需要在构造函数中添加setMouseTrack(true)，直接得到监听事件。若是setMouseTrack(false),只有鼠标按下才会有mouseMove监听事件响应。</p>
<p>在Qt图形视图框架中，有三个主要的坐标系系统。我来详细解释它们的转换关系和获取点击位置坐标的方法。</p>
<h2 id="三个坐标系的关系">三个坐标系的关系</h2>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">图元坐标 (Item Coordinates) ←→ 场景坐标 (Scene Coordinates) ←→ 视图坐标 (View Coordinates)</span><br></pre></td></tr></table></figure>
<h2 id="1-坐标系定义">1. 坐标系定义</h2>
<h3 id="图元坐标系-Item-Coordinates">图元坐标系 (Item Coordinates)</h3>
<ul>
<li>以图元自身的左上角为原点(0,0)</li>
<li>相对于图元自身的坐标系</li>
<li>不受图元位置、旋转、缩放影响</li>
</ul>
<h3 id="场景坐标系-Scene-Coordinates">场景坐标系 (Scene Coordinates)</h3>
<ul>
<li>以场景的左上角为原点(0,0)</li>
<li>所有图元的共同参考系</li>
<li>图元的位置(<code>pos()</code>)是相对于场景坐标系的</li>
</ul>
<h3 id="视图坐标系-View-Coordinates">视图坐标系 (View Coordinates)</h3>
<ul>
<li>以视图窗口的左上角为原点(0,0)</li>
<li>像素单位，与显示设备相关</li>
</ul>
<h2 id="2-转换方法">2. 转换方法</h2>
<h3 id="图元-↔-场景">图元 ↔ 场景</h3>
<p>cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 图元坐标 → 场景坐标</span></span><br><span class="line">QPointF scenePos = item-&gt;<span class="built_in">mapToScene</span>(itemLocalPos);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 场景坐标 → 图元坐标  </span></span><br><span class="line">QPointF itemPos = item-&gt;<span class="built_in">mapFromScene</span>(scenePos);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 图元的位置（在场景坐标系中）</span></span><br><span class="line">QPointF itemScenePos = item-&gt;<span class="built_in">scenePos</span>();</span><br></pre></td></tr></table></figure>
<h3 id="场景-↔-视图">场景 ↔ 视图</h3>
<p>cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 场景坐标 → 视图坐标</span></span><br><span class="line">QPoint viewPos = view-&gt;<span class="built_in">mapFromScene</span>(scenePos);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 视图坐标 → 场景坐标</span></span><br><span class="line">QPointF scenePos = view-&gt;<span class="built_in">mapToScene</span>(viewPos);</span><br></pre></td></tr></table></figure>
<h3 id="图元-↔-视图">图元 ↔ 视图</h3>
<p>cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 图元坐标 → 视图坐标（需要先转到场景坐标）</span></span><br><span class="line">QPoint viewPos = view-&gt;<span class="built_in">mapFromScene</span>(item-&gt;<span class="built_in">mapToScene</span>(itemLocalPos));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 视图坐标 → 图元坐标</span></span><br><span class="line">QPointF itemPos = item-&gt;<span class="built_in">mapFromScene</span>(view-&gt;<span class="built_in">mapToScene</span>(viewPos));</span><br></pre></td></tr></table></figure>
<h2 id="3-获取点击位置的三种坐标">3. 获取点击位置的三种坐标</h2>
<h3 id="方法1：在视图的事件处理中获取">方法1：在视图的事件处理中获取</h3>
<p>cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">MyView::mousePressEvent</span><span class="params">(QMouseEvent *event)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 1. 视图坐标（像素坐标）</span></span><br><span class="line">    QPoint viewPos = event-&gt;<span class="built_in">pos</span>();</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;视图坐标:&quot;</span> &lt;&lt; viewPos;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 场景坐标</span></span><br><span class="line">    QPointF scenePos = <span class="built_in">mapToScene</span>(viewPos);</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;场景坐标:&quot;</span> &lt;&lt; scenePos;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 获取点击的图元</span></span><br><span class="line">    QGraphicsItem* clickedItem = <span class="built_in">scene</span>()-&gt;<span class="built_in">itemAt</span>(scenePos, <span class="built_in">QTransform</span>());</span><br><span class="line">    <span class="keyword">if</span> (clickedItem) &#123;</span><br><span class="line">        <span class="comment">// 4. 图元局部坐标</span></span><br><span class="line">        QPointF itemPos = clickedItem-&gt;<span class="built_in">mapFromScene</span>(scenePos);</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;图元坐标:&quot;</span> &lt;&lt; itemPos;</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;图元场景位置:&quot;</span> &lt;&lt; clickedItem-&gt;<span class="built_in">scenePos</span>();</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;图元边界:&quot;</span> &lt;&lt; clickedItem-&gt;<span class="built_in">boundingRect</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="方法2：在图元的事件处理中获取">方法2：在图元的事件处理中获取</h3>
<p>cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">MyNode::mousePressEvent</span><span class="params">(QGraphicsSceneMouseEvent *event)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 1. 图元坐标（相对于图元自身）</span></span><br><span class="line">    QPointF itemPos = event-&gt;<span class="built_in">pos</span>();</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;图元坐标:&quot;</span> &lt;&lt; itemPos;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 场景坐标（相对于场景）</span></span><br><span class="line">    QPointF scenePos = event-&gt;<span class="built_in">scenePos</span>();</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;场景坐标:&quot;</span> &lt;&lt; scenePos;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 视图坐标（需要获取视图）</span></span><br><span class="line">    QGraphicsView* view = <span class="built_in">scene</span>()-&gt;<span class="built_in">views</span>().<span class="built_in">first</span>();</span><br><span class="line">    QPoint viewPos = view-&gt;<span class="built_in">mapFromScene</span>(scenePos);</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;视图坐标:&quot;</span> &lt;&lt; viewPos;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 4. 屏幕坐标</span></span><br><span class="line">    QPoint screenPos = event-&gt;<span class="built_in">screenPos</span>();</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;屏幕坐标:&quot;</span> &lt;&lt; screenPos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="方法3：在场景的事件处理中获取">方法3：在场景的事件处理中获取</h3>
<p>cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">MyScene::mousePressEvent</span><span class="params">(QGraphicsSceneMouseEvent *event)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 1. 场景坐标</span></span><br><span class="line">    QPointF scenePos = event-&gt;<span class="built_in">scenePos</span>();</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;场景坐标:&quot;</span> &lt;&lt; scenePos;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 获取点击的图元</span></span><br><span class="line">    QGraphicsItem* item = <span class="built_in">itemAt</span>(scenePos, <span class="built_in">QTransform</span>());</span><br><span class="line">    <span class="keyword">if</span> (item) &#123;</span><br><span class="line">        <span class="comment">// 3. 图元坐标</span></span><br><span class="line">        QPointF itemPos = item-&gt;<span class="built_in">mapFromScene</span>(scenePos);</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;图元坐标:&quot;</span> &lt;&lt; itemPos;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 4. 视图坐标（通过第一个视图）</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">views</span>().<span class="built_in">isEmpty</span>()) &#123;</span><br><span class="line">        QGraphicsView* view = <span class="built_in">views</span>().<span class="built_in">first</span>();</span><br><span class="line">        QPoint viewPos = view-&gt;<span class="built_in">mapFromScene</span>(scenePos);</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;视图坐标:&quot;</span> &lt;&lt; viewPos;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="图表">图表</h2>
<p>Qt图表使用<code>QtCharts</code>头文件， QtCharts基于QGraphicsView架构，核心组件是QChartView和QChart。</p>
<ul>
<li>
<p>QChartView是显示图标的视图，基类为QGraphicsView</p>
</li>
<li>
<p>QChart的基类是QGraphicsItem</p>
</li>
<li>
<p>Qt5:mainwindow.h头文件中添加命名空间<strong>using</strong> <strong>namespace</strong> QtCharts;//或者用宏 Qt_CHARTS_USE_NAMESPACE。Qt6</p>
  <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">QT_BEGIN_NAMESPACE</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">QChartView</span>;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">QChart</span>;</span><br><span class="line">QT_END_NAMESPACE</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>创建步骤</strong>：</p>
<ol>
<li>创建QChartView并添加到窗体中: QChartView是QChart视图组件类似于QGraphicsView</li>
<li>创建QChart: 一个图表包含：
<ol>
<li>数据序列</li>
<li>坐标轴</li>
<li>图例</li>
<li>图表标题</li>
</ol>
</li>
<li>设置图表QChart, 例如标题，添加数据序列对象，设置X、Y轴的标签，图例等。</li>
<li>将QChart添加到QChartView</li>
<li>给序列对象添加数值</li>
<li>创建坐标轴QValueAxis与设置坐标轴以及添加到QChart中</li>
</ol>
<p>图表添加序列<code>chart-&gt;addSeries</code>不能放在序列放在坐标轴的语句<code>series-&gt;attachAxis(axisX)</code>之后</p>
<p>在 Qt Charts 中，<code>QValueAxis</code>（数值坐标轴）和 <code>QChartView</code>（图表视图）的坐标系转换是数据可视化的关键操作。以下是它们之间的坐标转换方法及详细示例：</p>
<hr>
<h2 id="1-坐标系简介"><strong>1. 坐标系简介</strong></h2>
<table>
<thead>
<tr>
<th>坐标系</th>
<th>描述</th>
<th>示例值</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>数据值坐标系</strong> (<code>QValueAxis</code>)</td>
<td>逻辑数据值（如 <code>x=10.5</code>, <code>y=20.3</code>）</td>
<td><code>(0.5, 3.2)</code></td>
</tr>
<tr>
<td><strong>图表绘图区坐标系</strong> (<code>QChart::plotArea</code>)</td>
<td>相对于 <code>QChart</code> 的像素坐标（以绘图区左上角为原点）</td>
<td><code>(150.0, 200.0)</code></td>
</tr>
<tr>
<td><strong>视图坐标系</strong> (<code>QChartView</code>)</td>
<td>相对于 <code>QChartView</code> 窗口的像素坐标</td>
<td><code>(300.0, 400.0)</code></td>
</tr>
</tbody>
</table>
<hr>
<h2 id="2-核心转换方法"><strong>2. 核心转换方法</strong></h2>
<h3 id="1-数据值-→-图表像素坐标-QChart-mapToPosition"><strong>(1) 数据值 → 图表像素坐标 (<code>QChart::mapToPosition</code>)</strong></h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">QPointF pixelPos = <span class="built_in">chart</span>()-&gt;<span class="built_in">mapToPosition</span>(<span class="built_in">QPointF</span>(xValue, yValue), series);</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>用途</strong>：将数据点转换为图表绘图区内的像素坐标。</li>
<li><strong>参数</strong>：
<ul>
<li><code>QPointF(xValue, yValue)</code>：数据值。</li>
<li><code>series</code>：关联的数据系列（用于确定坐标轴）。</li>
</ul>
</li>
</ul>
<h3 id="2-图表像素坐标-→-数据值-QChart-mapToValue"><strong>(2) 图表像素坐标 → 数据值 (<code>QChart::mapToValue</code>)</strong></h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">QPointF dataValue = <span class="built_in">chart</span>()-&gt;<span class="built_in">mapToValue</span>(<span class="built_in">QPointF</span>(pixelX, pixelY), series);</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>用途</strong>：将像素坐标转换回数据值。</li>
<li><strong>参数</strong>：
<ul>
<li><code>QPointF(pixelX, pixelY)</code>：图表绘图区内的像素坐标。</li>
</ul>
</li>
</ul>
<h3 id="3-图表像素坐标-→-视图像素坐标-QChartView-mapFromScene"><strong>(3) 图表像素坐标 → 视图像素坐标 (<code>QChartView::mapFromScene</code>)</strong></h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">QPoint viewPos = chartView-&gt;<span class="built_in">mapFromScene</span>(pixelPos);</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>用途</strong>：将图表绘图区的坐标转换为 <code>QChartView</code> 窗口坐标。</li>
</ul>
<h3 id="4-视图像素坐标-→-图表像素坐标-QChartView-mapToScene"><strong>(4) 视图像素坐标 → 图表像素坐标 (<code>QChartView::mapToScene</code>)</strong></h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">QPointF pixelPos = chartView-&gt;<span class="built_in">mapToScene</span>(viewPos);</span><br></pre></td></tr></table></figure>
<h3 id="5-屏幕像素坐标"><strong>(5) 屏幕像素坐标</strong></h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">QPointF posScreen = event-&gt;<span class="built_in">globalPosition</span>();<span class="comment">//event-&gt;globalPosition()和QCursor::pos()坐标一样是屏幕坐标</span></span><br></pre></td></tr></table></figure>
<h3 id="6-应用程序窗口像素坐标"><strong>(6) 应用程序窗口像素坐标</strong></h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">QPointF posApp = event-&gt;<span class="built_in">scenePosition</span>();<span class="comment">//event-&gt;WindowPos();</span></span><br></pre></td></tr></table></figure>
<h3 id="7-视图像素坐标"><strong>(7) 视图像素坐标</strong></h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">QPointF posView = event-&gt;<span class="built_in">pos</span>();<span class="comment">//event-&gt;localPos(); event-&gt;position();</span></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="3-完整转换流程"><strong>3. 完整转换流程</strong></h2>
<h3 id="1-数据值-→-视图坐标"><strong>(1) 数据值 → 视图坐标</strong></h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 数据值 → 图表像素坐标</span></span><br><span class="line">QPointF pixelPos = <span class="built_in">chart</span>()-&gt;<span class="built_in">mapToPosition</span>(<span class="built_in">QPointF</span>(xValue, yValue), series);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 图表像素坐标 → 视图坐标</span></span><br><span class="line">QPoint viewPos = chartView-&gt;<span class="built_in">mapFromScene</span>(pixelPos);</span><br></pre></td></tr></table></figure>
<h3 id="2-视图坐标-→-数据值"><strong>(2) 视图坐标 → 数据值</strong></h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 视图坐标 → 图表像素坐标</span></span><br><span class="line">QPointF pixelPos = chartView-&gt;<span class="built_in">mapToScene</span>(mouseEvent-&gt;<span class="built_in">pos</span>());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 图表像素坐标 → 数据值</span></span><br><span class="line">QPointF dataValue = <span class="built_in">chart</span>()-&gt;<span class="built_in">mapToValue</span>(pixelPos, series);</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="4-实际应用示例"><strong>4. 实际应用示例</strong></h2>
<h3 id="场景：鼠标悬停显示数据点值"><strong>场景：鼠标悬停显示数据点值</strong></h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在 QChartView 子类中实现</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">CustomChartView::mouseMoveEvent</span><span class="params">(QMouseEvent* event)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 视图坐标 → 图表像素坐标</span></span><br><span class="line">    QPointF pixelPos = <span class="built_in">mapToScene</span>(event-&gt;<span class="built_in">pos</span>());</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 图表像素坐标 → 数据值</span></span><br><span class="line">    QPointF dataValue = <span class="built_in">chart</span>()-&gt;<span class="built_in">mapToValue</span>(pixelPos, m_series);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;Data value at cursor:&quot;</span> &lt;&lt; dataValue;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 数据值 → 图表像素坐标（验证）</span></span><br><span class="line">    QPointF verifyPos = <span class="built_in">chart</span>()-&gt;<span class="built_in">mapToPosition</span>(dataValue, m_series);</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;Back to pixel:&quot;</span> &lt;&lt; verifyPos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="场景：在指定数据点绘制标记"><strong>场景：在指定数据点绘制标记</strong></h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">CustomChartView::paintEvent</span><span class="params">(QPaintEvent* event)</span> </span>&#123;</span><br><span class="line">    QChartView::<span class="built_in">paintEvent</span>(event);</span><br><span class="line">    </span><br><span class="line">    <span class="function">QPainter <span class="title">painter</span><span class="params">(viewport())</span></span>;</span><br><span class="line">    painter.<span class="built_in">setRenderHint</span>(QPainter::Antialiasing);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 数据值 → 视图坐标</span></span><br><span class="line">    <span class="function">QPointF <span class="title">dataPoint</span><span class="params">(<span class="number">2.0</span>, <span class="number">4.0</span>)</span></span>;  <span class="comment">// 示例数据点</span></span><br><span class="line">    QPointF pixelPos = <span class="built_in">chart</span>()-&gt;<span class="built_in">mapToPosition</span>(dataPoint, m_series);</span><br><span class="line">    QPoint viewPos = <span class="built_in">mapFromScene</span>(pixelPos).<span class="built_in">toPoint</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 绘制红色圆圈标记</span></span><br><span class="line">    painter.<span class="built_in">setPen</span>(<span class="built_in">QPen</span>(Qt::red, <span class="number">2</span>));</span><br><span class="line">    painter.<span class="built_in">drawEllipse</span>(viewPos, <span class="number">10</span>, <span class="number">10</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="5-关键注意事项"><strong>5. 关键注意事项</strong></h2>
<ol>
<li>
<p><strong>坐标系原点差异</strong>：</p>
<ul>
<li><code>QChart::plotArea()</code> 的原点是绘图区的左上角。</li>
<li><code>QChartView</code> 的原点是整个窗口的左上角。</li>
</ul>
</li>
<li>
<p><strong>坐标轴关联</strong>：</p>
<ul>
<li>多系列图表需确保 <code>mapToPosition</code> 和 <code>mapToValue</code> 使用正确的 <code>QAbstractSeries*</code> 参数。</li>
</ul>
</li>
<li>
<p><strong>动态更新</strong>：</p>
<ul>
<li>缩放或平移图表后，需重新计算坐标：<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">connect</span>(<span class="built_in">chart</span>()-&gt;<span class="built_in">axes</span>(Qt::Horizontal).<span class="built_in">first</span>(), &amp;QValueAxis::rangeChanged, </span><br><span class="line">        <span class="keyword">this</span>, &amp;CustomChartView::updateCoordinates);</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li>
<p><strong>高DPI屏幕适配</strong>：</p>
<ul>
<li>启用高DPI缩放以避免坐标偏移：<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">QGuiApplication::<span class="built_in">setAttribute</span>(Qt::AA_EnableHighDpiScaling);</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<hr>
<h2 id="6-转换关系图"><strong>6. 转换关系图</strong></h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Data Values (QValueAxis)</span><br><span class="line">       ⇅ mapToValue / mapToPosition</span><br><span class="line">Chart Pixel Coordinates (QChart::plotArea)</span><br><span class="line">       ⇅ mapToScene / mapFromScene</span><br><span class="line">View Pixel Coordinates (QChartView)</span><br></pre></td></tr></table></figure>
<p>通过以上方法，可以精准实现 <code>QValueAxis</code> 和 <code>QChartView</code> 之间的坐标转换，满足交互式图表开发需求。</p>
<h3 id="一、模型-视图">一、模型-视图</h3>
<p>在 Qt 框架中，<strong>标准项模型（Standard Item Model）</strong> 是一种通用的数据模型，用于表示树形或列表结构的数据。它是 <code>QStandardItemModel</code> 类的实现，属于 Qt 的模型-视图架构的一部分。标准项模型提供了一种简单而灵活的方式来存储和操作数据，并与视图组件（如 <code>QTreeView</code>、<code>QListView</code> 或 <code>QTableView</code>）结合使用。</p>
<hr>
<h3 id="二、核心功能">二、核心功能</h3>
<ol>
<li><strong>模型-视图架构</strong> ：
<ul>
<li>Qt 的模型-视图架构将数据（模型）与用户界面（视图）分离。</li>
<li>模型负责管理数据，视图负责显示数据，两者通过信号槽机制进行交互。</li>
<li><code>QStandardItemModel</code> 是一个实现了 <code>QAbstractItemModel</code> 接口的具体模型类。</li>
</ul>
</li>
<li><strong>标准项模型的特点</strong> ：
<ul>
<li>它是一个通用的、可扩展的数据模型，支持树形结构和表格结构。</li>
<li>数据项由 <code>QStandardItem</code> 对象表示，每个项可以包含文本、图标、工具提示等信息。</li>
<li>支持动态添加、删除和修改数据项。</li>
</ul>
</li>
<li><strong>适用场景</strong> ：
<ul>
<li>需要快速构建简单的树形或表格视图。</li>
<li>数据量较小且不需要复杂的自定义逻辑。</li>
<li>适合原型开发或小型项目。</li>
</ul>
</li>
</ol>
<h3 id="柱状图">柱状图</h3>
<p>QBarSet 是 Qt 中的一个类，用于在柱状图中表示一组相关数据。它通常与 QBarSeries 一起使用，以便将不同的数据集分组显示。</p>
<p>QBarSeries 是 Qt 中的一个类，用于在图表中表示一系列的数据点，以柱状图的形式展示。它继承自 QAbstractSeries 类，提供了绘制柱状图所需的基本功能。</p>
<p><code>QBarCategoryAxis</code> 表示条形图横坐标，用于管理和显示条形图中的分类轴，其中每个条形图都属于特定的类别</p>
<h3 id="饼状图">饼状图</h3>
<h3 id="QPieSeries"><strong>QPieSeries</strong></h3>
<p>QPieSeries是一个用于创建和展示饼图的类。它提供了基本的饼图绘制功能，包括设置饼图的标签、数据和样式。用户可以通过实例化QPieSeries类并调用其方法来生成饼图。此外，QPieSeries还支持一些交互功能，如设置饼图的颜色、边框宽度等。</p>
<p>holeSize和pieSize范围0～1，否则显示不了饼状图。</p>
<h3 id="QPieSlice"><strong>QPieSlice</strong></h3>
<p>QPieSlice是QPieSeries类中的一个重要组成部分，它代表饼图中的一个扇形区域。每个QPieSlice都有一个标签（label）、值（value）以及可选的颜色（color）。QPieSeries通过将数据分成多个QPieSlice来构建饼图，每个QPieSlice的角度与其值成正比。用户可以通过修改QPieSlice的属性来定制饼图中各个扇形的外观。</p>
<h3 id="堆叠图">堆叠图</h3>
<p>QBarSet 是 Qt 中的一个类，用于在柱状图中表示一组相关数据。它通常与 QBarSeries 一起使用，以便将不同的数据集分组显示。</p>
<p>QStackedBarSeries 是 Qt 中的一个类，用于在图表中表示一系列的数据点，以柱状图的形式展示。它继承自 QAbstractSeries 类，提供了绘制柱状图所需的基本功能。</p>
<p><code>QBarCategoryAxis</code> 表示条形图横坐标，用于管理和显示条形图中的分类轴，其中每个条形图都属于特定的类别。</p>
<p><code>barSeries-&gt;setLabelsFormat(&quot;@value%&quot;)</code>无法实现控制小数位数，只能通过<code>setMath-&gt;append(QString::asprintf(&quot;%.1f&quot;, val).toDouble())</code>实现。</p>
<h3 id="百分比堆叠图">百分比堆叠图</h3>
<p>QPercentBarSeries中自带百分号无需setLabelsFormat(“@value%”)。</p>
<h2 id="三维视图模块">三维视图模块</h2>
<ul>
<li><strong>图表</strong></li>
</ul>
<p>Data Visualization的三维显示功能主要由三种三维图形来实现，分别是三维柱状图Q3DBars,三维空间散点Q3DScatter,三维曲面Q3DSurface.这三个类的父类都是QAbstract3DGraph,从QWindow继承而来。Q3DBars, Q3DScatter,Q3DSurface相当于Qt Charts中的QChart图表。</p>
<ul>
<li><strong>序列</strong></li>
</ul>
<p>QBar3DSeries, QScatter3DSeries, QSurface3DSeries</p>
<ul>
<li><strong>坐标轴</strong></li>
</ul>
<p>QCategory3DAxis, QValue3DAxis</p>
<ul>
<li><strong>数据代理Data Proxies</strong></li>
</ul>
<p>数据代理类就是序列与三维图像之间的翻译官，用于存储序列可调用的数据类。QBarDataProxy, QScatterDataProxy, QSurfaceDataProxy。数据代理下还有数据代理模型项（更细致的处理数据），QItemModelBarDataProxy，QItemModelScatterDataProxy, QHeightMapSurfaceDataProxy, QItemModelSurfaceDataProxy</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QtDataVisualization&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> QtDataVisualization</span><br><span class="line">Q3DBars* bar = <span class="keyword">new</span> Q3DBars;  </span><br><span class="line"><span class="comment">//在父窗口中创建视图容器</span></span><br><span class="line"><span class="keyword">this</span>-&gt;<span class="built_in">createWindowContainer</span>(bar);</span><br></pre></td></tr></table></figure>
<p><img src="/2025/02/24/QT-C/QT-C/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-07-18%20111856.png" alt="屏幕截图 2025-07-18 111856"></p>
<img src="/2025/02/24/QT-C/QT-C/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-07-21%20110648.png" alt="屏幕截图 2025-07-21 110648" style="zoom:75%;">
<p>需要使用QWidget::createWindowContainer()在代码中创建三维图表容器，没法在QDesigner中拖拉拽创建容器。</p>
<ul>
<li><strong>数据代理可处理的数据类型</strong></li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> QtDataVisualization &#123;</span><br><span class="line">  <span class="keyword">typedef</span> QVector&lt;QBarDataItem&gt; QBarDataRow;</span><br><span class="line">  <span class="keyword">typedef</span> QList&lt;QBarDataRow*&gt; QBarDataArray;</span><br><span class="line">  <span class="comment">//scatter没有行概念，按照自己的需求切序列为多干子序列，</span></span><br><span class="line">  <span class="keyword">typedef</span> QVector&lt;QScatterDataItem&gt; QScatterDataArray;</span><br><span class="line">  <span class="comment">//surface</span></span><br><span class="line">  <span class="keyword">typedef</span> QVector&lt;QSurfaceDataItem&gt; QSurfaceDataRow;</span><br><span class="line">  <span class="keyword">typedef</span> QList&lt;QSurfaceDataRow*&gt; QSurfaceDataArray;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2025/02/24/QT-C/QT-C/image-20250718154252770.png" alt="image-20250718154252770"></p>
<ul>
<li>
<p><strong>摄像机</strong>： Q3DCamera控制视角、俯仰、左右旋转、缩放等功能。</p>
  <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">barChart-&gt;<span class="built_in">scene</span>()-&gt;<span class="built_in">activeCamera</span>();</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="Qt-Data-Visualization概述">Qt Data Visualization概述</h4>
<p>Qt Data Visualization是<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=Qt%E6%A1%86%E6%9E%B6&amp;spm=1001.2101.3001.7020">Qt框架</a>中用于3D数据可视化的模块。它提供了一系列用于在3D空间中展示数据的类和组件。</p>
<h4 id="主要组件">主要组件</h4>
<h5 id="1-Q3DBars">1. Q3DBars</h5>
<p>用于创建3D柱状图的类。可以展示多个数据系列，支持自定义轴、主题和选择交互。</p>
<h5 id="2-Q3DScatter">2. Q3DScatter</h5>
<p>用于创建3D散点图的类。适合展示点云数据，支持点的大小和颜色自定义。</p>
<h5 id="3-Q3DSurface">3. Q3DSurface</h5>
<p>用于创建3D曲面图的类。适合展示连续变化的数据，支持高度图和颜色渐变。</p>
<h5 id="4-QAbstract3DGraph">4. QAbstract3DGraph</h5>
<p>所有3D图表的基础抽象类。提供通用的3D图表属性和功能。</p>
<h5 id="5-Q3DCamera">5. Q3DCamera</h5>
<p>控制3D场景中的相机视角。可以设置视角位置、目标点和旋转角度。</p>
<h5 id="6-Q3DTheme">6. Q3DTheme</h5>
<p>定义3D图表的外观主题。包括颜色、字体、背景等视觉元素。</p>
<h5 id="7-QValue3DAxis">7. QValue3DAxis</h5>
<p>表示3D图表中的数值轴。可以自定义范围、标签格式和刻度。</p>
<h5 id="8-QCategory3DAxis">8. QCategory3DAxis</h5>
<p>表示3D图表中的分类轴。用于显示非数值的类别标签。</p>
<h5 id="9-QScatter3DSeries">9. QScatter3DSeries</h5>
<p>表示3D散点图中的数据系列。包含数据项和样式属性。</p>
<h5 id="10-QBar3DSeries">10. QBar3DSeries</h5>
<p>表示3D柱状图中的数据系列。包含数据项和样式属性。</p>
<h5 id="11-QSurface3DSeries">11. QSurface3DSeries</h5>
<p>表示3D曲面图中的数据系列。包含数据项和样式属性。</p>
<h5 id="12-QCustom3DItem">12. QCustom3DItem</h5>
<p>允许在3D图表中添加自定义的3D对象。可以是简单的几何形状或复杂的3D模型。</p>
<h4 id="基本用法">基本用法</h4>
<ol>
<li>创建图表视图：</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Q3DBars *graph = <span class="keyword">new</span> <span class="built_in">Q3DBars</span>();</span><br><span class="line">QWidget *container = QWidget::<span class="built_in">createWindowContainer</span>(graph);</span><br><span class="line"></span><br><span class="line">AI生成项目cpp</span><br><span class="line">运行<span class="number">12</span></span><br></pre></td></tr></table></figure>
<ol>
<li>添加数据系列：</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">QBar3DSeries *series = <span class="keyword">new</span> <span class="built_in">QBar3DSeries</span>();</span><br><span class="line">graph-&gt;<span class="built_in">addSeries</span>(series);</span><br><span class="line"></span><br><span class="line">AI生成项目cpp</span><br><span class="line">运行<span class="number">12</span></span><br></pre></td></tr></table></figure>
<ol>
<li>设置轴：</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">QValue3DAxis *axisX = <span class="keyword">new</span> <span class="built_in">QValue3DAxis</span>();</span><br><span class="line">axisX-&gt;<span class="built_in">setTitle</span>(<span class="string">&quot;X Axis&quot;</span>);</span><br><span class="line">graph-&gt;<span class="built_in">setAxisX</span>(axisX);</span><br><span class="line"></span><br><span class="line">AI生成项目cpp</span><br><span class="line">运行<span class="number">123</span></span><br></pre></td></tr></table></figure>
<ol>
<li>填充数据：</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">QBarDataArray *dataArray = <span class="keyword">new</span> QBarDataArray;</span><br><span class="line">*dataArray &lt;&lt; <span class="keyword">new</span> QBarDataRow &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;;</span><br><span class="line">series-&gt;<span class="built_in">dataProxy</span>()-&gt;<span class="built_in">addRow</span>(dataArray);</span><br><span class="line"></span><br><span class="line">AI生成项目cpp</span><br><span class="line">运行<span class="number">123</span></span><br></pre></td></tr></table></figure>
<hr>
<h4 id="与其他模块的关系">与其他模块的关系</h4>
<p>Qt Data Visualization 模块与其他 Qt 模块有一定的依赖和协作关系，主要包括以下几个方面：</p>
<ol>
<li><strong>Qt Core</strong>
<ul>
<li>这是 Qt Data Visualization 的基础依赖模块，提供了核心的非 GUI 功能，如信号与槽机制、事件处理、字符串处理等。</li>
<li>所有 Qt Data Visualization 的类都依赖于 Qt Core 提供的功能。</li>
</ul>
</li>
<li><strong>Qt GUI</strong>
<ul>
<li>提供了基础的图形界面支持，包括窗口系统集成、OpenGL 上下文管理等。</li>
<li>Qt Data Visualization 的 3D 渲染依赖于 Qt GUI 模块提供的 OpenGL 功能。</li>
</ul>
</li>
<li><strong>Qt OpenGL</strong>
<ul>
<li>用于支持 3D 数据的渲染，Qt Data Visualization 通过 OpenGL 实现高效的数据可视化效果。</li>
<li>如果用户需要自定义渲染效果，可能需要直接使用 Qt OpenGL 模块。</li>
</ul>
</li>
<li><strong>Qt Widgets</strong>
<ul>
<li>如果需要在传统的 QWidget 应用程序中嵌入 3D 可视化组件（如 <code>Q3DScatter</code>、<code>Q3DSurface</code> 等），则需要依赖 Qt Widgets 模块。</li>
<li>例如，<code>Q3DScatterWidgetItem</code> 是一个可以嵌入到 <code>QGraphicsScene</code> 中的小部件。</li>
</ul>
</li>
<li><strong>Qt Quick</strong>
<ul>
<li>如果需要在 QML 中使用 Qt Data Visualization 的功能（如 <code>Scatter3D</code>、<code>Surface3D</code> 等 QML 类型），则需要依赖 Qt Quick 模块。</li>
<li>该模块提供了与 QML 集成的支持，使得在声明式 UI 中可以方便地使用 3D 数据可视化。</li>
</ul>
</li>
<li><strong>Qt Concurrent</strong>
<ul>
<li>虽然不是直接依赖，但在处理大量数据时，可能会使用 Qt Concurrent 模块进行并行计算，以提高数据处理的效率。</li>
</ul>
</li>
<li><strong>Qt Network</strong>
<ul>
<li>如果数据可视化需要从网络获取数据（如实时数据流），则可能需要使用 Qt Network 模块进行网络通信。</li>
</ul>
</li>
</ol>
<p>总结：<br>
Qt Data Visualization 主要依赖于 <strong>Qt Core</strong> 和 <strong>Qt GUI</strong>，并可选地结合 <strong>Qt Widgets</strong> 或 <strong>Qt Quick</strong> 来实现不同的 UI 集成方式。对于高级功能（如自定义渲染或并行计算），可能还需要其他模块的支持。</p>
<hr>
<h4 id="基本概念">基本概念</h4>
<h4 id="3D图形类型（Q3DBars、Q3DScatter、Q3DSurface）">3D图形类型（Q3DBars、Q3DScatter、Q3DSurface）</h4>
<h5 id="Q3DBars">Q3DBars</h5>
<ul>
<li>
<p><strong>用途</strong>：用于创建3D柱状图，适合展示分类数据的比较。</p>
</li>
<li>
<p>特点</p>
<p>：</p>
<ul>
<li>每个数据点用垂直的柱子表示</li>
<li>支持多系列数据显示</li>
<li>可以自定义柱子颜色、间距等属性</li>
</ul>
</li>
<li>
<p>典型应用场景</p>
<p>：</p>
<ul>
<li>销售数据对比</li>
<li>不同类别的数值比较</li>
<li>时间序列数据展示</li>
</ul>
</li>
</ul>
<h5 id="Q3DScatter">Q3DScatter</h5>
<ul>
<li>
<p><strong>用途</strong>：用于创建3D散点图，适合展示三维空间中的数据分布。</p>
</li>
<li>
<p>特点</p>
<p>：</p>
<ul>
<li>每个数据点用空间中的一个点表示</li>
<li>支持点的大小和颜色自定义</li>
<li>可以显示数据在三维空间中的聚类情况</li>
</ul>
</li>
<li>
<p>典型应用场景</p>
<p>：</p>
<ul>
<li>科学数据可视化</li>
<li>三维坐标数据展示</li>
<li>数据聚类分析</li>
</ul>
</li>
</ul>
<h5 id="Q3DSurface">Q3DSurface</h5>
<ul>
<li>
<p><strong>用途</strong>：用于创建3D曲面图，适合展示连续数据的表面变化。</p>
</li>
<li>
<p>特点</p>
<p>：</p>
<ul>
<li>用连续的曲面表示数据</li>
<li>支持高度图和颜色渐变</li>
<li>可以显示数据的峰值和谷值</li>
</ul>
</li>
<li>
<p>典型应用场景</p>
<p>：</p>
<ul>
<li>地形数据可视化</li>
<li>数学函数绘图</li>
<li>温度/压力等物理量分布</li>
</ul>
</li>
</ul>
<hr>
<h4 id="数据代理（Data-Proxy）">数据代理（Data Proxy）</h4>
<p>在 <strong>Qt Data Visualization</strong> 中，<strong>数据代理（Data Proxy）</strong> 是一个中间层，用于管理和转换原始数据，使其能够被可视化组件（如3D图表）正确渲染。它的主要作用是为数据提供一种抽象，允许在不直接修改原始数据的情况下，对数据进行过滤、排序或转换。</p>
<h5 id="核心功能">核心功能</h5>
<ol>
<li><strong>数据转换</strong>：将原始数据转换为适合可视化的格式（例如，将数值映射到3D坐标系中的点）。</li>
<li><strong>数据过滤</strong>：根据条件筛选数据，仅传递符合要求的数据到可视化组件。</li>
<li><strong>动态更新</strong>：当原始数据发生变化时，代理可以自动通知可视化组件更新。</li>
</ol>
<h5 id="常见用途">常见用途</h5>
<ul>
<li>在 <strong>3D散点图（Scatter3D）</strong> 或 <strong>3D柱状图（Bar3D）</strong> 中，代理可以将行/列数据转换为坐标点或柱子。</li>
<li>支持对大数据集进行动态加载或分页处理，提升性能。</li>
</ul>
<h5 id="示例代码片段">示例代码片段</h5>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 假设有一个自定义的数据代理类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CustomDataProxy</span> : <span class="keyword">public</span> QScatterDataProxy &#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">CustomDataProxy</span><span class="params">(QObject *parent = <span class="literal">nullptr</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">updateData</span><span class="params">(<span class="type">const</span> QList&lt;QVector3D&gt; &amp;newData)</span></span>; <span class="comment">// 自定义数据更新逻辑</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">AI生成项目cpp</span><br><span class="line">运行<span class="number">1234567</span></span><br></pre></td></tr></table></figure>
<h5 id="注意事项">注意事项</h5>
<ul>
<li>代理通常与 <strong>数据项（Data Item）</strong> 配合使用，例如 <code>QScatterDataItem</code> 或 <code>QBarDataItem</code>。</li>
<li>性能敏感场景中，需注意代理的数据处理效率，避免阻塞主线程。</li>
</ul>
<p>通过数据代理，开发者可以更灵活地控制数据流向和表现形式，而无需直接操作底层数据结构。</p>
<hr>
<h4 id="类与接口">类与接口</h4>
<h4 id="QAbstract3DGraph">QAbstract3DGraph</h4>
<p><code>QAbstract3DGraph</code>是Qt Data Visualization模块中的基类，用于表示3D图表的基本功能。它提供了3D图表共有的属性和方法，是其他具体图表类型（如<code>Q3DBars</code>、<code>Q3DScatter</code>和<code>Q3DSurface</code>）的父类。</p>
<h5 id="主要功能">主要功能</h5>
<ol>
<li><strong>场景管理</strong>：管理3D场景的渲染和显示。</li>
<li><strong>坐标轴</strong>：提供对X、Y、Z轴的控制，包括范围、标签和格式。</li>
<li><strong>渲染和性能</strong>：控制渲染质量、抗锯齿等性能相关设置。</li>
<li><strong>主题和样式</strong>：支持自定义图表的外观，如颜色、字体等。</li>
<li><strong>相机和视角</strong>：控制观察视角和相机位置。</li>
</ol>
<h5 id="常用属性">常用属性</h5>
<ul>
<li><code>activeTheme</code>：当前应用的图表主题。</li>
<li><code>shadowQuality</code>：阴影质量设置。</li>
<li><code>selectionMode</code>：图表中数据点的选择模式。</li>
<li><code>aspectRatio</code>：图表的宽高比。</li>
<li><code>horizontalAspectRatio</code>：水平方向的比例。</li>
</ul>
<h5 id="常用方法">常用方法</h5>
<ul>
<li><code>addCustomItem()</code>：向图表添加自定义项。</li>
<li><code>removeCustomItem()</code>：移除自定义项。</li>
<li><code>setOrthoProjection()</code>：设置是否使用正交投影。</li>
<li><code>setSelectionMode()</code>：设置选择模式（如无选择、单项选择等）。</li>
</ul>
<h5 id="信号">信号</h5>
<ul>
<li><code>activeInputHandlerChanged</code>：当活动的输入处理器改变时触发。</li>
<li><code>activeThemeChanged</code>：当主题改变时触发。</li>
<li><code>aspectRatioChanged</code>：当宽高比改变时触发。</li>
</ul>
<h5 id="注意事项-2">注意事项</h5>
<ul>
<li><code>QAbstract3DGraph</code>是抽象类，不能直接实例化。需要使用其子类（如<code>Q3DBars</code>）来创建具体的图表。</li>
<li>在使用前，确保正确初始化了Qt Data Visualization模块（如调用<code>QApplication::setAttribute(Qt::AA_EnableHighDpiScaling)</code>）。</li>
</ul>
<hr>
<h4 id="Q3DScene类">Q3DScene类</h4>
<p><code>Q3DScene</code>是Qt Data Visualization模块中的一个核心类，用于管理3D场景的属性和状态。它作为3D图表的容器，负责处理场景中的各种元素，如相机、灯光、视口等。</p>
<h5 id="主要功能-2">主要功能</h5>
<ol>
<li><strong>场景管理</strong>：维护3D场景的整体状态和属性。</li>
<li><strong>视口设置</strong>：控制场景的显示区域和大小。</li>
<li><strong>相机控制</strong>：管理观察场景的视角和投影方式。</li>
<li><strong>灯光配置</strong>：设置场景中的光源位置和属性。</li>
<li><strong>选择处理</strong>：管理场景中的对象选择行为。</li>
</ol>
<h5 id="常用属性-2">常用属性</h5>
<ul>
<li><code>activeCamera</code>：获取或设置当前活动的相机。</li>
<li><code>activeLight</code>：获取或设置当前活动的光源。</li>
<li><code>devicePixelRatio</code>：设备像素比例，用于高DPI显示。</li>
<li><code>selectionQueryPosition</code>：查询选择位置。</li>
<li><code>viewport</code>：场景的视口矩形。</li>
</ul>
<h5 id="常用方法-2">常用方法</h5>
<ul>
<li><code>setSelectionQueryPosition(const QPoint &amp;position)</code>：设置选择查询的位置。</li>
<li><code>invalidateSelection()</code>：使当前选择无效。</li>
<li><code>setSlicingActive(bool isSlicing)</code>：设置是否启用切片模式。</li>
</ul>
<h5 id="信号-2">信号</h5>
<ul>
<li><code>activeCameraChanged(Q3DCamera *camera)</code>：当活动相机改变时触发。</li>
<li><code>activeLightChanged(Q3DLight *light)</code>：当活动光源改变时触发。</li>
<li><code>devicePixelRatioChanged(float pixelRatio)</code>：当设备像素比例改变时触发。</li>
<li><code>selectionQueryPositionChanged(const QPoint &amp;position)</code>：当选择查询位置改变时触发。</li>
<li><code>viewportChanged(const QRect &amp;viewport)</code>：当视口改变时触发。</li>
</ul>
<h5 id="使用示例">使用示例</h5>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建3D场景</span></span><br><span class="line">Q3DScene *scene = <span class="keyword">new</span> <span class="built_in">Q3DScene</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置视口</span></span><br><span class="line">scene-&gt;<span class="built_in">setViewport</span>(<span class="built_in">QRect</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">800</span>, <span class="number">600</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取活动相机并设置其位置</span></span><br><span class="line">Q3DCamera *camera = scene-&gt;<span class="built_in">activeCamera</span>();</span><br><span class="line">camera-&gt;<span class="built_in">setCameraPosition</span>(<span class="built_in">QVector3D</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">500</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 连接信号</span></span><br><span class="line"><span class="built_in">connect</span>(scene, &amp;Q3DScene::viewportChanged, [](<span class="type">const</span> QRect &amp;viewport) &#123;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;Viewport changed to:&quot;</span> &lt;&lt; viewport;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">AI生成项目cpp</span><br><span class="line">运行</span><br><span class="line"><span class="number">1234567891011121314</span></span><br></pre></td></tr></table></figure>
<hr>
<h4 id="Q3DTheme类">Q3DTheme类</h4>
<p><code>Q3DTheme</code> 是 Qt Data Visualization 模块中的一个类，用于定义3D图表（如柱状图、散点图、曲面图等）的视觉样式。它允许你自定义图表的颜色、字体、背景等属性，以创建符合应用需求的统一外观。</p>
<h5 id="主要功能-3">主要功能</h5>
<ol>
<li><strong>颜色设置</strong>：控制图表中不同元素的颜色，如背景、网格线、标签、高亮等。</li>
<li><strong>字体设置</strong>：定义图表中文本的字体样式。</li>
<li><strong>光照效果</strong>：调整3D图表的光照参数，影响阴影和高光的表现。</li>
<li><strong>背景渐变</strong>：设置背景的渐变颜色，增强视觉效果。</li>
</ol>
<h5 id="常用属性-3">常用属性</h5>
<ul>
<li><code>ambientLightStrength</code>：环境光强度，影响整体亮度。</li>
<li><code>backgroundColor</code>：图表背景颜色。</li>
<li><code>baseColors</code>：图表中数据系列的基础颜色列表。</li>
<li><code>gridLineColor</code>：网格线颜色。</li>
<li><code>labelBackgroundColor</code>：标签背景颜色。</li>
<li><code>labelTextColor</code>：标签文本颜色。</li>
<li><code>lightStrength</code>：光源强度，影响阴影和高光。</li>
<li><code>multiHighlightColor</code>：多选高亮颜色。</li>
<li><code>singleHighlightColor</code>：单选高亮颜色。</li>
<li><code>windowColor</code>：窗口背景颜色。</li>
</ul>
<h5 id="示例代码">示例代码</h5>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建一个3D主题</span></span><br><span class="line">Q3DTheme *theme = <span class="keyword">new</span> <span class="built_in">Q3DTheme</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置主题属性</span></span><br><span class="line">theme-&gt;<span class="built_in">setAmbientLightStrength</span>(<span class="number">0.5f</span>);</span><br><span class="line">theme-&gt;<span class="built_in">setBackgroundColor</span>(Qt::white);</span><br><span class="line">theme-&gt;<span class="built_in">setGridLineColor</span>(Qt::gray);</span><br><span class="line">theme-&gt;<span class="built_in">setLabelTextColor</span>(Qt::black);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将主题应用到图表</span></span><br><span class="line">graph-&gt;<span class="built_in">setActiveTheme</span>(theme);</span><br><span class="line"></span><br><span class="line">AI生成项目cpp</span><br><span class="line">运行</span><br><span class="line"><span class="number">1234567891011</span></span><br></pre></td></tr></table></figure>
<h5 id="注意事项-3">注意事项</h5>
<ul>
<li><code>Q3DTheme</code> 通常与 <code>Q3DBars</code>、<code>Q3DScatter</code> 或 <code>Q3DSurface</code> 等图表类一起使用。</li>
<li>修改主题属性会立即反映在关联的图表上。</li>
<li>Qt 提供了一些内置主题（如 <code>Q3DTheme::ThemeQt</code>），可以直接使用。</li>
</ul>
<p>通过 <code>Q3DTheme</code>，你可以轻松实现图表样式的统一管理和自定义，提升用户体验。</p>
<hr>
<h4 id="数据处理">数据处理</h4>
<h4 id="数据的输入与输出">数据的输入与输出</h4>
<p>在Qt Data Visualization中，数据的输入与输出主要涉及如何将数据加载到可视化组件中以及如何从可视化组件中获取数据。</p>
<h5 id="数据输入">数据输入</h5>
<ul>
<li><strong>数据源</strong>：通常使用<code>Q3DScatter</code>、<code>Q3DBars</code>或<code>Q3DSurface</code>等类来创建可视化组件，并通过这些类的接口输入数据。</li>
<li><strong>数据格式</strong>：数据可以以数组、列表或自定义数据结构的形式提供。例如，使用<code>QScatter3DSeries</code>的<code>dataProxy()</code>方法设置数据代理，然后通过<code>addItem()</code>或<code>setArray()</code>方法添加数据点。</li>
<li><strong>动态更新</strong>：支持动态更新数据，可以通过<code>addItem()</code>或<code>removeItem()</code>等方法实时修改数据。</li>
</ul>
<h5 id="数据输出">数据输出</h5>
<ul>
<li><strong>数据获取</strong>：可以通过<code>dataProxy()</code>方法获取当前的数据代理，进而访问数据点。例如，使用<code>itemAt()</code>方法获取特定位置的数据点。</li>
<li><strong>导出功能</strong>：支持将可视化结果导出为图像（如PNG或JPEG），使用<code>grabFramebuffer()</code>方法捕获当前视图。</li>
<li><strong>日志与调试</strong>：可以通过Qt的日志系统输出数据状态，便于调试。</li>
</ul>
<h5 id="注意事项-4">注意事项</h5>
<ul>
<li>数据输入时需要确保数据格式与可视化组件的要求匹配，否则可能导致渲染错误。</li>
<li>动态更新数据时，频繁操作可能影响性能，建议批量更新。</li>
</ul>
<hr>
<h4 id="数据的更新与动态显示">数据的更新与动态显示</h4>
<p>在Qt Data Visualization中，数据的更新与动态显示是指如何在运行时修改数据并实时更新可视化图表。这通常用于需要动态展示变化数据的场景，如实时监控或数据流可视化。</p>
<h5 id="关键概念">关键概念</h5>
<ol>
<li><strong>数据序列（Data Series）</strong>：
<ul>
<li>数据序列是存储数据点的容器，例如<code>QScatter3DSeries</code>、<code>QBar3DSeries</code>或<code>QSurface3DSeries</code>。</li>
<li>通过修改数据序列中的数据点，可以实现数据的动态更新。</li>
</ul>
</li>
<li><strong>数据代理（Data Proxy）</strong>：
<ul>
<li>数据代理（如<code>QBarDataProxy</code>或<code>QSurfaceDataProxy</code>）是数据序列与实际数据之间的桥梁。</li>
<li>通过调用数据代理的方法（如<code>resetArray()</code>或<code>setRow()</code>）可以批量或逐点更新数据。</li>
</ul>
</li>
<li><strong>动态更新方法</strong>：
<ul>
<li><strong>直接替换数据</strong>：通过<code>setDataArray()</code>或<code>resetArray()</code>一次性替换整个数据集。</li>
<li><strong>逐点更新</strong>：通过<code>setItem()</code>或<code>insertRow()</code>等方法修改或添加单个数据点。</li>
</ul>
</li>
<li><strong>性能优化</strong>：
<ul>
<li>对于频繁更新的场景，建议使用<code>QML</code>或<code>OpenGL</code>加速渲染。</li>
<li>批量更新数据比逐点更新更高效，尤其是在数据量较大时。</li>
</ul>
</li>
</ol>
<h5 id="示例代码片段-2">示例代码片段</h5>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 假设有一个QBar3DSeries对象barSeries</span></span><br><span class="line">QBarDataArray *dataArray = <span class="keyword">new</span> QBarDataArray;</span><br><span class="line">QBarDataRow *dataRow = <span class="keyword">new</span> QBarDataRow;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加或修改数据点</span></span><br><span class="line">*dataRow &lt;&lt; <span class="number">1.0</span> &lt;&lt; <span class="number">2.0</span> &lt;&lt; <span class="number">3.0</span>;</span><br><span class="line">dataArray-&gt;<span class="built_in">append</span>(dataRow);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过数据代理更新数据</span></span><br><span class="line">barSeries-&gt;<span class="built_in">dataProxy</span>()-&gt;<span class="built_in">resetArray</span>(dataArray);</span><br><span class="line"></span><br><span class="line">AI生成项目cpp</span><br><span class="line">运行</span><br><span class="line"><span class="number">12345678910</span></span><br></pre></td></tr></table></figure>
<h5 id="注意事项-5">注意事项</h5>
<ul>
<li>动态更新数据时，可能需要调用<code>series-&gt;setMeshRotation()</code>或<code>chart-&gt;scene()-&gt;activeCamera()-&gt;setCameraPosition()</code>来调整视角。</li>
<li>频繁更新数据时，注意避免界面卡顿，可以通过Qt的信号槽机制或定时器控制更新频率。</li>
</ul>
<p>通过以上方法，可以实现Qt Data Visualization中数据的动态更新与实时显示。</p>
<hr>
<h4 id="图形设置">图形设置</h4>
<h4 id="外观定制（颜色、材质等）">外观定制（颜色、材质等）</h4>
<p>在Qt Data Visualization中，外观定制允许你调整3D<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96&amp;spm=1001.2101.3001.7020">数据可视化</a>的视觉表现，包括颜色、材质、光照等属性。这些定制选项可以应用于数据系列、坐标轴、背景等元素。</p>
<h5 id="颜色定制">颜色定制</h5>
<ul>
<li><strong>数据系列颜色</strong>：可以为不同的数据点或数据系列设置不同的颜色。例如，在散点图中，每个点可以有不同的颜色。</li>
<li><strong>渐变颜色</strong>：可以使用渐变颜色来表示数据的变化，例如从冷色到暖色表示数值的高低。</li>
<li><strong>主题颜色</strong>：Qt Data Visualization提供了内置的主题（如<code>QtTheme</code>、<code>PrimaryColorsTheme</code>等），你可以直接使用或基于这些主题进行自定义。</li>
</ul>
<h5 id="材质定制">材质定制</h5>
<ul>
<li><strong>数据点材质</strong>：可以为数据点设置材质属性，例如反射率、光泽度等。材质属性影响数据点在光照下的表现。</li>
<li><strong>表面材质</strong>：在3D表面图中，可以设置表面的材质属性，例如粗糙度或金属感。</li>
</ul>
<h5 id="其他外观定制">其他外观定制</h5>
<ul>
<li><strong>光照效果</strong>：可以调整光源的位置、强度和颜色，以改变3D场景的明暗和阴影效果。</li>
<li><strong>背景和网格线</strong>：可以自定义背景颜色、网格线颜色和透明度，使图表更符合你的设计需求。</li>
</ul>
<h5 id="示例代码片段-3">示例代码片段</h5>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置数据系列的颜色</span></span><br><span class="line">QBar3DSeries *series = <span class="keyword">new</span> QBar3DSeries;</span><br><span class="line">series-&gt;<span class="built_in">setBaseColor</span>(Qt::blue);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用渐变颜色</span></span><br><span class="line">QLinearGradient gradient;</span><br><span class="line">gradient.<span class="built_in">setColorAt</span>(<span class="number">0.0</span>, Qt::black);</span><br><span class="line">gradient.<span class="built_in">setColorAt</span>(<span class="number">1.0</span>, Qt::white);</span><br><span class="line">series-&gt;<span class="built_in">setBaseGradient</span>(gradient);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置材质属性</span></span><br><span class="line">series-&gt;<span class="built_in">setMeshSmooth</span>(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">AI生成项目cpp</span><br><span class="line">运行</span><br><span class="line"><span class="number">123456789101112</span></span><br></pre></td></tr></table></figure>
<p>通过这些定制选项，你可以创建出符合特定需求或品牌风格的3D数据可视化效果。</p>
<hr>
<h4 id="布局与尺寸调整">布局与尺寸调整</h4>
<h5 id="概述-3">概述</h5>
<p>在Qt Data Visualization中，布局与尺寸调整是指控制3D数据可视化组件（如<code>Q3DBars</code>、<code>Q3DScatter</code>、<code>Q3DSurface</code>等）及其子元素（坐标轴、图例、标题等）在容器中的位置和大小的机制。通过调整布局参数，可以优化可视化效果的空间利用率。</p>
<h5 id="关键概念-2">关键概念</h5>
<ol>
<li>
<p><strong>容器尺寸</strong></p>
<ul>
<li>
<p>通过<code>width</code>和<code>height</code>属性设置可视化组件的绝对尺寸（单位为像素）。</p>
</li>
<li>
<p>示例代码：</p>
  <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Q3DBars graph;</span><br><span class="line">graph.<span class="built_in">setWidth</span>(<span class="number">800</span>);</span><br><span class="line">graph.<span class="built_in">setHeight</span>(<span class="number">600</span>);</span><br><span class="line"></span><br><span class="line">AI生成项目cpp</span><br><span class="line">运行<span class="number">123</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li>
<p><strong>边距（Margins）</strong></p>
<ul>
<li>
<p>使用<code>setMargins()</code>调整组件内容与容器边界的间距，影响坐标轴、图例的布局。</p>
</li>
<li>
<p>参数为</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">QMargins</span><br></pre></td></tr></table></figure>
<p>对象，定义左、上、右、下边距。</p>
  <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">graph.<span class="built_in">setMargins</span>(<span class="built_in">QMargins</span>(<span class="number">20</span>, <span class="number">10</span>, <span class="number">20</span>, <span class="number">10</span>)); <span class="comment">// 左20, 上10, 右20, 下10</span></span><br><span class="line"></span><br><span class="line">AI生成项目cpp</span><br><span class="line">运行<span class="number">1</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li>
<p><strong>自动调整模式</strong></p>
<ul>
<li><code>setAspectRatio()</code>：控制3D场景的宽高比（如<code>Qt::AspectRatioMode::KeepAspectRatio</code>）。</li>
<li><code>setHorizontalAspectRatio()</code>：仅水平方向的比例调整（适用于<code>Q3DScatter</code>）。</li>
</ul>
</li>
<li>
<p><strong>子元素布局</strong></p>
<ul>
<li><strong>坐标轴</strong>：通过<code>axisX()-&gt;setTitle()</code>等设置标题位置，或<code>setLabelAutoRotation</code>调整标签方向。</li>
<li><strong>图例</strong>：使用<code>legend-&gt;setPosition(Qt::AlignmentFlag)</code>控制位置（如<code>Qt::AlignRight</code>）。</li>
</ul>
</li>
</ol>
<h5 id="注意事项-6">注意事项</h5>
<ul>
<li>动态调整时需考虑性能，频繁重绘可能影响交互流畅度。</li>
<li>部分属性（如边距）可能受主题（Theme）预设值影响，需在设置主题后覆盖。</li>
</ul>
<hr>
<h4 id="交互功能">交互功能</h4>
<h4 id="用户交互方式（鼠标、键盘等）">用户交互方式（鼠标、键盘等）</h4>
<p>在 <strong>Qt Data Visualization</strong> 模块中，用户可以通过 <strong>鼠标</strong> 和 <strong>键盘</strong> 与 3D 数据可视化图表进行交互，以调整视角、缩放或选择数据点等操作。</p>
<h5 id="鼠标交互">鼠标交互</h5>
<ol>
<li><strong>旋转视图</strong>：
<ul>
<li>按住鼠标左键并拖动，可以旋转 3D 图表，改变观察角度。</li>
<li>适用于 <code>Q3DScatter</code>、<code>Q3DBars</code> 和 <code>Q3DSurface</code> 等图表类型。</li>
</ul>
</li>
<li><strong>缩放视图</strong>：
<ul>
<li>使用鼠标滚轮上下滚动，可以放大或缩小图表。</li>
<li>也可以通过按住鼠标右键并上下拖动实现缩放。</li>
</ul>
</li>
<li><strong>平移视图</strong>：
<ul>
<li>按住鼠标中键（滚轮键）并拖动，可以平移图表。</li>
<li>在触控板上，可能支持双指滑动实现平移。</li>
</ul>
</li>
<li><strong>选择数据点</strong>：
<ul>
<li>单击某个数据点（如散点图中的点或柱状图中的柱子），可以选中该数据点，并触发相关信号（如 <code>selectedElementChanged</code>）。</li>
</ul>
</li>
</ol>
<h5 id="键盘交互">键盘交互</h5>
<ol>
<li><strong>旋转视图</strong>：
<ul>
<li>使用方向键（↑、↓、←、→）可以微调图表的旋转角度。</li>
</ul>
</li>
<li><strong>缩放视图</strong>：
<ul>
<li><code>+</code> 键放大视图，<code>-</code> 键缩小视图。</li>
</ul>
</li>
<li><strong>重置视图</strong>：
<ul>
<li><code>Home</code> 键可以重置视图到默认的视角和缩放级别。</li>
</ul>
</li>
<li><strong>切换显示模式</strong>：
<ul>
<li>在某些图表类型中，键盘快捷键可以切换显示模式（如切换为平面投影或透视视图）。</li>
</ul>
</li>
</ol>
<h5 id="自定义交互行为">自定义交互行为</h5>
<p>可以通过编程方式禁用或调整交互行为：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 禁用旋转</span></span><br><span class="line">graph-&gt;<span class="built_in">setRotationEnabled</span>(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 禁用缩放</span></span><br><span class="line">graph-&gt;<span class="built_in">setZoomEnabled</span>(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 禁用选择</span></span><br><span class="line">graph-&gt;<span class="built_in">setSelectionEnabled</span>(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">AI生成项目cpp</span><br><span class="line">运行<span class="number">12345678</span></span><br></pre></td></tr></table></figure>
<p>这些交互方式使用户能够直观地探索和分析 3D 数据，提升数据可视化的灵活性。</p>
<hr>
<h4 id="交互事件处理">交互事件处理</h4>
<p>在Qt Data Visualization中，交互事件处理允许用户与3D数据可视化图表进行交互。主要包括以下几种交互方式：</p>
<h5 id="旋转">旋转</h5>
<ul>
<li>用户可以通过鼠标拖动来旋转3D图表</li>
<li>旋转轴心和速度可以配置</li>
<li>通过<code>Q3DScene::setSelectionQueryPosition()</code>可以设置旋转的中心点</li>
</ul>
<h5 id="缩放">缩放</h5>
<ul>
<li>通过鼠标滚轮或手势进行缩放</li>
<li>缩放级别可以通过<code>Q3DInputHandler</code>控制</li>
<li>可以设置最小/最大缩放限制</li>
</ul>
<h5 id="选择">选择</h5>
<ul>
<li>点击数据项可以选中</li>
<li>选中项会高亮显示</li>
<li>通过<code>QAbstract3DGraph::selectedSeries()</code>获取选中的系列</li>
</ul>
<h5 id="平移">平移</h5>
<ul>
<li>按住鼠标右键拖动可以平移视图</li>
<li>平移范围可以通过边界限制</li>
<li>在移动设备上支持触摸平移</li>
</ul>
<h5 id="事件处理机制">事件处理机制</h5>
<ul>
<li>继承自<code>QWidget</code>的标准事件系统</li>
<li>可以重写<code>mousePressEvent()</code>, <code>mouseMoveEvent()</code>等</li>
<li>通过<code>Q3DInputHandler</code>类集中管理输入事件</li>
</ul>
<h5 id="自定义交互">自定义交互</h5>
<ul>
<li>可以继承<code>Q3DInputHandler</code>创建自定义交互</li>
<li>通过信号/槽机制响应交互事件</li>
<li>可以禁用特定交互方式</li>
</ul>
<p>交互事件处理使数据可视化更具动态性和用户友好性，是Qt Data Visualization的重要功能之一。</p>
<hr>
<h4 id="应用案例">应用案例</h4>
<h4 id="简单示例程序">简单示例程序</h4>
<p>在Qt Data Visualization中，一个简单的示例程序通常包含以下几个基本步骤：</p>
<ol>
<li>
<p><strong>包含必要的头文件</strong><br>
首先需要包含Qt Data Visualization模块的头文件：</p>
 <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QtDataVisualization&gt;</span></span></span><br><span class="line"></span><br><span class="line">AI生成项目cpp</span><br><span class="line">运行<span class="number">1</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>创建QApplication对象</strong><br>
任何Qt GUI程序都需要一个<code>QApplication</code>对象：</p>
 <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span> </span>&#123;</span><br><span class="line">    <span class="function">QApplication <span class="title">app</span><span class="params">(argc, argv)</span></span>;</span><br><span class="line"></span><br><span class="line">AI生成项目cpp</span><br><span class="line">运行<span class="number">12</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>创建3D图表对象</strong><br>
使用<code>Q3DBars</code>、<code>Q3DScatter</code>或<code>Q3DSurface</code>等类来创建3D图表：</p>
 <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">QtDataVisualization::Q3DBars bars;</span><br><span class="line"></span><br><span class="line">AI生成项目cpp</span><br><span class="line">运行<span class="number">1</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>设置图表属性</strong><br>
可以设置图表的标题、轴标签等属性：</p>
 <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">bars.<span class="built_in">setTitle</span>(<span class="string">&quot;Simple Bar Chart Example&quot;</span>);</span><br><span class="line">bars.<span class="built_in">rowAxis</span>()-&gt;<span class="built_in">setTitle</span>(<span class="string">&quot;Row&quot;</span>);</span><br><span class="line">bars.<span class="built_in">columnAxis</span>()-&gt;<span class="built_in">setTitle</span>(<span class="string">&quot;Column&quot;</span>);</span><br><span class="line">bars.<span class="built_in">valueAxis</span>()-&gt;<span class="built_in">setTitle</span>(<span class="string">&quot;Value&quot;</span>);</span><br><span class="line"></span><br><span class="line">AI生成项目cpp</span><br><span class="line">运行<span class="number">1234</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>创建数据代理</strong><br>
使用<code>QBarDataProxy</code>等数据代理类来管理数据：</p>
 <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">QtDataVisualization::QBarDataProxy *proxy = <span class="keyword">new</span> QtDataVisualization::QBarDataProxy;</span><br><span class="line"></span><br><span class="line">AI生成项目cpp</span><br><span class="line">运行<span class="number">1</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>填充数据</strong><br>
创建数据数组并填充数据：</p>
 <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">QtDataVisualization::QBarDataArray *dataArray = <span class="keyword">new</span> QtDataVisualization::QBarDataArray;</span><br><span class="line">QtDataVisualization::QBarDataRow *dataRow = <span class="keyword">new</span> QtDataVisualization::QBarDataRow;</span><br><span class="line">*dataRow &lt;&lt; <span class="number">1.0f</span> &lt;&lt; <span class="number">2.0f</span> &lt;&lt; <span class="number">3.0f</span>;</span><br><span class="line">dataArray-&gt;<span class="built_in">append</span>(dataRow);</span><br><span class="line">proxy-&gt;<span class="built_in">resetArray</span>(dataArray);</span><br><span class="line"></span><br><span class="line">AI生成项目cpp</span><br><span class="line">运行<span class="number">12345</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>将代理设置到图表</strong><br>
将数据代理设置到图表系列：</p>
 <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">QtDataVisualization::QBar3DSeries *series = <span class="keyword">new</span> QtDataVisualization::<span class="built_in">QBar3DSeries</span>(proxy);</span><br><span class="line">bars.<span class="built_in">addSeries</span>(series);</span><br><span class="line"></span><br><span class="line">AI生成项目cpp</span><br><span class="line">运行<span class="number">12</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>显示图表</strong><br>
显示图表窗口：</p>
 <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">bars.<span class="built_in">show</span>();</span><br><span class="line"></span><br><span class="line">AI生成项目cpp</span><br><span class="line">运行<span class="number">1</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>运行应用程序</strong><br>
最后执行应用程序事件循环：</p>
 <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> app.<span class="built_in">exec</span>();</span><br><span class="line"></span><br><span class="line">AI生成项目cpp</span><br><span class="line">运行<span class="number">1</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>完整示例代码：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QtDataVisualization&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QApplication&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">QApplication <span class="title">app</span><span class="params">(argc, argv)</span></span>;</span><br><span class="line"></span><br><span class="line">    QtDataVisualization::Q3DBars bars;</span><br><span class="line">    bars.<span class="built_in">setTitle</span>(<span class="string">&quot;Simple Bar Chart Example&quot;</span>);</span><br><span class="line">    bars.<span class="built_in">rowAxis</span>()-&gt;<span class="built_in">setTitle</span>(<span class="string">&quot;Row&quot;</span>);</span><br><span class="line">    bars.<span class="built_in">columnAxis</span>()-&gt;<span class="built_in">setTitle</span>(<span class="string">&quot;Column&quot;</span>);</span><br><span class="line">    bars.<span class="built_in">valueAxis</span>()-&gt;<span class="built_in">setTitle</span>(<span class="string">&quot;Value&quot;</span>);</span><br><span class="line"></span><br><span class="line">    QtDataVisualization::QBarDataProxy *proxy = <span class="keyword">new</span> QtDataVisualization::QBarDataProxy;</span><br><span class="line">    QtDataVisualization::QBarDataArray *dataArray = <span class="keyword">new</span> QtDataVisualization::QBarDataArray;</span><br><span class="line">    QtDataVisualization::QBarDataRow *dataRow = <span class="keyword">new</span> QtDataVisualization::QBarDataRow;</span><br><span class="line">    *dataRow &lt;&lt; <span class="number">1.0f</span> &lt;&lt; <span class="number">2.0f</span> &lt;&lt; <span class="number">3.0f</span>;</span><br><span class="line">    dataArray-&gt;<span class="built_in">append</span>(dataRow);</span><br><span class="line">    proxy-&gt;<span class="built_in">resetArray</span>(dataArray);</span><br><span class="line"></span><br><span class="line">    QtDataVisualization::QBar3DSeries *series = <span class="keyword">new</span> QtDataVisualization::<span class="built_in">QBar3DSeries</span>(proxy);</span><br><span class="line">    bars.<span class="built_in">addSeries</span>(series);</span><br><span class="line">    bars.<span class="built_in">show</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> app.<span class="built_in">exec</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>这个简单示例创建了一个包含3个柱状条的3D柱状图，每个柱状条的高度分别为1.0、2.0和3.0。</p>
<h2 id="数据库">数据库</h2>
<p>Qt SQL模块包含多个类，实现数据库的连接，SQL语句执行，数据获取与界面显示，数据与界面之间使用Model/View结构，方便实现数据的显示和操作。</p>
<p><img src="/2025/02/24/QT-C/QT-C/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-07-22%20154011.png" alt="屏幕截图 2025-07-22 154011"></p>
<p>ui组件QTableView通过QSqlTableModel访问连接数据库系统</p>
<h3 id="代理delegate">代理delegate</h3>
<p>QT实现了MVC (model–view–controller)模式，那么QT在操作控件的时候也就有三板斧了，View显示内容，Model提供数据（访问数据都靠其中的索引<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=QModelIndex&amp;spm=1001.2101.3001.7020">QModelIndex</a>）,控制自然就是代理了，而且关键是代理，因为代理的作用是在数据模型和显示view之间架起了一座桥，足见其重要性。这里我们以QComboBox为列来说说代理。所有代理类的基类为QAbstractItemDelegate，这是抽象类不能用，但有QStyledItemDelegate可以直接使用，它则作为QT控件默认的代理类。我们来到QStyledItemDelegate类的头文件，这里面注释写得很清楚，哪些是要重写的一看就知道，用了 editing来标注，如下图：<br>
<img src="/2025/02/24/QT-C/QT-C/893c992606d7be8ecc7d8e77870f43b5.png" alt="在这里插入图片描述"><br>
那么，这四个方法也是我们实现自定义代理必须实现的方法，我们可以直接将它们四个拷贝到我们的自定义控件代理类中，逐个实现即可。</p>
<p>1、createEditor：代理组件创建必要函数<br>
2、setEditorData：从<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B&amp;spm=1001.2101.3001.7020">数据模型</a>中取出数据显示在控件中<br>
3、setModelData：将控件中编辑过的数据更新到据模型中<br>
4、updateEditorGeometry：为代理组件设置一个“几何实体”大小</p>
<p><strong>关键语句说明</strong>：<br>
1、 editor-&gt;addItems(m_type_list_);//加入combobox的item列表<br>
2、 comboBox-&gt;findText(text); //通过显示的文本内容得到当前item索引值<br>
3、 comboBox-&gt;currentText(); //通过当前的索引得到文本内容<br>
4、 editor-&gt;setGeometry(option.rect);//设置控件激活状态下的外观尺寸<br>
updateEditorGeometry一般采用直接设置为option原有的大小，我们稍微修改一下rect的大小，也就改变了这个控件的外观尺寸了。<br>
<img src="/2025/02/24/QT-C/QT-C/24d65825de90135fb7c8d0d06b227f40.png" alt="在这里插入图片描述"></p>
<p><img src="/2025/02/24/QT-C/QT-C/f470ec7e07458630fe5c8b2d292157d1.png" alt="在这里插入图片描述"></p>
<p><strong>调用自定义代理对象</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">newCombboxDelegate combboxdelegate;<span class="comment">//不能使用指针形式指向new创建的一个对象在下一条语句使用，因为编译报错</span></span><br><span class="line">ui-&gt;TableView-&gt;<span class="built_in">setItemDelegateForColumn</span>(<span class="number">4</span>,&amp;combboxdelegate);</span><br></pre></td></tr></table></figure>
<h2 id="多线程程序">多线程程序</h2>
<p>对于只有一个线程的程序，操作顺序执行，如果有某个比较耗时的计算cpu或操作IO，容易造成堵塞。</p>
<p>QThread类提供管理线程的方法：</p>
<ul>
<li>一个对象管理一个线程。QThread threadA; 建立一个线程。</li>
<li>一般从QThread 继承一个自定义类，重载run函数。</li>
<li>启动线程 threadA.start();//开始执行重载的run函数</li>
<li>阻塞当前线程threadA.wait();//等threadA跑完后才能执行当前代码的后半部分</li>
</ul>
<h3 id="基于互斥量的线程同步">基于互斥量的线程同步</h3>
<p>处理用信号与槽机制实现线程同步（主程序被动响应，请求式），也可以用互斥量实现同步（主程序主动询问，阻塞）。QMutex和QMutexLocker是基于互斥量的线程同步类，QMutex定义的实例是互斥量，提供三个函数：</p>
<ul>
<li>lock():锁定互斥量，如果另一个线程锁定了这个互斥量，将阻塞直到另一个解锁。</li>
<li>unlock(): 解锁一个互斥量。</li>
<li>trylock(): 试图锁定一个互斥量，如果成功返回true；失败（其他线程已经锁定了这个互斥量）返回false,不阻塞线程。非阻塞版</li>
<li>注：只锁一个地方是无法起到互斥的，要锁两个地方，一个是修改处，一个是获取处。</li>
</ul>
<p>QMutexLocker简化了QMutex处理互斥量：</p>
<ul>
<li>构造函数接受一个互斥量作为参数，并将其锁定。QMutexLocker locker(&amp;mutex);</li>
<li>析构函数解锁该互斥量。</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//修改处</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DiceThread::run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// QThread::run();</span></span><br><span class="line">    mStop = <span class="literal">false</span>;</span><br><span class="line">    <span class="comment">//初始化</span></span><br><span class="line">    mSeq = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">srand</span>(QTime::<span class="built_in">currentTime</span>().<span class="built_in">second</span>());</span><br><span class="line">    <span class="keyword">while</span> (!mStop) &#123;</span><br><span class="line">        <span class="comment">// 业务层面让线程暂停</span></span><br><span class="line">        <span class="keyword">if</span> (!mPause) &#123;</span><br><span class="line">            mMutex.<span class="built_in">lock</span>();</span><br><span class="line">            mDiceValue = <span class="number">100</span>;</span><br><span class="line">            <span class="built_in">msleep</span>(<span class="number">50</span>);</span><br><span class="line">            mDiceValue = <span class="number">200</span>;</span><br><span class="line">            <span class="built_in">msleep</span>(<span class="number">50</span>);</span><br><span class="line">            mDiceValue = <span class="number">300</span>;</span><br><span class="line">            <span class="built_in">msleep</span>(<span class="number">50</span>);</span><br><span class="line">            mDiceValue = <span class="number">400</span>;</span><br><span class="line">            <span class="built_in">msleep</span>(<span class="number">50</span>);</span><br><span class="line">            mDiceValue = <span class="built_in">rand</span>();</span><br><span class="line">            <span class="built_in">msleep</span>(<span class="number">50</span>);</span><br><span class="line">            mDiceValue = <span class="built_in">rand</span>()%<span class="number">6</span> + <span class="number">1</span>;</span><br><span class="line">            mSeq++;</span><br><span class="line">            <span class="comment">// emit newValued(mSeq, mDiceValue);</span></span><br><span class="line">            mMutex.<span class="built_in">unlock</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//防止跑得太快，改一次值休息1秒</span></span><br><span class="line">        <span class="built_in">msleep</span>(<span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//结束线程</span></span><br><span class="line">    <span class="built_in">quit</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//读取处</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DiceThread::readValue</span><span class="params">(<span class="type">int</span> *seq, <span class="type">int</span> *diceValue)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//方式一：</span></span><br><span class="line">    <span class="comment">// mMutex.lock();</span></span><br><span class="line">    <span class="comment">// *seq = mSeq;</span></span><br><span class="line">    <span class="comment">// *diceValue = mDiceValue;</span></span><br><span class="line">    <span class="comment">// mMutex.unlock();</span></span><br><span class="line">    <span class="comment">// 方式二：</span></span><br><span class="line">    <span class="function">QMutexLocker <span class="title">locker</span><span class="params">(&amp;mMutex)</span></span>;</span><br><span class="line">    *seq = mSeq;</span><br><span class="line">    *diceValue = mDiceValue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">DiceThread::readValueBool</span><span class="params">(<span class="type">int</span> *seq, <span class="type">int</span> *diceValue)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//方式三：</span></span><br><span class="line">    <span class="keyword">if</span> (mMutex.<span class="built_in">tryLock</span>()) &#123;</span><br><span class="line">        *seq = mSeq;</span><br><span class="line">        *diceValue = mDiceValue;</span><br><span class="line">        mMutex.<span class="built_in">unlock</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="基于QReadWriteLock的线程同步">基于QReadWriteLock的线程同步</h4>
<ul>
<li>使用互斥量时存在一个问题，每次只能有一个线程获得互斥量的权限。</li>
<li>如果多个线程读取某一个变量，就会出现排队现象。</li>
<li>有时应该允许让多个线程同时读取，互斥量会降低程序的性能。</li>
</ul>
<p>QReadWriteLock提供几个主要函数：</p>
<ul>
<li>lockForRead(): 只读方式锁定资源，如果有其他线程以写入方式锁定，这个函数会阻塞。</li>
<li>lockForWrite(): 以写入方式锁定资源，如果本线程或其他线程以读或写模式锁定资源，则函数堵塞。</li>
<li>unlock(): 解锁。</li>
<li>tryLockForRead(): 是lockForRead的非阻塞版</li>
<li>tryLockForWrite(): 是lockForWrite的非阻塞版</li>
</ul>
<p>QReadLocker和QWriteLocker简化了QReadWriteLock处理互斥量形式，无需与unlock() 配对使用：</p>
<ul>
<li>
<p>构造函数接受一个互斥量作为参数，并将其锁定。</p>
</li>
<li>
<p>析构函数解锁该互斥量。</p>
  <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">QReadWriteLock lock;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">threadDAQ::run</span><span class="params">()</span></span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="function">QReadLocker <span class="title">locker</span><span class="params">(&amp;lock)</span></span>;</span><br><span class="line">    <span class="built_in">get_data_and_write_in_buffer</span>();<span class="comment">//读写数据到内存buffer</span></span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="基于QWaitCondition的线程同步">基于QWaitCondition的线程同步</h4>
<ul>
<li>痛点： 在一个线程解锁资源后，不能及时通知其他线程。（写完了，立即通知其他线程来读。）</li>
</ul>
<p>QWaitCondition提供如下函数：</p>
<ul>
<li>wait(QMutex* lockedMutex): 进入等待状态，解锁互斥量lockedMutex, 被唤醒后锁定lockedMutex并退出函数。即等待之前锁住互斥量，进入等待（解锁互斥量，被唤醒后锁住互斥量），括号中的是wait()函数要做的事。</li>
<li>wakeAll(): 唤醒所有处于等待状态的线程，线程唤醒的顺序不确定，由操作系统的调度策略决定。</li>
<li>wakeOne(): 唤醒一个处于等待状态的线程，唤醒哪一个线程不确定，由操作系统调度策略决定。</li>
<li>QWaitCondition一般用于“生产者/消费者”模型中。生产者：生产数据，消费者：使用数据。</li>
<li>等待发生在消费者身上, 生产者提供唤醒。</li>
</ul>
<p><img src="/2025/02/24/QT-C/QT-C/image-20250928172957417.png" alt="image-20250928172957417"></p>
<img src="/2025/02/24/QT-C/QT-C/image-20250930110943070.png" alt="image-20250930110943070" style="zoom:50%;">
<h4 id="基于信号量的线程同步">基于信号量的线程同步</h4>
<p>信号量（Semaphore）通常用于保护一定<strong>数量</strong>的<strong>相同资源</strong>。例如数据采集时的双缓冲区。（缓冲区大小相同）</p>
<img src="/2025/02/24/QT-C/QT-C/image-20251005002129366.png" alt="image-20251005002129366" style="zoom:50%;">
<p>QSemaphore实现信号量功能的类，提供：</p>
<ul>
<li>
<p>acquire(int n): 尝试获得n个资源，如果不够将<strong>阻塞</strong>线程，直到n个资源可用。</p>
</li>
<li>
<p>release(int n): 释放资源，如果资源已经全部可用，则可扩充资源总数。</p>
</li>
<li>
<p>int available(): 返回当前信号量的资源个数。</p>
</li>
<li>
<p>bool tryAcquire(int n=1): 尝试获取n个资源，不成功时<strong>不阻</strong>塞线程。</p>
</li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://chauchy-Liu.github.io">刘传玺</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://chauchy-liu.github.io/2025/02/24/QT-C/">http://chauchy-liu.github.io/2025/02/24/QT-C/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://chauchy-Liu.github.io" target="_blank">和其光, 同其尘</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/C/">C++</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/Justlovesmile/CDN2/post/cover4.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2025/03/06/deepseek/"><img class="prev-cover" src="https://cdn.jsdelivr.net/gh/Justlovesmile/CDN2/post/cover5.JPG" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">deepseek</div></div></a></div><div class="next-post pull-right"><a href="/2025/02/17/spring/"><img class="next-cover" src="https://hexo-theme-snippet-1251680922.cos.ap-beijing.myqcloud.com/img/banner.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">spring</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div><div id="comment-switch"><span class="first-comment">Valine</span><span class="switch-btn"></span><span class="second-comment">Disqus</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div><div><div id="disqus_thread"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/touxiang.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">刘传玺</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">34</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">27</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">30</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/chauchy-liu/"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="mailto:liuchuanxi_211@163.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">学习笔记</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">QT</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2%E7%A9%BA%E9%A1%B9%E7%9B%AE%E6%B5%81%E7%A8%8B"><span class="toc-number">1.1.</span> <span class="toc-text">部署空项目流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#macos%E7%B3%BB%E7%BB%9F"><span class="toc-number">1.2.</span> <span class="toc-text">macos系统</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Windows%E7%B3%BB%E7%BB%9F"><span class="toc-number">1.3.</span> <span class="toc-text">Windows系统</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">2.</span> <span class="toc-text">C++知识点</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4"><span class="toc-number">2.1.</span> <span class="toc-text">命名空间</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E8%81%94%E5%87%BD%E6%95%B0"><span class="toc-number">2.2.</span> <span class="toc-text">内联函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8C%BF%E5%90%8D%E5%87%BD%E6%95%B0-lambda%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">2.3.</span> <span class="toc-text">匿名函数 lambda表达式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#C-%E4%B8%ADLambda%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%9A%84%E4%B8%A4%E7%A7%8D%E5%BD%A2%E5%BC%8F%E8%A7%A3%E6%9E%90"><span class="toc-number">2.3.1.</span> <span class="toc-text">C++中Lambda表达式的两种形式解析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%80%BC%E6%8D%95%E8%8E%B7%EF%BC%88Capture-by-Value%EF%BC%89"><span class="toc-number">2.3.1.1.</span> <span class="toc-text">1. [&#x3D;](){} - 值捕获（Capture by Value）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8"><span class="toc-number">2.3.1.1.1.</span> <span class="toc-text">作用</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B"><span class="toc-number">2.3.1.1.2.</span> <span class="toc-text">示例</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%89%B9%E7%82%B9"><span class="toc-number">2.3.1.1.3.</span> <span class="toc-text">特点</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%BC%95%E7%94%A8%E6%8D%95%E8%8E%B7%EF%BC%88Capture-by-Reference%EF%BC%89"><span class="toc-number">2.3.1.2.</span> <span class="toc-text">2. [&amp;](){} - 引用捕获（Capture by Reference）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8-2"><span class="toc-number">2.3.1.2.1.</span> <span class="toc-text">作用</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B-2"><span class="toc-number">2.3.1.2.2.</span> <span class="toc-text">示例</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%89%B9%E7%82%B9-2"><span class="toc-number">2.3.1.2.3.</span> <span class="toc-text">特点</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E5%8C%BA%E5%88%AB%E5%AF%B9%E6%AF%94"><span class="toc-number">2.3.1.3.</span> <span class="toc-text">关键区别对比</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9B%B4%E7%81%B5%E6%B4%BB%E7%9A%84%E6%8D%95%E8%8E%B7%E6%96%B9%E5%BC%8F"><span class="toc-number">2.3.1.4.</span> <span class="toc-text">更灵活的捕获方式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%BB%BA%E8%AE%AE"><span class="toc-number">2.3.1.5.</span> <span class="toc-text">使用建议</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Qt%E4%B8%AD%E7%9A%84%E7%89%B9%E6%AE%8A%E8%80%83%E8%99%91"><span class="toc-number">2.3.1.6.</span> <span class="toc-text">Qt中的特殊考虑</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E7%BB%84-%E9%9D%99%E6%80%81"><span class="toc-number">2.4.</span> <span class="toc-text">数组(静态)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%95%E7%94%A8"><span class="toc-number">2.5.</span> <span class="toc-text">引用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E6%9E%84%E4%BD%93-%E7%B1%BB"><span class="toc-number">2.6.</span> <span class="toc-text">结构体&#x2F;类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%87%8D%E8%BD%BD"><span class="toc-number">2.7.</span> <span class="toc-text">重载</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E9%87%8D%E8%BD%BD"><span class="toc-number">2.7.1.</span> <span class="toc-text">函数重载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%90%E7%AE%97%E7%AC%A6%E9%87%8D%E8%BD%BD"><span class="toc-number">2.7.2.</span> <span class="toc-text">运算符重载</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0"><span class="toc-number">2.8.</span> <span class="toc-text">构造函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E5%88%97%E8%A1%A8"><span class="toc-number">2.8.1.</span> <span class="toc-text">初始化列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#this%E6%8C%87%E9%92%88"><span class="toc-number">2.8.2.</span> <span class="toc-text">this指针</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#new%E5%92%8Cdelete%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">2.8.3.</span> <span class="toc-text">new和delete关键字</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8B%B7%E8%B4%9D%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0"><span class="toc-number">2.9.</span> <span class="toc-text">拷贝构造函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%85%E6%8B%B7%E8%B4%9D"><span class="toc-number">2.9.1.</span> <span class="toc-text">浅拷贝</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%B1%E6%8B%B7%E8%B4%9D"><span class="toc-number">2.9.2.</span> <span class="toc-text">深拷贝</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%84%E5%88%99%E4%B8%89%E5%88%99"><span class="toc-number">2.9.3.</span> <span class="toc-text">规则三则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%81%BF%E5%85%8D%E4%B8%8D%E5%BF%85%E8%A6%81%E7%9A%84%E6%8B%B7%E8%B4%9D"><span class="toc-number">2.9.4.</span> <span class="toc-text">避免不必要的拷贝</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A6%81%E7%94%A8%E6%8B%B7%E8%B4%9D%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0"><span class="toc-number">2.9.5.</span> <span class="toc-text">禁用拷贝构造函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9E%90%E6%9E%84%E5%87%BD%E6%95%B0"><span class="toc-number">2.10.</span> <span class="toc-text">析构函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E6%88%90%E5%91%98"><span class="toc-number">2.11.</span> <span class="toc-text">静态成员</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%A7%E6%89%BF"><span class="toc-number">2.12.</span> <span class="toc-text">继承</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E6%96%87%E4%BB%B6%E6%96%B9%E5%BC%8F%E5%AE%9E%E7%8E%B0%E7%BB%A7%E6%89%BF"><span class="toc-number">2.12.1.</span> <span class="toc-text">分文件方式实现继承</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%B1%BB%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0"><span class="toc-number">2.12.2.</span> <span class="toc-text">基类构造函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%99%9A%E5%87%BD%E6%95%B0"><span class="toc-number">2.12.3.</span> <span class="toc-text">虚函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E9%87%8D%E7%BB%A7%E6%89%BF"><span class="toc-number">2.12.4.</span> <span class="toc-text">多重继承</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%99%9A%E7%BB%A7%E6%89%BF"><span class="toc-number">2.12.5.</span> <span class="toc-text">虚继承</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E6%80%81"><span class="toc-number">2.12.6.</span> <span class="toc-text">多态</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%BD%E8%B1%A1%E7%B1%BB"><span class="toc-number">2.12.7.</span> <span class="toc-text">抽象类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%AF%E8%99%9A%E5%87%BD%E6%95%B0-%E6%8E%A5%E5%8F%A3"><span class="toc-number">2.12.8.</span> <span class="toc-text">纯虚函数-接口</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E7%89%88"><span class="toc-number">2.13.</span> <span class="toc-text">模版</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E6%A8%A1%E7%89%88"><span class="toc-number">2.13.1.</span> <span class="toc-text">类模版</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E6%A8%A1%E7%89%88"><span class="toc-number">2.13.2.</span> <span class="toc-text">函数模版</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E7%89%88%E7%89%B9%E5%8C%96"><span class="toc-number">2.13.3.</span> <span class="toc-text">模版特化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E7%89%88%E5%A3%B0%E6%98%8E"><span class="toc-number">2.13.4.</span> <span class="toc-text">模版声明</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%BA%E5%88%B6%E8%BD%AC%E6%8D%A2"><span class="toc-number">2.14.</span> <span class="toc-text">强制转换</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1%E6%9E%B6%E6%9E%84"><span class="toc-number">2.15.</span> <span class="toc-text">软件开发网络通信架构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#BS%E6%9E%B6%E6%9E%84-CS%E6%9E%B6%E6%9E%84"><span class="toc-number">2.15.1.</span> <span class="toc-text">BS架构&#x2F;CS架构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HTTP"><span class="toc-number">2.15.2.</span> <span class="toc-text">HTTP</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JSON%E6%95%B0%E6%8D%AE"><span class="toc-number">2.16.</span> <span class="toc-text">JSON数据</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Qt%E7%94%9F%E6%88%90JSON%E6%95%B0%E6%8D%AE"><span class="toc-number">2.16.1.</span> <span class="toc-text">Qt生成JSON数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#QT%E8%A7%A3%E6%9E%90JSON%E6%95%B0%E6%8D%AE"><span class="toc-number">2.16.2.</span> <span class="toc-text">QT解析JSON数据</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Model-View%E7%BB%93%E6%9E%84"><span class="toc-number">2.17.</span> <span class="toc-text">Model&#x2F;View结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AA%97%E4%BD%93"><span class="toc-number">2.18.</span> <span class="toc-text">窗体</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Qt%E5%AF%B9%E8%AF%9D%E6%A1%86%E6%A8%A1%E6%80%81%E5%92%8C%E9%9D%9E%E6%A8%A1%E6%80%81"><span class="toc-number">2.18.1.</span> <span class="toc-text">Qt对话框模态和非模态</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E6%80%81%E5%AF%B9%E8%AF%9D%E6%A1%86%EF%BC%88Modal-Dialog%EF%BC%89"><span class="toc-number">2.18.1.1.</span> <span class="toc-text">模态对话框（Modal Dialog）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9D%9E%E6%A8%A1%E6%80%81%E5%AF%B9%E8%AF%9D%E6%A1%86%EF%BC%88Modeless-Dialog%EF%BC%89"><span class="toc-number">2.18.1.2.</span> <span class="toc-text">非模态对话框（Modeless Dialog）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E7%AA%97%E4%BD%93"><span class="toc-number">2.18.2.</span> <span class="toc-text">多窗体</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MDI%E6%A8%A1%E5%BC%8F%EF%BC%88Multi-Document-Interface%EF%BC%89"><span class="toc-number">2.18.3.</span> <span class="toc-text">MDI模式（Multi Document Interface）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#QT%E8%AE%B0%E4%BA%8B%E6%9C%AC%E9%A1%B9%E7%9B%AE"><span class="toc-number">2.19.</span> <span class="toc-text">QT记事本项目</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8EUI-Designer%E4%B8%AD%E4%B8%AA%E6%80%A7%E5%8C%96%E7%AA%97%E5%8F%A3%E6%A0%B7%E5%BC%8F"><span class="toc-number">2.19.1.</span> <span class="toc-text">从UI Designer中个性化窗口样式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%A0%E8%BD%BD%E8%B5%84%E6%BA%90%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="toc-number">2.19.1.1.</span> <span class="toc-text">加载资源的配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#UI%E7%BB%84%E4%BB%B6%E4%B8%8E%E7%AA%97%E4%BD%93%E8%81%94%E5%8A%A8"><span class="toc-number">2.19.1.2.</span> <span class="toc-text">UI组件与窗体联动</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%A1%E5%8F%B7%E4%B8%8E%E6%A7%BD"><span class="toc-number">2.19.2.</span> <span class="toc-text">信号与槽</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#private-%E5%92%8C-private-slots-%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">2.19.3.</span> <span class="toc-text">private: 和 private slots: 的区别</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-private-%E8%AE%BF%E9%97%AE%E4%BF%AE%E9%A5%B0%E7%AC%A6"><span class="toc-number">2.19.3.1.</span> <span class="toc-text">1. private: 访问修饰符</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-private-slots-%E8%AE%BF%E9%97%AE%E4%BF%AE%E9%A5%B0%E7%AC%A6"><span class="toc-number">2.19.3.2.</span> <span class="toc-text">2. private slots: 访问修饰符</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E6%9D%83%E9%99%90%E4%B8%8E%E4%BF%A1%E5%8F%B7%E6%A7%BD%E6%9C%BA%E5%88%B6"><span class="toc-number">2.19.3.3.</span> <span class="toc-text">访问权限与信号槽机制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88-private-slots-%E4%B8%AD%E7%9A%84%E6%A7%BD%E5%87%BD%E6%95%B0%E5%8F%AF%E4%BB%A5%E6%AD%A3%E5%B8%B8%E4%BD%BF%E7%94%A8%EF%BC%9F"><span class="toc-number">2.19.3.4.</span> <span class="toc-text">为什么 private slots: 中的槽函数可以正常使用？</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E4%BF%A1%E5%8F%B7%E4%B8%8E%E6%A7%BD"><span class="toc-number">2.19.4.</span> <span class="toc-text">自定义信号与槽</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E7%B1%BBQFile"><span class="toc-number">2.19.5.</span> <span class="toc-text">文件操作类QFile</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#QTextStream"><span class="toc-number">2.19.5.1.</span> <span class="toc-text">QTextStream</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#QFileDialog%E6%96%87%E4%BB%B6%E5%AF%B9%E8%AF%9D%E6%A1%86"><span class="toc-number">2.19.5.2.</span> <span class="toc-text">QFileDialog文件对话框</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6%E6%98%BE%E7%A4%BA%E5%9C%A8%E7%AA%97%E5%8F%A3%E4%B8%AD"><span class="toc-number">2.19.5.3.</span> <span class="toc-text">读取文件显示在窗口中</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%9D%E5%AD%98%E6%98%BE%E7%A4%BA%E5%9C%A8%E7%AA%97%E5%8F%A3%E4%B8%AD%E7%9A%84%E5%86%85%E5%AE%B9"><span class="toc-number">2.19.5.4.</span> <span class="toc-text">保存显示在窗口中的内容</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B3%E9%97%AD%E6%96%87%E6%A1%A3"><span class="toc-number">2.19.5.5.</span> <span class="toc-text">关闭文档</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#QComboBox"><span class="toc-number">2.19.6.</span> <span class="toc-text">QComboBox</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B8%B8%E6%A0%87QTextCursor"><span class="toc-number">2.19.7.</span> <span class="toc-text">游标QTextCursor</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AA%97%E5%8F%A3%E6%A0%87%E9%A2%98"><span class="toc-number">2.19.8.</span> <span class="toc-text">窗口标题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BD%93%E5%89%8D%E8%A1%8C%E9%AB%98%E4%BA%AE"><span class="toc-number">2.19.9.</span> <span class="toc-text">当前行高亮</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#QList"><span class="toc-number">2.19.10.</span> <span class="toc-text">QList</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%BF%AB%E6%8D%B7%E9%94%AE"><span class="toc-number">2.19.11.</span> <span class="toc-text">创建快捷键</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E4%BD%93%E6%94%BE%E5%A4%A7%E7%BC%A9%E5%B0%8F"><span class="toc-number">2.19.12.</span> <span class="toc-text">字体放大缩小</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E4%BB%B6"><span class="toc-number">2.19.13.</span> <span class="toc-text">事件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8B%E4%BB%B6%E8%BF%87%E7%A8%8B%E4%B8%AD%E7%9A%84%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%E7%8E%AF%E8%8A%82"><span class="toc-number">2.19.13.1.</span> <span class="toc-text">事件过程中的事件处理环节</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8B%E4%BB%B6%E8%BF%87%E7%A8%8B%E4%B8%AD%E7%9A%84%E4%BA%8B%E4%BB%B6%E8%BF%87%E6%BB%A4%E7%8E%AF%E8%8A%82"><span class="toc-number">2.19.13.2.</span> <span class="toc-text">事件过程中的事件过滤环节</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%B0%E4%BA%8B%E6%9C%AC%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93"><span class="toc-number">2.19.14.</span> <span class="toc-text">记事本项目总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%B2%E5%8F%A3%E8%B0%83%E8%AF%95%E5%8A%A9%E6%89%8B"><span class="toc-number">2.20.</span> <span class="toc-text">串口调试助手</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0"><span class="toc-number">2.20.1.</span> <span class="toc-text">初始化构造函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%A1%E5%8F%B7%E4%B8%8E%E6%A7%BD-2"><span class="toc-number">2.20.2.</span> <span class="toc-text">信号与槽</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%93%E5%BC%80%E4%B8%B2%E5%8F%A3%E6%97%B6%E4%B8%BA%E4%B8%B2%E5%8F%A3%E9%85%8D%E7%BD%AE%E6%B3%A2%E7%89%B9%E7%8E%87%E3%80%81%E6%95%B0%E6%8D%AE%E4%BD%8D%E3%80%81%E6%A0%A1%E9%AA%8C%E4%BD%8D%E3%80%81%E5%81%9C%E6%AD%A2%E4%BD%8D%E3%80%81%E6%B5%81%E6%8E%A7%E5%8F%82%E6%95%B0%E3%80%82"><span class="toc-number">2.20.2.1.</span> <span class="toc-text">打开串口时为串口配置波特率、数据位、校验位、停止位、流控参数。</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%91%E9%80%81%E6%96%87%E6%9C%AC%E4%BF%A1%E6%81%AF"><span class="toc-number">2.20.2.2.</span> <span class="toc-text">发送文本信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%8A%B6%E6%80%81%E6%A0%8F"><span class="toc-number">2.20.2.3.</span> <span class="toc-text">状态栏</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%B2%E5%8F%A3%E5%8D%A0%E7%94%A8%E7%BB%99%E4%BA%88%E6%8F%90%E7%A4%BA%E5%AF%B9%E8%AF%9D%E6%A1%86"><span class="toc-number">2.20.2.4.</span> <span class="toc-text">串口占用给予提示对话框</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%B2%E5%8F%A3%E6%89%93%E5%BC%80%E5%8F%98%E5%85%B3%E9%97%AD%E5%92%8C%E4%B8%B2%E5%8F%A3%E5%8F%82%E6%95%B0%E4%B8%8D%E5%8F%AF%E4%BF%AE%E6%94%B9%E7%8A%B6%E6%80%81"><span class="toc-number">2.20.2.5.</span> <span class="toc-text">串口打开变关闭和串口参数不可修改状态</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9A%E6%97%B6%E5%8F%91%E9%80%81-%E5%AE%9A%E6%97%B6%E5%99%A8"><span class="toc-number">2.20.2.6.</span> <span class="toc-text">定时发送&#x2F;定时器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B8%85%E7%A9%BA-%E4%BF%9D%E5%AD%98%E6%8E%A5%E6%94%B6%E6%8C%89%E9%94%AE"><span class="toc-number">2.20.2.7.</span> <span class="toc-text">清空&#x2F;保存接收按键</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%A5%E6%94%B6%E6%97%B6%E9%97%B4-%E7%8A%B6%E6%80%81%E6%A0%8F%E6%97%B6%E9%97%B4"><span class="toc-number">2.20.2.8.</span> <span class="toc-text">接收时间&#x2F;状态栏时间</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Hex%E8%BD%AC%E6%8D%A2"><span class="toc-number">2.20.2.9.</span> <span class="toc-text">Hex转换</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Hex%E5%8F%91%E9%80%81%E6%8C%89%E9%92%AE"><span class="toc-number">2.20.2.10.</span> <span class="toc-text">Hex发送按钮</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B0%E8%A1%8Ccheckbox"><span class="toc-number">2.20.2.11.</span> <span class="toc-text">新行checkbox</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9A%90%E8%97%8F%E9%9D%A2%E6%9D%BF%E5%92%8C%E9%9A%90%E8%97%8F%E5%8E%86%E5%8F%B2pushbutton"><span class="toc-number">2.20.2.12.</span> <span class="toc-text">隐藏面板和隐藏历史pushbutton</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%B2%E5%8F%A3combox%E5%88%B7%E6%96%B0%E4%B8%B2%E5%8F%A3"><span class="toc-number">2.20.2.13.</span> <span class="toc-text">串口combox刷新串口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A2%84%E5%AE%9A%E4%B9%89%E5%91%BD%E4%BB%A4%E5%8F%91%E9%80%81"><span class="toc-number">2.20.2.14.</span> <span class="toc-text">预定义命令发送</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BE%AA%E7%8E%AF%E5%8F%91%E9%80%81%E9%A2%84%E5%AE%9A%E4%B9%89%E5%91%BD%E4%BB%A4"><span class="toc-number">2.20.2.15.</span> <span class="toc-text">循环发送预定义命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%8D%E7%BD%AEpushButton"><span class="toc-number">2.20.2.16.</span> <span class="toc-text">重置pushButton</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%9D%E5%AD%98-%E8%BD%BD%E5%85%A5pushButton-%E5%91%BD%E4%BB%A4%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">2.20.2.17.</span> <span class="toc-text">保存&#x2F;载入pushButton 命令字符串</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%98%BE%E7%A4%BA%E6%A1%86%E4%B8%AD%E5%86%85%E5%AE%B9%E8%BF%87%E5%A4%9A%E6%97%B6%E6%98%BE%E7%A4%BA%E7%9A%84%E5%86%85%E5%AE%B9%E4%B8%8D%E5%9C%A8%E6%9C%80%E6%96%B0%E4%BD%8D%E7%BD%AE"><span class="toc-number">2.20.2.18.</span> <span class="toc-text">显示框中内容过多时显示的内容不在最新位置</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E8%B0%83%E8%AF%95%E5%8A%A9%E6%89%8B"><span class="toc-number">2.21.</span> <span class="toc-text">网络调试助手</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E6%A6%82%E8%BF%B0"><span class="toc-number">2.21.1.</span> <span class="toc-text">项目概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B"><span class="toc-number">2.21.2.</span> <span class="toc-text">开发流程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BB%BA%E7%AB%8B%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AF%B9%E5%83%8F%E3%80%81%E5%BC%80%E5%A7%8B%E7%9B%91%E5%90%AC%E5%92%8CnewConnect%E4%BF%A1%E5%8F%B7"><span class="toc-number">2.21.2.1.</span> <span class="toc-text">建立服务器对像、开始监听和newConnect信号</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%98%BE%E7%A4%BA%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84IP%E5%B9%B6%E7%9B%91%E5%90%AC%E6%98%BE%E7%A4%BA%E7%9A%84IP"><span class="toc-number">2.21.2.2.</span> <span class="toc-text">显示服务器的IP并监听显示的IP</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8%E5%BB%BA%E7%AB%8B%E7%9A%84%E5%AE%A2%E6%88%B7%E8%BF%9E%E6%8E%A5-socket-%E4%B8%AD%E5%A4%84%E7%90%86%E6%95%B0%E6%8D%AE%E6%8E%A5%E6%94%B6%E7%9A%84readyRead%E4%BF%A1%E5%8F%B7"><span class="toc-number">2.21.2.3.</span> <span class="toc-text">在建立的客户连接(socket)中处理数据接收的readyRead信号</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%A3%80%E6%B5%8B%E5%AE%A2%E6%88%B7%E7%AB%AFsocket%E6%98%AF%E5%90%A6%E6%96%AD%E5%BC%80"><span class="toc-number">2.21.2.4.</span> <span class="toc-text">服务端检测客户端socket是否断开</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%8F%91%E9%80%81%E6%95%B0%E6%8D%AE"><span class="toc-number">2.21.2.5.</span> <span class="toc-text">服务端发送数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E7%AB%AF%E9%80%89%E6%8B%A9%E6%8C%87%E5%AE%9A%E7%9A%84socket%E5%8F%91%E9%80%81%E6%95%B0%E6%8D%AE"><span class="toc-number">2.21.2.6.</span> <span class="toc-text">服务端选择指定的socket发送数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%81%9C%E6%AD%A2%E7%9B%91%E5%90%AC%E5%92%8C%E6%96%AD%E5%BC%80%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">2.21.2.7.</span> <span class="toc-text">停止监听和断开服务器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-number">2.21.2.8.</span> <span class="toc-text">客户端</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%AE%BE%E7%BD%AE%E6%8E%A5%E6%94%B6%E5%92%8C%E5%8F%91%E9%80%81%E7%94%A8%E4%B8%8D%E5%90%8C%E7%9A%84%E9%A2%9C%E8%89%B2%E5%B1%95%E7%A4%BA%E4%BB%A5%E5%8F%8A%E5%B7%A6%E5%8F%B3%E5%AF%B9%E9%BD%90"><span class="toc-number">2.21.2.9.</span> <span class="toc-text">客户端设置接收和发送用不同的颜色展示以及左右对齐</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%A3%80%E6%B5%8B%E5%88%B0%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%96%AD%E8%BF%9E%E5%90%8E%E5%B0%86comboBox%E4%B8%AD%E7%9A%84%E9%A1%B9%E5%88%A0%E9%99%A4%EF%BC%8C%E6%A3%80%E6%B5%8B%E5%88%B0%E6%96%B0%E8%BF%9E%E6%8E%A5%E4%B9%9F%E5%8A%A0%E5%85%A5%E8%AF%A5%E9%A1%B9%EF%BC%8C%E5%8F%91%E9%80%81pushButton%E6%A3%80%E6%B5%8B%E5%88%B0%E6%B2%A1%E6%9C%89%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%BF%9E%E6%8E%A5%E6%97%B6%E4%B8%8D%E5%8F%91%E9%80%81%E4%BF%A1%E6%81%AF"><span class="toc-number">2.21.2.10.</span> <span class="toc-text">服务端检测到客户端断连后将comboBox中的项删除，检测到新连接也加入该项，发送pushButton检测到没有客户端连接时不发送信息</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8E%A7%E4%BB%B6"><span class="toc-number">2.22.</span> <span class="toc-text">自定义可视化控件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#QPaintEvent%E7%BB%98%E5%9B%BE%E4%BA%8B%E4%BB%B6"><span class="toc-number">2.22.1.</span> <span class="toc-text">QPaintEvent绘图事件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#QPainter%E7%94%BB%E5%AE%B6"><span class="toc-number">2.22.2.</span> <span class="toc-text">QPainter画家</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-number">2.22.2.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B8%90%E5%8F%98%E8%89%B2"><span class="toc-number">2.22.2.2.</span> <span class="toc-text">渐变色</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BA%BF%E6%80%A7%E6%B8%90%E5%8F%98%E8%89%B2"><span class="toc-number">2.22.2.2.1.</span> <span class="toc-text">线性渐变色</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%BE%84%E5%90%91%E6%B8%90%E5%8F%98"><span class="toc-number">2.22.2.2.2.</span> <span class="toc-text">径向渐变</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9C%86%E9%94%A5%E5%BD%A2%E6%B8%90%E5%8F%98"><span class="toc-number">2.22.2.2.3.</span> <span class="toc-text">圆锥形渐变</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9B%B7%E8%BE%BE"><span class="toc-number">2.22.3.</span> <span class="toc-text">雷达</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E6%98%93%E4%BB%AA%E8%A1%A8%E7%9B%98"><span class="toc-number">2.22.4.</span> <span class="toc-text">简易仪表盘</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B1%BD%E8%BD%A6%E4%BB%AA%E8%A1%A8%E7%9B%98"><span class="toc-number">2.22.5.</span> <span class="toc-text">汽车仪表盘</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%98%BE%E7%A4%BA%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8C%89%E9%92%AE"><span class="toc-number">2.22.6.</span> <span class="toc-text">显示自定义按钮</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8F%92%E4%BB%B6"><span class="toc-number">2.23.</span> <span class="toc-text">自定义插件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5%E5%BA%93"><span class="toc-number">2.23.1.</span> <span class="toc-text">动态链接库</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E5%BA%93%E7%89%B9%E4%BE%8B%E6%8F%92%E4%BB%B6%E4%B8%8D%E5%85%89%E5%85%B6%E4%BB%96%E9%A1%B9%E7%9B%AE%E4%BD%BF%E7%94%A8qt-designer%E4%B9%9F%E4%BD%BF%E7%94%A8"><span class="toc-number">2.23.1.1.</span> <span class="toc-text">动态库特例插件不光其他项目使用qt designer也使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%98%BE%E5%BC%8F%E8%B0%83%E7%94%A8%E5%8A%A8%E6%80%81%E5%BA%93"><span class="toc-number">2.23.1.2.</span> <span class="toc-text">显式调用动态库</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E9%93%BE%E6%8E%A5%E5%BA%93"><span class="toc-number">2.23.2.</span> <span class="toc-text">静态链接库</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%A9%E6%B0%94%E9%A2%84%E6%8A%A5"><span class="toc-number">2.24.</span> <span class="toc-text">天气预报</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0-2"><span class="toc-number">2.24.0.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#stylesheet%E6%A0%B7%E5%BC%8F"><span class="toc-number">2.24.0.2.</span> <span class="toc-text">stylesheet样式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E7%AA%97%E4%BD%93%E6%8B%96%E5%8A%A8%EF%BC%9A%E9%BC%A0%E6%A0%87%E5%9D%90%E6%A0%87"><span class="toc-number">2.24.0.3.</span> <span class="toc-text">应用窗体拖动：鼠标坐标</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%A9%E6%B0%94%E6%95%B0%E6%8D%AE%E8%8E%B7%E5%8F%96"><span class="toc-number">2.24.0.4.</span> <span class="toc-text">天气数据获取</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#QT%E7%9A%84HTTP%E7%BC%96%E7%A8%8B"><span class="toc-number">2.24.0.5.</span> <span class="toc-text">QT的HTTP编程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8B%E4%BB%B6%E6%BB%A4%E6%B3%A2%E5%99%A8"><span class="toc-number">2.24.0.6.</span> <span class="toc-text">事件滤波器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%A9%E6%B0%94%E5%9B%BE%E7%BC%A9%E6%94%BE%E5%8C%B9%E9%85%8D%E7%AA%97%E5%8F%A3"><span class="toc-number">2.24.0.7.</span> <span class="toc-text">天气图缩放匹配窗口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%9C%E5%9B%BE%E8%A2%AB%E5%B8%83%E5%B1%80%E9%81%AE%E6%8C%A1"><span class="toc-number">2.24.0.8.</span> <span class="toc-text">作图被布局遮挡</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">3.</span> <span class="toc-text">Graphics View架构</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E4%B8%AA%E5%9D%90%E6%A0%87%E7%B3%BB%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="toc-number">3.1.</span> <span class="toc-text">三个坐标系的关系</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%9D%90%E6%A0%87%E7%B3%BB%E5%AE%9A%E4%B9%89"><span class="toc-number">3.2.</span> <span class="toc-text">1. 坐标系定义</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%BE%E5%85%83%E5%9D%90%E6%A0%87%E7%B3%BB-Item-Coordinates"><span class="toc-number">3.2.1.</span> <span class="toc-text">图元坐标系 (Item Coordinates)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF%E5%9D%90%E6%A0%87%E7%B3%BB-Scene-Coordinates"><span class="toc-number">3.2.2.</span> <span class="toc-text">场景坐标系 (Scene Coordinates)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE%E5%9D%90%E6%A0%87%E7%B3%BB-View-Coordinates"><span class="toc-number">3.2.3.</span> <span class="toc-text">视图坐标系 (View Coordinates)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E8%BD%AC%E6%8D%A2%E6%96%B9%E6%B3%95"><span class="toc-number">3.3.</span> <span class="toc-text">2. 转换方法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%BE%E5%85%83-%E2%86%94-%E5%9C%BA%E6%99%AF"><span class="toc-number">3.3.1.</span> <span class="toc-text">图元 ↔ 场景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF-%E2%86%94-%E8%A7%86%E5%9B%BE"><span class="toc-number">3.3.2.</span> <span class="toc-text">场景 ↔ 视图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%BE%E5%85%83-%E2%86%94-%E8%A7%86%E5%9B%BE"><span class="toc-number">3.3.3.</span> <span class="toc-text">图元 ↔ 视图</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E8%8E%B7%E5%8F%96%E7%82%B9%E5%87%BB%E4%BD%8D%E7%BD%AE%E7%9A%84%E4%B8%89%E7%A7%8D%E5%9D%90%E6%A0%87"><span class="toc-number">3.4.</span> <span class="toc-text">3. 获取点击位置的三种坐标</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%B3%951%EF%BC%9A%E5%9C%A8%E8%A7%86%E5%9B%BE%E7%9A%84%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%E4%B8%AD%E8%8E%B7%E5%8F%96"><span class="toc-number">3.4.1.</span> <span class="toc-text">方法1：在视图的事件处理中获取</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%B3%952%EF%BC%9A%E5%9C%A8%E5%9B%BE%E5%85%83%E7%9A%84%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%E4%B8%AD%E8%8E%B7%E5%8F%96"><span class="toc-number">3.4.2.</span> <span class="toc-text">方法2：在图元的事件处理中获取</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%B3%953%EF%BC%9A%E5%9C%A8%E5%9C%BA%E6%99%AF%E7%9A%84%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%E4%B8%AD%E8%8E%B7%E5%8F%96"><span class="toc-number">3.4.3.</span> <span class="toc-text">方法3：在场景的事件处理中获取</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%BE%E8%A1%A8"><span class="toc-number">3.5.</span> <span class="toc-text">图表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%9D%90%E6%A0%87%E7%B3%BB%E7%AE%80%E4%BB%8B"><span class="toc-number">3.6.</span> <span class="toc-text">1. 坐标系简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E6%A0%B8%E5%BF%83%E8%BD%AC%E6%8D%A2%E6%96%B9%E6%B3%95"><span class="toc-number">3.7.</span> <span class="toc-text">2. 核心转换方法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%95%B0%E6%8D%AE%E5%80%BC-%E2%86%92-%E5%9B%BE%E8%A1%A8%E5%83%8F%E7%B4%A0%E5%9D%90%E6%A0%87-QChart-mapToPosition"><span class="toc-number">3.7.1.</span> <span class="toc-text">(1) 数据值 → 图表像素坐标 (QChart::mapToPosition)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%9B%BE%E8%A1%A8%E5%83%8F%E7%B4%A0%E5%9D%90%E6%A0%87-%E2%86%92-%E6%95%B0%E6%8D%AE%E5%80%BC-QChart-mapToValue"><span class="toc-number">3.7.2.</span> <span class="toc-text">(2) 图表像素坐标 → 数据值 (QChart::mapToValue)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%9B%BE%E8%A1%A8%E5%83%8F%E7%B4%A0%E5%9D%90%E6%A0%87-%E2%86%92-%E8%A7%86%E5%9B%BE%E5%83%8F%E7%B4%A0%E5%9D%90%E6%A0%87-QChartView-mapFromScene"><span class="toc-number">3.7.3.</span> <span class="toc-text">(3) 图表像素坐标 → 视图像素坐标 (QChartView::mapFromScene)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E8%A7%86%E5%9B%BE%E5%83%8F%E7%B4%A0%E5%9D%90%E6%A0%87-%E2%86%92-%E5%9B%BE%E8%A1%A8%E5%83%8F%E7%B4%A0%E5%9D%90%E6%A0%87-QChartView-mapToScene"><span class="toc-number">3.7.4.</span> <span class="toc-text">(4) 视图像素坐标 → 图表像素坐标 (QChartView::mapToScene)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E5%B1%8F%E5%B9%95%E5%83%8F%E7%B4%A0%E5%9D%90%E6%A0%87"><span class="toc-number">3.7.5.</span> <span class="toc-text">(5) 屏幕像素坐标</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E7%AA%97%E5%8F%A3%E5%83%8F%E7%B4%A0%E5%9D%90%E6%A0%87"><span class="toc-number">3.7.6.</span> <span class="toc-text">(6) 应用程序窗口像素坐标</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%E8%A7%86%E5%9B%BE%E5%83%8F%E7%B4%A0%E5%9D%90%E6%A0%87"><span class="toc-number">3.7.7.</span> <span class="toc-text">(7) 视图像素坐标</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%AE%8C%E6%95%B4%E8%BD%AC%E6%8D%A2%E6%B5%81%E7%A8%8B"><span class="toc-number">3.8.</span> <span class="toc-text">3. 完整转换流程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%95%B0%E6%8D%AE%E5%80%BC-%E2%86%92-%E8%A7%86%E5%9B%BE%E5%9D%90%E6%A0%87"><span class="toc-number">3.8.1.</span> <span class="toc-text">(1) 数据值 → 视图坐标</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E8%A7%86%E5%9B%BE%E5%9D%90%E6%A0%87-%E2%86%92-%E6%95%B0%E6%8D%AE%E5%80%BC"><span class="toc-number">3.8.2.</span> <span class="toc-text">(2) 视图坐标 → 数据值</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E7%A4%BA%E4%BE%8B"><span class="toc-number">3.9.</span> <span class="toc-text">4. 实际应用示例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF%EF%BC%9A%E9%BC%A0%E6%A0%87%E6%82%AC%E5%81%9C%E6%98%BE%E7%A4%BA%E6%95%B0%E6%8D%AE%E7%82%B9%E5%80%BC"><span class="toc-number">3.9.1.</span> <span class="toc-text">场景：鼠标悬停显示数据点值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF%EF%BC%9A%E5%9C%A8%E6%8C%87%E5%AE%9A%E6%95%B0%E6%8D%AE%E7%82%B9%E7%BB%98%E5%88%B6%E6%A0%87%E8%AE%B0"><span class="toc-number">3.9.2.</span> <span class="toc-text">场景：在指定数据点绘制标记</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E5%85%B3%E9%94%AE%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">3.10.</span> <span class="toc-text">5. 关键注意事项</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E8%BD%AC%E6%8D%A2%E5%85%B3%E7%B3%BB%E5%9B%BE"><span class="toc-number">3.11.</span> <span class="toc-text">6. 转换关系图</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E6%A8%A1%E5%9E%8B-%E8%A7%86%E5%9B%BE"><span class="toc-number">3.11.1.</span> <span class="toc-text">一、模型-视图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD"><span class="toc-number">3.11.2.</span> <span class="toc-text">二、核心功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%B1%E7%8A%B6%E5%9B%BE"><span class="toc-number">3.11.3.</span> <span class="toc-text">柱状图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A5%BC%E7%8A%B6%E5%9B%BE"><span class="toc-number">3.11.4.</span> <span class="toc-text">饼状图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#QPieSeries"><span class="toc-number">3.11.5.</span> <span class="toc-text">QPieSeries</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#QPieSlice"><span class="toc-number">3.11.6.</span> <span class="toc-text">QPieSlice</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A0%86%E5%8F%A0%E5%9B%BE"><span class="toc-number">3.11.7.</span> <span class="toc-text">堆叠图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%99%BE%E5%88%86%E6%AF%94%E5%A0%86%E5%8F%A0%E5%9B%BE"><span class="toc-number">3.11.8.</span> <span class="toc-text">百分比堆叠图</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E7%BB%B4%E8%A7%86%E5%9B%BE%E6%A8%A1%E5%9D%97"><span class="toc-number">3.12.</span> <span class="toc-text">三维视图模块</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Qt-Data-Visualization%E6%A6%82%E8%BF%B0"><span class="toc-number">3.12.0.1.</span> <span class="toc-text">Qt Data Visualization概述</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BB%E8%A6%81%E7%BB%84%E4%BB%B6"><span class="toc-number">3.12.0.2.</span> <span class="toc-text">主要组件</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-Q3DBars"><span class="toc-number">3.12.0.2.1.</span> <span class="toc-text">1. Q3DBars</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-Q3DScatter"><span class="toc-number">3.12.0.2.2.</span> <span class="toc-text">2. Q3DScatter</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-Q3DSurface"><span class="toc-number">3.12.0.2.3.</span> <span class="toc-text">3. Q3DSurface</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-QAbstract3DGraph"><span class="toc-number">3.12.0.2.4.</span> <span class="toc-text">4. QAbstract3DGraph</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-Q3DCamera"><span class="toc-number">3.12.0.2.5.</span> <span class="toc-text">5. Q3DCamera</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-Q3DTheme"><span class="toc-number">3.12.0.2.6.</span> <span class="toc-text">6. Q3DTheme</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#7-QValue3DAxis"><span class="toc-number">3.12.0.2.7.</span> <span class="toc-text">7. QValue3DAxis</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#8-QCategory3DAxis"><span class="toc-number">3.12.0.2.8.</span> <span class="toc-text">8. QCategory3DAxis</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#9-QScatter3DSeries"><span class="toc-number">3.12.0.2.9.</span> <span class="toc-text">9. QScatter3DSeries</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-QBar3DSeries"><span class="toc-number">3.12.0.2.10.</span> <span class="toc-text">10. QBar3DSeries</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#11-QSurface3DSeries"><span class="toc-number">3.12.0.2.11.</span> <span class="toc-text">11. QSurface3DSeries</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#12-QCustom3DItem"><span class="toc-number">3.12.0.2.12.</span> <span class="toc-text">12. QCustom3DItem</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95"><span class="toc-number">3.12.0.3.</span> <span class="toc-text">基本用法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%8E%E5%85%B6%E4%BB%96%E6%A8%A1%E5%9D%97%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="toc-number">3.12.0.4.</span> <span class="toc-text">与其他模块的关系</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-number">3.12.0.5.</span> <span class="toc-text">基本概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3D%E5%9B%BE%E5%BD%A2%E7%B1%BB%E5%9E%8B%EF%BC%88Q3DBars%E3%80%81Q3DScatter%E3%80%81Q3DSurface%EF%BC%89"><span class="toc-number">3.12.0.6.</span> <span class="toc-text">3D图形类型（Q3DBars、Q3DScatter、Q3DSurface）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Q3DBars"><span class="toc-number">3.12.0.6.1.</span> <span class="toc-text">Q3DBars</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Q3DScatter"><span class="toc-number">3.12.0.6.2.</span> <span class="toc-text">Q3DScatter</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Q3DSurface"><span class="toc-number">3.12.0.6.3.</span> <span class="toc-text">Q3DSurface</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E4%BB%A3%E7%90%86%EF%BC%88Data-Proxy%EF%BC%89"><span class="toc-number">3.12.0.7.</span> <span class="toc-text">数据代理（Data Proxy）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD"><span class="toc-number">3.12.0.7.1.</span> <span class="toc-text">核心功能</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E7%94%A8%E9%80%94"><span class="toc-number">3.12.0.7.2.</span> <span class="toc-text">常见用途</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81%E7%89%87%E6%AE%B5"><span class="toc-number">3.12.0.7.3.</span> <span class="toc-text">示例代码片段</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">3.12.0.7.4.</span> <span class="toc-text">注意事项</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B1%BB%E4%B8%8E%E6%8E%A5%E5%8F%A3"><span class="toc-number">3.12.0.8.</span> <span class="toc-text">类与接口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#QAbstract3DGraph"><span class="toc-number">3.12.0.9.</span> <span class="toc-text">QAbstract3DGraph</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%BB%E8%A6%81%E5%8A%9F%E8%83%BD"><span class="toc-number">3.12.0.9.1.</span> <span class="toc-text">主要功能</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%B1%9E%E6%80%A7"><span class="toc-number">3.12.0.9.2.</span> <span class="toc-text">常用属性</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95"><span class="toc-number">3.12.0.9.3.</span> <span class="toc-text">常用方法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BF%A1%E5%8F%B7"><span class="toc-number">3.12.0.9.4.</span> <span class="toc-text">信号</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9-2"><span class="toc-number">3.12.0.9.5.</span> <span class="toc-text">注意事项</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Q3DScene%E7%B1%BB"><span class="toc-number">3.12.0.10.</span> <span class="toc-text">Q3DScene类</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%BB%E8%A6%81%E5%8A%9F%E8%83%BD-2"><span class="toc-number">3.12.0.10.1.</span> <span class="toc-text">主要功能</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%B1%9E%E6%80%A7-2"><span class="toc-number">3.12.0.10.2.</span> <span class="toc-text">常用属性</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95-2"><span class="toc-number">3.12.0.10.3.</span> <span class="toc-text">常用方法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BF%A1%E5%8F%B7-2"><span class="toc-number">3.12.0.10.4.</span> <span class="toc-text">信号</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B"><span class="toc-number">3.12.0.10.5.</span> <span class="toc-text">使用示例</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Q3DTheme%E7%B1%BB"><span class="toc-number">3.12.0.11.</span> <span class="toc-text">Q3DTheme类</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%BB%E8%A6%81%E5%8A%9F%E8%83%BD-3"><span class="toc-number">3.12.0.11.1.</span> <span class="toc-text">主要功能</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%B1%9E%E6%80%A7-3"><span class="toc-number">3.12.0.11.2.</span> <span class="toc-text">常用属性</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81"><span class="toc-number">3.12.0.11.3.</span> <span class="toc-text">示例代码</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9-3"><span class="toc-number">3.12.0.11.4.</span> <span class="toc-text">注意事项</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86"><span class="toc-number">3.12.0.12.</span> <span class="toc-text">数据处理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%9A%84%E8%BE%93%E5%85%A5%E4%B8%8E%E8%BE%93%E5%87%BA"><span class="toc-number">3.12.0.13.</span> <span class="toc-text">数据的输入与输出</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E8%BE%93%E5%85%A5"><span class="toc-number">3.12.0.13.1.</span> <span class="toc-text">数据输入</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E8%BE%93%E5%87%BA"><span class="toc-number">3.12.0.13.2.</span> <span class="toc-text">数据输出</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9-4"><span class="toc-number">3.12.0.13.3.</span> <span class="toc-text">注意事项</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%9A%84%E6%9B%B4%E6%96%B0%E4%B8%8E%E5%8A%A8%E6%80%81%E6%98%BE%E7%A4%BA"><span class="toc-number">3.12.0.14.</span> <span class="toc-text">数据的更新与动态显示</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E6%A6%82%E5%BF%B5"><span class="toc-number">3.12.0.14.1.</span> <span class="toc-text">关键概念</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81%E7%89%87%E6%AE%B5-2"><span class="toc-number">3.12.0.14.2.</span> <span class="toc-text">示例代码片段</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9-5"><span class="toc-number">3.12.0.14.3.</span> <span class="toc-text">注意事项</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9B%BE%E5%BD%A2%E8%AE%BE%E7%BD%AE"><span class="toc-number">3.12.0.15.</span> <span class="toc-text">图形设置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%96%E8%A7%82%E5%AE%9A%E5%88%B6%EF%BC%88%E9%A2%9C%E8%89%B2%E3%80%81%E6%9D%90%E8%B4%A8%E7%AD%89%EF%BC%89"><span class="toc-number">3.12.0.16.</span> <span class="toc-text">外观定制（颜色、材质等）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%A2%9C%E8%89%B2%E5%AE%9A%E5%88%B6"><span class="toc-number">3.12.0.16.1.</span> <span class="toc-text">颜色定制</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9D%90%E8%B4%A8%E5%AE%9A%E5%88%B6"><span class="toc-number">3.12.0.16.2.</span> <span class="toc-text">材质定制</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E5%A4%96%E8%A7%82%E5%AE%9A%E5%88%B6"><span class="toc-number">3.12.0.16.3.</span> <span class="toc-text">其他外观定制</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81%E7%89%87%E6%AE%B5-3"><span class="toc-number">3.12.0.16.4.</span> <span class="toc-text">示例代码片段</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%83%E5%B1%80%E4%B8%8E%E5%B0%BA%E5%AF%B8%E8%B0%83%E6%95%B4"><span class="toc-number">3.12.0.17.</span> <span class="toc-text">布局与尺寸调整</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0-3"><span class="toc-number">3.12.0.17.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E6%A6%82%E5%BF%B5-2"><span class="toc-number">3.12.0.17.2.</span> <span class="toc-text">关键概念</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9-6"><span class="toc-number">3.12.0.17.3.</span> <span class="toc-text">注意事项</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%A4%E4%BA%92%E5%8A%9F%E8%83%BD"><span class="toc-number">3.12.0.18.</span> <span class="toc-text">交互功能</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E4%BA%A4%E4%BA%92%E6%96%B9%E5%BC%8F%EF%BC%88%E9%BC%A0%E6%A0%87%E3%80%81%E9%94%AE%E7%9B%98%E7%AD%89%EF%BC%89"><span class="toc-number">3.12.0.19.</span> <span class="toc-text">用户交互方式（鼠标、键盘等）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%BC%A0%E6%A0%87%E4%BA%A4%E4%BA%92"><span class="toc-number">3.12.0.19.1.</span> <span class="toc-text">鼠标交互</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%94%AE%E7%9B%98%E4%BA%A4%E4%BA%92"><span class="toc-number">3.12.0.19.2.</span> <span class="toc-text">键盘交互</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E4%BA%A4%E4%BA%92%E8%A1%8C%E4%B8%BA"><span class="toc-number">3.12.0.19.3.</span> <span class="toc-text">自定义交互行为</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%A4%E4%BA%92%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86"><span class="toc-number">3.12.0.20.</span> <span class="toc-text">交互事件处理</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%97%8B%E8%BD%AC"><span class="toc-number">3.12.0.20.1.</span> <span class="toc-text">旋转</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BC%A9%E6%94%BE"><span class="toc-number">3.12.0.20.2.</span> <span class="toc-text">缩放</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%80%89%E6%8B%A9"><span class="toc-number">3.12.0.20.3.</span> <span class="toc-text">选择</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B9%B3%E7%A7%BB"><span class="toc-number">3.12.0.20.4.</span> <span class="toc-text">平移</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%E6%9C%BA%E5%88%B6"><span class="toc-number">3.12.0.20.5.</span> <span class="toc-text">事件处理机制</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E4%BA%A4%E4%BA%92"><span class="toc-number">3.12.0.20.6.</span> <span class="toc-text">自定义交互</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E6%A1%88%E4%BE%8B"><span class="toc-number">3.12.0.21.</span> <span class="toc-text">应用案例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F"><span class="toc-number">3.12.0.22.</span> <span class="toc-text">简单示例程序</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">3.13.</span> <span class="toc-text">数据库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%90%86delegate"><span class="toc-number">3.13.1.</span> <span class="toc-text">代理delegate</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%A8%8B%E5%BA%8F"><span class="toc-number">3.14.</span> <span class="toc-text">多线程程序</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E4%BA%92%E6%96%A5%E9%87%8F%E7%9A%84%E7%BA%BF%E7%A8%8B%E5%90%8C%E6%AD%A5"><span class="toc-number">3.14.1.</span> <span class="toc-text">基于互斥量的线程同步</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8EQReadWriteLock%E7%9A%84%E7%BA%BF%E7%A8%8B%E5%90%8C%E6%AD%A5"><span class="toc-number">3.14.1.1.</span> <span class="toc-text">基于QReadWriteLock的线程同步</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8EQWaitCondition%E7%9A%84%E7%BA%BF%E7%A8%8B%E5%90%8C%E6%AD%A5"><span class="toc-number">3.14.1.2.</span> <span class="toc-text">基于QWaitCondition的线程同步</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E4%BF%A1%E5%8F%B7%E9%87%8F%E7%9A%84%E7%BA%BF%E7%A8%8B%E5%90%8C%E6%AD%A5"><span class="toc-number">3.14.1.3.</span> <span class="toc-text">基于信号量的线程同步</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2026/01/09/%E6%95%B0%E5%AD%97%E5%AD%AA%E7%94%9F/" title="数字孪生"><img src="https://cdn.jsdelivr.net/gh/Justlovesmile/CDN2/post/cover3.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="数字孪生"/></a><div class="content"><a class="title" href="/2026/01/09/%E6%95%B0%E5%AD%97%E5%AD%AA%E7%94%9F/" title="数字孪生">数字孪生</a><time datetime="2026-01-09T02:28:07.000Z" title="发表于 2026-01-09 10:28:07">2026-01-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2026/01/05/three-js/" title="three_js"><img src="https://cdn.jsdelivr.net/gh/Justlovesmile/CDN2/post/cover4.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="three_js"/></a><div class="content"><a class="title" href="/2026/01/05/three-js/" title="three_js">three_js</a><time datetime="2026-01-05T14:03:18.000Z" title="发表于 2026-01-05 22:03:18">2026-01-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/11/12/unity/" title="unity"><img src="https://hexo-theme-snippet-1251680922.cos.ap-beijing.myqcloud.com/img/banner.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="unity"/></a><div class="content"><a class="title" href="/2025/11/12/unity/" title="unity">unity</a><time datetime="2025-11-12T12:06:59.000Z" title="发表于 2025-11-12 20:06:59">2025-11-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/11/05/OpenGL-Qt/" title="OpenGL-Qt"><img src="https://cdn.jsdelivr.net/gh/Justlovesmile/CDN2/post/cover7.JPG" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="OpenGL-Qt"/></a><div class="content"><a class="title" href="/2025/11/05/OpenGL-Qt/" title="OpenGL-Qt">OpenGL-Qt</a><time datetime="2025-11-05T14:17:53.000Z" title="发表于 2025-11-05 22:17:53">2025-11-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/11/04/%E5%BA%94%E7%94%A8%E5%9E%8B%E6%96%87%E7%AB%A0/" title="应用型文章"><img src="https://cdn.jsdelivr.net/gh/Justlovesmile/CDN2/post/cover4.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="应用型文章"/></a><div class="content"><a class="title" href="/2025/11/04/%E5%BA%94%E7%94%A8%E5%9E%8B%E6%96%87%E7%AB%A0/" title="应用型文章">应用型文章</a><time datetime="2025-11-04T12:39:22.000Z" title="发表于 2025-11-04 20:39:22">2025-11-04</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://cdn.jsdelivr.net/gh/Justlovesmile/CDN2/post/cover4.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2026 By 刘传玺</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.2
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container:not\([display]\)').forEach(node => {
            const target = node.parentNode
            if (target.nodeName.toLowerCase() === 'li') {
              target.parentNode.classList.add('has-jax')
            } else {
              target.classList.add('has-jax')
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '',
      appKey: '',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script><script>function loadDisqus () {
  var disqus_config = function () {
    this.page.url = 'http://chauchy-liu.github.io/2025/02/24/QT-C/'
    this.page.identifier = '/2025/02/24/QT-C/'
    this.page.title = 'QT_C++'
  };

  window.disqusReset = () => {
    DISQUS.reset({
      reload: true,
      config: disqus_config
    })
  }

  if (window.DISQUS) disqusReset()
  else {
    (function() { 
      var d = document, s = d.createElement('script');
      s.src = 'https://.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  }

  document.getElementById('darkmode').addEventListener('click', () => {
    setTimeout(() => window.disqusReset(), 200)
  })
}

if ('Valine' === 'Disqus' || !true) {
  if (true) btf.loadComment(document.getElementById('disqus_thread'), loadDisqus)
  else loadDisqus()
} else {
  function loadOtherComment () {
    loadDisqus()
  }
}
</script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginModelPath":"assets/","model":{"scale":1,"hHeadPos":0.5,"vHeadPos":0.618,"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"left","width":100,"height":200,"vOffset":-80,"hOffset":0},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>